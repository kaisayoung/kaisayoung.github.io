<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>ä¸€ç›´åœ¨è·¯ä¸Š</title>
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://yoursite.com/"/>
  <updated>2017-05-31T17:40:52.000Z</updated>
  <id>http://yoursite.com/</id>
  
  <author>
    <name>Kaisa</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>RxSwiftè¿›é˜¶ï¼Œç»†èŠ‚ä¸UIç»‘å®š</title>
    <link href="http://yoursite.com/2017/05/27/RxSwift-from-zero-to-one-second-lesson/"/>
    <id>http://yoursite.com/2017/05/27/RxSwift-from-zero-to-one-second-lesson/</id>
    <published>2017-05-26T17:12:48.000Z</published>
    <updated>2017-05-31T17:40:52.000Z</updated>
    
    <content type="html"><![CDATA[<p>ä¸Šä¸€ç¯‡ä¸»è¦æ˜¯ä¸€äº›åŸºç¡€æ¦‚å¿µï¼Œè¿™ç¯‡æ¥æ¶‰åŠäº›ç¨å¾®æ·±å¥¥éš¾æ‡‚çš„ã€‚</p>
<p>ä»ç„¶å…ˆæ¥ä¸€å¼ å›¾é•‡å¸–ã€‚</p>
<p><img src="http://ocepn6hgq.bkt.clouddn.com/RxSwift-from-zero-to-one-second-lesson.png" alt="1"></p>
<a id="more"></a>
<h2 id="å¤šçº¿ç¨‹"><a href="#å¤šçº¿ç¨‹" class="headerlink" title="å¤šçº¿ç¨‹"></a>å¤šçº¿ç¨‹</h2><p><code>Schedulers</code>æ˜¯RxSwiftä¸­å¯¹<code>Thread</code>ï¼Œ<code>GCD</code>ï¼Œ<code>OperationQueue</code>ç­‰iOSå¼€å‘ä¸­çº¿ç¨‹ç›¸å…³è¿›è¡Œçš„æŠ½è±¡å’Œå°è£…ã€‚å¯ä»¥è®¤ä¸ºä¸€ä¸ª<code>Scheduler</code>ä»£è¡¨ä¸€ä¸ªçº¿ç¨‹ã€‚</p>
<p>æ¶‰åŠçš„ç±»ä¸»è¦æœ‰ï¼š</p>
<ul>
<li><code>MainScheduler</code> </li>
<li><code>CurrentThreadScheduler</code></li>
<li><code>SerialDispatchQueueScheduler</code></li>
<li><code>ConcurrentDispatchQueueScheduler</code> </li>
<li><code>OperationQueueScheduler</code></li>
</ul>
<p>ä»€ä¹ˆæ„æ€å…¶å®ä»å‘½åä¸Šå°±å¯ä»¥çœ‹å‡ºæ¥ï¼Œä¸å¤šè§£é‡Šäº†ã€‚</p>
<p>æ¶‰åŠçš„æ“ä½œç¬¦æœ‰ä¸¤ä¸ªï¼š</p>
<ul>
<li><a href="http://reactivex.io/documentation/operators/observeon.html" target="_blank" rel="external">observeOn()</a></li>
<li><a href="http://reactivex.io/documentation/operators/subscribeon.html" target="_blank" rel="external">subscribeOn()</a></li>
</ul>
<p>å¹¶ä¸æ˜¯å¾ˆå¥½è§£é‡Šï¼Œè¿˜æ˜¯ç›´æ¥çœ‹ä»£ç å§ã€‚</p>
<p>é¦–å…ˆå®šä¹‰ä¸€ä¸ªè¾…åŠ©å‡½æ•°ï¼š</p>
<pre><code>func myJust(_ element: String) -&gt; Observable&lt;String&gt; {
    print(&quot;Creating an Observable in thread : \(Thread.current)&quot;)
    return Observable.create { observer in
        print(&quot;Emitting one Event in thread : \(Thread.current)&quot;)
        observer.on(.next(element))
        observer.on(.completed)
        return Disposables.create()
    }
}
</code></pre><p>ä½œç”¨å’ŒRxSwiftè‡ªå¸¦çš„<code>Just</code>æ“ä½œç¬¦ä¸€æ ·ï¼Œåªæ˜¯é¢å¤–å¤šäº†ä¸¤è¡Œæ‰“å°ä»£ç ã€‚</p>
<p>ğŸŒ°1:</p>
<pre><code>print(&quot;Subscribing an Observable in thread : \(Thread.current)&quot;)
myJust(&quot;ğŸ&quot;)
    .do(onNext: { print(&quot;Intercepted \($0) in thread : \(Thread.current)&quot;) }
        , onError: nil, onCompleted: nil
    )
    .filter({
        print(&quot;Filtering \($0) in thread : \(Thread.current)&quot;)
        return $0 != &quot;ğŸ&quot;
    })
    .subscribe(onNext: {
        print(&quot;Receiving \($0) in thread : \(Thread.current)&quot;)
    })
    .disposed(by: disposeBag)
</code></pre><p>ç»“æœ1:</p>
<pre><code>Subscribing an Observable in thread : &lt;NSThread: 0x608000078f40&gt;{number = 1, name = main}
Creating an Observable in thread : &lt;NSThread: 0x608000078f40&gt;{number = 1, name = main}
Emitting one Event in thread : &lt;NSThread: 0x608000078f40&gt;{number = 1, name = main}
Intercepted ğŸ in thread : &lt;NSThread: 0x608000078f40&gt;{number = 1, name = main}
Filtering ğŸ in thread : &lt;NSThread: 0x608000078f40&gt;{number = 1, name = main}
Receiving ğŸ in thread : &lt;NSThread: 0x608000078f40&gt;{number = 1, name = main}
</code></pre><p>è§‚å¯Ÿç»“æœå¯ä»¥å‘ç°ï¼š</p>
<ol>
<li>ä»£ç æ‰§è¡Œé¡ºåºä¸ºï¼šè®¢é˜…-åˆ›å»º-å‘é€-æ‹¦æˆª-è¿‡æ»¤-æ¥æ”¶ï¼Œæ‰€æœ‰ä»£ç çš„æ‰§è¡Œéƒ½å‘ç”Ÿåœ¨åŒä¸€ä¸ªçº¿ç¨‹ä¸­ ï¼›</li>
</ol>
<p>è§£é‡Šä¸€ä¸‹ä¸Šé¢ä»£ç ï¼š</p>
<ol>
<li>è®¢é˜…ä½œä¸ºåˆå§‹æ­¥éª¤ï¼Œæ‰€åœ¨çš„ä¸Šä¸‹æ–‡ç¯å¢ƒæ˜¯ä¸»çº¿ç¨‹ï¼Œå¯¼è‡´æ¥ä¸‹æ¥çš„æ‰€æœ‰æ­¥éª¤éƒ½æ˜¯å‘ç”Ÿåœ¨ä¸»çº¿ç¨‹ï¼šä¹Ÿå°±æ˜¯è¯´é»˜è®¤æƒ…å†µä¸‹åœ¨å“ªä¸ªçº¿ç¨‹è®¢é˜…ä¸€ä¸ª<code>Observable</code>ï¼Œä¹‹åæ‰€æœ‰ä»£ç éƒ½ä¼šåœ¨åŒä¸€ä¸ªçº¿ç¨‹ä¸­æ‰§è¡Œã€‚</li>
</ol>
<p>ğŸŒ°2:</p>
<pre><code>let serialScheduler1 = SerialDispatchQueueScheduler(internalSerialQueueName: &quot;com.kaisa.gcdqueue1&quot;)  
let serialScheduler2 = SerialDispatchQueueScheduler(internalSerialQueueName: &quot;com.kaisa.gcdqueue2&quot;)  // 1

print(&quot;Subscribing an Observable in thread : \(Thread.current)&quot;)
myJust(&quot;ğŸ&quot;)
    .do(onNext: { print(&quot;Intercepted \($0) in thread : \(Thread.current)&quot;) }
        , onError: nil, onCompleted: nil
    )
    .observeOn(serialScheduler1)  // 2
    .filter({
        print(&quot;Filtering \($0) in thread : \(Thread.current)&quot;)
        return $0 != &quot;ğŸ&quot;
    })
    .observeOn(serialScheduler2)  // 2
    .map({ fruit in
        print(&quot;Mapping \(fruit) in thread : \(Thread.current)&quot;)
        return &quot;ğŸŠ&quot;
    })
    .observeOn(MainScheduler.instance)  // 3
    .subscribe(onNext: { (fruit: String) in
        print(&quot;Receiving \(fruit) in thread : \(Thread.current)&quot;)
    })
    .disposed(by: disposeBag)    
</code></pre><p>ç»“æœ2:</p>
<pre><code>Subscribing an Observable in thread : &lt;NSThread: 0x60000007e440&gt;{number = 1, name = main}
Creating an Observable in thread : &lt;NSThread: 0x60000007e440&gt;{number = 1, name = main}
Emitting one Event in thread : &lt;NSThread: 0x60000007e440&gt;{number = 1, name = main}
Intercepted ğŸ in thread : &lt;NSThread: 0x60000007e440&gt;{number = 1, name = main}
Filtering ğŸ in thread : &lt;NSThread: 0x600000470c40&gt;{number = 3, name = (null)}
Mapping ğŸ in thread : &lt;NSThread: 0x608000671200&gt;{number = 4, name = (null)}
Receiving ğŸŠ in thread : &lt;NSThread: 0x60000007ee40&gt;{number = 1, name = main}
</code></pre><p>è§‚å¯Ÿç»“æœå¯ä»¥å‘ç°ï¼š</p>
<ol>
<li>ä»£ç æ‰§è¡Œé¡ºåºå¹¶æ²¡æœ‰æ”¹å˜ï¼Œä½†æ˜¯å´å‘ç”Ÿåœ¨ä¸‰ä¸ªä¸åŒçš„çº¿ç¨‹ä¸­ ï¼›</li>
</ol>
<p>è§£é‡Šä¸€ä¸‹ä¸Šé¢ä»£ç ï¼š</p>
<ol>
<li>åˆ›å»ºä¸¤ä¸ªå’Œçº¿ç¨‹å¯¹åº”çš„<code>Scheduler</code>å¯¹è±¡ï¼ˆæ­¤ä¾‹å­ä¸­åº”ç”¨çš„æ˜¯GCDçš„ä¸²è¡Œé˜Ÿåˆ—ï¼‰ï¼›</li>
<li>å¯¹<code>observeOn()</code>æ“ä½œç¬¦ä¼ å…¥<code>Scheduler</code>å¯¹è±¡å¯ä»¥æ”¹å˜äº‹ä»¶æ¥å—æ—¶ä»£ç æ‰§è¡Œæ‰€åœ¨çš„çº¿ç¨‹ï¼šä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªæ“ä½œç¬¦ä¼šæ”¹å˜<code>Observable</code>å¯¹å¤–å‘é€äº‹ä»¶æ—¶ä½¿ç”¨çš„çº¿ç¨‹ï¼Œå¯¼è‡´ä¹‹åæ¥æ”¶åˆ°è¿™ä¸ªäº‹ä»¶æ—¶ä¹Ÿä¼šåœ¨ç›¸åŒçº¿ç¨‹ä¸­ ï¼›</li>
<li>é€šå¸¸éƒ½æ˜¯åœ¨ä¸»çº¿ç¨‹ä¸­è®¢é˜…ä¸€ä¸ª<code>Observable</code>ï¼Œç„¶åå›è°ƒä¹Ÿå’ŒUIç›¸å…³ï¼Œæ‰€ä»¥å¦‚æœä¸­é€”åç¦»äº†ä¸»çº¿ç¨‹æœ€åéƒ½è¦è½¬å›æ¥ ï¼›</li>
<li>åœ¨ä¸€æ®µä»£ç ä¸²ä¸­å¯ä»¥åŒæ—¶ä½¿ç”¨å¤šæ¬¡<code>observeOn()</code>æ“ä½œç¬¦ã€‚</li>
</ol>
<p>ğŸŒ°3:</p>
<pre><code>let serialScheduler = SerialDispatchQueueScheduler(internalSerialQueueName: &quot;com.kaisa.gcdqueue&quot;)  // 1

print(&quot;Subscribing an Observable in thread : \(Thread.current)&quot;)
myJust(&quot;ğŸ&quot;)
    .do(onNext: { print(&quot;Intercepted \($0) in thread : \(Thread.current)&quot;) }
        , onError: nil, onCompleted: nil
    )
    .map({ fruit in
        print(&quot;Mapping \(fruit) in thread : \(Thread.current)&quot;)
        return &quot;ğŸ‹&quot;
    })
    .subscribeOn(serialScheduler)  // 2
    .observeOn(MainScheduler.instance)  // 3
    .subscribe(onNext: { (fruit: String) in
        print(&quot;Receiving \(fruit) in thread : \(Thread.current)&quot;)
    })
    .disposed(by: disposeBag)
</code></pre><p>ç»“æœ3:</p>
<pre><code>Subscribing an Observable in thread : &lt;NSThread: 0x60000006fec0&gt;{number = 1, name = main}
Creating an Observable in thread : &lt;NSThread: 0x60000006fec0&gt;{number = 1, name = main}
Emitting one Event in thread : &lt;NSThread: 0x60000046e2c0&gt;{number = 3, name = (null)}
Intercepted ğŸ in thread : &lt;NSThread: 0x60000046e2c0&gt;{number = 3, name = (null)}
Mapping ğŸ in thread : &lt;NSThread: 0x60000046e2c0&gt;{number = 3, name = (null)}
Receiving ğŸ‹ in thread : &lt;NSThread: 0x60000006fec0&gt;{number = 1, name = main}
</code></pre><p>è§‚å¯Ÿç»“æœå¯ä»¥å‘ç°ï¼š</p>
<ol>
<li>ä»£ç æ‰§è¡Œé¡ºåºä¾ç„¶æ²¡æœ‰æ”¹å˜ï¼Œä½†æ˜¯å´å‘ç”Ÿåœ¨ä¸¤ä¸ªä¸åŒçš„çº¿ç¨‹ä¸­ ï¼›</li>
</ol>
<p>è§£é‡Šä¸€ä¸‹ä¸Šé¢ä»£ç ï¼š</p>
<ol>
<li>åˆ›å»ºä¸€ä¸ªå’Œçº¿ç¨‹å¯¹åº”çš„<code>Scheduler</code>å¯¹è±¡ ï¼›</li>
<li>å¯¹<code>subscribeOn()</code>æ“ä½œç¬¦ä¼ å…¥<code>Scheduler</code>å¯¹è±¡å¯ä»¥æ”¹å˜åˆ›å»º<code>Observable</code>ä¹‹åæ‰€æœ‰ä»£ç æ‰§è¡Œæ‰€åœ¨çš„çº¿ç¨‹ï¼šä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªæ“ä½œç¬¦ä¼šä»æºå¤´ä¸Šæ”¹å˜ä»£ç æ‰§è¡Œæ‰€åœ¨çš„ç¯å¢ƒï¼Œæ¯”<code>observeOn()</code>èµ·ä½œç”¨çš„æ—¶æœºè¦æ—© ï¼›</li>
<li>åº”ç”¨<code>observeOn()</code>æ“ä½œç¬¦ä¼ å…¥<code>MainScheduler.instance</code>ä½¿å¾—æœ€åçš„å›è°ƒä¾ç„¶å‘ç”Ÿåœ¨ä¸»çº¿ç¨‹ ï¼›</li>
<li><code>subscribeOn()</code>æ“ä½œç¬¦å¹¶ä¸å¸¸ç”¨ã€‚</li>
</ol>
<p>ğŸŒ°4:</p>
<pre><code>let serialScheduler = SerialDispatchQueueScheduler(internalSerialQueueName: &quot;com.kaisa.gcdqueue&quot;)

let observable = Observable.just(&quot;ğŸ&quot;).delay(1.0, scheduler: serialScheduler)  // 1

print(&quot;Subscribing an Observable in thread : \(Thread.current)&quot;)
observable
    .do(onNext: { print(&quot;Intercepted \($0) in thread : \(Thread.current)&quot;) }
        , onError: nil, onCompleted: nil
    )
    .map({ fruit in
        print(&quot;Mapping \(fruit) in thread : \(Thread.current)&quot;)
        return &quot;ğŸ&quot;
    })
    .observeOn(MainScheduler.instance) 
    .subscribe(onNext: { (fruit: String) in
        print(&quot;Receiving \(fruit) in thread : \(Thread.current)&quot;)
    })
    .disposed(by: disposeBag)
</code></pre><p>ç»“æœ4:</p>
<pre><code>Subscribing an Observable in thread : &lt;NSThread: 0x600000076c80&gt;{number = 1, name = main}
Intercepted ğŸ in thread : &lt;NSThread: 0x60800047c180&gt;{number = 3, name = (null)}
Mapping ğŸ in thread : &lt;NSThread: 0x60800047c180&gt;{number = 3, name = (null)}
Receiving ğŸ in thread : &lt;NSThread: 0x600000076c80&gt;{number = 1, name = main}
</code></pre><p>è§‚å¯Ÿç»“æœå¯ä»¥å‘ç°ï¼š</p>
<ol>
<li>åº”ç”¨RxSwiftæä¾›çš„ä¾¿æ·åˆ›å»º<code>Observable</code>çš„æ–¹æ³•æ—¶ï¼Œåˆ›å»º&amp;å‘é€ä¸¤ä¸ªæ—¶æœºå°±ä¸èƒ½ç›´æ¥æ§åˆ¶äº† ï¼›</li>
</ol>
<p>è§£é‡Šä¸€ä¸‹ä¸Šé¢ä»£ç ï¼š</p>
<ol>
<li>åˆ›å»ºä¸€ä¸ª<code>Observable</code>æ—¶é€šè¿‡è°ƒç”¨<code>delay</code>æ“ä½œç¬¦å¯ä»¥ä¼ å…¥ä¸€ä¸ª<code>Scheduler</code>å¯¹è±¡ï¼Œä½œç”¨ç±»ä¼¼äºä¸Šé¢çš„<code>subscribeOn()</code>ï¼Œæ‰€ä»¥æ­¤æ—¶æ— é¡»è°ƒç”¨<code>subscribeOn()</code>äº†ã€‚</li>
</ol>
<p>PSï¼šè¿˜è®°å¾—ä¸Šä¸€ç¯‡æ–‡ç« ä¸­æåˆ°çš„<code>interval</code>æ“ä½œç¬¦ä¹ˆï¼Ÿä½¿ç”¨æ–¹å¼ç±»ä¼¼è¿™æ ·ï¼š</p>
<pre><code>Observable&lt;Int&gt;
    .interval(0.3, scheduler: MainScheduler.instance)
    .subscribe (onNext: { print($0) })
    .disposed(by: disposeBag)
</code></pre><p>å®ç°å›ºå®šæ—¶é—´é—´éš”å‘é€ä¸€ä¸ªäº‹ä»¶ï¼ˆåœ¨è¿™é‡Œæ˜¯ä¸€ä¸ªæ•´æ•°ï¼‰çš„åŠŸèƒ½ï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯<code>interval</code>æ“ä½œç¬¦ä¹Ÿè¦ä¼ å…¥ä¸€ä¸ª<code>Scheduler</code>å¯¹è±¡ï¼Œæ„æ€å’Œä¸Šé¢ä¾‹å­ä¸­ä¸€æ ·ï¼Œç›¸ä¿¡ä½ å·²ç»ç†è§£äº†ã€‚</p>
<h2 id="Cold-amp-Hot"><a href="#Cold-amp-Hot" class="headerlink" title="Cold &amp; Hot"></a>Cold &amp; Hot</h2><p>åœ¨swiftè¯­è¨€ä¸Šå¦ä¸€ä¸ªéå¸¸å¼ºå¤§çš„FRPæ¡†æ¶RACä¸­å’ŒRxSwiftä¸­Observableç›¸å¯¹åº”çš„æ¦‚å¿µæ˜¯signalï¼Œç¿»è¯‘è¿‡æ¥å°±æ˜¯ä¿¡å·ã€‚RACä¸­æ˜ç¡®å°†ä¿¡å·åˆ†ä¸ºä¸¤ç§ï¼Œå³ï¼šå†·ä¿¡å·å’Œçƒ­ä¿¡å·ï¼Œå®ƒä»¬æ˜¯ä¸¤ç§ä¸åŒçš„ç±»å‹ã€‚é‚£ä¹ˆåœ¨RxSwiftä¸­æœ‰æ²¡æœ‰<code>Cold Observable</code> å’Œ <code>Hot Observable</code>ä¹‹åˆ†å‘¢ï¼Ÿå…¶å®ä¹Ÿæ˜¯æœ‰çš„ã€‚</p>
<p>åœ¨<a href="http://reactivex.io/documentation/observable.html" target="_blank" rel="external">ReactiveX.io</a>ä¸­æœ‰å¦‚ä¸‹ä¸€æ®µè¯´æ˜æ–‡å­—ï¼š</p>
<blockquote>
<p>â€œHotâ€ and â€œColdâ€ Observables</p>
<p>When does an Observable begin emitting its sequence of items? It depends on the Observable. A â€œhotâ€ Observable may begin emitting items as soon as it is created, and so any observer who later subscribes to that Observable may start observing the sequence somewhere in the middle. A â€œcoldâ€ Observable, on the other hand, waits until an observer subscribes to it before it begins to emit items, and so such an observer is guaranteed to see the whole sequence from the beginning.</p>
<p>In some implementations of ReactiveX, there is also something called a â€œConnectableâ€ Observable. Such an Observable does not begin emitting items until its Connect method is called, whether or not any observers have subscribed to it.</p>
</blockquote>
<p>å…³é”®åŒºåˆ«ç‚¹åœ¨äº<code>Observable</code>å¼€å§‹å‘é€äº‹ä»¶çš„æ—¶æœºã€‚å¦‚æœå®ƒè¢«åˆ›å»ºåæ— è®ºæœ‰æ²¡æœ‰è¢«è®¢é˜…éƒ½ç«‹å³å‘é€é‚£ä¹ˆå®ƒå°±æ˜¯ä¸€ä¸ªçƒ­çš„<code>Observable</code>ï¼Œå¦‚æœåªæœ‰è¢«è®¢é˜…åæ‰å¼€å§‹å‘é€é‚£ä¹ˆå®ƒå°±æ˜¯ä¸€ä¸ªå†·çš„<code>Observable</code>ã€‚è€Œè¿™å…¶å®ä¼šå¼•ç”³å‡ºå¦ä¸€ä¸ªæ›´é‡è¦çš„é—®é¢˜ï¼šä¸åŒè®¢é˜…è€…åœ¨ä¸åŒæ—¶é—´ç‚¹è®¢é˜…åŒä¸€ä¸ªæº<code>Observable</code>ï¼Œå®ƒä»¬æ¥æ”¶åˆ°çš„æ˜¯å¦æ˜¯è¿™ä¸ªæº<code>Observable</code>å‘é€çš„å…¨éƒ¨äº‹ä»¶ã€‚æ–°çš„è®¢é˜…è€…è®¢é˜…äº†ä¸€ä¸ªçƒ­çš„<code>Observable</code>ååªä¼šæ¥æ”¶åˆ°ä¹‹åå‘å‡ºçš„äº‹ä»¶ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸åŒè®¢é˜…è€…ä¹‹é—´å…±äº«åŒä¸€ä¸ªæº<code>Observable</code>ï¼›è€Œè®¢é˜…äº†ä¸€ä¸ªå†·çš„<code>Observable</code>åä¼šå®Œæ•´æ¥æ”¶åˆ°å‘å‡ºçš„å…¨éƒ¨äº‹ä»¶ï¼Œä¹Ÿå°±æ˜¯è¯´æ¯ä¸€ä¸ªè®¢é˜…è€…å¯¹åº”ç€ä¸€ä¸ªå•ç‹¬çš„æº<code>Observable</code>ã€‚</p>
<p>ä¸¾ä¸ªä¸æ˜¯ååˆ†æ°å½“çš„ä¾‹å­ï¼šå®ƒä»¬ä¹‹é—´æœ‰ç‚¹åƒç«è½¦å’Œå‡ºç§Ÿè½¦çš„å…³ç³»ï¼Œä¸€åˆ—ç«è½¦å‡ºå‘çš„æ—¶é—´ç‚¹ä»¥åŠç»è¿‡å“ªäº›ç«™éƒ½æ˜¯æå‰å°±å®šå¥½äº†çš„ï¼ˆå¿½ç•¥æ™šç‚¹åŠå…¶ä»–ç‰¹æ®Šæƒ…å†µï¼‰ï¼Œå®ƒä¸ä¼šå› æœ‰æ²¡æœ‰ä¹˜å®¢æœ‰å¤šå°‘ä¹˜å®¢è€Œæ”¹å˜ï¼Œæ‰€æœ‰ä¹˜å®¢å…±äº«è¿™ä¸€åˆ—ç«è½¦ï¼Œä¸€ä¸ªä¹˜å®¢è‹¥ä¸Šä¸€ç«™æ²¡æœ‰èµ¶ä¸Šåˆ™åªèƒ½å»ä¸‹ä¸€ç«™ä¸Šè½¦äº†ï¼›è€Œå‡ºç§Ÿè½¦å‘¢ï¼Œä»»ä½•ä¸€å®šæ—¶é—´å†…å¯¹äºä¸€ä¸ªä¹˜å®¢è€Œè¨€éƒ½æ˜¯ä¸€ä¸€å¯¹åº”çš„ï¼ˆæš‚ä¸è€ƒè™‘å¤šäººå…±æ‰“ä¸€è¾†è½¦çš„æƒ…å†µï¼‰ï¼ŒAæƒ³ä»æµ·æ·€å»æœé˜³éœ€è¦æ‰“ä¸€è¾†è½¦ï¼ŒBä¹Ÿæƒ³ä»æµ·æ·€å»æœé˜³åˆ™éœ€è¦æ‰“å¦å¤–ä¸€è¾†è½¦ï¼Œå®ƒä»¬å½¼æ­¤ä¹‹é—´ç›¸äº’ç‹¬ç«‹ï¼Œä¹Ÿå°±æ˜¯ä¸å…±äº«ã€‚</p>
<p>æ ¸å¿ƒå…³é”®å°±æ˜¯ä¸€ä¸ªè¯ï¼šå…±äº«ã€‚</p>
<p>è¿˜è®°å¾—ä¸Šä¸€ç¯‡ä»‹ç»å¯è¿æ¥çš„<code>Observable</code>æ—¶æ¶‰åŠåˆ°çš„è¿æ¥æ“ä½œç¬¦ä¹ˆï¼Œå°¤å…¶æ˜¯<code>replay</code>ï¼Œå¿˜äº†çš„è¯ç¿»å›å»å¤ä¹ ä¸€éï¼Œå¯¹æ¥ä¸‹æ¥çš„ç†è§£å¾ˆæœ‰å¸®åŠ©ã€‚</p>
<p>ä¸‹é¢ç›´æ¥çœ‹ä»£ç ã€‚</p>
<p>é¦–å…ˆå®šä¹‰ä¸€ä¸ªè¾…åŠ©å‡½æ•°ï¼š</p>
<pre><code>func myInterval(_ interval: TimeInterval) -&gt; Observable&lt;Int&gt; {
    return Observable.create { observer in
        print(&quot;Subscribed&quot;)
        let timer = DispatchSource.makeTimerSource(queue: DispatchQueue.global())
        timer.scheduleRepeating(deadline: DispatchTime.now() + interval, interval: interval)

        let cancel = Disposables.create {
            print(&quot;Disposed&quot;)
            timer.cancel()
        }

        var next = 0
        timer.setEventHandler {
            if cancel.isDisposed {
                return
            }
            observer.on(.next(next))
            next += 1
        }
        timer.resume()

        return cancel
    }
}
</code></pre><p>å¦‚æœçœ‹ä¸æ‡‚ä¹Ÿæ²¡å…³ç³»ï¼Œä¸ç”¨å…³å¿ƒå¤ªå¤šç»†èŠ‚ï¼Œåªè¦ç†è§£å®ƒæ˜¯ä»¿ç…§RxSwiftæä¾›çš„<code>interval</code>æ“ä½œç¬¦ï¼Œå®ç°é—´éš”ä¸€å®šæ—¶é—´å‘é€ä¸€ä¸ªæ•´å½¢å˜é‡çš„åŠŸèƒ½å°±å¯ä»¥äº†ã€‚</p>
<p>ğŸŒ°1:</p>
<pre><code>let observable = myInterval(1)

print(&quot;Started ----&quot;)

let subscription1 = observable
    .subscribe(onNext: { n in
        print(&quot;First \(n)&quot;)
    })

Thread.sleep(forTimeInterval: 2)

let subscription2 = observable
    .subscribe(onNext: { n in
        print(&quot;Second \(n)&quot;)
    })

Thread.sleep(forTimeInterval: 3)

subscription1.dispose()

Thread.sleep(forTimeInterval: 4)

subscription2.dispose()

print(&quot;Ended ----&quot;)
</code></pre><p>ç»“æœ1ï¼š</p>
<pre><code>Started ----
Subscribed
First 0
First 1
Subscribed
First 2
Second 0
First 3
Second 1
First 4
Second 2
Disposed
Second 3
Second 4
Second 5
Second 6
Disposed
Ended ----
</code></pre><p>è§‚å¯Ÿç»“æœå¯ä»¥å‘ç°ï¼š</p>
<ol>
<li><code>observable</code>åœ¨è¢«è®¢é˜…ä¹‹åæ¯é—´éš”1séƒ½ä¼šå‘é€ä¸€ä¸ªæ•´å½¢æ•° ï¼›</li>
<li>è®¢é˜…è€…1 <code>subscription1</code> åœ¨è®¢é˜…çš„5sæ—¶é—´å†…å…±æ¥æ”¶åˆ°5æ¡æ•°æ®ï¼Œè®¢é˜…è€…2 <code>subscription2</code> åœ¨è®¢é˜…çš„7sæ—¶é—´å†…å…±æ¥æ”¶åˆ°7æ¡æ•°æ®ï¼Œä¸€å¦‚é¢„æœŸ ï¼›</li>
<li><code>Subscribed</code> å’Œ <code>Disposed</code>åˆ†åˆ«éƒ½è¢«æ‰“å°äº†ä¸¤æ¬¡ï¼Œè®¢é˜…è€…1å’Œè®¢é˜…è€…2æ¥æ”¶åˆ°çš„æ•´å½¢æ•°éƒ½æ˜¯ä»0å¼€å§‹çš„ ï¼›</li>
</ol>
<p>è§£é‡Šä¸€ä¸‹ä¸Šé¢ä»£ç ï¼š</p>
<ol>
<li><code>Subscribed</code> å’Œ <code>Disposed</code>åˆ†åˆ«éƒ½è¢«æ‰“å°äº†ä¸¤æ¬¡ï¼Œè¯æ˜æº<code>observable</code>å†…éƒ¨çš„åˆ›å»ºæµç¨‹ä¹Ÿèµ°äº†ä¸¤æ¬¡ ï¼›</li>
<li>è®¢é˜…è€…2åœ¨2såæ‰è®¢é˜…ä¹Ÿæ˜¯ä»0å¼€å§‹æ¥æ”¶åˆ°æ•°æ®ï¼Œè¯æ˜æ¯ä¸€ä¸ªè®¢é˜…è€…éƒ½å¯¹åº”ä¸€ä¸ªæº<code>observable</code>ã€‚</li>
</ol>
<p>è¿™å°±æ˜¯ä¸€ç§å…¸å‹çš„<code>Cold Observable</code>çš„ä½¿ç”¨æ–¹å¼ã€‚é‚£ä¹ˆåˆ°åº•è¿™ç§æ–¹å¼æœ‰ä»€ä¹ˆå¼Šç«¯æˆ–è€…è¯´ä¸æ»¡è¶³ä»€ä¹ˆæƒ…å†µå‘¢ï¼Ÿ</p>
<p>ä¸€åˆ‡å–å†³äº<code>observable</code>å†…éƒ¨å‘é€äº‹ä»¶çš„æœºåˆ¶ï¼Œåƒä¸Šé¢ä¾‹å­ä¸­åªæ˜¯é—´éš”å›ºå®šæ—¶é—´å‘é€ä¸€ä¸ªæ•´å½¢æ•°ï¼Œå¯¹å¤–ç•Œå¹¶ä¸ä¼šäº§ç”Ÿä»»ä½•å½±å“ï¼Œæ‰€ä»¥å¹¶æ²¡æœ‰é—®é¢˜ã€‚ä½†æ˜¯è€ƒè™‘è¿™ä¹ˆä¸€ç§æƒ…å†µï¼šæº<code>observable</code>è¢«è®¢é˜…åä¼šè§¦å‘ä¸€ä¸ªç½‘ç»œè¯·æ±‚ï¼Œç„¶åæ ¹æ®è¯·æ±‚ç»“æœå†³å®šå¯¹å¤–å‘é€çš„æ•°æ®ï¼Œä¸¤ä¸ªè®¢é˜…è€…åˆ†åˆ«æ˜¯ä¸¤ä¸ªUIæ§ä»¶ï¼Œå®ƒä»¬ç­‰å¾…æº<code>observable</code>å‘å‡ºæ•°æ®è¿›è¡Œåˆ·æ–°ã€‚é‚£ä¹ˆç”¨ä¸Šé¢è¿™ç§æ–¹å¼ä¼šå¯¼è‡´ç½‘ç»œè¯·æ±‚å‘é€ä¸¤æ¬¡ï¼Œä»è€Œæœ‰å¯èƒ½é€ æˆUIåˆ·æ–°ä¸ä¸€è‡´ï¼Œæµªè´¹æµé‡ï¼Œæ•°æ®ç»Ÿè®¡é”™è¯¯ç­‰ä¸€ç³»åˆ—é—®é¢˜ã€‚æœ‰äº›æ–‡ç« ä¸­ä¼šè¯´è¿™æ˜¯ä¸€ç§â€œå‰¯ä½œç”¨â€ï¼Œå«ä»€ä¹ˆåå­—æ— æ‰€è°“ï¼Œé¢†ä¼šç²¾ç¥å°±å¥½ã€‚</p>
<p>é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œæ€ä¹ˆæ ·è§£å†³è¿™ç§é—®é¢˜å‘¢ï¼Ÿç­”æ¡ˆå¾ˆç®€å•ï¼Œæœ‰ä¸€ä¸ªæ–°çš„æ“ä½œç¬¦æ˜¯ï¼š<a href="http://reactivex.io/documentation/operators/replay.html" target="_blank" rel="external">shareReplay()</a>ã€‚</p>
<h3 id="shareReplay"><a href="#shareReplay" class="headerlink" title="shareReplay"></a>shareReplay</h3><p>æ¥çœ‹ä¸‹é¢çš„ğŸŒ°2:</p>
<pre><code>let observable = myInterval(1).shareReplay(1)  // 1

print(&quot;Started ----&quot;)

let subscription1 = observable
    .subscribe(onNext: { n in
        print(&quot;First \(n)&quot;)
    })

Thread.sleep(forTimeInterval: 2)

let subscription2 = observable
    .subscribe(onNext: { n in
        print(&quot;Second \(n)&quot;)
    })

Thread.sleep(forTimeInterval: 3)

subscription1.dispose()

Thread.sleep(forTimeInterval: 4)

subscription2.dispose()

print(&quot;Ended ----&quot;)
</code></pre><p>ç»“æœ2ï¼š</p>
<pre><code>Started ----
Subscribed
First 0
First 1
Second 1
First 2
Second 2
First 3
Second 3
First 4
Second 4
Second 5
Second 6
Second 7
Second 8
Disposed
Ended ----
</code></pre><p>è§‚å¯Ÿç»“æœå¯ä»¥å‘ç°ï¼š</p>
<ol>
<li><code>observable</code>åœ¨è¢«è®¢é˜…ä¹‹åä»ç„¶æ¯é—´éš”1så‘é€ä¸€ä¸ªæ•´å½¢æ•° ï¼›</li>
<li>è®¢é˜…è€…1 <code>subscription1</code> åœ¨è®¢é˜…çš„5sæ—¶é—´å†…å…±æ¥æ”¶åˆ°5æ¡æ•°æ®ï¼Œè€Œä¸”æ˜¯ä»0å¼€å§‹çš„ï¼Œå’Œä¹‹å‰ä¸€æ · ï¼›</li>
<li>è®¢é˜…è€…2 <code>subscription2</code> åœ¨è®¢é˜…çš„7sæ—¶é—´å†…å…±æ¥æ”¶åˆ°8æ¡æ•°æ®ï¼Œæ¯”ä¹‹å‰å¤šä¸€æ¡ï¼Œè€Œä¸”æ˜¯ä»1å¼€å§‹çš„ï¼Œå’Œä¹‹å‰ä¸ä¸€æ · ï¼›</li>
<li><code>Subscribed</code> å’Œ <code>Disposed</code>åˆ†åˆ«éƒ½åªè¢«æ‰“å°äº†ä¸€æ¬¡ ï¼›</li>
</ol>
<p>è§£é‡Šä¸€ä¸‹ä¸Šé¢ä»£ç ï¼š</p>
<ol>
<li>å’Œä¸Šé¢ä¾‹å­å”¯ä¸€çš„åŒºåˆ«æ˜¯åº”ç”¨äº†<code>shareReplay()</code>æ“ä½œç¬¦å¹¶ä¸”ä¼ å…¥äº†ä¸€ä¸ª1ä½œä¸ºå‚æ•° ï¼›</li>
<li><code>Subscribed</code> å’Œ <code>Disposed</code>åˆ†åˆ«éƒ½åªè¢«æ‰“å°äº†ä¸€æ¬¡ï¼Œè¯æ˜æºobservableå†…éƒ¨çš„åˆ›å»ºæµç¨‹åªèµ°äº†ä¸€æ¬¡ ï¼›</li>
<li>è®¢é˜…è€…2åœ¨2såå¼€å§‹è®¢é˜…ç„¶åç«‹åˆ»æ¥æ”¶åˆ°çš„ç¬¬ä¸€ä¸ªæ•°æ®æ˜¯1æ˜¯å› ä¸ºç»è¿‡äº†<code>shareReplay(1)</code>ä¹‹åçš„<code>observable</code>å†…éƒ¨ä¼šä¿å­˜å½“å‰å‘é€çš„æœ€åä¸€æ¡æ•°æ®ï¼Œå½“æœ‰æ–°çš„è®¢é˜…è€…è®¢é˜…ä¹‹åé¦–å…ˆå°†æœ€åä¸€æ¡å†å‘é€ç»™å®ƒï¼Œä¹Ÿå°±æ˜¯è¯´ç»è¿‡<code>shareReplay(1)</code>ä¹‹åä¸€ä¸ªæ— çŠ¶æ€çš„<code>observable</code>ä¼šå˜ä¸ºæœ‰çŠ¶æ€çš„<code>observable</code> ï¼›</li>
<li>è®¢é˜…è€…2åœ¨æ”¶åˆ°1ä¹‹ååˆå’Œè®¢é˜…è€…1åŒæ—¶é™†ç»­æ”¶åˆ°äº†æ•´æ•°2ï¼Œ3ï¼Œ4ï¼Œè¯æ˜å’Œä¸¤ä¸ªè®¢é˜…è€…ä¹‹é—´ç¡®å®å…±äº«ç€åŒä¸€ä¸ªæº<code>Observable</code>ã€‚</li>
</ol>
<p>å»ºè®®è¯»è€…å†å‘<code>shareReplay()</code>ä¸­åˆ†åˆ«ä¼ å…¥0å’Œ2å¯¹æ¯”è§‚å¯Ÿä¸€ä¸‹è¾“å‡ºç»“æœã€‚</p>
<p>å¯è§ï¼Œé€šè¿‡ä½¿ç”¨<code>shareReplay()</code>ä½¿å¾—å¤šä¸ªè®¢é˜…è€…ä¹‹é—´å…±äº«åŒä¸€ä¸ªæº<code>Observable</code>å°±å®Œç¾çš„è§£å†³äº†ä¸Šé¢ä¾‹å­ä¸­ä½¿ç”¨<code>Cold Observable</code>æ‰€å¸¦æ¥çš„é—®é¢˜ï¼Œæ­¤æ—¶å°±å˜æˆäº†<code>Hot Observable</code>ã€‚</p>
<h3 id="shareReplayLatestWhileConnected"><a href="#shareReplayLatestWhileConnected" class="headerlink" title="shareReplayLatestWhileConnected"></a>shareReplayLatestWhileConnected</h3><p><code>shareReplay</code> è¿˜æœ‰ä¸€ä¸ªå…„å¼Ÿæ“ä½œç¬¦å«åš <code>shareReplayLatestWhileConnected</code>ï¼Œä¸¤è€…ä¹‹é—´åªæœ‰ä¸€ä¸ªéå¸¸å°çš„åŒºåˆ«ã€‚</p>
<p>ğŸŒ°3:</p>
<pre><code>let observable = myInterval(1).shareReplay(1)

print(&quot;Started ----&quot;)

let subscription1 = observable
    .subscribe(onNext: { n in
        print(&quot;First \(n)&quot;)
    })

Thread.sleep(forTimeInterval: 2)

let subscription2 = observable
    .subscribe(onNext: { n in
        print(&quot;Second \(n)&quot;)
    })

Thread.sleep(forTimeInterval: 3)

subscription1.dispose()

Thread.sleep(forTimeInterval: 4)

subscription2.dispose()

print(&quot;Observer become 0&quot;)

Thread.sleep(forTimeInterval: 1)

let subscription3 = observable
    .subscribe(onNext: { n in
        print(&quot;Third \(n)&quot;)
    })

Thread.sleep(forTimeInterval: 2)

subscription3.dispose()

print(&quot;Ended ----&quot;)
</code></pre><p>ç»“æœ3ï¼š</p>
<pre><code>Started ----
Subscribed
First 0
First 1
Second 1
First 2
Second 2
First 3
Second 3
First 4
Second 4
Second 5
Second 6
Second 7
Second 8
Disposed
Observer become 0
Third 8
Subscribed
Third 0
Third 1
Disposed
Ended ----
</code></pre><p>æ³¨æ„å’Œä¸Šé¢ä¾‹å­çš„åŒºåˆ«ï¼Œ<code>observable</code>ä¼šç»å†ä¸€ä¸ªä»è¢«è®¢é˜…åˆ°æ²¡æœ‰è¢«è®¢é˜…å†åˆ°é‡æ–°è¢«è®¢é˜…çš„è¿‡ç¨‹ï¼Œè€Œé‡æ–°è¢«è®¢é˜…æ—¶ä»ç„¶é¦–å…ˆä¼šå‘é€ä¸€ä¸ªæ­¤å‰æ›¾ç»å‘é€è¿‡çš„æœ€åä¸€ä¸ªå€¼ï¼Œä¹‹åå†é‡æ–°å¼€å§‹ã€‚</p>
<p>ğŸŒ°4:</p>
<pre><code>let observable = myInterval(1).shareReplayLatestWhileConnected()

print(&quot;Started ----&quot;)

let subscription1 = observable
    .subscribe(onNext: { n in
        print(&quot;First \(n)&quot;)
    })

Thread.sleep(forTimeInterval: 2)

let subscription2 = observable
    .subscribe(onNext: { n in
        print(&quot;Second \(n)&quot;)
    })

Thread.sleep(forTimeInterval: 3)

subscription1.dispose()

Thread.sleep(forTimeInterval: 4)

subscription2.dispose()

print(&quot;Observer become 0&quot;)

Thread.sleep(forTimeInterval: 1)

let subscription3 = observable
    .subscribe(onNext: { n in
        print(&quot;Third \(n)&quot;)
    })

Thread.sleep(forTimeInterval: 2)

subscription3.dispose()

print(&quot;Ended ----&quot;)
</code></pre><p>ç»“æœ4ï¼š </p>
<pre><code>Started ----
Subscribed
First 0
First 1
Second 1
First 2
Second 2
First 3
Second 3
First 4
Second 4
Second 5
Second 6
Second 7
Second 8
Disposed
Observer become 0
Subscribed
Third 0
Third 1
Disposed
Ended ----  
</code></pre><p>å¯¹æ¯”<code>shareReplayLatestWhileConnected</code>å’Œ<code>shareReplay(1)</code>å¯ä»¥å‘ç°ï¼Œä»è¢«è®¢é˜…åˆ°æ²¡æœ‰è¢«è®¢é˜…å†åˆ°é‡æ–°è¢«è®¢é˜…æ—¶ä¸ä¼šå‘é€æ­¤å‰æ›¾ç»å‘é€è¿‡çš„æœ€åä¸€ä¸ªå€¼ï¼Œè€Œæ˜¯ç›´æ¥é‡æ–°å¼€å§‹ã€‚    </p>
<p>å¼„æ‡‚äº†è¿™ä¸¤ä¸ªä¹‹åå†ç¿»å›å»çœ‹ä¸€ä¸‹ä¸Šä¸€ç¯‡ä»‹ç»çš„<code>Subject</code>ç›¸å…³çš„å‡ ä¸ªæ“ä½œç¬¦ï¼Œç›¸ä¿¡ä½ ä¸€å®šä¼šè±ç„¶å¼€æœ—ã€‚</p>
<p>æœ€åçœ‹ä¸€ä¸‹RxSwiftå®˜æ–¹ä»‹ç»åŠ æ·±ä¸€ä¸‹ç†è§£ï¼š<a href="https://github.com/ReactiveX/RxSwift/blob/master/Documentation/HotAndColdObservables.md" target="_blank" rel="external">Hot and Cold Observables</a> ã€‚</p>
<h2 id="è‡ªå®šä¹‰operator"><a href="#è‡ªå®šä¹‰operator" class="headerlink" title="è‡ªå®šä¹‰operator"></a>è‡ªå®šä¹‰operator</h2><p>ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ä»‹ç»äº†å¾ˆå¤šä¸ªæ“ä½œç¬¦ï¼Œè¿™ç¯‡æ–‡ç« å‰é¢éƒ¨åˆ†åˆé‡ç‚¹ä»‹ç»äº†3ä¸ªæ“ä½œç¬¦ï¼Œå¦å¤–è¿˜æœ‰å¾ˆå¤šå¹¶æœªæåŠçš„æ“ä½œç¬¦ï¼Œæ‰€ä»¥ä»æŸç§æ„ä¹‰ä¸Šå¯ä»¥è¯´ï¼ŒRxSwiftä¹‹æ‰€ä»¥å¼ºå¤§å°±åœ¨äºå®ƒæœ¬èº«å®šä¹‰äº†å„ç§å„æ ·çš„æ“ä½œç¬¦ã€‚</p>
<p>è¿™é‡Œæ˜¯æ‰€æœ‰æ“ä½œç¬¦çš„<a href="http://reactivex.io/documentation/operators.html#tree" target="_blank" rel="external">åˆ—è¡¨</a>ï¼Œæœ‰äº‹æ²¡äº‹å¯ä»¥æŸ¥ä¸€æŸ¥ï¼Œçœ‹çœ‹å…·ä½“éƒ½æœ‰å“ªäº›ã€‚</p>
<p>ä½†å³ä½¿æ˜¯å·²ç»æœ‰äº†è¿™ä¹ˆå¤šï¼Œåœ¨å®é™…å¼€å‘ä¸­å¯èƒ½ä¹Ÿä¼šé‡åˆ°ä¸æ»¡è¶³æ¡ä»¶çš„æƒ…å†µï¼Œæ€ä¹ˆåŠå‘¢ï¼Ÿå¾ˆç®€å•ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰æ“ä½œç¬¦ã€‚</p>
<p>é‰´äºæœ¬èº«å·²ç»å­˜åœ¨çš„æ“ä½œç¬¦çš„å®ç°æ–¹å¼å·²ç»åšäº†ç›¸å½“ç¨‹åº¦çš„ä¼˜åŒ–ï¼Œæ‰€ä»¥è²Œä¸€çœ‹ä¸ä¸€å®šèƒ½çœ‹å¾—æ‡‚ã€‚ä½†ä¸‡å˜ä¸ç¦»å…¶å®—ï¼Œåˆ›å»ºæ“ä½œç¬¦åœ¨æœ¬è´¨ä¸Šä»ç„¶æ˜¯åˆ›å»ºä¸€ä¸ªObservableåºåˆ—ï¼Œæ‰€ä»¥å…¶å®æ–¹æ³•ä½ å·²ç»çŸ¥é“äº†ã€‚è€Œä¸”å‰é¢ä¹Ÿå·²ç»æˆ–å¤šæˆ–å°‘çš„æ¶‰åŠè¿‡ï¼Œè¿˜è®°å¾—ä¸Šæ–‡ä¸­å‡ºç°çš„ <code>myJust()</code> å’Œ <code>myInterval()</code> ä¹ˆï¼Ÿç¿»å›å»å†çœ‹ä¸€éï¼Œå®ƒä»¬å°±æ˜¯è‡ªå®šä¹‰çš„æ“ä½œç¬¦ã€‚</p>
<p>æ¥çœ‹ä¸€ä¸‹å®˜æ–¹æä¾›çš„æœªç»è¿‡ä¼˜åŒ–çš„<code>map</code>æ“ä½œç¬¦ç‰ˆæœ¬ï¼š</p>
<pre><code>extension ObservableType {
    func myMap&lt;R&gt;(transform: @escaping (E) -&gt; R) -&gt; Observable&lt;R&gt; {
        return Observable.create { observer in
            let subscription = self.subscribe { e in
                switch e {
                case .next(let value):
                    let result = transform(value)
                    observer.on(.next(result))
                case .error(let error):
                    observer.on(.error(error))
                case .completed:
                    observer.on(.completed)
                }
            }

            return subscription
        }
    }
}
</code></pre><p>ä½¿ç”¨æ–¹å¼å’Œä½¿ç”¨ç³»ç»Ÿæä¾›çš„ä¸€æ¨¡ä¸€æ ·ï¼š</p>
<pre><code>let subscription = myInterval(0.1)
    .myMap { event in
        return &quot;This is simply \(event)&quot;
    }
    .subscribe(onNext: { next in
        print(next)
    })
</code></pre><p>ä¸€å¦‚é¢„æœŸï¼Œè¾“å‡ºç»“æœä¸ºï¼š</p>
<pre><code>Subscribed
This is simply 0
This is simply 1
This is simply 2
This is simply 3
This is simply 4
This is simply 5
This is simply 6
...
</code></pre><p>ç›¸å½“ç®€å•æœ‰æœ¨æœ‰ï¼Ÿï¼    </p>
<hr>
<p>ç›®å‰ä¸ºæ­¢ä»‹ç»çš„å…¨æ˜¯RxSwifté’ˆå¯¹swiftè¿™é—¨è¯­è¨€å®ç°çš„å‡½æ•°å¼å“åº”å¼ç¼–ç¨‹èŒƒå¼ï¼Œè‡³äºä½ æ˜¯ç”¨swiftå†™å®¢æˆ·ç«¯è¿˜æ˜¯å†™æœåŠ¡ç«¯å…¶å®æ— æ‰€è°“ã€‚æ¥ä¸‹æ¥è¦ä»‹ç»çš„ä¸€äº›å†…å®¹å°±åªé€‚ç”¨äºiOSç³»ç»Ÿå¼€å‘è‹¹æœæ‰‹æœºAppäº†ã€‚</p>
<h2 id="å¤§ä¸€ç»Ÿ"><a href="#å¤§ä¸€ç»Ÿ" class="headerlink" title="å¤§ä¸€ç»Ÿ"></a>å¤§ä¸€ç»Ÿ</h2><p>ä¸Šä¸€ç¯‡ä¸­æåˆ°è¿‡ï¼ŒRxSwiftå¯ä»¥å°†iOSç³»ç»Ÿé»˜è®¤æä¾›çš„å‡ ç§äº‹ä»¶å“åº”æ–¹å¼è¿›è¡Œç»Ÿä¸€ï¼Œè¿™æ ·èƒ½å¾ˆå¤§ç¨‹åº¦ä¸Šæé«˜ä»£ç å¯è¯»æ€§ï¼Œä½¿å¾—ä»£ç æ›´åŠ æ˜“äºç»´æŠ¤ä¸æ‹“å±•ã€‚ä¸‹é¢å°±æ¥çœ‹çœ‹å…·ä½“æ˜¯æ€ä¹ˆåšçš„ã€‚</p>
<h3 id="KVO"><a href="#KVO" class="headerlink" title="KVO"></a>KVO</h3><p>å…ˆæ¥çœ‹ä¸€ä¸‹ç³»ç»Ÿæä¾›çš„ä½¿ç”¨KVOçš„ä¸‰ä¸ªå‡½æ•°ï¼Œæ³¨æ„æ˜¯ä¸‰ä¸ª!!!</p>
<pre><code>func addObserver(_ observer: NSObject, forKeyPath keyPath: String, options: NSKeyValueObservingOptions = [], context: UnsafeMutableRawPointer?)
func removeObserver(_ observer: NSObject, forKeyPath keyPath: String)
func observeValue(forKeyPath keyPath: String?, of object: Any?, change: [NSKeyValueChangeKey : Any]?, context: UnsafeMutableRawPointer?)
</code></pre><p>å…·ä½“æœ‰å¤šéš¾ç”¨å°±ä¸æäº†ï¼Œè°ç”¨è°çŸ¥é“ã€‚</p>
<p>æ¥çœ‹ä¸€ä¸‹RxSwiftæä¾›çš„æ”¯æŒKVOçš„ä¸¤ç§æ–¹å¼ï¼Œæ¯ç§æ–¹å¼éƒ½åªæœ‰ä¸€ä¸ªå‡½æ•°ã€‚</p>
<pre><code>func observe&lt;E&gt;(_ type: E.Type, _ keyPath: String, options: NSKeyValueObservingOptions = [.new, .initial], retainSelf: Bool = true) -&gt; Observable&lt;E?&gt; { }

func observeWeakly&lt;E&gt;(_ type: E.Type, _ keyPath: String, options: NSKeyValueObservingOptions = [.new, .initial]) -&gt; Observable&lt;E?&gt; { }
</code></pre><p>åŒºåˆ«ä¸»è¦åœ¨äºå†…å­˜ç®¡ç†æ–¹å¼ä¸ä¸€è‡´ã€‚æ¥çœ‹ä¸€ä¸‹æ€ä¹ˆä½¿ç”¨ï¼š</p>
<pre><code>view
   .rx.observe(CGRect.self, &quot;frame&quot;)
    .subscribe(onNext: { frame in
      ...
    })
    .disposed(by: disposeBag)
</code></pre><p>æˆ–è€…</p>
<pre><code>view
    .rx.observeWeakly(CGRect.self, &quot;frame&quot;)
    .subscribe(onNext: { frame in
      ...
    }) 
    .disposed(by: disposeBag)       
</code></pre><p>çœŸæ˜¯æ²¡æœ‰å¯¹æ¯”å°±æ²¡æœ‰ä¼¤å®³ï¼Œæ—¢ä¸éœ€è¦æ³¨å†Œåˆä¸éœ€è¦ç§»é™¤ï¼Œæ¯”ç³»ç»Ÿçš„æ–¹ä¾¿ç®€å•å¾ˆå¤šæœ‰æœ¨æœ‰ï¼Ÿï¼</p>
<h4 id="rx-observe"><a href="#rx-observe" class="headerlink" title="rx.observe"></a>rx.observe</h4><p><code>rx.observe</code>æ€§èƒ½æ›´åŠ é«˜æ•ˆæ˜¯å› ä¸ºå®ƒä»…ä»…æ˜¯å¯¹ç³»ç»ŸKVOçš„ç®€å•å°è£…ï¼Œç›¸å¯¹æ¥è¯´é€‚åˆåº”ç”¨çš„åœºæ™¯æ¯”è¾ƒå°‘ï¼š</p>
<ul>
<li>å®ƒå¯ä»¥ç”¨äºç›‘æµ‹ç”±<code>self</code>æˆ–è€…çˆ¶ç±»å¼€å§‹çš„è·¯å¾„ (<code>retainSelf</code> = <code>false</code>)</li>
<li>å®ƒå¯ä»¥ç”¨äºç›‘æµ‹ç”±å­ç±»å¼€å§‹çš„è·¯å¾„ (<code>retainSelf</code> = <code>true</code>)</li>
<li>æ•´ä¸ªè·¯å¾„å½“ä¸­çš„æ‰€æœ‰å±æ€§å¿…é¡»éƒ½æ˜¯ç”¨<code>strong</code>ä¿®é¥°çš„ï¼Œå¦åˆ™å°±ä¼šé¢ä¸´ç€crashçš„é£é™©</li>
</ul>
<p>ä¸¾ä¸ªä¾‹å­ï¼š</p>
<pre><code>self.rx.observe(CGRect.self, &quot;view.frame&quot;, retainSelf: false)
</code></pre><h4 id="rx-observeWeakly"><a href="#rx-observeWeakly" class="headerlink" title="rx.observeWeakly"></a>rx.observeWeakly</h4><p><code>rx.observeWeakly</code>ä¼šæ¯”<code>rx.observe</code>æ€§èƒ½ç¨å¾®å·®ä¸€äº›æ˜¯å› ä¸ºå®ƒä¸ºäº†é˜²æ­¢å¼±å¼•ç”¨å‡ºç°ä¸å¾—ä¸å»å¤„ç†å¯¹è±¡çš„é‡Šæ”¾ï¼ˆ<code>dealloc</code>ï¼‰ã€‚</p>
<p>å®ƒé™¤äº†å¯ä»¥ç”¨äºä»»ä½•é€‚ç”¨äº<code>rx.observe</code>çš„åœºæ™¯ä¹‹å¤–ï¼Œè¿˜é€‚åˆåº”ç”¨çš„åœºæ™¯æœ‰ï¼š</p>
<ul>
<li>å› ä¸ºå®ƒä¸ä¼šä¿ç•™è¢«ç›‘æµ‹çš„ç›®æ ‡ï¼Œå®ƒå¯ä»¥ç”¨äºç›‘æµ‹ä»»æ„çš„å¯¹è±¡ï¼Œå³ä½¿å®ƒçš„æ‰€æœ‰æƒå…³ç³»æœªçŸ¥</li>
<li>å®ƒå¯ä»¥ç”¨äºç›‘æµ‹ç”¨<code>weak</code>ä¿®é¥°çš„å±æ€§</li>
</ul>
<p>å†ä¸¾ä¸ªä¾‹å­ï¼š</p>
<pre><code>someSuspiciousViewController.rx.observeWeakly(Bool.self, &quot;behavingOk&quot;)
</code></pre><p>æ€»ç»“ä¸€ä¸‹ï¼Œé™¤éä½ ååˆ†ç¡®å®šç”¨<code>rx.observe</code>å¾ˆåˆé€‚ï¼Œå¦åˆ™éƒ½ç”¨<code>rx.observeWeakly</code>æ²¡æ¯›ç—…ã€‚</p>
<h3 id="Notification"><a href="#Notification" class="headerlink" title="Notification"></a>Notification</h3><p>é€šçŸ¥å’ŒKVOç‰¹åˆ«åƒï¼Œé¦–å…ˆè¿˜æ˜¯çœ‹ä¸€ä¸‹ç³»ç»Ÿæä¾›çš„å‡½æ•°ï¼š</p>
<pre><code>func addObserver(_ observer: Any, selector aSelector: Selector, name aName: NSNotification.Name?, object anObject: Any?)
func addObserver(forName name: NSNotification.Name?, object obj: Any?, queue: OperationQueue?, using block: @escaping (Notification) -&gt; Swift.Void) -&gt; NSObjectProtocol
removeObserver(_ observer: Any)
post(name aName: NSNotification.Name, object anObject: Any?, userInfo aUserInfo: [AnyHashable : Any]? = nil)
</code></pre><p>å‰ä¸¤ä¸ªå‡½æ•°æ˜¯å¹¶åˆ—å…³ç³»ï¼Œä½¿ç”¨æ—¶äºŒé€‰ä¸€ã€‚å…¶å®ç›¸æ¯”äºKVOï¼Œå¹¶æ²¡æœ‰è§‰å¾—é€šçŸ¥å¤šä¹ˆéš¾ç”¨ã€‚</p>
<p>æ¥çœ‹ä¸€ä¸‹RxSwiftæä¾›çš„ç”¨äºä»£æ›¿ç³»ç»Ÿé€šçŸ¥çš„å‡½æ•°ã€‚</p>
<pre><code>public func notification(_ name: Notification.Name?, object: AnyObject? = nil) -&gt; Observable&lt;Notification&gt; { }
</code></pre><p>ä½¿ç”¨æ–¹å¼ä¸ºï¼š</p>
<pre><code>NotificationCenter.default
   .rx.notification(Notification.Name(rawValue: &quot;testNotification&quot;), object: nil)
   .subscribe(onNext: { noti in
          ...
   })
   .disposed(by: disposeBag)
</code></pre><p>æˆ–è€…</p>
<pre><code>NotificationCenter.default
     .rx.notification(Notification.Name.UITextViewTextDidBeginEditing, object: myTextView)
     .subscribe(onNext: { n in
       ...
     }) 
     .disposed(by: disposeBag) 
</code></pre><p>å¯è§ï¼Œåªæ˜¯ä½¿å¾—æ¥æ”¶é€šçŸ¥æ—¶çš„å¤„ç†æ–¹å¼å˜çš„æ›´åŠ ä¼˜é›…ï¼Œå‘é€å’Œé”€æ¯çš„æ–¹å¼ä¸å˜ã€‚</p>
<h3 id="Target-Action"><a href="#Target-Action" class="headerlink" title="Target-Action"></a>Target-Action</h3><p>è¿™ç§æ–¹å¼å˜å¾—å°¤å…¶ç®€å•ã€‚</p>
<pre><code>@IBOutlet weak var button: UIButton!

button.rx.tap
   .subscribe(onNext: {
       print(&quot;button is clicked&quot;)
   })
   .addDisposableTo(disposeBag)
</code></pre><p>çœŸæ˜¯æ²¡ä»€ä¹ˆå¯è§£é‡Šçš„ï¼ŒSo Easyï¼Œç…§è‘«èŠ¦ç”»ç“¢å°±å¯ä»¥ã€‚</p>
<h3 id="Delegate"><a href="#Delegate" class="headerlink" title="Delegate"></a>Delegate</h3><p>ä¸åºŸè¯ï¼Œç›´æ¥çœ‹ä»£ç ã€‚</p>
<pre><code>@IBOutlet weak var scrollView: UIScrollView!

scrollView.rx.didScroll
   .subscribe(onNext: { [weak self] in
       print(&quot;current offsetY is \(self?.scrollView.contentOffset.y)&quot;)
   })
   .addDisposableTo(disposeBag)
</code></pre><p>å¯è§ï¼ŒRxSwiftå°†<code>UIScrollView</code>çš„ä»£ç†æ–¹æ³•<code>scrollViewDidScroll:</code>å°è£…æˆäº†ä¸€ä¸ª<code>Observable</code>çš„å±æ€§ï¼Œä½¿ç”¨çš„æ—¶å€™ä¸å†éœ€è¦è·¨æ–¹æ³•ï¼Œç›´æ¥è®¢é˜…å°±å¥½äº†ã€‚ä»£ç æ›´åŠ ç´§å‡‘æœ‰æœ¨æœ‰ï¼Ÿ</p>
<p>è‡³äºå¦‚ä½•æ‹“å±•è‡ªå·±å®šä¹‰çš„ä»£ç†æ–¹æ³•ä¹Ÿå¯ä»¥åº”ç”¨è¿™ç§æ–¹å¼ç•¥æœ‰ç‚¹å¤æ‚ï¼Œæš‚æ—¶å¿½ç•¥ï¼Œæœ‰å…´è¶£çš„å¯ä»¥è‡ªå·±å»ç ”ç©¶ä¸€ä¸‹ã€‚</p>
<h2 id="ç»‘å®š"><a href="#ç»‘å®š" class="headerlink" title="ç»‘å®š"></a>ç»‘å®š</h2><p>ä¸€å¥è¯æè¿°é‡è¦æ€§ï¼šè¿™æ˜¯RxSwiftç”šè‡³å“åº”å¼ç¼–ç¨‹ä¸­æœ€é‡è¦çš„ä¸€ä¸ªæ¦‚å¿µï¼Œæ²¡æœ‰ä¹‹ä¸€ã€‚</p>
<p>å…¶å®å…¨ç§°åº”è¯¥æ˜¯æ•°æ®ç»‘å®šï¼Œ<a href="http://baike.baidu.com/item/%E6%95%B0%E6%8D%AE%E7%BB%91%E5%AE%9A" target="_blank" rel="external">ç™¾åº¦ç™¾ç§‘</a>ä¸Šæ˜¯è¿™ä¹ˆå®šä¹‰çš„ï¼šç»‘å®šæ˜¯å°†ä¸€ä¸ªç”¨æˆ·ç•Œé¢å…ƒç´ ï¼ˆæ§ä»¶ï¼‰çš„å±æ€§ç»‘å®šåˆ°ä¸€ä¸ªç±»å‹ï¼ˆå¯¹è±¡ï¼‰å®ä¾‹ä¸Šçš„æŸä¸ªå±æ€§çš„æ–¹æ³•ã€‚</p>
<p>å¦‚æœä½ å¹¶æ²¡æœ‰å®Œå…¨ç†è§£ï¼Œé‚£ä¹ˆæˆ‘æ¥ä¸¾ä¸€ä¸ªé€šä¿—æ˜“æ‡‚çš„ä¾‹å­ã€‚å‡è®¾ç°åœ¨è¦åšä¸€ä¸ªç±»ä¼¼å¾®ä¿¡æœ‹å‹åœˆçš„åŠŸèƒ½ï¼Œå¯ä»¥å‘å¸–å¯ä»¥ç‚¹èµï¼Œåœ¨æ¯æ¡å¸–å­ä¸‹é¢è¦å±•ç¤ºå½“å‰è·å¾—çš„ç‚¹èµæ•°ã€‚å¾ˆç®€å•çš„éœ€æ±‚å¯¹å§ï¼ŒæŠ›å¼€å‘å¸–ç‚¹èµä¸æåªè€ƒè™‘å±•ç¤ºç‚¹èµï¼Œå‡è®¾æ¨¡å‹ç±»çš„å®ä¾‹å¯¹è±¡å«åš<code>article</code>ï¼Œç‚¹èµæ•°é‡çš„å±æ€§å­—æ®µå«åš<code>starCount</code>ï¼Œåªéœ€è¦å–åˆ°è¿™ä¸ªå­—æ®µç„¶åèµ‹å€¼ç»™ä¸€ä¸ª<code>label</code>å°±å¯ä»¥ã€‚é‚£ä¹ˆå½“å½“å‰ç”¨æˆ·ä¹Ÿç‚¹èµäº†åï¼Œ<code>starCount</code>è¦+1ï¼Œ<code>label</code>è¦æ”¹å˜ï¼Œæ€ä¹ˆåšå‘¢ï¼ŸæŒ‰ç…§ä»¥å¾€æœ€ç®€å•çš„æ–¹å¼æ— å¤–ä¹æ˜¯å¯¹<code>article</code>çš„<code>starCount</code>åšä¸€ä¸ªKVOï¼Œå½“æ”¹å˜æ—¶é‡æ–°å¯¹<code>label</code>è¿›è¡Œèµ‹å€¼ã€‚é‚£å¦‚æœåº”ç”¨ç»‘å®šçš„æ–¹å¼å‘¢ï¼Œå°†è¿™ä¸ª<code>label</code>å’Œ<code>article</code>çš„<code>starCount</code>è¿›è¡Œç»‘å®šï¼Œ<code>starCount</code>å¯ä»¥éšæ„å˜ï¼Œæ— éœ€æ‰‹åŠ¨å†™KVOï¼Œæ— éœ€æ‰‹åŠ¨é‡æ–°èµ‹å€¼ï¼Œ<code>label</code>éƒ½ä¼šè‡ªåŠ¨æ”¹å˜ï¼Œ666æœ‰æœ¨æœ‰ï¼Ÿï¼</p>
<p>ç„¶åæ³¨æ„è¿™åªæ˜¯å•å‘ç»‘å®šï¼ŒåŒå‘ç»‘å®šå¤ªå¤æ‚ï¼Œæš‚æ—¶ä¸åšè®¨è®ºã€‚</p>
<p>å…ˆæ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼š</p>
<pre><code>@IBOutlet weak var number1: UITextField!
@IBOutlet weak var number2: UITextField!
@IBOutlet weak var label: UILabel!

let disposeBag = DisposeBag()

number1.rx.text
    .bind(to: label.rx.text)
    .addDisposableTo(disposeBag)

number1.rx.text
    .bind(to: number2.rx.text)
    .addDisposableTo(disposeBag)
</code></pre><p>é¦–å…ˆå®šä¹‰äº†ä¸¤ä¸ª<code>UITextField</code>å’Œä¸€ä¸ª<code>UILabel</code>åˆ†åˆ«å«åš<code>number1</code>ï¼Œ<code>number2</code>å’Œ<code>label</code>ï¼Œç„¶ååº”ç”¨<code>bind</code>å‘½ä»¤å°†<code>number1</code>å’Œ<code>label</code>è¿›è¡Œç»‘å®šï¼Œå°†<code>number1</code>å’Œ<code>number2</code>ä¹Ÿè¿›è¡Œç»‘å®šã€‚å®é™…è¿è¡Œæ—¶ä¼šå‘ç°æ— è®ºåœ¨<code>number1</code>ä¸­è¾“å…¥ä»»ä½•å†…å®¹<code>number2</code>å’Œ<code>label</code>éƒ½ä¼šå˜æˆåŒæ ·çš„å†…å®¹ã€‚è¿™å°±æ˜¯ç»‘å®šçš„å‰å®³ã€‚é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œä¸ºä»€ä¹ˆå¯ä»¥è¿™æ ·ç»‘å®šå‘¢ï¼Ÿ</p>
<p>åŸæ¥ï¼Œé€šè¿‡æŸ¥çœ‹æºç ä¼šå‘ç° <code>number1.rx.text</code> æ˜¯ä¸€ä¸ª <code>ControlProperty&lt;String?&gt;</code> ç±»å‹çš„å±æ€§ï¼Œè€Œ <code>label.rx.text</code> æ˜¯ä¸€ä¸ª <code>UIBindingObserver&lt;Base, String?&gt;</code> ç±»å‹çš„å±æ€§ï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªç©¶ç«Ÿæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p>
<p>åœ¨ä»‹ç»è¿™ä¸¤ä¸ªä¹‹å‰ï¼Œé¦–å…ˆè¦æ’ä¸ªé˜Ÿï¼Œè¿˜è®°å¾—ä¸Šé¢ç”¨è¿‡çš„ <code>button.rx.tap</code>å—ï¼Œå…¶å®å®ƒæ˜¯ä¸€ä¸ª <code>ControlEvent&lt;Void&gt;</code> ç±»å‹çš„å±æ€§ï¼Œç°åœ¨ä¹Ÿæ¥æ¢ç©¶ä¸€ä¸‹å®ƒç©¶ç«Ÿæ˜¯ä»€ä¹ˆã€‚</p>
<p>åœ¨å®é™…å¼€å‘ä¸­æœ€å¸¸ç”¨çš„ä¸‰ä¸ªåŸºç¡€æ§ä»¶ï¼š<code>UIButton</code>ï¼Œ<code>UITextField</code>ï¼Œ<code>UILabel</code>ã€‚</p>
<p>ç›¸å¯¹åº”çš„æƒ³è¦ç†è§£å¦‚ä½•å®ç°çš„ç»‘å®šé¦–å…ˆè¦æ¸…æ¥šä¸‰ä¸ªæ¦‚å¿µï¼š<code>ControlEvent</code>ï¼Œ<code>ControlProperty</code>ï¼Œ<code>UIBindingObserver</code>ã€‚</p>
<p>é¦–å…ˆè¦æ˜ç¡®çš„ä¸€ç‚¹æ˜¯è¿™ä¸‰ä¸ªæ¦‚å¿µéƒ½åªé€‚ç”¨äºUIå±‚ï¼Œæ‰€ä»¥ä¸å­˜åœ¨å¤šçº¿ç¨‹çš„é—®é¢˜ã€‚</p>
<h3 id="ControlEvent"><a href="#ControlEvent" class="headerlink" title="ControlEvent"></a>ControlEvent</h3><p>é¦–å…ˆçœ‹å®šä¹‰ï¼š</p>
<pre><code>struct ControlEvent&lt;PropertyType&gt; : ControlEventType

protocol ControlEventType : ObservableType
</code></pre><p>äºæ˜¯æˆ‘ä»¬å‘ç°é¦–å…ˆ<code>ControlEvent</code>æ˜¯ä¸€ä¸ªç»“æ„ä½“ï¼Œç„¶åå½’æ ¹ç»“åº•å®ç°äº†<code>ObservableType</code>åè®®ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒæ˜¯ä¸€ä¸ªè¢«è§‚å¯Ÿè€…ï¼Œå³<code>Observable</code>ã€‚</p>
<p>ç„¶åå®ƒæœ‰ä»¥ä¸‹è¿™äº›æ€§è´¨ï¼š</p>
<pre><code>- it never fails
- it won&apos;t send any initial value on subscription
- it will `Complete` sequence on control being deallocated
- it never errors out
- it delivers events on `MainScheduler.instance`
</code></pre><p>éƒ½æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Œæ‹¿åˆšæ‰çš„æŒ‰é’®ä¸¾ä¾‹ï¼Œä¸€ä¸ªæŒ‰é’®è¢«ç‚¹å‡»æ˜¯ä¸€ä¸ª<code>ControlEvent</code>çš„å®ä¾‹ï¼Œé‚£ä¹ˆï¼š</p>
<ol>
<li>ä¸è€ƒè™‘ä¸»çº¿ç¨‹å¡æ­»ï¼ŒæŒ‰é’®ä¸€ç›´å¯ä»¥è¢«ç‚¹å‡»ï¼Œå½“ç„¶ä¸ä¼šå¤±è´¥ï¼›</li>
<li>æŒ‰é’®åªæœ‰è¢«æŒ‰ä¸‹æ—¶æ‰ä¼šå‘é€äº‹ä»¶ï¼Œåˆšè¢«è¿›è¡Œç»‘å®šåä¸ä¼šå‘é€äº‹ä»¶ï¼›</li>
<li>æŒ‰é’®è¢«é”€æ¯æ—¶ä¼šå‘é€ä¸€ä¸ªå®Œæˆç±»å‹äº‹ä»¶ï¼›</li>
<li>å’Œç¬¬ä¸€æ¡å·®ä¸å¤šï¼Œä¸ä¼šå¤±è´¥ä¹Ÿå°±ä¸ä¼šå‘é€é”™è¯¯ç±»å‹äº‹ä»¶ï¼›</li>
<li>å‘é€äº‹ä»¶éƒ½æ˜¯åœ¨ä¸»çº¿ç¨‹ï¼›</li>
</ol>
<p>ä¸€å¥è¯æ€»ç»“å°±æ˜¯ï¼Œè¿™æ˜¯ä¸€ä¸ªåªèƒ½åœ¨ä¸»çº¿ç¨‹å‘é€äº‹ä»¶çš„<code>Observable</code>ã€‚</p>
<p>é¡ºä¾¿æä¸€å¥ï¼Œä¸Šé¢ç”¨è¿‡çš„ <code>scrollView.rx.didScroll</code>å…¶å®ä¹Ÿæ˜¯ä¸€ä¸ª<code>ControlEvent&lt;Void&gt;</code> ç±»å‹çš„å±æ€§ã€‚æ‰€ä»¥ç°åœ¨ä½ ç»ˆäºçŸ¥é“å®ƒä»¬ä¸ºä»€ä¹ˆå¯ä»¥è¢«è®¢é˜…äº†å§ï¼</p>
<h3 id="ControlProperty"><a href="#ControlProperty" class="headerlink" title="ControlProperty"></a>ControlProperty</h3><p>ä»ç„¶é¦–å…ˆçœ‹å®šä¹‰ï¼š</p>
<pre><code>struct ControlProperty&lt;PropertyType&gt; : ControlPropertyType

protocol ControlPropertyType : ObservableType, ObserverType
</code></pre><p>äºæ˜¯æˆ‘ä»¬å‘ç°é¦–å…ˆ<code>ControlProperty</code>ä¹Ÿæ˜¯ä¸€ä¸ªç»“æ„ä½“ï¼Œç„¶åå½’æ ¹ç»“åº•åŒæ—¶å®ç°äº†<code>ObservableType</code>ä¸<code>ObserverType</code>ä¸¤ä¸ªåè®®ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒå³æ˜¯ä¸€ä¸ªè¢«è§‚å¯Ÿè€…ï¼Œå³<code>Observable</code>ï¼Œåˆæ˜¯ä¸€ä¸ªè§‚å¯Ÿè€…ï¼Œå³<code>Observer</code>ã€‚</p>
<p>ç„¶åå®ƒæœ‰ä»¥ä¸‹è¿™äº›æ€§è´¨ï¼š</p>
<pre><code>- it never fails
- `shareReplay(1)` behavior
    - it&apos;s stateful, upon subscription (calling subscribe) last element is immediately replayed if it was produced
- it will `Complete` sequence on control being deallocated
- it never errors out
- it delivers events on `MainScheduler.instance`
</code></pre><p>æ‹¿åˆšæ‰çš„è¾“å…¥æ¡†ä¸¾ä¾‹å­ï¼Œä¸€ä¸ªè¾“å…¥æ¡†çš„<code>text</code>å€¼æ˜¯ä¸€ä¸ª<code>ControlProperty</code>çš„å®ä¾‹ï¼Œé‚£ä¹ˆï¼š</p>
<ol>
<li>ä¸è€ƒè™‘ä¸»çº¿ç¨‹å¡æ­»ï¼Œè¾“å…¥æ¡†ä¸€ç›´å¯ä»¥è¢«æ”¹å˜ï¼Œå½“ç„¶ä¸ä¼šå¤±è´¥ï¼›</li>
<li>ä¸€ä¸ªè¾“å…¥æ¡†å½“ç„¶å¯ä»¥åŒæ—¶è¢«å¤šä¸ªè§‚å¯Ÿè€…è®¢é˜…ï¼Œæ­¤æ—¶è¿™äº›è§‚å¯Ÿè€…æ˜¯<code>å…±äº«</code>è¿™ä¸€ä¸ªè¾“å…¥æ¡†çš„ï¼›</li>
<li>å‰©ä¸‹ä¸‰æ¡éƒ½å’Œä¸Šé¢ä¸€æ ·ã€‚</li>
</ol>
<p>ä¸€å¥è¯æ€»ç»“å°±æ˜¯ï¼Œè¿™æ˜¯ä¸€ä¸ªåªèƒ½åœ¨ä¸»çº¿ç¨‹å‘é€äº‹ä»¶çš„<code>Observable</code>å’Œä¸€ä¸ªåªèƒ½åœ¨ä¸»çº¿ç¨‹è®¢é˜…äº‹ä»¶çš„<code>Observer</code>çš„è”åˆä½“ã€‚</p>
<h3 id="UIBindingObserver"><a href="#UIBindingObserver" class="headerlink" title="UIBindingObserver"></a>UIBindingObserver</h3><p>ä¾ç„¶é¦–å…ˆçœ‹å®šä¹‰ï¼š</p>
<pre><code>class UIBindingObserver&lt;UIElementType, Value&gt; : ObserverType where UIElementType: AnyObject
</code></pre><p>äºæ˜¯æˆ‘ä»¬å‘ç°é¦–å…ˆ<code>UIBindingObserver</code>æ˜¯ä¸€ä¸ªç±»ï¼Œç„¶åå½’æ ¹ç»“åº•å®ç°äº†<code>ObserverType</code>åè®®ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒæ˜¯ä¸€ä¸ªè§‚å¯Ÿè€…ï¼Œå³<code>Observer</code>ã€‚</p>
<p>ç„¶åå®ƒæœ‰ä»¥ä¸‹è¿™äº›è§„åˆ™æˆ–è€…è¯´é™åˆ¶ï¼š</p>
<pre><code>* can&apos;t bind errors 
 * ensures binding is performed on main thread
</code></pre><p>æ‹¿åˆšæ‰çš„æ ‡ç­¾ä¸¾ä¾‹å­ï¼Œä¸€ä¸ªæ ‡ç­¾çš„<code>text</code>å€¼æ˜¯ä¸€ä¸ª<code>UIBindingObserver</code>çš„å®ä¾‹ï¼Œé‚£ä¹ˆï¼š</p>
<ol>
<li>å› ä¸ºæ ‡ç­¾çš„textå±æ€§å¯¹åº”çš„åªèƒ½æ˜¯æœ‰æ•ˆçš„å­—ç¬¦ä¸²ï¼Œé‚£ä¹ˆå¦‚æœç»‘å®šä¸€ä¸ªä¼šå‘é€é”™è¯¯äº‹ä»¶çš„Observableï¼Œæ¥æ”¶åˆ°é”™è¯¯äº‹ä»¶æ—¶æ— æ³•å¤„ç†äº†ï¼›</li>
<li>æ—¢ç„¶æ˜¯æ ‡ç­¾å°±å±äºUIKitåº“ï¼Œä¹Ÿå°±è¢«é™åˆ¶ä½åªèƒ½åœ¨ä¸»çº¿ç¨‹æ“ä½œï¼Œæ—¢ç„¶åªèƒ½åœ¨ä¸»çº¿ç¨‹æ¥æ”¶å€¼ï¼Œé‚£ä¹ˆä¹Ÿå°±é™åˆ¶äº†åªèƒ½åœ¨ä¸»çº¿ç¨‹ç»‘å®šå€¼ã€‚</li>
</ol>
<p>ä¸€å¥è¯æ€»ç»“å°±æ˜¯ï¼Œè¿™æ˜¯ä¸€ä¸ªåªèƒ½åœ¨ä¸»çº¿ç¨‹è¿›è¡Œç»‘å®šçš„<code>Observer</code>ã€‚</p>
<p>æ‰€è°“æºç é¢å‰æ²¡æœ‰ç§˜å¯†ï¼Œåˆæ­¥äº†è§£äº†è¿™ä¸‰ä¸ªåŸºæœ¬æ¦‚å¿µä¹‹åå†å›è¿‡å¤´å»çœ‹ä¸Šé¢çš„ä¾‹å­å°±ä¼šè±ç„¶å¼€æœ—ã€‚ç»‘å®šå…¶å®ä¹Ÿä¸è¿‡å°±æ˜¯ä¸€ä¸ª<code>Observable</code>å»è°ƒç”¨ç»‘å®šå‡½æ•°ï¼Œå‡½æ•°ä¸­ä¼ å…¥å¦ä¸€ä¸ª<code>Observer</code>è€Œå·²ã€‚<code>number1.rx.text</code> ä½œä¸ºä¸€ä¸ª<code>Observable</code>å½“ç„¶å¯ä»¥å»è°ƒç”¨<code>bind</code>å‡½æ•°ï¼Œè€Œ<code>number2.rx.text</code>å’Œ<code>label.rx.text</code>ä½œä¸ºä¸€ä¸ª<code>Observer</code>å½“ç„¶ä¹Ÿå¯ä»¥ä½œä¸ºå‚æ•°ä¼ åˆ°<code>bind</code>å‡½æ•°ä¸­ã€‚</p>
<p>é¡ºä¾¿æä¸€å¥ï¼ŒUIBindingObserverè¿˜å¯ä»¥è‡ªæ‹“å±•ä»¥æ›´å¥½çš„æ»¡è¶³å®é™…å¼€å‘ä¸­çš„éœ€æ±‚ã€‚</p>
<p>æ€ä¹ˆåšå‘¢ï¼Œå‚è€ƒå·²ç»å®ç°å¥½äº†çš„å‘€ï¼Œæ¯”å¦‚åˆšæ‰çš„<code>label.rx.text</code>æ˜¯è¿™æ ·å®ç°çš„ï¼š</p>
<pre><code>extension Reactive where Base: UILabel {

    /// Bindable sink for `text` property.
    public var text: UIBindingObserver&lt;Base, String?&gt; {
        return UIBindingObserver(UIElement: self.base) { label, text in
            label.text = text
        }
    }

}
</code></pre><p>äºæ˜¯ä¹ä»¿ç…§ä¸€ä¸ªï¼š</p>
<pre><code>extension ValidationResult: CustomStringConvertible {
    public var description: String {
        switch self {
        case .empty:
            return &quot;&quot;
        case let .ok(message):
                return message
           case let .failed(message):
                return message
            }
        }
}

extension ValidationResult {
    var textColor: UIColor {
            switch self {
            case .empty:
            return UIColor.yellow
        case .ok:
            return UIColor.green
        case .failed:
            return UIColor.red
            }
    }
}

extension Reactive where Base: UILabel {
    var validationResult: UIBindingObserver&lt;Base, ValidationResult&gt; {
        return UIBindingObserver(UIElement: base) { label, result in
            label.text = result.description
            label.textColor = result.textColor
        }
    }
}
</code></pre><p>é€šè¿‡ä½¿ç”¨è¿™ä¸ªæ‹“å±•ï¼Œå¯ä»¥åšåˆ°åŒæ—¶ä¿®æ”¹æ ‡ç­¾çš„å†…å®¹åŠé¢œè‰²ã€‚</p>
<h2 id="Driver"><a href="#Driver" class="headerlink" title="Driver"></a>Driver</h2><p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œå¯¹RxSwiftä¹Ÿä»‹ç»äº†ä¸å°‘å†…å®¹äº†ï¼Œä½†æ˜¯æœ€æ ¸å¿ƒçš„å…¶å®å°±æ˜¯å››ä¸ªæ¦‚å¿µï¼Œä¸¤ä¸ªåè¯ï¼š<code>è¢«è§‚å¯Ÿè€…</code>ï¼ˆ<code>Observable</code>ï¼‰å’Œ<code>è§‚å¯Ÿè€…</code>ï¼ˆ<code>Observer</code>ï¼‰ï¼›ä¸¤ä¸ªåŠ¨è¯ï¼š<code>è®¢é˜…</code>ï¼ˆ<code>subscribe</code>ï¼‰å’Œ<code>ç»‘å®š</code>ï¼ˆ<code>bind</code>ï¼‰ã€‚æ¥ä¸‹æ¥ç»ˆäºè¦è½®åˆ°ç¬¬äº”ä¸ªä¹Ÿæ˜¯æœ€åä¸€ä¸ªäº†ï¼Œå®ƒå°±æ˜¯ â€“ <code>é©±åŠ¨</code>ï¼ˆ<code>driver</code>ï¼‰ã€‚</p>
<p>äº‹å®ä¸Šï¼Œå®ƒæ˜¯ä¸“ä¸ºUIå±‚ç»‘å®šæ–¹ä¾¿è€Œåˆ›é€ å‡ºçš„ä¸€ä¸ªæ¦‚å¿µï¼Œä¹Ÿå°±æ˜¯è¯´å½“åœ¨UIå±‚åšç»‘å®šæ—¶å®ƒå¹¶ä¸æ˜¯å¿…é¡»çš„ï¼Œä½†æ˜¯åº”ç”¨å®ƒä¼šä½¿å¾—äº‹æƒ…æ›´åŠ ç®€å•ã€‚</p>
<h3 id="UIå±‚çš„è®¢é˜…å’Œç»‘å®š"><a href="#UIå±‚çš„è®¢é˜…å’Œç»‘å®š" class="headerlink" title="UIå±‚çš„è®¢é˜…å’Œç»‘å®š"></a>UIå±‚çš„è®¢é˜…å’Œç»‘å®š</h3><p>æ—¢ç„¶è¯´åˆ°UIå±‚ï¼Œç‰¹æ„è¯´æ˜ä¸€ä¸‹ï¼šåœ¨UIå±‚åšç»‘å®šæ‰€ä½¿ç”¨çš„<code>Observable</code>å…¶å®æ˜¯å¿…é¡»è¦æ»¡è¶³äºä»¥ä¸‹ä¸‰ä¸ªæ¡ä»¶çš„ã€‚</p>
<h4 id="ä¸»çº¿ç¨‹"><a href="#ä¸»çº¿ç¨‹" class="headerlink" title="ä¸»çº¿ç¨‹"></a>ä¸»çº¿ç¨‹</h4><p>æ‰€æœ‰ç³»ç»Ÿæä¾›çš„UIæ§ä»¶å…¨éƒ¨åœ¨UIKitæ¡†æ¶ä¸­ï¼Œè€Œè¿™ä¸ªæ¡†æ¶åªèƒ½åœ¨ä¸»çº¿ç¨‹ä¸­è¢«ä½¿ç”¨ï¼Œå¦åˆ™ä¸çŸ¥é“ä¼šå‘ç”Ÿä»€ä¹ˆã€‚å½“ç„¶è¿™ä¸€ç‚¹ä½ è‚¯å®šæ˜¯çŸ¥é“çš„ï¼Œé‚£ä¹ˆç›¸å¯¹åº”çš„åœ¨ä¸»çº¿ç¨‹ä¸­ç»‘å®šä½¿ç”¨çš„<code>Observable</code>ä¹Ÿå°±åªèƒ½åœ¨ä¸»çº¿ç¨‹ä¸­å‘é€æ•°æ®ï¼Œæ‰€ä»¥é€šå¸¸ä¹Ÿå°±ä¼šè°ƒç”¨ä¸€ä¸‹æ“ä½œç¬¦ï¼š<code>observeOn()</code>ï¼Œç„¶åä¼ å…¥<code>MainScheduler.instance</code>ã€‚</p>
<h4 id="é”™è¯¯å¤„ç†"><a href="#é”™è¯¯å¤„ç†" class="headerlink" title="é”™è¯¯å¤„ç†"></a>é”™è¯¯å¤„ç†</h4><p>ä¸Šä¸€å°èŠ‚ä»‹ç»çš„ä¸‰ä¸ªæ¦‚å¿µæœ‰å¾ˆå¤šç›¸åŒä¹‹å¤„ï¼Œå…¶ä¸­ä¸€ä¸ªå°±æ˜¯<code>can&#39;t error</code>ã€‚å› ä¸ºæ— è®ºæ˜¯ä¸€ä¸ª<code>UITextField</code>è¿˜æ˜¯ä¸€ä¸ª<code>UILabel</code>éƒ½æ— æ³•æ¥æ”¶å¤„ç†é”™è¯¯ï¼Œæ‰€ä»¥é€šå¸¸ä¹Ÿå°±ä¼šè°ƒç”¨ä¸€ä¸‹æ“ä½œç¬¦ï¼š<code>catchErrorJustReturn()</code>ç„¶åä¼ å…¥ä¸€ä¸ªå½“é”™è¯¯å‘ç”Ÿæ—¶è¦ä¼ é€’çš„å€¼ã€‚</p>
<h4 id="å…±äº«ç»™å¤šä¸ªè®¢é˜…è€…"><a href="#å…±äº«ç»™å¤šä¸ªè®¢é˜…è€…" class="headerlink" title="å…±äº«ç»™å¤šä¸ªè®¢é˜…è€…"></a>å…±äº«ç»™å¤šä¸ªè®¢é˜…è€…</h4><p>é€šå¸¸åœ¨UIå±‚éƒ½ä¼šå¤šä¸ª<code>Observer</code>å…±äº«åŒä¸€ä¸ª<code>Observable</code>ï¼Œæ¯”å¦‚å½“å¤šä¸ªUIæ§ä»¶çš„æ•°æ®æ¥æºäºåŒä¸€ä¸ªç½‘ç»œè¯·æ±‚çš„ç»“æœæ—¶ï¼Œä½ è‚¯å®šä¸å¸Œæœ›æ­¤è¯·æ±‚å‘ç”Ÿå¤šæ¬¡ï¼Œæ‰€ä»¥é€šå¸¸ä¹Ÿå°±ä¼šè°ƒç”¨ä¸€ä¸‹æ“ä½œç¬¦ï¼š<br><code>shareReplay()</code>ï¼Œä¸€èˆ¬éƒ½ä¼šä¼ å…¥<code>1</code>ã€‚</p>
<h3 id="å®ä¾‹"><a href="#å®ä¾‹" class="headerlink" title="å®ä¾‹"></a>å®ä¾‹</h3><p>ä¸‹é¢æ¥çœ‹ä¸€ä¸ªå®ä¾‹ï¼Œé¦–å…ˆå®šä¹‰å‡ ä¸ªå˜é‡ä¾›ä¸‹é¢ä½¿ç”¨ï¼š</p>
<pre><code>@IBOutlet weak var searchText: UITextField!
@IBOutlet weak var resultCount: UILabel!
@IBOutlet weak var resultsTableView: UITableView!
let disposeBag = DisposeBag()
</code></pre><p>æœ€åˆå§‹ç‰ˆæœ¬ï¼š</p>
<pre><code>let results = searchText.rx.text
    .throttle(0.3, scheduler: MainScheduler.instance)
    .distinctUntilChanged()
    .flatMapLatest { query in
        API.getSearchResults(query) 
    }

results
    .map { &quot;\($0.count)&quot; }
    .bind(to: resultCount.rx.text)
    .addDisposableTo(disposeBag)

results
    .bind(to: resultsTableView.rx.items(cellIdentifier: &quot;Cell&quot;)) { (_, result, cell) in
        cell.textLabel?.text = &quot;\(result)&quot;
    }
    .addDisposableTo(disposeBag)
</code></pre><p>å¾ˆç®€å•ï¼Œæ ¹æ®è¾“å…¥å†…å®¹è§¦å‘ä¸€ä¸ªæœç´¢è¯·æ±‚ï¼Œå°†ç»“æœç»‘å®šåˆ°ä¸¤ä¸ªUIæ§ä»¶ä¸Šã€‚</p>
<p>é¡ºä¾¿è¯´ä¸‹ï¼š<code>throttle</code>æ“ä½œç¬¦å¯ä»¥æ§åˆ¶å½“è¾“å…¥æ¡†<code>searchText</code>ä¸­çš„å†…å®¹è¶…è¿‡0.3sæ— å˜åŒ–åå†å¾€ä¸‹ç»§ç»­ï¼Œé¿å…ç”¨æˆ·è¿˜åœ¨å¿«é€Ÿè¾“å…¥æ—¶å°±è§¦å‘ä¸‹é¢çš„ç½‘ç»œè¯·æ±‚ï¼›</p>
<p>é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œä¸Šé¢ä»£ç æœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ</p>
<p>ç­”æ¡ˆä¸€ç›®äº†ç„¶ï¼Œä¸Šé¢è¯´çš„ä¸‰ä¸ªæ¡ä»¶éƒ½æ²¡æ»¡è¶³ï¼šéä¸»çº¿ç¨‹å¯¹UIæ§ä»¶èµ‹å€¼ä¸å®‰å…¨ï¼›è¯·æ±‚é”™è¯¯ä¹‹åæ— æ³•è¯†åˆ«ï¼›ç½‘ç»œè¯·æ±‚å‘ç”Ÿä¸¤æ¬¡ã€‚</p>
<p>æ€ä¹ˆè§£å†³å‘¢ï¼Ÿ</p>
<p>æ”¹è¿›åç‰ˆæœ¬ï¼š</p>
<pre><code>let results = searchText.rx.text
    .throttle(0.3, MainScheduler.instance) 
    .distinctUntilChanged()
    .flatMapLatest { query in
          API.getSearchResults(query)
            .observeOn(MainScheduler.instance) // 1
          .catchErrorJustReturn([]) // 2
    }
    .shareReplay(1) // 3  

results
    .map { &quot;\($0.count)&quot; }
    .bind(to: resultCount.rx.text) 
    .disposed(by: disposeBag)

results
    .bind(to: resultsTableView.rx.items(cellIdentifier: &quot;Cell&quot;)) { (_, result, cell) in  
        cell.textLabel?.text = &quot;\(result)&quot;
    }
    .disposed(by: disposeBag)
</code></pre><p>å®Œå…¨è§£å†³äº†ä¸Šé¢ä»£ç ä¸­å­˜åœ¨çš„é—®é¢˜ï¼Œä¸‰ä¸ªæ¡ä»¶éƒ½æ»¡è¶³ï¼š</p>
<ol>
<li>åº”ç”¨<code>observeOn()</code>æ“ä½œç¬¦ä½¿å¾—ä¹‹åä¼šåœ¨ä¸»çº¿ç¨‹å‘é€æ•°æ®ï¼›</li>
<li>åº”ç”¨<code>catchErrorJustReturn()</code>æ“ä½œç¬¦ä½¿å¾—é‡åˆ°é”™è¯¯æ—¶ä¼šè¿”å›ä¸€ä¸ªç©ºæ•°ç»„ï¼›</li>
<li>åº”ç”¨<code>shareReplay()</code>æ“ä½œç¬¦å…±äº«ç½‘ç»œè¯·æ±‚å¾—åˆ°çš„æ•°æ®ï¼›</li>
</ol>
<p>é‚£ä¹ˆé—®é¢˜åˆæ¥äº†ï¼Œä¸Šé¢ä»£ç æœ‰ä»€ä¹ˆé—®é¢˜ï¼ˆæˆ–è€…ç¼ºé™·ï¼‰ï¼Ÿ</p>
<p>ç­”æ¡ˆæ˜¯ç¨å¾®æœ‰ç‚¹éº»çƒ¦ã€‚å› ä¸ºå¯ä»¥æƒ³åƒè¿™ä¸‰ä¸ªæ“ä½œç¬¦ä¼šå¤§é‡é‡å¤ä½¿ç”¨ã€‚</p>
<p>é‚£ä¹ˆæœ‰æ²¡æœ‰æ›´å¥½çš„æ–¹å¼å‘¢ï¼Ÿ</p>
<p>ç­”æ¡ˆå½“ç„¶æ˜¯è‚¯å®šçš„ï¼Œä¹Ÿå°±æ˜¯åº”ç”¨æœ¬å°èŠ‚çš„ä¸»è§’-<code>driver</code>ã€‚</p>
<p>å®Œç¾çš„ç‰ˆæœ¬ï¼š</p>
<pre><code>let results = searchText.rx.text.asDriver() 
    .throttle(0.3, scheduler: MainScheduler.instance)
    .distinctUntilChanged()
    .flatMapLatest { query in
         API.getSearchResults(query)
            .asDriver(onErrorJustReturn: []) 
    }

results
    .map { &quot;\($0.count)&quot; }
    .drive(resultCount.rx.text)               
    .disposed(by: disposeBag)                                                            

results
    .drive(resultsTableView.rx.items(cellIdentifier: &quot;Cell&quot;)) { (_, result, cell) in  
        cell.textLabel?.text = &quot;\(result)&quot;
    }
    .disposed(by: disposeBag)
</code></pre><p>ç¨å¾®è§£é‡Šä¸€ä¸‹å‡ å¤„ä¸åŒçš„åœ°æ–¹ï¼š</p>
<ol>
<li>åº”ç”¨<code>asDriver()</code>æ“ä½œç¬¦å°†<code>ControlProperty</code>è½¬æ¢æˆä¸€ä¸ª<code>Driver</code>ï¼Œåº”ç”¨<code>asDriver(onErrorJustReturn: [])</code>ä½¿å¾—è¯·æ±‚ç»“æœé€šè¿‡ä¸€ä¸ª<code>Driver</code>å‘é€å‡ºå»ï¼›</li>
<li>åœ¨åŸæ¥åº”ç”¨<code>bind</code>æ“ä½œç¬¦çš„åœ°æ–¹å…¨æ¢æˆ<code>drive</code>æ“ä½œç¬¦ï¼Œå‚æ•°ä¸å˜ã€‚</li>
</ol>
<p>é€šè¿‡è¿™æ ·å°å°çš„è°ƒæ•´ï¼Œæ–°çš„<code>results</code>å°±è‡ªåŠ¨æ»¡è¶³äº†ä¸Šé¢è¯´çš„ä¸‰ä¸ªæ¡ä»¶ï¼Œå®Œç¾è§£å†³äº†æœ€åˆçš„é—®é¢˜ï¼š</p>
<ul>
<li>ä¸å‘é€é”™è¯¯äº‹ä»¶</li>
<li>åœ¨ä¸»çº¿ç¨‹å‘é€æ•°æ®</li>
<li>å…±äº«äº‹ä»¶æµï¼ˆæ³¨æ„å…¶å®æ˜¯<code>shareReplayLatestWhileConnected()</code>ï¼‰</li>
</ul>
<p>å¯ä»¥æƒ³è±¡ï¼Œ<code>asDriver(onErrorJustReturn: [])</code>å†…éƒ¨å®ç°å¤§æ¦‚æ˜¯è¿™æ ·ï¼š</p>
<pre><code>let safeObservable = xs
      .observeOn(MainScheduler.instance)       // observe events on main scheduler
      .catchErrorJustReturn(onErrorJustReturn) // can&apos;t error out
      .shareReplayLatestWhileConnected()       // side effects sharing
return Driver(raw: safeObservable)           // wrap it up
</code></pre><p>æ€»ç»“ä¸€ä¸‹ï¼šå‡¡æ˜¯åœ¨UIå±‚åšç»‘å®šçš„åœ°æ–¹å…¨éƒ¨æ¢æˆ<code>drive</code>æ“ä½œç¬¦æ²¡æ¯›ç—…ã€‚</p>
<p>æœ€åå†çœ‹ä¸€çœ¼æœ€å¼€å§‹å‡ºç°è¿‡çš„å›¾ç‰‡ã€‚</p>
<p><img src="http://ocepn6hgq.bkt.clouddn.com/RxSwift-from-zero-to-one-second-lesson.png" alt="1"></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ä¸Šä¸€ç¯‡ä¸»è¦æ˜¯ä¸€äº›åŸºç¡€æ¦‚å¿µï¼Œè¿™ç¯‡æ¥æ¶‰åŠäº›ç¨å¾®æ·±å¥¥éš¾æ‡‚çš„ã€‚&lt;/p&gt;
&lt;p&gt;ä»ç„¶å…ˆæ¥ä¸€å¼ å›¾é•‡å¸–ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://ocepn6hgq.bkt.clouddn.com/RxSwift-from-zero-to-one-second-lesson.png&quot; alt=&quot;1&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="FRP" scheme="http://yoursite.com/categories/FRP/"/>
    
    
      <category term="RxSwift" scheme="http://yoursite.com/tags/RxSwift/"/>
    
  </entry>
  
  <entry>
    <title>RxSwiftåŸºæœ¬æ¦‚å¿µä¸ä½¿ç”¨</title>
    <link href="http://yoursite.com/2017/04/21/RxSwift-from-zero-to-one-first-lesson/"/>
    <id>http://yoursite.com/2017/04/21/RxSwift-from-zero-to-one-first-lesson/</id>
    <published>2017-04-21T08:57:03.000Z</published>
    <updated>2017-04-26T09:48:44.000Z</updated>
    
    <content type="html"><![CDATA[<p>å»å¹´å…¬å¸é¡¹ç›®æé‡æ„æ—¶å­¦ä¹ å¹¶åº”ç”¨è¿‡ä¸€é˜µRACï¼Œæ„Ÿè§‰çœŸæ˜¯6çš„èµ·é£ã€‚è¿‘æ¥å¬è¯´åœ¨swiftä¸Šæœ‰ä¸€ä¸ªRxSwiftåº“å†™çš„æ£’æ£’çš„ï¼Œç‰¹åœ°å­¦ä¹ äº†ä¸‹ã€‚å†™ä¸‹ä¸€ç‚¹å­¦ä¹ ç¬”è®°ä»…ä¾›å‚è€ƒã€‚</p>
<p>æœ¬ç¯‡æ–‡ç« ä¸»è¦åˆ†å››ä¸ªéƒ¨åˆ†ï¼šRxSwiftç®€ä»‹ï¼ŒRxSwiftä¸­çš„åŸºæœ¬æ¦‚å¿µï¼ŒRxSwiftåŸºæœ¬ç”¨æ³•ï¼ŒRxSwiftä¸­ä¸°å¯Œè€Œç¥å¥‡çš„æ“ä½œã€‚</p>
<p>å…ˆæ¥ä¸€å¼ å›¾é•‡å¸–ã€‚</p>
<p><img src="http://ocepn6hgq.bkt.clouddn.com/RxSwift-from-zero-to-one-first-lesson.png" alt="1"></p>
<a id="more"></a>
<p>ç»§ç»­é˜…è¯»ä¹‹å‰ï¼Œå¼ºçƒˆå»ºè®®è¯»è€…å…ˆå»è¯»ä¸€éå®˜æ–¹çš„<a href="https://github.com/ReactiveX/RxSwift/blob/master/README.md" target="_blank" rel="external">ReadMe</a>ï¼Œç„¶åè¿è¡Œä¸€ä¸‹å®˜æ–¹çš„Playgroundså’ŒExampleå·¥ç¨‹ï¼Œç¨å¾®æœ‰ä¸ªå°è±¡å¯¹äºæ¥ä¸‹æ¥çš„ç†è§£ä¼šå¾ˆæœ‰å¸®åŠ©ã€‚</p>
<h2 id="RxSwiftç®€ä»‹"><a href="#RxSwiftç®€ä»‹" class="headerlink" title="RxSwiftç®€ä»‹"></a>RxSwiftç®€ä»‹</h2><p>RxSwiftæ˜¯<a href="http://reactivex.io/" target="_blank" rel="external">ReactiveX</a>åœ¨Swiftè¯­è¨€å¹³å°ä¸Šå®ç°çš„ä¸€ä¸ªå‡½æ•°å“åº”å¼ç¼–ç¨‹æ¡†æ¶ã€‚å…¼å…·å‡½æ•°å¼ä¸å“åº”å¼çš„ç‰¹æ€§ï¼Œå†åŠ ä¸ŠSwiftæœ¬èº«å·²ç»é›†ä¼—å®¶ä¹‹æ‰€é•¿ï¼Œé…åˆä½¿ç”¨ç®€ç›´å¦‚è™æ·»ç¿¼ï¼Œä½¿å¾—ä»£ç ä¼˜é›…ç®€æ´ã€‚</p>
<p>äº‹å®ä¸Šï¼Œæˆ‘ä»¬å†™çš„ç»å¤§éƒ¨åˆ†ä»£ç å…¶å®éƒ½æ˜¯ä¸ºäº†å“åº”äº‹ä»¶ï¼šå½“ä¸€ä¸ªæŒ‰é’®è¢«ç‚¹å‡»æ—¶ï¼Œéœ€è¦å†™ä¸€ä¸ª@IBActionæ–¹æ³•æ¥å¤„ç†ï¼›å½“éœ€è¦ç›‘å¬é”®ç›˜ä½ç½®å˜åŒ–æ—¶ï¼Œéœ€è¦æ³¨å†Œä¸€ä¸ªnotificationï¼›å½“ä½¿ç”¨URLSessionåšç½‘ç»œè¯·æ±‚æ—¶éœ€è¦æä¾›ä¸€ä¸ªclosureæ¥æ‰§è¡Œç»“æœï¼›æƒ³è¦æ—¶åˆ»å…³æ³¨ä¸€ä¸ªå€¼çš„å˜åŒ–æ—¶ï¼Œä½¿ç”¨KVOï¼›å¤„ç†ä¸€ä¸ªtableviewçš„ç‚¹å‡»äº‹ä»¶æ—¶ï¼Œåº”ç”¨delegateã€‚åº”ç”¨ç³»ç»Ÿæä¾›çš„å¤šç§ä¸åŒçš„æ–¹å¼æœ€ç»ˆä¼šå¯¼è‡´æˆ‘ä»¬çš„ä»£ç å¼‚å¸¸çš„å¤æ‚ä¸æ··ä¹±ã€‚å¦‚æœæœ‰ä¸€ç§æ–¹å¼å¯ä»¥å°†ä¸Šè¿°äº”ç§åˆè€Œä¸ºä¸€ï¼Œä¼šä¸ä¼šå¾ˆå¤§ç¨‹åº¦æé«˜ä»£ç å¯è¯»æ€§ï¼Ÿç­”æ¡ˆæ˜¯è‚¯å®šçš„ï¼ŒRxåšåˆ°äº†ã€‚</p>
<h2 id="RxSwiftä¸­çš„åŸºæœ¬æ¦‚å¿µ"><a href="#RxSwiftä¸­çš„åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="RxSwiftä¸­çš„åŸºæœ¬æ¦‚å¿µ"></a>RxSwiftä¸­çš„åŸºæœ¬æ¦‚å¿µ</h2><p>æ‰€è°“å“åº”å¼ç¼–ç¨‹æœ€åŸºæœ¬çš„å°±æ˜¯ä¸¤ä¸ªæ¦‚å¿µï¼šè¢«è§‚å¯Ÿè€…å’Œè§‚å¯Ÿè€…ã€‚è¢«è§‚å¯Ÿè€…èƒ½å¤Ÿå¯¹å¤–å‘é€å¯è¢«æ¥æ”¶çš„æ•°æ®ï¼Œè§‚å¯Ÿè€…èƒ½å¤Ÿè®¾ç½®å»æ¥æ”¶è¿™äº›æ•°æ®ï¼Œç„¶åå¯¹ä¸åŒæ•°æ®è¿›è¡Œä¸åŒå¤„ç†ã€‚è¿™ä¸ªè®¾ç½®çš„åŠ¨ä½œå«åšè®¢é˜…ã€‚ä»è®¾è®¡æ¨¡å¼çš„è§’åº¦è®²ï¼Œè¿™ä¸ªè¿‡ç¨‹åº”ç”¨äº†è§‚å¯Ÿè€…æ¨¡å¼ï¼Œåƒç³»ç»Ÿæä¾›çš„KVOï¼Œnotificationå…¶å®éƒ½æ˜¯è¿™ä¸€æ¨¡å¼ã€‚</p>
<h3 id="Observable-amp-Observer"><a href="#Observable-amp-Observer" class="headerlink" title="Observable &amp; Observer"></a>Observable &amp; Observer</h3><p>åœ¨RxSwiftçš„ä¸–ç•Œä¸­ï¼ŒObservableè¡¨ç¤ºè¢«è§‚å¯Ÿè€…ï¼ŒObserverè¡¨ç¤ºè§‚å¯Ÿè€…ã€‚</p>
<p>é¦–å…ˆç¡®å®šä½ å·²ç»äº†è§£äº†Swiftä¸­çš„åºåˆ—(sequence)ï¼Œä¸€ä¸ªObservableçš„å®ä¾‹å¯ä»¥ç†è§£æˆå°±æ˜¯ä¸€ä¸ªåºåˆ—ã€‚<br>è€Œä¸€ä¸ªObservableåºåˆ—æ¯”Swiftä¸­çš„åºåˆ—å¼ºå¤§ä¹‹å¤„åœ¨äºå®ƒèƒ½å¤Ÿå¼‚æ­¥æ¥æ”¶æ•°æ®ã€‚è¿™æ˜¯RxSwiftçš„ç²¾é«“ã€‚å…¶ä»–æ‰€æœ‰éƒ½æ˜¯åŸºäºè¿™ä¸€æ¦‚å¿µæ‹“å±•è€Œæ¥çš„ã€‚</p>
<p>Observableæœ‰ä¸€ä¸ªå‡½æ•°è¡¨ç¤ºè¢«è®¢é˜…ï¼Œå³subscribe(_:) ï¼Œè°ƒç”¨äº†ä¹‹åå®ƒå‘é€ä»»ä½•æ•°æ®éƒ½èƒ½è¢«æ¥æ”¶åˆ°ã€‚</p>
<p>ä»€ä¹ˆæ˜¯è®¢é˜…å‘¢ï¼Ÿä½ æ­£åœ¨çœ‹åšå®¢ï¼Œè‚¯å®šçŸ¥é“ç¥é©¬å«è®¢é˜…åšå®¢ï¼Œä¸€ä¸ªæ„æ€ã€‚</p>
<p>åˆ›å»ºä¸€ä¸ªObservableå¯¹è±¡ï¼Œæ­¤æ—¶å®ƒè¿˜åªæ˜¯æ‹¥æœ‰è¢«è§‚å¯Ÿçš„èƒ½åŠ›ï¼Œå¹¶æ²¡æœ‰å‘æŒ¥å‡ºæ¥ï¼Œç›´åˆ°è¢«è°ƒç”¨äº†è®¢é˜…å‡½æ•°subscribe(_:)ï¼Œåœ¨å“ªä¸ªå¯¹è±¡ä¸­è°ƒç”¨çš„è¿™ä¸ªå‡½æ•°ï¼Œå“ªä¸ªå¯¹è±¡å³æ˜¯Observerã€‚</p>
<p>å½“ä¸€ä¸ªObservableè¢«ä¸€ä¸ªObserverè®¢é˜…æ—¶ï¼Œå¯ä»¥è®¤ä¸ºåœ¨ä¸¤è€…ä¹‹é—´å»ºç«‹èµ·äº†ä¸€æ¡ç®¡é“ï¼ŒObservableå¯ä»¥æºæºä¸æ–­çš„å‘Observerå‘é€æ•°æ®ï¼Œç›´åˆ°ç®¡é“è¢«é”€æ¯ã€‚ä½†æ˜¯è¦æ³¨æ„ï¼Œè¿™æ˜¯ä¸€æ¡å¾ˆçª„çš„ç®¡é“ï¼Œçª„åˆ°ä¸€æ¬¡åªèƒ½é€šè¿‡ä¸€æ¡æ•°æ®ã€‚å¦‚æœå°†ä¸€æ¡æ•°æ®ç†è§£æˆä¸€ä¸ªçƒï¼Œé‚£ä¹ˆé€šä¿—çš„è¯´å°±æ˜¯ä¸€ä¸ªçƒå‘é€å®Œå†å‘é€å¦ä¸€ä¸ªçƒï¼Œè€Œç»ä¸èƒ½åŒæ—¶å‘é€ä¸¤ä¸ªçƒã€‚</p>
<h3 id="Event"><a href="#Event" class="headerlink" title="Event"></a>Event</h3><p>åˆšæ‰æåˆ°Observableå¯ä»¥å¯¹å¤–å‘é€æ•°æ®ï¼Œé‚£åº”ç”¨ä»€ä¹ˆæ ·çš„è½½ä½“æ¥è£…è¿™äº›æ•°æ®å‘¢ï¼Ÿåœ¨ä»€ä¹ˆæ ·çš„æ—¶æœºæ¥å‘é€è¿™äº›æ•°æ®å‘¢ï¼Ÿç­”æ¡ˆæ˜¯äº‹ä»¶ã€‚é‚£ä»€ä¹ˆæ˜¯äº‹ä»¶å‘¢ï¼Œæˆ‘ä¸¾å‡ ä¸ªä¾‹å­ï¼Œä¸€ä¸ªæ–‡æœ¬æ¡†å†…å®¹æ”¹å˜æ˜¯äº‹ä»¶ï¼Œä¸€ä¸ªæŒ‰é’®è¢«ç‚¹å‡»æ˜¯äº‹ä»¶ï¼Œä¸€ä¸ªåˆ—è¡¨è¢«æ»‘åŠ¨æ˜¯äº‹ä»¶ï¼Œä¸€ä¸ªç½‘ç»œè¯·æ±‚è¢«è§¦å‘æ˜¯äº‹ä»¶ï¼Œä¸€ä¸ªæ•°æ®åº“è¢«ä¿®æ”¹è¿˜æ˜¯äº‹ä»¶ã€‚</p>
<p>åœ¨RxSwiftçš„ä¸–ç•Œä¸­ï¼ŒEventè¡¨ç¤ºäº‹ä»¶ã€‚Observableåºåˆ—å¯ä»¥å‘é€å‡ºå»çš„äº‹ä»¶è¢«åˆ†æˆäº†ä¸‰ç§ç±»å‹ï¼Œåˆ†åˆ«æ˜¯nextç±»å‹ï¼Œé”™è¯¯(error)ç±»å‹å’Œå®Œæˆ(completed)ç±»å‹ã€‚å…¶ä¸­nextäº‹ä»¶å’Œé”™è¯¯äº‹ä»¶å†…éƒ¨éƒ½è£…æœ‰æ•°æ®ï¼Œè€Œå®Œæˆäº‹ä»¶å¹¶æ²¡æœ‰ã€‚</p>
<p>æ‰€ä»¥ä¸‹æ–‡ä¸­æåˆ°çš„Observableåºåˆ—å‘é€äº‹ä»¶æˆ–è€…å‘é€æ•°æ®å…¶å®éƒ½æ˜¯ä¸€ä¸ªæ„æ€ï¼Œåˆ«çº ç»“ã€‚</p>
<p>ä¸€ä¸ªObservableåºåˆ—ä½œä¸ºä¸€ä¸ªäº‹ä»¶æºç†è®ºä¸Šå½“ç„¶å¯ä»¥å‘é€ä»»æ„å¤šä¸ªäº‹ä»¶ã€‚æ‰€ä»¥è§„å®šä»¥å‘é€ä¸€ä¸ªå®Œæˆäº‹ä»¶æˆ–è€…ä¸€ä¸ªé”™è¯¯äº‹ä»¶ä½œä¸ºç»“æŸï¼Œåœ¨è¿™ä¹‹å‰å¯ä»¥å‘é€æ— é™å¤šä¸ªnextäº‹ä»¶ï¼Œä½†æ˜¯åªè¦è¿™ä¸¤ä¸ªäº‹ä»¶å…¶ä¸­ä¹‹ä¸€ä¸€å‘é€ï¼Œä»¥åå°±ä¸èƒ½å†ç»§ç»­å‘é€ä»»ä½•äº‹ä»¶äº†ã€‚</p>
<p>æ ¹æ®Observableæ˜¯å¦ä¼šå‘é€ä»£è¡¨ç»“æŸçš„äº‹ä»¶å¯ä»¥åˆ†ä¸¤ç§ç±»å‹ï¼Œæˆ‘ä¸¾2ä¸ªå…·ä½“çš„ä¾‹å­æ„Ÿå—ä¸‹ï¼Œç½‘ç»œè¯·æ±‚å¯ä»¥ä½œä¸ºä¸€ä¸ªObservableï¼Œè®¾ç½®å»è®¢é˜…å®ƒï¼Œè¢«è§¦å‘å³è°ƒç”¨APIå¾—åˆ°ç»“æœåå°†æ•°æ®è£…é…åˆ°nextäº‹ä»¶ä¸­å‘å‡ºï¼Œç„¶åæ ¹æ®ç»“æœå†³å®šå‘é€ä¸€ä¸ªé”™è¯¯äº‹ä»¶æˆ–æ˜¯ä¸€ä¸ªå®Œæˆäº‹ä»¶ï¼Œæ­¤æ—¶è¿™ä¸ªç½‘ç»œè¯·æ±‚å®Œå…¨ç»“æŸï¼Œä»¥åå†ä¸èƒ½å‘é€äº‹ä»¶ã€‚æƒ³é‡æ–°è°ƒç”¨æ­¤APIåªèƒ½åˆ›å»ºå¦ä¸€ä¸ªç½‘ç»œè¯·æ±‚ï¼›ä¸€ä¸ªæŒ‰é’®å¯ä»¥ä¹Ÿä½œä¸ºä¸€ä¸ªObservableï¼Œè®¾ç½®å»è®¢é˜…å®ƒï¼Œè¢«ç‚¹å‡»åå°±å‘é€ä¸€ä¸ªnextäº‹ä»¶ï¼Œä½†æ˜¯åªè¦è¿™ä¸ªæŒ‰é’®ä¸è¢«é”€æ¯ï¼Œå°±å¯ä»¥æºæºä¸æ–­å‘é€äº‹ä»¶ï¼Œå³ä½¿è¢«é”€æ¯æ—¶ï¼Œä¹Ÿä¸ä¼šå‘é€é”™è¯¯äº‹ä»¶æˆ–æ˜¯å®Œæˆäº‹ä»¶ã€‚</p>
<p>çœ‹ä¸€ä¸‹å®˜æ–¹å‡ºçš„å›¾æ ‡ç‰¹åˆ«å½¢è±¡ï¼š</p>
<p>â€“1â€“2â€“3â€“4â€“5â€“6â€“|â€”-&gt; // â€œ|â€ = Terminates normally: with an completed</p>
<p>â€“aâ€“bâ€“câ€“dâ€“eâ€“fâ€“Xâ€”-&gt; // â€œXâ€ = Terminates with an error</p>
<p>â€“tapâ€“tapâ€”â€”â€”-tapâ€“&gt; // â€œ|â€ = Continues indefinitely, such as a sequence of button taps</p>
<p>æ€»ç»“ä¸€ä¸‹ï¼Œè®°ä½å››ä¸ªæ ¸å¿ƒæ¦‚å¿µï¼Œä¸‰ä¸ªåè¯ï¼šObservableè¢«è§‚å¯Ÿè€…ï¼ŒObserverè§‚å¯Ÿè€…ï¼ŒEventäº‹ä»¶ï¼›ä¸€ä¸ªåŠ¨è¯ï¼šè®¢é˜…subscribeã€‚</p>
<h2 id="RxSwiftåŸºæœ¬ç”¨æ³•"><a href="#RxSwiftåŸºæœ¬ç”¨æ³•" class="headerlink" title="RxSwiftåŸºæœ¬ç”¨æ³•"></a>RxSwiftåŸºæœ¬ç”¨æ³•</h2><p>RxSwiftçš„ä½¿ç”¨è¯´èµ·æ¥éå¸¸ç®€å•ï¼šç¬¬ä¸€æ­¥åˆ›å»ºä¸€ä¸ªObservableåºåˆ—ï¼›ç¬¬äºŒæ­¥å»è®¢é˜…å®ƒï¼Œæ­¤æ—¶å¯ä»¥æå‰è®¾ç½®å¥½é‡åˆ°ä¸åŒçš„äº‹ä»¶æ¶ˆæ¯è¿›è¡Œä¸åŒç›¸åº”çš„å¤„ç†ï¼›ç¬¬ä¸‰æ­¥è®°å¾—åœ¨é€‚å½“çš„æ—¶å€™é”€æ¯ï¼Œå›æ”¶èµ„æºã€‚</p>
<p>ä¸‰ä¸ªæ­¥éª¤æ ¸å¿ƒå…³é”®è¯ï¼šåˆ›å»ºcreateï¼Œè®¢é˜…subscribeï¼Œé”€æ¯disposeã€‚</p>
<h3 id="åˆ›å»º-create-amp-è®¢é˜…-subscribe"><a href="#åˆ›å»º-create-amp-è®¢é˜…-subscribe" class="headerlink" title="åˆ›å»º create &amp; è®¢é˜… subscribe"></a>åˆ›å»º create &amp; è®¢é˜… subscribe</h3><p>å‰é¢æåˆ°è¿‡ï¼Œåˆ›å»ºä¸€ä¸ªObservableå¯¹è±¡ååªæœ‰è°ƒç”¨è®¢é˜…å‡½æ•°æ‰èƒ½è®©å…¶å°†èƒ½åŠ›å‘æŒ¥å‡ºæ¥ï¼Œæ‰€ä»¥ä¸¤è€…éœ€è¦é…åˆä½¿ç”¨ã€‚</p>
<p>é’ˆå¯¹Observableåºåˆ—å¯ä»¥å‘å‡ºçš„ä¸‰ç§ä¸åŒç±»å‹äº‹ä»¶ï¼Œè®¢é˜…æ—¶ä¹Ÿå¯ä»¥æœ‰é€‰æ‹©æ€§çš„åªè®¢é˜…å•ä¸€ç±»å‹çš„äº‹ä»¶æˆ–è€…å…¨éƒ¨ç±»å‹çš„äº‹ä»¶ã€‚</p>
<p>è®¢é˜…æ‰€æœ‰ç±»å‹äº‹ä»¶ï¼š<code>subscribe(_:)</code></p>
<p>åªè®¢é˜…nextç±»å‹äº‹ä»¶ï¼š<code>subscribe(onNext:)</code></p>
<p>åªè®¢é˜…é”™è¯¯ç±»å‹äº‹ä»¶ï¼š<code>subscribe(onError:)</code></p>
<p>åªè®¢é˜…å®Œæˆç±»å‹äº‹ä»¶ï¼š<code>subscribe(onCompleted:)</code></p>
<p>åˆ†åˆ«è®¢é˜…æ‰€æœ‰ç±»å‹äº‹ä»¶ï¼š<code>subscribe(onNext:onError:onCompleted:)</code></p>
<p>å¦å¤–ï¼Œé€šå¸¸è°ƒç”¨è®¢é˜…å‡½æ•°<code>subscribe(_:)</code>ä¹‹åçš„è¿”å›å€¼éƒ½èµ·åå«åš<code>***Subscription</code>ã€‚</p>
<h4 id="å¿«é€Ÿåˆ›å»º"><a href="#å¿«é€Ÿåˆ›å»º" class="headerlink" title="å¿«é€Ÿåˆ›å»º"></a>å¿«é€Ÿåˆ›å»º</h4><p>RxSwiftè‡ªå¸¦ä¸€äº›å¯ä»¥å¿«é€Ÿåˆ›å»ºObservableåºåˆ—çš„æ“ä½œç¬¦ï¼Œåº”ç”¨å®ƒä»¬åˆ›å»ºåçš„åºåˆ—æœ¬èº«å·²ç»å…·æœ‰å‘é€äº‹ä»¶çš„èƒ½åŠ›ã€‚ä¸€ä¸ªObservableåºåˆ—å¯ä»¥å‘é€ä»»æ„ä¸ªnextäº‹ä»¶ç›´åˆ°å‘é€äº†ä¸€ä¸ªå®Œæˆäº‹ä»¶æˆ–è€…é”™è¯¯äº‹ä»¶ä½œä¸ºç»“æŸã€‚</p>
<h5 id="never"><a href="#never" class="headerlink" title="never"></a>never</h5><p>åˆ›å»ºä¸€ä¸ªæ°¸ä¸å‘é€ä»»ä½•äº‹ä»¶ä¸”æ°¸ä¸è‡ªåŠ¨ç»ˆç»“çš„åºåˆ—ã€‚</p>
<p>ä¸¾ä¸ªğŸŒ°ï¼š</p>
<pre><code>let disposeBag = DisposeBag() // 1
let neverSequence = Observable&lt;String&gt;.never()

let neverSequenceSubscription = neverSequence
    .subscribe { _ in
        print(&quot;This will never be printed&quot;)
}

neverSequenceSubscription.disposed(by: disposeBag) // 1
</code></pre><p>ç»“æœæ˜¯ä»€ä¹ˆä¹Ÿä¸è¾“å‡ºã€‚</p>
<p>è¯´æ˜ï¼šè¿™ä¸¤è¡Œä»£ç éƒ½æ˜¯å’Œèµ„æºå›æ”¶ç›¸å…³ï¼Œä¸‹é¢ä¼šè®²åˆ°ï¼Œæš‚æ—¶å…ˆå¿½ç•¥ã€‚</p>
<h5 id="empty"><a href="#empty" class="headerlink" title="empty"></a>empty</h5><p>åˆ›å»ºä¸€ä¸ªåªä¼šå‘é€ä¸€ä¸ªå®Œæˆäº‹ä»¶çš„Observableåºåˆ—ã€‚</p>
<p>ä¸¾ä¸ªğŸŒ°ï¼š</p>
<pre><code>let disposeBag = DisposeBag()

Observable&lt;Int&gt;.empty()
    .subscribe { event in
        print(event)
    }
    .disposed(by: disposeBag)
</code></pre><p>ç»“æœæ˜¯ï¼š</p>
<pre><code>completed
</code></pre><h5 id="just"><a href="#just" class="headerlink" title="just"></a>just</h5><p>åˆ›å»ºä¸€ä¸ªåªä¼šå‘é€ä¸€ä¸ªnextäº‹ä»¶å’Œä¸€ä¸ªå®Œæˆäº‹ä»¶çš„Observableåºåˆ—ã€‚</p>
<p>ä¸¾ä¸ªğŸŒ°ï¼š</p>
<pre><code>let disposeBag = DisposeBag()

Observable.just(&quot;ğŸ”´&quot;)
    .subscribe { event in
        print(event)
    }
    .disposed(by: disposeBag)
</code></pre><p>ç»“æœæ˜¯ï¼š</p>
<pre><code>next(ğŸ”´)
completed
</code></pre><h5 id="of"><a href="#of" class="headerlink" title="of"></a>of</h5><p>åˆ›å»ºä¸€ä¸ªä¼šå‘é€å›ºå®šæ•°é‡æ•°æ®çš„Observableåºåˆ—ã€‚</p>
<p>ä¸¾ä¸ªğŸŒ°ï¼š</p>
<pre><code>let disposeBag = DisposeBag()

Observable.of(&quot;ğŸ¶&quot;, &quot;ğŸ±&quot;, &quot;ğŸ­&quot;, &quot;ğŸ¹&quot;)
    .subscribe(onNext: { element in
        print(element)
    })
    .disposed(by: disposeBag)
</code></pre><p>ç»“æœæ˜¯ï¼š</p>
<pre><code>ğŸ¶
ğŸ±
ğŸ­
ğŸ¹
</code></pre><p>æ³¨æ„æ­¤ä¾‹å­ä¸­åªè®¢é˜…äº†nextäº‹ä»¶ï¼Œæ‰€ä»¥å¹¶æ²¡æœ‰åƒä¸Šä¸¤ä¸ªä¾‹å­ä¸€æ ·æ‰“å°<code>completed</code>ã€‚</p>
<h5 id="from"><a href="#from" class="headerlink" title="from"></a>from</h5><p>ä»ä¸€ä¸ªSwiftçš„ç³»ç»Ÿç±»Arrayï¼ŒDictionaryï¼ŒSetè¿™æ ·çš„åºåˆ—ä¸­åˆ›å»ºä¸€ä¸ªObservableåºåˆ—ã€‚</p>
<p>ä¸¾ä¸ªğŸŒ°ï¼š</p>
<pre><code>let disposeBag = DisposeBag()

Observable.from([&quot;ğŸ¶&quot;, &quot;ğŸ±&quot;, &quot;ğŸ­&quot;, &quot;ğŸ¹&quot;])
    .subscribe(onNext: { print($0) })
    .disposed(by: disposeBag)
</code></pre><p>ç»“æœæ˜¯ï¼š</p>
<pre><code>ğŸ¶
ğŸ±
ğŸ­
ğŸ¹
</code></pre><h5 id="range"><a href="#range" class="headerlink" title="range"></a>range</h5><p>åˆ›å»ºä¸€ä¸ªä¼šå‘é€ä¸€ä¸ªèŒƒå›´å†…çš„è¿ç»­æ•´æ•°çš„Observableåºåˆ—ã€‚</p>
<p>ä¸¾ä¸ªğŸŒ°ï¼š</p>
<pre><code>let disposeBag = DisposeBag()

Observable.range(start: 1, count: 10)
    .subscribe { print($0) }
    .disposed(by: disposeBag)
</code></pre><p>ç»“æœæ˜¯ï¼š</p>
<pre><code>next(1)
next(2)
next(3)
next(4)
next(5)
next(6)
next(7)
next(8)
next(9)
next(10)
completed
</code></pre><h5 id="repeatElement"><a href="#repeatElement" class="headerlink" title="repeatElement"></a>repeatElement</h5><p>åˆ›å»ºä¸€ä¸ªä¼šé‡å¤å‘é€ç‰¹å®šæ•°æ®çš„Observableåºåˆ—ã€‚</p>
<p>ä¸¾ä¸ªğŸŒ°ï¼š</p>
<pre><code>let disposeBag = DisposeBag()

Observable.repeatElement(&quot;ğŸ”´&quot;)
    .take(3)  // 1
    .subscribe(onNext: { print($0) })
    .disposed(by: disposeBag)
</code></pre><p>ç»“æœæ˜¯ï¼š</p>
<pre><code>ğŸ”´
ğŸ”´
ğŸ”´
</code></pre><p>è¯´æ˜ï¼šè¿™é‡Œä½¿ç”¨äº†ä¸€ä¸ªtakeæ“ä½œç¬¦ï¼Œç”¨æ¥æ§åˆ¶å‘é€æ•°æ®çš„æ¬¡æ•°ï¼Œåé¢ä¼šè®²åˆ°ï¼Œæš‚æ—¶å…ˆå¿½ç•¥ã€‚</p>
<h5 id="generate"><a href="#generate" class="headerlink" title="generate"></a>generate</h5><p>æœ‰ä¸€ä¸ªåˆå§‹å€¼ä¸€ä¸ªåˆ¤æ–­æ¡ä»¶å’Œä¸€ä¸ªæ”¹å˜æ•°æ®å†…å®¹çš„å‡½æ•°ï¼Œåˆ›å»ºä¸€ä¸ªåªè¦æ¡ä»¶æ»¡è¶³å°±ä¼šå‘é€æ•°æ®çš„Observableåºåˆ—ã€‚</p>
<p>ä¸¾ä¸ªğŸŒ°ï¼š</p>
<pre><code>let disposeBag = DisposeBag()

Observable.generate(
        initialState: 0,
        condition: { $0 &lt; 3 },
        iterate: { $0 + 1 }
    )
    .subscribe(onNext: { print($0) })
    .disposed(by: disposeBag)
</code></pre><p>ç»“æœæ˜¯ï¼š</p>
<pre><code>0
1
2
</code></pre><h5 id="interval"><a href="#interval" class="headerlink" title="interval"></a>interval</h5><p>åˆ›å»ºä¸€ä¸ªé—´éš”å›ºå®šæ—¶é—´å°±ä¼šå‘é€ä¸€ä¸ªnextäº‹ä»¶çš„Observableåºåˆ—ã€‚</p>
<p>ä¸¾ä¸ªğŸŒ°ï¼š</p>
<pre><code>let disposeBag = DisposeBag()

Observable&lt;Int&gt;.interval(1, scheduler: MainScheduler.instance)
   .subscribe(onNext: { print($0) })
   .disposed(by: disposeBag)
</code></pre><p>ç»“æœæ˜¯ï¼š</p>
<pre><code>0
1
2
3
4
5
6
...
</code></pre><p>è¯´æ˜ï¼š<code>MainScheduler.instance</code>è¿™é‡Œä»£è¡¨ä¸»çº¿ç¨‹ï¼Œå¤šçº¿ç¨‹ç›¸å…³çŸ¥è¯†ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­ä¼šæœ‰ä»‹ç»ï¼Œæš‚æ—¶å…ˆå¿½ç•¥ã€‚</p>
<h5 id="error"><a href="#error" class="headerlink" title="error"></a>error</h5><p>åˆ›å»ºä¸€ä¸ªä¼šç«‹å³å‘é€ä¸€ä¸ªé”™è¯¯äº‹ä»¶çš„Observableåºåˆ—ã€‚</p>
<p>ä¸¾ä¸ªğŸŒ°ï¼š</p>
<pre><code>let disposeBag = DisposeBag()

Observable&lt;Int&gt;.error(TestError.test)
    .subscribe { print($0) }
    .disposed(by: disposeBag)
</code></pre><p>ç»“æœæ˜¯ï¼š</p>
<pre><code>error(test)
</code></pre><p>ä¸Šé¢å‡ºç°çš„æ‰€æœ‰æ“ä½œç¬¦å…¶å®å¯ä»¥åˆ†å››ç§ï¼Œ<code>never</code>ä¸å‘é€ä»»ä½•äº‹ä»¶ï¼Œ<code>interval</code>ä¸€ç›´å‘é€nextäº‹ä»¶ï¼Œ<code>error</code>ä»…å‘é€ä¸€ä¸ªé”™è¯¯äº‹ä»¶ï¼Œå…¶ä»–çš„å‘é€å®Œnextäº‹ä»¶ä¹‹åéƒ½ä¼šå‘é€ä¸€ä¸ªå®Œæˆäº‹ä»¶ã€‚</p>
<h4 id="åŸºæœ¬åˆ›å»º"><a href="#åŸºæœ¬åˆ›å»º" class="headerlink" title="åŸºæœ¬åˆ›å»º"></a>åŸºæœ¬åˆ›å»º</h4><h5 id="create"><a href="#create" class="headerlink" title="create"></a>create</h5><p>åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„Observableåºåˆ—ã€‚</p>
<p>æ­¤æ—¶éœ€è¦æ‰‹åŠ¨è®¾ç½®å‘é€äº‹ä»¶çš„ç±»å‹å’Œæ—¶æœºï¼Œå¹¶ä¸”è¦æ³¨æ„åœ¨å‘é€å®Œnextäº‹ä»¶ä¹‹åéœ€è¦å‘é€ä¸€ä¸ªå®Œæˆäº‹ä»¶æˆ–è€…é”™è¯¯äº‹ä»¶è¡¨ç¤ºç»“æŸã€‚</p>
<p>å…ˆæ¥çœ‹ä¸€ä¸ªğŸŒ°ï¼š</p>
<pre><code>let disposeBag = DisposeBag()
var count = 1
let myJust = { (element: String) -&gt; Observable&lt;String&gt; in
    print(&quot;Creating \(count)&quot;)
    count += 1
    return Observable.create { observer in // 1
        print(&quot;Emitting...&quot;)
        observer.on(.next(element))
        observer.on(.completed)  // 2
        return Disposables.create()  // 3
    }
}

myJust(&quot;ğŸ”´&quot;)
    .subscribe { print($0) }
    .disposed(by: disposeBag)  // 3
myJust(&quot;ğŸŒ°&quot;)
    .subscribe { print($0) }
    .disposed(by: disposeBag)
</code></pre><p>è¾“å‡ºç»“æœæ˜¯ï¼š</p>
<pre><code>Creating 1
Emitting...
next(ğŸ”´)
completed
Creating 2
Emitting...
next(ğŸŒ°)
completed
</code></pre><p>è§£é‡Šä¸€ä¸‹ä¸Šé¢çš„ä»£ç ï¼š</p>
<ol>
<li>é¦–å…ˆå‘ç°åˆ›å»ºObservableæ—¶å†…éƒ¨ä¹Ÿæœ‰ä¸€ä¸ªobserverï¼Œå­—é¢æ„æ€ä¹Ÿæ˜¯è§‚å¯Ÿè€…ã€‚è€Œå‰é¢æåˆ°è°ƒç”¨<code>subscribe</code>çš„å¯¹è±¡æ‰æ˜¯è§‚å¯Ÿè€…ï¼Œé‚£ç°åœ¨æ€ä¹ˆæœ‰ä¸¤ä¸ªè§‚å¯Ÿè€…ï¼Ÿä¸è¦æ‡µé€¼ï¼Œç¡®å®æœ‰ä¸¤ä¸ªä½†æ˜¯èŒè´£ä¸åŒï¼Œå¤–éƒ¨çš„observeræ˜¯ä¸ºäº†è§‚å¯ŸObservableå‘å‡ºä¸åŒæ•°æ®ä»¥ä¾¿è¿›è¡Œä¸åŒå¤„ç†ï¼Œè€Œå†…éƒ¨çš„observeræ˜¯ä¸ºäº†å‘å¤–å‘é€æ•°æ®ã€‚äº‹å®ä¸Šå¦‚æœè¿˜æ˜¯è§‰å¾—å¥‡æ€ªå¯ä»¥æ”¹æˆä»»æ„åå­—ï¼Œåªè¦ä¸å½±å“å‘é€æ•°æ®å°±å¥½ï¼›</li>
<li>æœ€åè¦å‘é€ä¸€ä¸ªå®Œæˆäº‹ä»¶ä½œä¸ºç»“æŸæ ‡å¿—ï¼›</li>
<li>ä»ç„¶æ˜¯å’Œèµ„æºå›æ”¶ç›¸å…³ï¼Œä¸‹é¢ä¼šè®²åˆ°ï¼Œæš‚æ—¶ä»å¿½ç•¥ã€‚</li>
</ol>
<p>createçš„é—­åŒ…ä¸­æœ‰ä¸€ä¸ªobserverå¯¹è±¡è´Ÿè´£å»å‘é€äº‹ä»¶ï¼Œä»ç„¶æ˜¯nextäº‹ä»¶å’Œé”™è¯¯äº‹ä»¶éœ€è¦æœ‰æ•°æ®ï¼Œè€Œå®Œæˆäº‹ä»¶ä¸éœ€è¦æœ‰æ•°æ®ã€‚</p>
<p>å‘é€æ‰€æœ‰ç±»å‹äº‹ä»¶ï¼š<code>on(_:)</code>  </p>
<p>å…·ä½“åˆ†ä¸ºï¼š<code>on(.next())</code>, <code>on(.error())</code>, <code>on(.completed)</code></p>
<p>ä»…å‘é€nextç±»å‹äº‹ä»¶ï¼š<code>onNext(_:)</code> </p>
<p>ä»…å‘é€é”™è¯¯ç±»å‹äº‹ä»¶ï¼š<code>onError(_:)</code></p>
<p>ä»…å‘é€å®Œæˆç±»å‹äº‹ä»¶ï¼š<code>onCompleted()</code></p>
<h5 id="doOn"><a href="#doOn" class="headerlink" title="doOn"></a>doOn</h5><p><code>doOn</code>æ“ä½œå¹¶ä¸æ˜¯ä¸ºäº†åˆ›å»ºObservableåºåˆ—ã€‚è€Œæ˜¯ä¸ºäº†ä½¿å¾—Observableåºåˆ—å¯ä»¥åœ¨å‘é€äº‹ä»¶ä¹‹å‰å…ˆæ¥åšä¸€äº›äº‹æƒ…ã€‚</p>
<p>ä¸¾ä¸ªğŸŒ°ï¼š</p>
<pre><code>let disposeBag = DisposeBag()

Observable.of(&quot;ğŸ&quot;, &quot;ğŸ&quot;, &quot;ğŸŠ&quot;, &quot;ğŸ‹&quot;)
    .do(onNext: { print(&quot;Intercepted:&quot;, $0) }, onError: { print(&quot;Intercepted error:&quot;, $0) }, onCompleted: { print(&quot;Completed&quot;)  })
    .subscribe(onNext: { print($0) })
    .disposed(by: disposeBag)
</code></pre><p>ç»“æœæ˜¯ï¼š</p>
<pre><code>Intercepted: ğŸ
ğŸ
Intercepted: ğŸ
ğŸ
Intercepted: ğŸŠ
ğŸŠ
Intercepted: ğŸ‹
ğŸ‹
Completed
</code></pre><p>å¯ä»¥çœ‹å‡ºåœ¨æ¯æ¬¡å‘é€äº‹ä»¶ä¹‹å‰éƒ½åšäº†ä¸€æ¬¡æ‰“å°ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰æ”¹å˜è¦å‘é€æ•°æ®çš„å€¼ã€‚</p>
<p>å¦‚ä¾‹å­ä¸­å±•ç¤ºï¼Œå‡½æ•°ä¸ºï¼š<code>do(onNext:onError:onCompleted:)</code> ï¼Œå¯ä»¥å¯¹ä¸€ä¸ªæˆ–å¤šä¸ªå‚æ•°èµ‹å€¼ï¼Œä»è€Œé€‰æ‹©åœ¨å‘é€ç›¸åº”ç±»å‹äº‹ä»¶ä¹‹å‰åšäº›äº‹æƒ…ã€‚</p>
<h3 id="é”€æ¯-dispose"><a href="#é”€æ¯-dispose" class="headerlink" title="é”€æ¯ dispose"></a>é”€æ¯ dispose</h3><p>ä¸Šé¢ä»‹ç»äº†å¦‚ä½•åˆ›å»ºä¸€ä¸ªObservableåºåˆ—å¹¶ä¸”å»è®¢é˜…å®ƒï¼Œé‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œå½“è¿™ä¸ªåºåˆ—ä¸å†å‘é€æ–°äº‹ä»¶äº†ï¼Œæ­¤æ—¶å¦‚æœå†ç»§ç»­è®¢é˜…å°±æ²¡æœ‰æ„ä¹‰äº†ï¼Œå¦‚ä½•è¿›è¡Œå–æ¶ˆæˆ–è€…è¯´å¦‚ä½•å›æ”¶è¿™ä¸€éƒ¨åˆ†å†…å­˜èµ„æºå‘¢ï¼Ÿ</p>
<h4 id="æ‰‹åŠ¨-Disposable"><a href="#æ‰‹åŠ¨-Disposable" class="headerlink" title="æ‰‹åŠ¨ Disposable"></a>æ‰‹åŠ¨ Disposable</h4><p>å›åˆ°è®¢é˜…å‡½æ•°ï¼š</p>
<pre><code>public func subscribe(_ on: ) -&gt; Disposable
</code></pre><p>æˆ‘ä»¬å‘ç°è®¢é˜…å‡½æ•°è¿”å›ç±»å‹æ˜¯Disposableåè®®ï¼Œè¿™ä¸ªåè®®ä¸­åªæœ‰ä¸€ä¸ªå‡½æ•°:</p>
<pre><code>func dispose()
</code></pre><p>äºæ˜¯ä¹é€šè¿‡è°ƒç”¨è¿™ä¸ªå‡½æ•°å¯ä»¥è¿›è¡Œèµ„æºå›æ”¶ã€‚</p>
<p>ä¸¾ä¸ªğŸŒ°ï¼š</p>
<pre><code>let subscription = Observable&lt;Int&gt;.interval(0.3, scheduler: MainScheduler.instance)   // 1
    .subscribe (onNext: { print($0) })

delay(2) {    // 2 
    subscription.dispose()
}
</code></pre><p>ç»“æœæ˜¯ï¼š</p>
<pre><code>0
1
2
3
4
5
</code></pre><p>è§£é‡Šä¸€ä¸‹ä¸Šé¢çš„ä»£ç ï¼š</p>
<ol>
<li>åˆ›å»ºä¸€ä¸ªé—´éš”0.3såœ¨ä¸»çº¿ç¨‹å‘é€æ•´å½¢å˜é‡çš„Observableï¼›</li>
<li>å»¶è¿Ÿ2sæ‰§è¡Œï¼Œéç³»ç»Ÿæä¾›ï¼Œç†è§£æ„æ€å³å¯ã€‚</li>
</ol>
<p>å¯ä»¥å°†<code>subscription.dispose()</code>æ³¨é‡Šæ‰å¯¹æ¯”ä¸€ä¸‹ç»“æœï¼Œä¼šå‘ç°åœ¨è°ƒç”¨äº† <code>dispose()</code> å‡½æ•°ä¹‹åï¼Œåˆ›å»ºçš„Observableåºåˆ—å°±ä¸å†å‘é€æ–°çš„äº‹ä»¶äº†ï¼Œè¯æ˜èµ„æºå·²ç»è¢«å›æ”¶äº†ã€‚</p>
<p>å®é™…å¼€å‘å½“ä¸­è¿™ç§æ–¹å¼å¹¶ä¸å¸¸ç”¨ï¼Œå› ä¸ºé€šå¸¸å¹¶ä¸èƒ½å¾ˆå¥½çš„æŒæ§è°ƒç”¨<code>dispose()</code> å‡½æ•°çš„æ—¶æœºï¼Œæ›´æ¨èä¸‹é¢ä¸€ç§å‡½æ•°ã€‚</p>
<h4 id="è‡ªåŠ¨-DisposeBag"><a href="#è‡ªåŠ¨-DisposeBag" class="headerlink" title="è‡ªåŠ¨ DisposeBag"></a>è‡ªåŠ¨ DisposeBag</h4><p>ä¸Šé¢ä»‹ç»äº†å¾ˆå¤šåˆ›å»ºObservableåºåˆ—çš„å‡½æ•°ï¼Œè§‚å¯Ÿä¹‹å‰çš„ä¾‹å­ä¸­é€šç”¨çš„ä»£ç æœ‰å¦‚ä¸‹ä¸¤è¡Œï¼š</p>
<pre><code>let disposeBag = DisposeBag()

.disposed(by: disposeBag)
</code></pre><p>å…ˆè¯´ä¸€ä¸‹ä»€ä¹ˆæ˜¯DisposeBag ï¼Œå®ƒæ˜¯RxSwiftåˆ›é€ çš„å¦ä¸€ä¸ªé‡è¦çš„æ¦‚å¿µï¼Œå¯ä»¥ç›´è¯‘æˆç”¨äºé”€æ¯çš„åŒ…ã€‚å…¶å®å°±æ˜¯ä¸€ä¸ªç±»ä¼¼åƒåœ¾è¢‹çš„ä¸œè¥¿ã€‚æˆ‘è¿˜æ˜¯ä¸¾ä¸€ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬åœ¨å®¶é‡Œåƒè¥¿ç“œæ—¶ä¼šå‰©ä¸‹ä¸€å †è¥¿ç“œçš®ï¼Œä½†æ˜¯æˆ‘ä»¬ä¸ä¼šåƒä¸€å—è¥¿ç“œå‰©ä¸‹ä¸€å—è¥¿ç“œçš®å°±æ‰”åˆ°æ¥¼ä¸‹çš„åƒåœ¾æ¡¶ï¼Œå¦åˆ™ä½ ä¼šç´¯æ­»ã€‚è€Œæ˜¯å…ˆæ”¾åˆ°ä¸€ä¸ªåƒåœ¾è¢‹é‡Œï¼Œç­‰åˆ°åˆ‡å¥½çš„è¥¿ç“œéƒ½è¢«åƒå®Œäº†å°†æ‰€æœ‰çš„è¥¿ç“œçš®æ”¾åˆ°åƒåœ¾è¢‹ä¸­ä¸€æ¬¡æ€§æ‰”åˆ°æ¥¼ä¸‹çš„åƒåœ¾æ¡¶ã€‚</p>
<p>DisposeBagçš„ä½¿ç”¨å…¶å®ä¹Ÿæ˜¯è¿™ä¸ªæ€è·¯ï¼ˆä½œè€…é»˜è®¤ä½ æ˜¯åœ¨ARCçš„ç¯å¢ƒä¸‹è¿›è¡Œå¼€å‘ï¼Œå¦åˆ™åˆ«å¾€ä¸‹çœ‹äº†ï¼‰ã€‚é¦–å…ˆåœ¨ä¸€ä¸ªç±»ä¸­åˆ›å»ºä¸€ä¸ªDisposeBagçš„å®ä¾‹ï¼Œé€šå¸¸èµ·åå­—å«åš<code>disposeBag</code>ï¼ˆæ‰“å¼€ä¸€ä¸ªåƒåœ¾è¢‹ï¼‰ï¼Œç„¶åå°†å„ç§è®¢é˜…åè¿”å›çš„Disposableç±»å‹çš„å¯¹è±¡è°ƒç”¨è¿™ä¸ª<code>disposed(by:)</code> å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯åŠ å…¥åˆ°è¿™ä¸ªå®ä¾‹ä¸­ï¼ˆå°†ä¸€å—è¥¿ç“œçš®æ”¾åˆ°è¿™ä¸ªåƒåœ¾è¢‹ä¸­ï¼‰ã€‚ç¨‹åºè¿è¡Œæ—¶å½“è¿™ä¸ªç±»çš„å®ä¾‹è¢«ARCç³»ç»Ÿè‡ªåŠ¨å›æ”¶æ—¶ï¼Œä¼šæ¸…ç©ºå†…éƒ¨æ‰€æœ‰å¯¹è±¡å¹¶é‡Šæ”¾ç›¸åº”èµ„æºå½“ç„¶ä¹ŸåŒ…æ‹¬è¿™ä¸ª<code>disposeBag</code>ï¼ˆå°†åƒåœ¾è¢‹æ‰”åˆ°æ¥¼ä¸‹åƒåœ¾æ¡¶ï¼‰ã€‚</p>
<p>è€Œè¿™ä¹Ÿè§£é‡Šäº†ä¸ºä»€ä¹ˆåœ¨<code>create</code>ä¸€ä¸ªObservableæ—¶é—­åŒ…é‡Œæœ€åè¦æ·»åŠ è¿™ä¹ˆä¸€ä¸ªè¡Œä»£ç ï¼š</p>
<pre><code>return Disposables.create()
</code></pre><h2 id="Subjects"><a href="#Subjects" class="headerlink" title="Subjects"></a>Subjects</h2><p>Subjectæ˜¯RxSwiftåˆ›é€ çš„å¦ä¸€ä¸ªé‡è¦çš„æ¦‚å¿µï¼Œå®ƒæ—¢æ˜¯Observableåˆæ˜¯Observerï¼Œå¹¶ä¸”å¯ä»¥è¯´æ˜¯ä¸¤è€…ä¹‹é—´çš„ä¸€ç§æ¡¥æ¢ã€‚ä½œä¸ºä¸€ä¸ªobserverï¼Œå®ƒå¯ä»¥åŒæ—¶è®¢é˜…ä¸€ä¸ªæˆ–å¤šä¸ªObservableï¼Œä½œä¸ºä¸€ä¸ªObservableï¼Œå®ƒèƒ½å¤Ÿä¼ é€’å®ƒè®¢é˜…çš„Observableå‘å‡ºçš„äº‹ä»¶ï¼ŒåŒæ—¶è‡ªå·±ä¹Ÿèƒ½å‘é€æ–°çš„äº‹ä»¶ã€‚</p>
<h3 id="PublishSubject"><a href="#PublishSubject" class="headerlink" title="PublishSubject"></a>PublishSubject</h3><p>å‘å®ƒçš„æ‰€æœ‰è®¢é˜…è€…å‘é€ï¼ˆå¹¿æ’­ï¼‰æ–°çš„äº‹ä»¶ã€‚</p>
<p>ä¸¾ä¸ªğŸŒ°ï¼š</p>
<pre><code>let disposeBag = DisposeBag()
let subject = PublishSubject&lt;String&gt;()

subject.addObserver(&quot;1&quot;).disposed(by: disposeBag) // 1
subject.onNext(&quot;ğŸ¶&quot;)  // 2
subject.onNext(&quot;ğŸ±&quot;)

subject.addObserver(&quot;2&quot;).disposed(by: disposeBag) 
subject.onNext(&quot;ğŸ…°ï¸&quot;)
subject.onNext(&quot;ğŸ…±ï¸&quot;)
</code></pre><p>ç»“æœæ˜¯ï¼š</p>
<pre><code>Subscription: 1 Event: next(ğŸ¶)
Subscription: 1 Event: next(ğŸ±)
Subscription: 1 Event: next(ğŸ…°ï¸)
Subscription: 2 Event: next(ğŸ…°ï¸)
Subscription: 1 Event: next(ğŸ…±ï¸)
Subscription: 2 Event: next(ğŸ…±ï¸)
</code></pre><p>é¦–å…ˆè¦æ³¨æ„ä¸Šé¢ä½¿ç”¨äº†ä¸€ä¸ª<code>addObserver</code>å‡½æ•°ï¼Œå®ƒçš„å®šä¹‰æ˜¯è¿™æ ·çš„ï¼š</p>
<pre><code>func addObserver(_ id: String) -&gt; Disposable {
     return subscribe { print(&quot;Subscription:&quot;, id, &quot;Event:&quot;, $0) }
}
</code></pre><p>å…¶å®ä¹Ÿå°±æ˜¯å°è£…äº†ä¸€ä¸‹<code>subscribe</code> å‡½æ•°ï¼Œè¿™æ˜¯ä¸ºäº†åœ¨å‡ ä¸ªä¾‹å­ä¸­å¯ä»¥å…±ç”¨ã€‚</p>
<p>ç„¶åè§£é‡Šä¸€ä¸‹ä¸Šé¢çš„ä»£ç ï¼š</p>
<ol>
<li>å› ä¸º<code>subject</code>æ˜¯ä¸€ä¸ªobserverï¼Œæ‰€ä»¥å¯ä»¥è®¢é˜…Observableï¼›</li>
<li>å› ä¸º<code>subject</code>æ˜¯ä¸€ä¸ªObservableï¼Œæ‰€ä»¥å¯ä»¥å‘é€æ•°æ®ã€‚</li>
</ol>
<p>è§‚å¯Ÿæ‰“å°ç»“æœå¯ä»¥å‘ç°ï¼š</p>
<ol>
<li>è®¢é˜…ä¹‹åå‘å‡ºçš„äº‹ä»¶å¯ä»¥æ¥æ”¶åˆ°ï¼Œä½†ä¹‹å‰çš„äº‹ä»¶æ¥æ”¶ä¸åˆ°ï¼›</li>
<li>è¿™å¾ˆæ­£å¸¸ï¼Œå’Œä¸Šé¢åˆ›å»ºObservableç„¶åå»è®¢é˜…å¾—åˆ°çš„ç»“æœæ˜¯ä¸€æ ·çš„ã€‚</li>
</ol>
<h3 id="ReplaySubject"><a href="#ReplaySubject" class="headerlink" title="ReplaySubject"></a>ReplaySubject</h3><p>ä»ç„¶æ˜¯å‘å®ƒçš„æ‰€æœ‰è®¢é˜…è€…å‘é€ï¼ˆå¹¿æ’­ï¼‰æ–°çš„äº‹ä»¶ï¼Œä½†åŒæ—¶æœ‰ä¸€ä¸ªç¼“å­˜æœºåˆ¶ï¼Œé€šè¿‡è®¾ç½®<code>bufferSize</code>çš„å€¼å¯ä»¥å‘æ–°çš„è®¢é˜…è€…é‡æ–°å‘é€å›ºå®šæ•°é‡çš„å†å²äº‹ä»¶ã€‚</p>
<p>ä¸¾ä¸ªğŸŒ°ï¼š</p>
<pre><code>let disposeBag = DisposeBag()
let subject = ReplaySubject&lt;String&gt;.create(bufferSize: 1)

subject.addObserver(&quot;1&quot;).disposed(by: disposeBag) 
subject.onNext(&quot;ğŸ¶&quot;)
subject.onNext(&quot;ğŸ±&quot;)

subject.addObserver(&quot;2&quot;).disposed(by: disposeBag) 
subject.onNext(&quot;ğŸ…°ï¸&quot;)
subject.onNext(&quot;ğŸ…±ï¸&quot;)
</code></pre><p>ç»“æœæ˜¯ï¼š</p>
<pre><code>Subscription: 1 Event: next(ğŸ¶)
Subscription: 1 Event: next(ğŸ±)
Subscription: 2 Event: next(ğŸ±) // 
Subscription: 1 Event: next(ğŸ…°ï¸)
Subscription: 2 Event: next(ğŸ…°ï¸)
Subscription: 1 Event: next(ğŸ…±ï¸)
Subscription: 2 Event: next(ğŸ…±ï¸)
</code></pre><p>è§‚å¯Ÿæ‰“å°ç»“æœå¯ä»¥å‘ç°ï¼š</p>
<ol>
<li>ç¬¬äºŒæ¬¡è®¢é˜…åç«‹åˆ»æ¥æ”¶åˆ°äº†ä¸€ä¸ªå†å²äº‹ä»¶ <code>&quot;ğŸ±&quot;</code>ï¼›</li>
<li>å¯è§<code>ReplaySubject</code>åœ¨å†…éƒ¨ä¼šä¿å­˜ä¸€ä¸‹ä¹‹å‰å‘é€è¿‡çš„äº‹ä»¶ï¼Œä»¥ä¾¿å°†æ¥è¢«æ–°çš„è®¢é˜…è€…è®¢é˜…æ—¶é‡å¤å‘é€ã€‚</li>
</ol>
<h3 id="BehaviorSubject"><a href="#BehaviorSubject" class="headerlink" title="BehaviorSubject"></a>BehaviorSubject</h3><p>ä»ç„¶æ˜¯å‘å®ƒçš„æ‰€æœ‰è®¢é˜…è€…å‘é€ï¼ˆå¹¿æ’­ï¼‰æ–°çš„äº‹ä»¶ï¼Œä½†åŒæ—¶ç«‹åˆ»å‘æ–°çš„è®¢é˜…è€…å‘é€æœ€è¿‘ä¸€æ¬¡å‘é€è¿‡çš„äº‹ä»¶ï¼ˆæˆ–è€…å°†åˆå§‹åŒ–çš„å€¼ä½œä¸ºäº‹ä»¶ï¼‰ã€‚</p>
<p>ä¸¾ä¸ªğŸŒ°ï¼š</p>
<pre><code>let disposeBag = DisposeBag()
let subject = BehaviorSubject(value: &quot;ğŸ”´&quot;)

subject.addObserver(&quot;1&quot;).disposed(by: disposeBag) 
subject.onNext(&quot;ğŸ¶&quot;)
subject.onNext(&quot;ğŸ±&quot;)

subject.addObserver(&quot;2&quot;).disposed(by: disposeBag) 
subject.onNext(&quot;ğŸ…°ï¸&quot;)
subject.onNext(&quot;ğŸ…±ï¸&quot;)

subject.addObserver(&quot;3&quot;).disposed(by: disposeBag) 
subject.onNext(&quot;ğŸ&quot;)
subject.onNext(&quot;ğŸŠ&quot;)
</code></pre><p>ç»“æœæ˜¯ï¼š</p>
<pre><code>Subscription: 1 Event: next(ğŸ”´) //
Subscription: 1 Event: next(ğŸ¶)
Subscription: 1 Event: next(ğŸ±)
Subscription: 2 Event: next(ğŸ±) //
Subscription: 1 Event: next(ğŸ…°ï¸)
Subscription: 2 Event: next(ğŸ…°ï¸)
Subscription: 1 Event: next(ğŸ…±ï¸)
Subscription: 2 Event: next(ğŸ…±ï¸)
Subscription: 3 Event: next(ğŸ…±ï¸) //
Subscription: 1 Event: next(ğŸ)
Subscription: 2 Event: next(ğŸ)
Subscription: 3 Event: next(ğŸ)
Subscription: 1 Event: next(ğŸŠ)
Subscription: 2 Event: next(ğŸŠ)
Subscription: 3 Event: next(ğŸŠ)
</code></pre><p>è§‚å¯Ÿæ‰“å°ç»“æœå¯ä»¥å‘ç°ï¼š</p>
<ol>
<li>ç¬¬ä¸€æ¬¡è®¢é˜…åç«‹åˆ»æ¥æ”¶åˆ°äº†<code>subject</code>çš„åˆå§‹å€¼ <code>&quot;ğŸ”´&quot;</code>ï¼›</li>
<li>ç¬¬äºŒæ¬¡è®¢é˜…åç«‹åˆ»æ¥æ”¶åˆ°äº†<code>subject</code>ä¹‹å‰å‘å‡ºçš„æœ€åä¸€ä¸ªå€¼ <code>&quot;ğŸ±&quot;</code>ï¼›</li>
<li>ç¬¬ä¸‰æ¬¡è®¢é˜…åä¹Ÿæ˜¯ç«‹åˆ»æ¥æ”¶åˆ°äº†<code>subject</code>ä¹‹å‰å‘å‡ºçš„æœ€åä¸€ä¸ªå€¼ <code>&quot;ğŸ…±ï¸&quot;</code>ã€‚</li>
</ol>
<p>å¯è§<code>BehaviorSubject</code>å°±æ˜¯åœ¨å°†<code>bufferSize</code>è®¾ç½®ä¸º1çš„<code>ReplaySubject</code>çš„åŸºç¡€ä¸Šï¼Œé™„åŠ äº†ä¸€ä¸ªå‘é€åˆå§‹å€¼çš„åŠŸèƒ½ã€‚</p>
<h3 id="Variable"><a href="#Variable" class="headerlink" title="Variable"></a>Variable</h3><p>åœ¨å†…éƒ¨åŒ…è£…ç€ä¸€ä¸ª<code>BehaviorSubject</code>ï¼Œç±»ä¼¼äºå°†<code>BehaviorSubject</code>æ”¾è¿›äº†ä¸€ä¸ªç®±å­ï¼Œæ‰€ä»¥å®ƒæ‹¥æœ‰<code>BehaviorSubject</code>çš„å…¨éƒ¨èƒ½åŠ›ï¼›æ­¤å¤–<code>Variable</code>è¿˜è®°å½•ç€å½“å‰å€¼çš„çŠ¶æ€ã€‚<code>Variable</code>æ°¸è¿œä¸ä¼šå‘é€é”™è¯¯äº‹ä»¶ï¼Œä½†æ˜¯å®ƒä¼šè‡ªåŠ¨å‘é€ä¸€ä¸ªå®Œæˆäº‹ä»¶ã€‚</p>
<p>ä¸¾ä¸ªğŸŒ°ï¼š</p>
<pre><code>let disposeBag = DisposeBag()
let variable = Variable(&quot;ğŸ”´&quot;)

variable.asObservable().addObserver(&quot;1&quot;).disposed(by: disposeBag) // 1
variable.value = &quot;ğŸ¶&quot; // 2
variable.value = &quot;ğŸ±&quot;

variable.asObservable().addObserver(&quot;2&quot;).disposed(by: disposeBag)
variable.value = &quot;ğŸ…°ï¸&quot;
variable.value = &quot;ğŸ…±ï¸&quot;
</code></pre><p>ç»“æœæ˜¯ï¼š</p>
<pre><code>Subscription: 1 Event: next(ğŸ”´)
Subscription: 1 Event: next(ğŸ¶)
Subscription: 1 Event: next(ğŸ±)
Subscription: 2 Event: next(ğŸ±)
Subscription: 1 Event: next(ğŸ…°ï¸)
Subscription: 2 Event: next(ğŸ…°ï¸)
Subscription: 1 Event: next(ğŸ…±ï¸)
Subscription: 2 Event: next(ğŸ…±ï¸)
Subscription: 1 Event: completed //
Subscription: 2 Event: completed
</code></pre><p>ç„¶åè§£é‡Šä¸€ä¸‹ä¸Šé¢çš„ä»£ç ï¼š</p>
<ol>
<li>å› ä¸º<code>Variable</code>ç›¸å½“äº<code>BehaviorSubject</code>å¤–é¢çš„ä¸€ä¸ªç®±å­ï¼Œæ‰€ä»¥é¦–å…ˆè¦è°ƒç”¨<code>asObservable()</code>å‡½æ•°æ‹†ç®±ï¼›</li>
<li><code>Variable</code>å¹¶æ²¡æœ‰ç›´æ¥å®ç°å‘é€äº‹ä»¶çš„å‡ ä¸ªå‡½æ•°ï¼Œä½œä¸ºä»£æ›¿å®ƒå¯¹å¤–æš´éœ²äº†ä¸€ä¸ª<code>value</code>å±æ€§ç”¨äºå–å¾—å½“å‰å€¼æˆ–æ˜¯è®¾ç½®æœ€æ–°å€¼ã€‚è®¾ç½®æ–°å€¼çš„æ—¶å€™å°±ä¼šåŠ åˆ°å†…éƒ¨çš„<code>BehaviorSubject</code>åºåˆ—ä¸Šï¼Œä»è€Œé—´æ¥å®ç°äº†å‘é€æ•°æ®åŠŸèƒ½ã€‚</li>
</ol>
<p>è§‚å¯Ÿæ‰“å°ç»“æœå¯ä»¥å‘ç°ï¼š</p>
<ol>
<li>æ‹¥æœ‰<code>BehaviorSubject</code>çš„å…¨éƒ¨ç‰¹æ€§ï¼›</li>
<li>ä¼šåœ¨æœ€åè‡ªåŠ¨å‘é€ä¸€ä¸ªå®Œæˆäº‹ä»¶ã€‚</li>
</ol>
<h2 id="ç§ç±»ä¸°å¯Œè€Œç¥å¥‡çš„æ“ä½œ"><a href="#ç§ç±»ä¸°å¯Œè€Œç¥å¥‡çš„æ“ä½œ" class="headerlink" title="ç§ç±»ä¸°å¯Œè€Œç¥å¥‡çš„æ“ä½œ"></a>ç§ç±»ä¸°å¯Œè€Œç¥å¥‡çš„æ“ä½œ</h2><p>RxSwiftå·²ç»å®šä¹‰å¥½äº†éå¸¸å¤šçš„<a href="http://reactivex.io/documentation/operators.html" target="_blank" rel="external">æ“ä½œç¬¦</a>ï¼Œç†Ÿç»ƒä½¿ç”¨å®ƒä»¬å¯ä»¥å¤§å¹…åº¦æé«˜å¼€å‘æ•ˆç‡ã€‚<a href="http://rxmarbles.com/" target="_blank" rel="external">è¿™é‡Œ</a>æ˜¯ç”¨å½¢è±¡çš„å›¾è¡¨æ¥å±•ç¤ºæè¿°å®ƒä»¬ï¼Œå¯ä»¥çœ‹çœ‹å¸®åŠ©ç†è§£ï¼Œè™½ç„¶å¹¶ä¸å…¨ã€‚</p>
<p>å› ä¸ºå®åœ¨å¤ªå¤šï¼Œä¸‹é¢ä»…ä»‹ç»ä¸€äº›ä¸»è¦å’Œå¸¸ç”¨çš„ã€‚</p>
<h3 id="ç»„åˆæ“ä½œ"><a href="#ç»„åˆæ“ä½œ" class="headerlink" title="ç»„åˆæ“ä½œ"></a>ç»„åˆæ“ä½œ</h3><p>å°†å¤šä¸ªæºObservaleç»„åˆæˆä¸€ä¸ªObservaleã€‚</p>
<h4 id="startWith"><a href="#startWith" class="headerlink" title="startWith"></a>startWith</h4><p>åœ¨æºObservaleå¼€å§‹å‘å‡ºäº‹ä»¶ä¹‹å‰å…ˆå‘å‡ºç‰¹å®šçš„äº‹ä»¶åºåˆ—ã€‚</p>
<p>ä¸¾ä¸ªğŸŒ°ï¼š</p>
<pre><code>Observable.of(&quot;ğŸ¶&quot;, &quot;ğŸ±&quot;, &quot;ğŸ­&quot;, &quot;ğŸ¹&quot;)
    .startWith(&quot;1ï¸âƒ£&quot;)
    .startWith(&quot;2ï¸âƒ£&quot;)
    .startWith(&quot;3ï¸âƒ£&quot;, &quot;ğŸ…°ï¸&quot;, &quot;ğŸ…±ï¸&quot;)
    .subscribe(onNext: { print($0) })
    .disposed(by: disposeBag)
</code></pre><p>ç»“æœä¸ºï¼š</p>
<pre><code>3ï¸âƒ£
ğŸ…°ï¸
ğŸ…±ï¸
2ï¸âƒ£
1ï¸âƒ£
ğŸ¶
ğŸ±
ğŸ­
ğŸ¹    
</code></pre><p>å¯ä»¥çœ‹å‡º <code>startWith</code>æ‹¥æœ‰<code>LIFO</code>å³<code>last-in-first-out</code>çš„ç‰¹æ€§ï¼Œè¶Šåœ¨åé¢æ·»åŠ çš„äº‹ä»¶è¶Šå…ˆè¢«å‘é€å‡ºå»ã€‚</p>
<h4 id="merge"><a href="#merge" class="headerlink" title="merge"></a>merge</h4><p>å°†å¤šä¸ªæºObservaleåºåˆ—å‘å‡ºçš„äº‹ä»¶ç»„åˆè£…è¿›ä¸€ä¸ªæ–°çš„Observaleåºåˆ—ï¼Œæ¯ä¸€ä¸ªæºObservaleåºåˆ—å‘å‡ºäº‹ä»¶æ—¶ï¼Œæ–°åˆæˆçš„åºåˆ—éƒ½ä¼šå‘å‡ºã€‚</p>
<p>å¯ä»¥ç†è§£æˆå¤šæ¡ç®¡é“æ±‡å¹¶å…¥ä¸€æ¡ï¼Œç®€å•çš„è¯´å°±æ˜¯å¹¶ã€‚</p>
<p>ä¸¾ä¸ªğŸŒ°ï¼š</p>
<pre><code>let disposeBag = DisposeBag()

let subject1 = PublishSubject&lt;String&gt;()
let subject2 = PublishSubject&lt;String&gt;()

Observable.of(subject1, subject2)
    .merge()
    .subscribe(onNext: { print($0) })
    .disposed(by: disposeBag)

subject1.onNext(&quot;ğŸ…°ï¸&quot;)

subject1.onNext(&quot;ğŸ…±ï¸&quot;)

subject2.onNext(&quot;â‘ &quot;)

subject2.onNext(&quot;â‘¡&quot;)

subject1.onNext(&quot;ğŸ†&quot;)

subject2.onNext(&quot;â‘¢&quot;)
</code></pre><p>ç»“æœä¸ºï¼š</p>
<pre><code>ğŸ…°ï¸
ğŸ…±ï¸
â‘ 
â‘¡
ğŸ†
â‘¢
</code></pre><h4 id="zip"><a href="#zip" class="headerlink" title="zip"></a>zip</h4><p>å°†æœ€å¤šä¸è¶…è¿‡8ä¸ªæºObservaleåºåˆ—ç»„åˆæˆä¸€ä¸ªæ–°çš„Observaleåºåˆ—ï¼Œæ–°åºåˆ—å°†æ¯æ¬¡æ¯ä¸ªæºObservaleåºåˆ—åˆ†åˆ«å‘å‡ºçš„äº‹ä»¶ç»„åˆåå†å‘å‡ºã€‚</p>
<p>æ³¨æ„æ¯ä¸ªæºObservaleéƒ½è¦å‘å‡ºä¸€ä¸ªäº‹ä»¶ååˆæˆåçš„Observaleåºåˆ—æ‰ä¼šå‘å‡ºä¸€ä¸ªäº‹ä»¶ã€‚ä¸¾ä¸ªç”Ÿæ´»ä¸­çš„ä¾‹å­ï¼Œåšè‚‰å¤¹é¦æ—¶ï¼Œè‚‰å’Œé¦éƒ½å±äºåŸææ–™ï¼Œä¹Ÿå°±æ˜¯æºObservaleï¼Œä¸€ä»½è‚‰ä¸¥æ ¼å¯¹åº”ä¸€ä¸ªé¦ï¼Œå¤¹åœ¨ä¸€èµ·ä¹‹åæ‰ç®—æ˜¯ä¸€ä¸ªæˆå“ï¼Œä¹Ÿå°±æ˜¯æ‰èƒ½åˆæˆä¸€ä¸ªäº‹ä»¶ã€‚ä¸€ç§ææ–™ç”¨å®Œä¹‹åå¦ä¸€ç§æ— è®ºå‰©ä¸‹å¤šå°‘éƒ½ä¸èƒ½åšæˆæ–°çš„è‚‰å¤¹é¦ï¼Œä¹Ÿå°±æ˜¯ä¸èƒ½åˆæˆæ–°çš„äº‹ä»¶ã€‚</p>
<p>ä¸¾ä¸ªğŸŒ°ï¼š</p>
<pre><code>let disposeBag = DisposeBag()

let stringSubject = PublishSubject&lt;String&gt;()
let intSubject = PublishSubject&lt;Int&gt;()

Observable.zip(stringSubject, intSubject) { stringElement, intElement in
    &quot;\(stringElement) \(intElement)&quot;
    }
    .subscribe(onNext: { print($0) })
    .disposed(by: disposeBag)

stringSubject.onNext(&quot;ğŸ…°ï¸&quot;)
stringSubject.onNext(&quot;ğŸ…±ï¸&quot;)

intSubject.onNext(1)

intSubject.onNext(2)

stringSubject.onNext(&quot;ğŸ†&quot;)
intSubject.onNext(3)
</code></pre><p>ç»“æœæ˜¯ï¼š</p>
<pre><code>ğŸ…°ï¸ 1
ğŸ…±ï¸ 2
ğŸ† 3    
</code></pre><h4 id="combineLatest"><a href="#combineLatest" class="headerlink" title="combineLatest"></a>combineLatest</h4><p>å°†æœ€å¤šä¸è¶…è¿‡8ä¸ªæºObservaleåºåˆ—ç»„åˆæˆä¸€ä¸ªæ–°çš„Observaleåºåˆ—ï¼Œå½“æ‰€æœ‰çš„æºObservaleéƒ½è‡³å°‘å‘å‡ºäº†ä¸€ä¸ªäº‹ä»¶æˆ–è€…ä¹‹åä»»ä½•ä¸€ä¸ªObservaleå‘å‡ºäº†ä¸€ä¸ªæ–°çš„äº‹ä»¶æ—¶ï¼Œåˆæˆåçš„Observaleåºåˆ—æ ¹æ®æ¯ä¸€ä¸ªæºObservaleåºåˆ—æœ€åå‘å‡ºçš„äº‹ä»¶å‘å‡ºä¸€ä¸ªäº‹ä»¶ã€‚</p>
<p>æ³¨æ„æ¯ä¸ªæºObservaleå‘å‡ºä¸€ä¸ªäº‹ä»¶ååˆæˆåçš„Observaleåºåˆ—éƒ½ä¼šå‘å‡ºä¸€ä¸ªäº‹ä»¶ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œè®¡ç®—å‡ ä¸ªå¯æ‰‹åŠ¨è¾“å…¥çš„æ•°å­—çš„æ€»å’Œæ—¶ï¼Œæ¯ä¸ªæ•°å­—é‡æ–°è¢«è¾“å…¥åï¼Œæ€»å’Œéƒ½è¦é‡æ–°è¢«è®¡ç®—æ‰æ­£ç¡®ã€‚</p>
<p>ä¸¾ä¸ªğŸŒ°ï¼š</p>
<pre><code>let disposeBag = DisposeBag()

let stringSubject = PublishSubject&lt;String&gt;()
let intSubject = PublishSubject&lt;Int&gt;()

Observable.combineLatest(stringSubject, intSubject) { stringElement, intElement in
        &quot;\(stringElement) \(intElement)&quot;
    }
    .subscribe(onNext: { print($0) })
    .disposed(by: disposeBag)

stringSubject.onNext(&quot;ğŸ…°ï¸&quot;)

stringSubject.onNext(&quot;ğŸ…±ï¸&quot;)

intSubject.onNext(1)

intSubject.onNext(2)

stringSubject.onNext(&quot;ğŸ†&quot;)
</code></pre><p>ç»“æœæ˜¯ï¼š</p>
<pre><code>ğŸ…±ï¸ 1
ğŸ…±ï¸ 2
ğŸ† 2
</code></pre><h4 id="switchLatest"><a href="#switchLatest" class="headerlink" title="switchLatest"></a>switchLatest</h4><p>å°†æºObservaleåºåˆ—è£…è¿›ä¸€ä¸ªVariableä¸­ï¼Œä½¿ç”¨è€…ç›´æ¥å»è®¢é˜…Variableè½¬æ¢æˆçš„Observaleï¼Œå½“Variableçš„<code>value</code>æ”¹å˜æ—¶ï¼Œåªæ¥æ”¶æœ€æ–°çš„Observaleå‘å‡ºçš„äº‹ä»¶ï¼Œä¹‹å‰è¢«æ”¾è¿›Variableä¸­çš„Observaleå‘å‡ºçš„äº‹ä»¶å°†ä¸å†è¢«æ”¶åˆ°ã€‚</p>
<p>å¯ä»¥è¿™é‡Œç†è§£ï¼Œæ¯ä¸€ä¸ªè¢«æ”¾è¿›Variableä¸­çš„Observaleéƒ½æ˜¯çš‡ä¸Šï¼Œè®¢é˜…è€…éƒ½æ˜¯å¤§è‡£ï¼Œå¤§è‡£åªå¬çš‡ä¸Šçš„è¯<br>ï¼›å½“<code>value</code>æ”¹å˜æ—¶ï¼Œæ–°Observaleå˜æˆäº†çš‡ä¸Šï¼Œå¤§è‡£å¼€å§‹åªå¬ä»–çš„ï¼ŒåŸæ¥çš„Observaleæˆ–è€…æ˜¯å˜æˆå¤ªä¸Šçš‡æˆ–è€…æ˜¯æ­»äº†æˆ–è€…æ˜¯å‡ºå®¶ï¼Œä½†ä¸ç®¡æ€æ ·ï¼Œå¤§è‡£éƒ½ä¸å†å¬ä»–çš„äº†ã€‚</p>
<p>ä¸¾ä¸ªğŸŒ°ï¼š</p>
<pre><code>let disposeBag = DisposeBag()

let subject1 = BehaviorSubject(value: &quot;âš½ï¸&quot;)
let subject2 = BehaviorSubject(value: &quot;ğŸ&quot;)

let variable = Variable(subject1)

variable.asObservable()
    .switchLatest()
    .subscribe(onNext: { print($0) })
    .disposed(by: disposeBag)

subject1.onNext(&quot;ğŸˆ&quot;)
subject1.onNext(&quot;ğŸ€&quot;)

variable.value = subject2

subject1.onNext(&quot;âš¾ï¸&quot;)

subject2.onNext(&quot;ğŸ&quot;)
</code></pre><p>ç»“æœæ˜¯ï¼š</p>
<pre><code>âš½ï¸
ğŸˆ
ğŸ€
ğŸ
ğŸ
</code></pre><h3 id="å˜æ¢æ“ä½œ"><a href="#å˜æ¢æ“ä½œ" class="headerlink" title="å˜æ¢æ“ä½œ"></a>å˜æ¢æ“ä½œ</h3><p>å¯¹Observableåºåˆ—å‘é€çš„æ¯ä¸€ä¸ªnextäº‹ä»¶ä¸­çš„æ•°å€¼è¿›è¡Œå˜æ¢ã€‚</p>
<h4 id="map"><a href="#map" class="headerlink" title="map"></a>map</h4><p>å¯¹Observableåºåˆ—å‘å‡ºçš„æ¯ä¸€ä¸ªnextäº‹ä»¶ä¸­çš„æ•°å€¼åº”ç”¨ä¸€ä¸ªé—­åŒ…è½¬æ¢æˆä¸€ä¸ªæ–°çš„æ•°å€¼ï¼Œè¿™æ ·æ¥æ”¶åˆ°çš„å°±æ˜¯è½¬æ¢è¿‡åçš„æ•°å€¼äº†ã€‚</p>
<p>ä¸¾ä¸ªğŸŒ°ï¼š</p>
<pre><code>let disposeBag = DisposeBag()
Observable.of(1, 2, 3)
    .map { $0 * $0 }
    .subscribe(onNext: { print($0) })
    .disposed(by: disposeBag)
</code></pre><p>ç»“æœæ˜¯ï¼š</p>
<pre><code>1
4
9
</code></pre><p>è§‚å¯Ÿæ‰“å°ç»“æœå¯ä»¥å‘ç°ï¼š</p>
<p>æºåºåˆ—å‘é€ä¸‰ä¸ªå€¼ï¼Œç»è¿‡<code>map</code>ä¹‹åä»ç„¶æ˜¯ä¸‰ä¸ªå€¼ï¼Œä¹Ÿå°±æ˜¯è¯´<code>map</code>åªæ˜¯æ”¹å˜äº†æ¯ä¸€ä¸ªå€¼çš„å†…å®¹ï¼Œå¹¶ä¸ä¼šæ”¹å˜æ•°é‡ã€‚</p>
<h4 id="flatMap"><a href="#flatMap" class="headerlink" title="flatMap"></a>flatMap</h4><p>åœ¨ä»‹ç»flatMapä¹‹å‰ï¼Œé¦–å…ˆçœ‹ä¸€ä¸‹ä¸‹é¢çš„ä¾‹å­ï¼š</p>
<pre><code>let disposeBag = DisposeBag()
Observable.of(1, 2, 3)
    .map { Observable.just($0) }
    .subscribe(onNext: { print($0) })
    .disposed(by: disposeBag)
</code></pre><p>è¾“å‡ºç»“æœæ˜¯ï¼š</p>
<pre><code>RxSwift.Just&lt;Swift.Int&gt;
RxSwift.Just&lt;Swift.Int&gt;
RxSwift.Just&lt;Swift.Int&gt;
</code></pre><p>è§‚å¯Ÿæ‰“å°ç»“æœå¯ä»¥å‘ç°ï¼š</p>
<p>è™½ç„¶å‘é€æ•°æ®çš„æ•°é‡ä»ç„¶æ²¡æœ‰å˜åŒ–ï¼Œä½†æ˜¯æ¯ä¸€ä¸ªæ•°å€¼å´å˜æˆäº†ä¸€ä¸ªåºåˆ—ã€‚ä¸“ä¸šä¸€ç‚¹çš„è¯´å°±æ˜¯å‡ºç°äº†å‡ç»´ã€‚ä»€ä¹ˆæ˜¯å‡ç»´ï¼Ÿæ¯”å¦‚è¯´è¿‡ç”Ÿæ—¥æ—¶æœ‹å‹é€ä½ ç¤¼ç‰©ä¸€èˆ¬éƒ½ä¼šè£…è¿›ä¸€ä¸ªåŒ…è£…ç›’ä¸­ï¼Œä½†æ˜¯è¿™æ¬¡å°†è£…ç¤¼ç‰©çš„åŒ…è£…ç›’å¤–é¢åˆå¥—äº†ä¸€å±‚æˆ–è€…nå±‚åŒ…è£…ç›’ã€‚æ‹†ç¤¼ç‰©æ—¶æˆ‘ä»¬å¯ä»¥è€ç€æ€§å­ä¸€å±‚ä¸€å±‚æ‹†ï¼Œæ€»ä¼šæ‹¿åˆ°ï¼Œä½†é’ˆå¯¹Observableæˆ‘ä»¬ä¸èƒ½è®¢é˜…å¤šæ¬¡å§ï¼Œå› ä¸ºå…³é”®é—®é¢˜æ˜¯æˆ‘ä»¬å¹¶ä¸çŸ¥é“åˆ°åº•åŒ…è£…äº†å¤šå°‘å±‚ã€‚è¿™å°±å°´å°¬äº†ï¼Œæ­¤æ—¶åº”è¯¥æ€æ ·å–åˆ°æœ€å†…å±‚çš„æ•°æ®å‘¢ï¼Ÿ</p>
<p>è¿™å°±æ˜¯<code>flatMap</code>èƒ½åšçš„äº‹ï¼Œé’ˆå¯¹å‡ç»´åšé™ç»´ï¼Œç†è§£äº†å‡ç»´å°±ä¸éš¾ç†è§£é™ç»´ï¼Œç›´ç™½çš„è¯´å°±æ˜¯å–å¾—åºåˆ—ä¸­çš„åºåˆ—çš„æ•°å€¼ã€‚</p>
<p>çœ‹ä¸€ä¸‹å®˜æ–¹è§£é‡Šï¼šå¯¹Observableåºåˆ—å‘å‡ºçš„æ¯ä¸€ä¸ªNextäº‹ä»¶ä¸­çš„æ•°å€¼åº”ç”¨ä¸€ä¸ªé—­åŒ…è½¬æ¢æˆä¸€ä¸ªObservableåºåˆ—ï¼Œç„¶åå°†æ‰€æœ‰è¿™äº›Observableåºåˆ—åº”ç”¨ä¸Šé¢ä»‹ç»çš„<code>merge</code>æ“ä½œï¼Œåˆå¹¶è¿›ä¸€ä¸ªæ–°çš„Observableåºåˆ—ã€‚</p>
<p>æ‰€ä»¥flatMapæ“ä½œå…¶å®æ˜¯<code>map</code> + <code>merge</code>ä¸¤ä¸ªæ“ä½œç»“åˆè€Œæˆçš„å¤åˆæ“ä½œã€‚</p>
<p>é’ˆå¯¹ä¸Šé¢çš„ä¾‹å­å°†mapæ¢æˆflatMapï¼š</p>
<pre><code>let disposeBag = DisposeBag()
Observable.of(1, 2, 3)
    .flatMap { Observable.just($0) }
    .subscribe(onNext: { print($0) })
    .disposed(by: disposeBag)
</code></pre><p>ç»“æœæ˜¯ï¼š</p>
<pre><code>1
4
9
</code></pre><p>è§‚å¯Ÿæ‰“å°ç»“æœå¯ä»¥å‘ç°ï¼š</p>
<p>ç»“æœå’Œ<code>map</code>ä¾‹å­ä¸­æ˜¯ä¸€æ ·çš„ï¼Œè¯æ˜ç¡®å®èƒ½å–å¾—å¤šå±‚åºåˆ—ä¸­çš„å€¼ã€‚</p>
<p>å¦å¤–è¯´æ˜ä¸€ç‚¹ï¼Œæºåºåˆ—å‘é€ä¸‰ä¸ªå€¼ï¼Œç»è¿‡<code>flatMap</code>ä¹‹åä¸ä¸€å®šæ˜¯ä¸‰ä¸ªå€¼ï¼Œä¹Ÿå°±æ˜¯å¾ˆå¯èƒ½ä¼šæ”¹å˜æ•°é‡ã€‚</p>
<p>å†ä¸¾ä¸ªğŸŒ°ï¼š</p>
<pre><code>let disposeBag = DisposeBag()
Observable.of(1, 2, 3)
    .flatMap { Observable.of($0, $0 * $0) }
    .subscribe(onNext: { print($0) })
    .disposed(by: disposeBag)
</code></pre><p>ç»“æœæ˜¯ï¼š</p>
<pre><code>1
1
2
4
3
9 
</code></pre><p>å¾ˆç¥å¥‡å¾ˆé…·æœ‰æœ¨æœ‰ï¼Ÿï¼</p>
<h4 id="flatMapLatest"><a href="#flatMapLatest" class="headerlink" title="flatMapLatest"></a>flatMapLatest</h4><p>ç†è§£äº†<code>flatMap</code>å†ç†è§£<code>flatMapLatest</code>å°±éå¸¸ç®€å•äº†ï¼ŒåŠ ä¸ŠLateståˆ™åªä¼šç”¨å†…éƒ¨æœ€è¿‘çš„Observableåºåˆ—å‘é€äº‹ä»¶ã€‚</p>
<p><code>flatMapLatest</code>æ“ä½œå…¶å®å°±æ˜¯<code>map</code> + <code>switchLatest</code>ä¸¤ä¸ªæ“ä½œç»“åˆè€Œæˆçš„å¤åˆæ“ä½œã€‚</p>
<p>ä¸¾ä¸ªğŸŒ°ï¼š</p>
<pre><code>let disposeBag = DisposeBag()

struct Player {
    var score: Variable&lt;Int&gt;
}

let ğŸ‘¦ğŸ» = Player(score: Variable(80))
let ğŸ‘§ğŸ¼ = Player(score: Variable(90))

let player = Variable(ğŸ‘¦ğŸ»)

player.asObservable()
    .flatMapLatest { $0.score.asObservable() } 
    .subscribe(onNext: { print($0) })
    .disposed(by: disposeBag)

ğŸ‘¦ğŸ».score.value = 85

player.value = ğŸ‘§ğŸ¼

ğŸ‘¦ğŸ».score.value = 95     
ğŸ‘§ğŸ¼.score.value = 100
</code></pre><p>ç»“æœæ˜¯ï¼š</p>
<pre><code>80
85
90
100
</code></pre><p>è¯´ä¸€ä¸ª<code>flatMapLatest</code>å¯ä»¥å®é™…åº”ç”¨çš„åœºæ™¯ï¼Œåœ¨æœç´¢é¡µé¢ä¸­å½“ç”¨æˆ·è¾“å…¥å†…å®¹æ—¶ä¸€èˆ¬éƒ½ä¼šæ®æ­¤è¿›è¡Œç½‘ç»œè¯·æ±‚è·å¾—è”æƒ³æ•°æ®ï¼Œé‚£å¦‚æœä¸Šä¸€ä¸ªç½‘ç»œè¯·æ±‚å¾—åˆ°çš„æ•°æ®è¿˜æ²¡æœ‰å›æ¥æ—¶ç”¨æˆ·è¾“å…¥çš„å†…å®¹å˜äº†ï¼Œæ­¤æ—¶å°±éœ€è¦æ ¹æ®æ–°å†…å®¹å‘é€æ–°è¯·æ±‚è·å¾—æ–°æ•°æ®ã€‚æ­¤æ—¶ä¸Šä¸€ä¸ªè¯·æ±‚è·å¾—çš„æ•°æ®å°±æ²¡æœ‰æ„ä¹‰äº†ï¼Œæ— éœ€å†å±•ç¤ºç»™ç”¨æˆ·ã€‚å…·ä½“ä¾‹å­å°±ä¸å†™äº†ï¼Œç¬¬ä¸‰ç¯‡Demoå·¥ç¨‹ä¸­ä¼šå±•ç¤ºã€‚</p>
<h4 id="scan"><a href="#scan" class="headerlink" title="scan"></a>scan</h4><p>æœ‰ä¸€ä¸ªåˆå§‹å€¼ï¼Œåº”ç”¨ä¸€ä¸ªç´¯åŠ çš„é—­åŒ…åˆ°Observableåºåˆ—å‘é€çš„æ¯ä¸€æ¡æ•°æ®ä¸Šï¼Œæ¯ä¸€æ¬¡çš„è®¡ç®—ç»“æœéƒ½ä½œä¸ºä¸‹ä¸€ä¸ªé—­åŒ…çš„åˆå§‹å€¼ï¼Œæœ€åè¿”å›å’ŒåŸåºåˆ—æ•°é‡ç›¸ç­‰çš„äº‹ä»¶ã€‚</p>
<p>ä¸¾ä¸ªğŸŒ°ï¼š</p>
<pre><code>let disposeBag = DisposeBag()

Observable.of(10, 100, 1000)
    .scan(2) { aggregateValue, newValue in
        return aggregateValue + newValue
    }
    .subscribe(onNext: { print($0) })
    .disposed(by: disposeBag)
</code></pre><p>ç»“æœæ˜¯ï¼š    </p>
<pre><code>12
112
1112        
</code></pre><h3 id="è¿‡æ»¤å’Œæ¡ä»¶æ“ä½œ"><a href="#è¿‡æ»¤å’Œæ¡ä»¶æ“ä½œ" class="headerlink" title="è¿‡æ»¤å’Œæ¡ä»¶æ“ä½œ"></a>è¿‡æ»¤å’Œæ¡ä»¶æ“ä½œ</h3><p>è®©ä¸€ä¸ªæºObservableåºåˆ—æœ‰é€‰æ‹©çš„å‘é€äº‹ä»¶ã€‚</p>
<h4 id="filter"><a href="#filter" class="headerlink" title="filter"></a>filter</h4><p>è®©æºObservableåºåˆ—åªå‘é€æ»¡è¶³æ¡ä»¶çš„äº‹ä»¶ã€‚</p>
<p>ä¸¾ä¸ªğŸŒ°ï¼š</p>
<pre><code>let disposeBag = DisposeBag()

Observable.of(
    &quot;ğŸ±&quot;, &quot;ğŸ°&quot;, &quot;ğŸ¶&quot;,
    &quot;ğŸ¸&quot;, &quot;ğŸ±&quot;, &quot;ğŸ°&quot;,
    &quot;ğŸ¹&quot;, &quot;ğŸ¸&quot;, &quot;ğŸ±&quot;)
    .filter {
        $0 == &quot;ğŸ±&quot;
    }
    .subscribe(onNext: { print($0) })
    .disposed(by: disposeBag)
</code></pre><p>ç»“æœæ˜¯ï¼š</p>
<pre><code>ğŸ±
ğŸ±
ğŸ±
</code></pre><h4 id="distinctUntilChanged"><a href="#distinctUntilChanged" class="headerlink" title="distinctUntilChanged"></a>distinctUntilChanged</h4><p>é˜»æ­¢æºObservableåºåˆ—è¿ç»­å‘é€é‡å¤äº‹ä»¶ï¼Œä¹Ÿå°±æ˜¯äº‹ä»¶å˜åŒ–äº†æ‰å‘é€ã€‚</p>
<p>ä¸¾ä¸ªğŸŒ°ï¼š</p>
<pre><code>let disposeBag = DisposeBag()

Observable.of(&quot;ğŸ±&quot;, &quot;ğŸ·&quot;, &quot;ğŸ±&quot;, &quot;ğŸ±&quot;, &quot;ğŸ±&quot;, &quot;ğŸµ&quot;, &quot;ğŸ±&quot;)
    .distinctUntilChanged()
    .subscribe(onNext: { print($0) })
    .disposed(by: disposeBag)
</code></pre><p>ç»“æœæ˜¯ï¼š</p>
<pre><code>ğŸ±
ğŸ·
ğŸ±
ğŸµ
ğŸ±
</code></pre><h4 id="elementAt"><a href="#elementAt" class="headerlink" title="elementAt"></a>elementAt</h4><p>è®©æºObservableåºåˆ—åªå‘é€ç‰¹å®šç´¢å¼•çš„äº‹ä»¶ã€‚</p>
<p>ä¸¾ä¸ªğŸŒ°ï¼š</p>
<pre><code>let disposeBag = DisposeBag()

Observable.of(&quot;ğŸ±&quot;, &quot;ğŸ°&quot;, &quot;ğŸ¶&quot;, &quot;ğŸ¸&quot;, &quot;ğŸ·&quot;, &quot;ğŸµ&quot;)
    .elementAt(3)
    .subscribe(onNext: { print($0) })
    .disposed(by: disposeBag)
</code></pre><p>ç»“æœæ˜¯ï¼š</p>
<pre><code>ğŸ¸    
</code></pre><h4 id="single"><a href="#single" class="headerlink" title="single"></a>single</h4><p>ä»…å‘é€æºObservableåºåˆ—å‘å‡ºçš„ç¬¬ä¸€ä¸ªäº‹ä»¶(æˆ–è€…æ˜¯ç¬¦åˆæ¡ä»¶çš„ç¬¬ä¸€ä¸ªäº‹ä»¶)ï¼Œå¦‚æœObservableåºåˆ—ä¸æ˜¯æ­£å¥½å‘é€ä¸€ä¸ªäº‹ä»¶ä¼šæŠ¥é”™ã€‚</p>
<p>ä¸¾ä¸ªğŸŒ°ï¼š</p>
<pre><code>let disposeBag = DisposeBag()

Observable.of(&quot;ğŸ±&quot;, &quot;ğŸ°&quot;, &quot;ğŸ¶&quot;, &quot;ğŸ¸&quot;, &quot;ğŸ·&quot;, &quot;ğŸµ&quot;)
    .single()
    .subscribe(onNext: { print($0) })
    .disposed(by: disposeBag)

Observable.of(&quot;ğŸ±&quot;, &quot;ğŸ°&quot;, &quot;ğŸ¶&quot;, &quot;ğŸ¸&quot;, &quot;ğŸ·&quot;, &quot;ğŸµ&quot;)
    .single { $0 == &quot;ğŸ¸&quot; }
    .subscribe { print($0) }
    .disposed(by: disposeBag)

Observable.of(&quot;ğŸ±&quot;, &quot;ğŸ°&quot;, &quot;ğŸ¶&quot;, &quot;ğŸ±&quot;, &quot;ğŸ°&quot;, &quot;ğŸ¶&quot;)
    .single { $0 == &quot;ğŸ°&quot; }
    .subscribe { print($0) }
    .disposed(by: disposeBag)

Observable.of(&quot;ğŸ±&quot;, &quot;ğŸ°&quot;, &quot;ğŸ¶&quot;, &quot;ğŸ¸&quot;, &quot;ğŸ·&quot;, &quot;ğŸµ&quot;)
    .single { $0 == &quot;ğŸ”µ&quot; }
    .subscribe { print($0) }
    .disposed(by: disposeBag)
</code></pre><p>ç»“æœæ˜¯ï¼š</p>
<pre><code>ğŸ±
Received unhandled error: Sequence contains more than one element.

next(ğŸ¸)
completed

next(ğŸ°)
error(Sequence contains more than one element.)

error(Sequence doesn&apos;t contain any elements.)
</code></pre><h4 id="take"><a href="#take" class="headerlink" title="take"></a>take</h4><p>è®©æºObservableåºåˆ—åªå‘é€ä»å¤´å¼€å§‹çš„ç‰¹å®šæ•°é‡çš„äº‹ä»¶ã€‚</p>
<p>ä¸¾ä¸ªğŸŒ°ï¼š</p>
<pre><code>let disposeBag = DisposeBag()

Observable.of(&quot;ğŸ±&quot;, &quot;ğŸ°&quot;, &quot;ğŸ¶&quot;, &quot;ğŸ¸&quot;, &quot;ğŸ·&quot;, &quot;ğŸµ&quot;)
    .take(3)
    .subscribe(onNext: { print($0) })
    .disposed(by: disposeBag)
</code></pre><p>ç»“æœæ˜¯ï¼š</p>
<pre><code>ğŸ±
ğŸ°
ğŸ¶    
</code></pre><h4 id="takeLast"><a href="#takeLast" class="headerlink" title="takeLast"></a>takeLast</h4><p>è®©æºObservableåºåˆ—åªå‘é€åœ¨æœ€åçš„ç‰¹å®šæ•°é‡çš„äº‹ä»¶ã€‚</p>
<p>ä¸¾ä¸ªğŸŒ°ï¼š</p>
<pre><code>let disposeBag = DisposeBag()

Observable.of(&quot;ğŸ±&quot;, &quot;ğŸ°&quot;, &quot;ğŸ¶&quot;, &quot;ğŸ¸&quot;, &quot;ğŸ·&quot;, &quot;ğŸµ&quot;)
    .takeLast(3)
    .subscribe(onNext: { print($0) })
    .disposed(by: disposeBag)
</code></pre><p>ç»“æœæ˜¯ï¼š</p>
<pre><code>ğŸ¸
ğŸ·
ğŸµ
</code></pre><h4 id="takeWhile"><a href="#takeWhile" class="headerlink" title="takeWhile"></a>takeWhile</h4><p>è®©æºObservableåºåˆ—åªå‘é€æ»¡è¶³ç‰¹å®šæ¡ä»¶çš„äº‹ä»¶ã€‚</p>
<p>ä¸¾ä¸ªğŸŒ°ï¼š</p>
<pre><code>let disposeBag = DisposeBag()

Observable.of(1, 2, 3, 4, 5, 6)
    .takeWhile { $0 &lt; 4 }
    .subscribe(onNext: { print($0) })
    .disposed(by: disposeBag)
</code></pre><p>ç»“æœæ˜¯ï¼š</p>
<pre><code>1
2
3
</code></pre><h4 id="takeUntil"><a href="#takeUntil" class="headerlink" title="takeUntil"></a>takeUntil</h4><p>è®©æºObservableåºåˆ—æ­£å¸¸å‘é€äº‹ä»¶ç›´åˆ°å¦ä¸€ä¸ªObservableåºåˆ—å‘å‡ºäº†ç¬¬ä¸€ä¸ªäº‹ä»¶ã€‚</p>
<p>ä¸¾ä¸ªğŸŒ°ï¼š</p>
<pre><code>let disposeBag = DisposeBag()

let sourceSequence = PublishSubject&lt;String&gt;()
let referenceSequence = PublishSubject&lt;String&gt;()

sourceSequence
    .takeUntil(referenceSequence)
    .subscribe { print($0) }
    .disposed(by: disposeBag)

sourceSequence.onNext(&quot;ğŸ±&quot;)
sourceSequence.onNext(&quot;ğŸ°&quot;)
sourceSequence.onNext(&quot;ğŸ¶&quot;)

referenceSequence.onNext(&quot;ğŸ”´&quot;)

sourceSequence.onNext(&quot;ğŸ¸&quot;)
sourceSequence.onNext(&quot;ğŸ·&quot;)
sourceSequence.onNext(&quot;ğŸµ&quot;)
</code></pre><p>ç»“æœæ˜¯ï¼š</p>
<pre><code>next(ğŸ±)
next(ğŸ°)
next(ğŸ¶)
completed
</code></pre><h4 id="skip"><a href="#skip" class="headerlink" title="skip"></a>skip</h4><p>é˜»æ­¢æºObservableåºåˆ—ä»å¤´å¼€å§‹å‘é€ç‰¹å®šæ•°é‡çš„äº‹ä»¶ï¼Œä¹Ÿå°±æ˜¯è·³è¿‡å‰nä¸ªäº‹ä»¶ï¼Œä»n+1ä¸ªäº‹ä»¶å¼€å§‹å‘ã€‚</p>
<p>ä¸¾ä¸ªğŸŒ°ï¼š</p>
<pre><code>let disposeBag = DisposeBag()

Observable.of(&quot;ğŸ±&quot;, &quot;ğŸ°&quot;, &quot;ğŸ¶&quot;, &quot;ğŸ¸&quot;, &quot;ğŸ·&quot;, &quot;ğŸµ&quot;)
    .skip(2)
    .subscribe(onNext: { print($0) })
    .disposed(by: disposeBag)
</code></pre><p>ç»“æœæ˜¯ï¼š</p>
<pre><code>ğŸ¶
ğŸ¸
ğŸ·
ğŸµ    
</code></pre><h4 id="skipWhile"><a href="#skipWhile" class="headerlink" title="skipWhile"></a>skipWhile</h4><p>é˜»æ­¢æºObservableåºåˆ—å‘é€æ»¡è¶³ç‰¹å®šæ¡ä»¶çš„äº‹ä»¶ï¼Œä¹Ÿå°±æ˜¯æ¡ä»¶æ»¡è¶³å°±è·³è¿‡ã€‚</p>
<p>ä¸¾ä¸ªğŸŒ°ï¼š</p>
<pre><code>let disposeBag = DisposeBag()

Observable.of(1, 2, 3, 4, 5, 6)
    .skipWhile { $0 &lt; 4 }
    .subscribe(onNext: { print($0) })
    .disposed(by: disposeBag)
</code></pre><p>ç»“æœæ˜¯ï¼š</p>
<pre><code>4
5
6
</code></pre><h4 id="skipWhileWithIndex"><a href="#skipWhileWithIndex" class="headerlink" title="skipWhileWithIndex"></a>skipWhileWithIndex</h4><p>é˜»æ­¢æºObservableåºåˆ—å‘é€æ»¡è¶³ç‰¹å®šæ¡ä»¶çš„äº‹ä»¶ï¼Œå’Œä¸Šé¢æ“ä½œçš„åŒºåˆ«æ˜¯åˆ¤æ–­æ¡ä»¶çš„é—­åŒ…ä¸­ä¹Ÿä¼ å…¥äº†å½“å‰äº‹ä»¶æ‰€å±çš„ç´¢å¼•å·ï¼Œæ‰€ä»¥ä¸ä½†å¯ä»¥ç”¨å®é™…æ•°æ®åšåˆ¤æ–­æ¡ä»¶ä¹Ÿå¯ä»¥ç”¨ç´¢å¼•å·åšåˆ¤æ–­æ¡ä»¶ã€‚</p>
<p>ä¸¾ä¸ªğŸŒ°ï¼š</p>
<pre><code>let disposeBag = DisposeBag()

Observable.of(&quot;ğŸ±&quot;, &quot;ğŸ°&quot;, &quot;ğŸ¶&quot;, &quot;ğŸ¸&quot;, &quot;ğŸ·&quot;, &quot;ğŸµ&quot;)
    .skipWhileWithIndex { element, index in
        index &lt; 3
    }
    .subscribe(onNext: { print($0) })
    .disposed(by: disposeBag)
</code></pre><p>ç»“æœæ˜¯ï¼š</p>
<pre><code>ğŸ¸
ğŸ·
ğŸµ
</code></pre><h4 id="skipUntil"><a href="#skipUntil" class="headerlink" title="skipUntil"></a>skipUntil</h4><p>é˜»æ­¢æºObservableåºåˆ—å‘é€äº‹ä»¶ç›´åˆ°å¦ä¸€ä¸ªObservableåºåˆ—å‘å‡ºäº†ç¬¬ä¸€ä¸ªäº‹ä»¶ã€‚</p>
<p>ä¸¾ä¸ªğŸŒ°ï¼š</p>
<pre><code>let disposeBag = DisposeBag()

let sourceSequence = PublishSubject&lt;String&gt;()
let referenceSequence = PublishSubject&lt;String&gt;()

sourceSequence
    .skipUntil(referenceSequence)
    .subscribe(onNext: { print($0) })
    .disposed(by: disposeBag)

sourceSequence.onNext(&quot;ğŸ±&quot;)
sourceSequence.onNext(&quot;ğŸ°&quot;)
sourceSequence.onNext(&quot;ğŸ¶&quot;)

referenceSequence.onNext(&quot;ğŸ”´&quot;)

sourceSequence.onNext(&quot;ğŸ¸&quot;)
sourceSequence.onNext(&quot;ğŸ·&quot;)
sourceSequence.onNext(&quot;ğŸµ&quot;)
</code></pre><p>ç»“æœæ˜¯ï¼š</p>
<pre><code>ğŸ¸
ğŸ·
ğŸµ
</code></pre><h3 id="æ•°å­¦å’Œæ•´ä½“æ“ä½œ"><a href="#æ•°å­¦å’Œæ•´ä½“æ“ä½œ" class="headerlink" title="æ•°å­¦å’Œæ•´ä½“æ“ä½œ"></a>æ•°å­¦å’Œæ•´ä½“æ“ä½œ</h3><p>å¯¹Observableå‘å‡ºçš„æ•´ä¸ªäº‹ä»¶åºåˆ—è¿›è¡Œæ“ä½œã€‚</p>
<h4 id="toArray"><a href="#toArray" class="headerlink" title="toArray"></a>toArray</h4><p>å°†ä¸€ä¸ªObservableåºåˆ—è½¬å˜æˆä¸€ä¸ªæ•°ç»„ï¼Œå°†è¿™ä¸ªæ•°ç»„ä½œä¸ºä¸€ä¸ªæ–°çš„å•ä¸€äº‹ä»¶å‘å‡ºï¼Œç„¶åå‘å‡ºå®Œæˆäº‹ä»¶ã€‚</p>
<p>ä¸¾ä¸ªğŸŒ°ï¼š</p>
<pre><code>let disposeBag = DisposeBag()

Observable.range(start: 1, count: 10)
    .toArray()
    .subscribe { print($0) }
    .disposed(by: disposeBag)    )    
</code></pre><p>ç»“æœæ˜¯ï¼š</p>
<pre><code>next([1, 2, 3, 4, 5, 6, 7, 8, 9, 10])
completed
</code></pre><h4 id="reduce"><a href="#reduce" class="headerlink" title="reduce"></a>reduce</h4><p>ä»¥ä¸€ä¸ªå€¼å¼€å§‹ï¼Œåº”ç”¨ä¸€ä¸ªç´¯åŠ çš„é—­åŒ…åˆ°Observableåºåˆ—å‘å‡ºçš„æ¯ä¸€æ¡æ•°æ®ä¸Šï¼Œæœ€åè¿”å›æ€»çš„è®¡ç®—ç»“æœä½œä¸ºä¸€ä¸ªå•ä¸€äº‹ä»¶ã€‚</p>
<p>ä¸¾ä¸ªğŸŒ°ï¼š</p>
<pre><code>let disposeBag = DisposeBag()

Observable.of(10, 100, 1000)
    .reduce(1, accumulator: +)
    .subscribe(onNext: { print($0) })
    .disposed(by: disposeBag)
</code></pre><p>ç»“æœæ˜¯ï¼š</p>
<pre><code>1111    
</code></pre><h4 id="concat"><a href="#concat" class="headerlink" title="concat"></a>concat</h4><p>æ‹¼æ¥å¤šä¸ªObservableåºåˆ—æˆä¸€ä¸ªï¼Œç­‰å¾…ä¸Šä¸€ä¸ªåºåˆ—å‘å‡ºäº†å®Œæˆäº‹ä»¶åä¸‹ä¸€ä¸ªåºåˆ—æ‰å¼€å§‹å‘é€äº‹ä»¶ã€‚</p>
<p>ç±»ä¼¼æ¥åŠ›æ¯”èµ›ï¼Œåªæœ‰ä¸Šä¸€æ£’çš„å°ä¼™ä¼´Aè·‘å®Œä»–çš„ä½ç½®å°†æ£’æˆåŠŸæ”¾åˆ°ä¸‹ä¸€æ£’å°ä¼™ä¼´Bçš„æ‰‹ä¸­Bæ‰æ‹¿ç€æ£’å¼€å§‹è·‘ã€‚</p>
<p>ä¸¾ä¸ªğŸŒ°ï¼š</p>
<pre><code>let disposeBag = DisposeBag()

let subject1 = BehaviorSubject(value: &quot;ğŸ&quot;)
let subject2 = BehaviorSubject(value: &quot;ğŸ¶&quot;)

let variable = Variable(subject1)

variable.asObservable()
    .concat()
    .subscribe { print($0) }
    .disposed(by: disposeBag)

subject1.onNext(&quot;ğŸ&quot;)
subject1.onNext(&quot;ğŸŠ&quot;)

variable.value = subject2

subject2.onNext(&quot;I would be ignored&quot;)
subject2.onNext(&quot;ğŸ±&quot;)

subject1.onCompleted()

subject2.onNext(&quot;ğŸ­&quot;)
</code></pre><p>ç»“æœæ˜¯ï¼š</p>
<pre><code>next(ğŸ)
next(ğŸ)
next(ğŸŠ)
next(ğŸ±)
next(ğŸ­)
</code></pre><h3 id="è¿æ¥æ“ä½œ"><a href="#è¿æ¥æ“ä½œ" class="headerlink" title="è¿æ¥æ“ä½œ"></a>è¿æ¥æ“ä½œ</h3><p>å¯è¿æ¥çš„Observableåºåˆ—å†…éƒ¨å°è£…äº†æ™®é€šçš„Observableåºåˆ—ï¼ŒåŒºåˆ«åœ¨äºæ™®é€šçš„Observableåºåˆ—åœ¨è¢«è®¢é˜…åç«‹åˆ»å‘é€äº‹ä»¶ï¼Œè€Œå¯è¿æ¥çš„Observableåºåˆ—åªæœ‰è¢«è°ƒç”¨äº†<code>connect()</code>å‡½æ•°åæ‰å¼€å§‹å‘é€ã€‚è¿™æ ·å¯ä»¥ç­‰æ‰€æœ‰è®¢é˜…è€…éƒ½è®¢é˜…äº†ä¹‹åå†å‘é€äº‹ä»¶ã€‚</p>
<p>åœ¨å­¦ä¹ å¯è¿æ¥çš„Observableåºåˆ—ä¹‹å‰ï¼Œå…ˆå›é¡¾ä¸€ä¸‹æ™®é€šçš„Observableåºåˆ—ã€‚</p>
<p>ä¸¾ä¸ªğŸŒ°ï¼š</p>
<pre><code>let interval = Observable&lt;Int&gt;.interval(2, scheduler: MainScheduler.instance)

_ = interval
    .subscribe(onNext: { print(&quot;Subscription: 1, Event: \($0)&quot;) })

delay(2) {
    print(&quot;delay two seconds&quot;)
    _ = interval
        .subscribe(onNext: { print(&quot;Subscription: 2, Event: \($0)&quot;) })
}    }
</code></pre><p>ç»“æœæ˜¯ï¼š</p>
<pre><code>Subscription: 1, Event: 0
delay two seconds
Subscription: 1, Event: 1
Subscription: 2, Event: 0
Subscription: 1, Event: 2
Subscription: 2, Event: 1
Subscription: 1, Event: 3
Subscription: 2, Event: 2
Subscription: 1, Event: 4
Subscription: 2, Event: 3
Subscription: 1, Event: 5
Subscription: 2, Event: 4
...
</code></pre><p>è§‚å¯Ÿæ‰“å°ç»“æœå¯ä»¥å‘ç°ï¼š</p>
<ol>
<li>æ™®é€šçš„Observableåºåˆ—æ¯å½“è¢«è®¢é˜…æ—¶ç«‹åˆ»å‘é€äº‹ä»¶ï¼›</li>
<li>æ™®é€šçš„Observableåºåˆ—æ¯å½“è¢«æ–°çš„è®¢é˜…è€…è®¢é˜…æ—¶éƒ½ä¼šé‡æ–°ä»å¤´å¼€å§‹å‘é€äº‹ä»¶ã€‚</li>
</ol>
<h4 id="publish"><a href="#publish" class="headerlink" title="publish"></a>publish</h4><p>å°†æ™®é€šçš„æºObservableåºåˆ—è½¬æ¢æˆä¸€ä¸ªå¯è¿æ¥çš„Observableåºåˆ—ã€‚</p>
<p>ä¸¾ä¸ªğŸŒ°ï¼š</p>
<pre><code>print(&quot;here is begin&quot;)

let intSequence = Observable&lt;Int&gt;.interval(1, scheduler: MainScheduler.instance)
    .publish()  // 1

_ = intSequence
    .subscribe(onNext: { print(&quot;Subscription 1:, Event: \($0)&quot;) })

delay(2) {
    print(&quot;delay two seconds&quot;)
    _ = intSequence.connect()  // 2
}

delay(4) {
    print(&quot;delay four seconds&quot;)
    _ = intSequence
        .subscribe(onNext: { print(&quot;Subscription 2:, Event: \($0)&quot;) })
}

delay(6) {
    print(&quot;delay six seconds&quot;)
    _ = intSequence
        .subscribe(onNext: { print(&quot;Subscription 3:, Event: \($0)&quot;) })
}
</code></pre><p>ç»“æœæ˜¯ï¼š</p>
<pre><code>here is begin
delay two seconds
Subscription 1:, Event: 0
delay four seconds
Subscription 1:, Event: 1
Subscription 2:, Event: 1
Subscription 1:, Event: 2
Subscription 2:, Event: 2
delay six seconds
Subscription 1:, Event: 3
Subscription 2:, Event: 3
Subscription 3:, Event: 3
Subscription 1:, Event: 4
Subscription 2:, Event: 4
Subscription 3:, Event: 4
...
</code></pre><p>è§£é‡Šä¸€ä¸‹ä¸Šé¢çš„ä»£ç ï¼š</p>
<ol>
<li>è°ƒç”¨<code>publish()</code>å‡½æ•°å°†æ™®é€šçš„Observableåºåˆ—è½¬æ¢æˆä¸€ä¸ªå¯è¿æ¥çš„Observableåºåˆ—ï¼›</li>
<li>è°ƒç”¨<code>connect()</code>å‡½æ•°ä½¿å¾—å¯è¿æ¥çš„Observableåºåˆ—å¼€å§‹å‘é€äº‹ä»¶ã€‚</li>
</ol>
<p>è§‚å¯Ÿæ‰“å°ç»“æœå¯ä»¥å‘ç°ï¼š</p>
<ol>
<li>å¯è¿æ¥çš„Observableåºåˆ—è¢«è®¢é˜…æ—¶ä¸ä¼šç«‹åˆ»å‘é€äº‹ä»¶ï¼›</li>
<li>å¯è¿æ¥çš„Observableåºåˆ—åªæœ‰è¢«è°ƒç”¨<code>connect()</code>å‡½æ•°åæ‰ä¼šä»å¤´å¼€å§‹å‘é€äº‹ä»¶ï¼›</li>
<li>å¯è¿æ¥çš„Observableåºåˆ—æ¯å½“è¢«æ–°çš„è®¢é˜…è€…è®¢é˜…æ—¶ä¸ä¼šé‡æ–°ä»å¤´å¼€å§‹å‘é€äº‹ä»¶ï¼Œè€Œæ˜¯ç»§ç»­ä¿æŒå½“å‰å‘é€äº‹ä»¶çš„èŠ‚å¥ã€‚</li>
</ol>
<h4 id="replay"><a href="#replay" class="headerlink" title="replay"></a>replay</h4><p>å°†æ™®é€šçš„æºObservableåºåˆ—è½¬æ¢æˆä¸€ä¸ªå¯è¿æ¥çš„Observableåºåˆ—ï¼Œå¹¶ä¸”æœ‰ä¸€ä¸ªç¼“å­˜æœºåˆ¶å¯ä»¥ä½¿å¾—æ–°çš„è®¢é˜…è€…èƒ½æ”¶åˆ°ä¹‹å‰å·²ç»å‘é€è¿‡çš„ç‰¹å®šæ•°é‡çš„å†å²äº‹ä»¶ã€‚</p>
<p>ä¸¾ä¸ªğŸŒ°ï¼š</p>
<pre><code>print(&quot;here is begin&quot;)

let intSequence = Observable&lt;Int&gt;.interval(1, scheduler: MainScheduler.instance)
    .replay(5)  // 1

_ = intSequence
    .subscribe(onNext: { print(&quot;Subscription 1:, Event: \($0)&quot;) })

delay(2) {
    print(&quot;delay two seconds&quot;)
    _ = intSequence.connect()  // 2
}

delay(4) {
    print(&quot;delay four seconds&quot;)
    _ = intSequence
        .subscribe(onNext: { print(&quot;Subscription 2:, Event: \($0)&quot;) })
}

delay(8) {
    print(&quot;delay eight seconds&quot;)
    _ = intSequence
        .subscribe(onNext: { print(&quot;Subscription 3:, Event: \($0)&quot;) })
}
</code></pre><p>ç»“æœæ˜¯ï¼š</p>
<pre><code>here is begin
delay two seconds
Subscription 1:, Event: 0
delay four seconds
Subscription 2:, Event: 0
Subscription 1:, Event: 1
Subscription 2:, Event: 1
Subscription 1:, Event: 2
Subscription 2:, Event: 2
Subscription 1:, Event: 3
Subscription 2:, Event: 3
Subscription 1:, Event: 4
Subscription 2:, Event: 4
delay eight seconds
Subscription 3:, Event: 0
Subscription 3:, Event: 1
Subscription 3:, Event: 2
Subscription 3:, Event: 3
Subscription 3:, Event: 4
Subscription 1:, Event: 5
Subscription 2:, Event: 5
Subscription 3:, Event: 5
Subscription 1:, Event: 6
Subscription 2:, Event: 6
Subscription 3:, Event: 6
...
</code></pre><p>è§£é‡Šä¸€ä¸‹ä¸Šé¢çš„ä»£ç ï¼š</p>
<ol>
<li>è°ƒç”¨<code>replay()</code>å‡½æ•°å°†æ™®é€šçš„Observableåºåˆ—è½¬æ¢æˆä¸€ä¸ªå¯è¿æ¥çš„Observableåºåˆ—ï¼Œå¹¶ä¸”è®¾ç½®ç¼“å­˜å†å²äº‹ä»¶æ•°é‡ä¸º5ï¼›</li>
<li>è°ƒç”¨<code>connect()</code>å‡½æ•°ä½¿å¾—å¯è¿æ¥çš„Observableåºåˆ—å¼€å§‹å‘é€äº‹ä»¶ã€‚</li>
</ol>
<p>è§‚å¯Ÿæ‰“å°ç»“æœå¯ä»¥å‘ç°ï¼š</p>
<ol>
<li><code>replay</code>æ‹¥æœ‰ä¸Šé¢<code>publish</code>ä¸€åˆ‡çš„èƒ½åŠ›ï¼›</li>
<li>é€šè¿‡è®¾ç½®<code>replay</code>æ•°é‡ä¸º5ä½¿å¾—å¯è¿æ¥çš„Observableåºåˆ—æ¯å½“è¢«æ–°çš„è®¢é˜…è€…è®¢é˜…æ—¶é¦–å…ˆä¼šæœ€å¤šå‘é€5ä¸ªå†å²äº‹ä»¶ï¼›</li>
</ol>
<h4 id="multicast"><a href="#multicast" class="headerlink" title="multicast"></a>multicast</h4><p>å°†æ™®é€šçš„æºObservableåºåˆ—è½¬æ¢æˆä¸€ä¸ªå¯è¿æ¥çš„Observableåºåˆ—ï¼Œå¹¶ä¸”é€šè¿‡ç‰¹å®šçš„<code>subject</code>å¯¹è±¡å‘é€äº‹ä»¶ã€‚</p>
<p>ä¸¾ä¸ªğŸŒ°ï¼š</p>
<pre><code>print(&quot;here is begin&quot;)

let subject = PublishSubject&lt;Int&gt;()

_ = subject
    .subscribe(onNext: { print(&quot;Subject: \($0)&quot;) }) // 1

let intSequence = Observable&lt;Int&gt;.interval(1, scheduler: MainScheduler.instance)
    .multicast(subject)  // 2

_ = intSequence
    .subscribe(onNext: { print(&quot;\tSubscription 1:, Event: \($0)&quot;) })

delay(2) {
    print(&quot;delay two seconds&quot;)
    _ = intSequence.connect()  // 3
}

delay(4) {
    print(&quot;delay four seconds&quot;)
    _ = intSequence
        .subscribe(onNext: { print(&quot;\tSubscription 2:, Event: \($0)&quot;) })
}

delay(6) {
    print(&quot;delay six seconds&quot;)
    _ = intSequence
        .subscribe(onNext: { print(&quot;\tSubscription 3:, Event: \($0)&quot;) })
}
</code></pre><p>ç»“æœæ˜¯ï¼š</p>
<pre><code>here is begin
delay two seconds
Subject: 0
    Subscription 1:, Event: 0
delay four seconds
Subject: 1
    Subscription 1:, Event: 1
    Subscription 2:, Event: 1
Subject: 2
    Subscription 1:, Event: 2
    Subscription 2:, Event: 2
delay six seconds
Subject: 3
    Subscription 1:, Event: 3
    Subscription 2:, Event: 3
    Subscription 3:, Event: 3
Subject: 4
    Subscription 1:, Event: 4
    Subscription 2:, Event: 4
    Subscription 3:, Event: 4
...
</code></pre><p>è§£é‡Šä¸€ä¸‹ä¸Šé¢çš„ä»£ç ï¼š</p>
<ol>
<li>é¦–å…ˆåˆ›å»ºä¸€ä¸ª<code>PublishSubject</code>ç±»å‹çš„å¯¹è±¡<code>subject</code>å¹¶ä¸”å»è®¢é˜…å®ƒï¼›</li>
<li>è°ƒç”¨<code>multicast()</code>å‡½æ•°å°†æ™®é€šçš„Observableåºåˆ—è½¬æ¢æˆä¸€ä¸ªå¯è¿æ¥çš„Observableåºåˆ—ï¼Œå¹¶ä¸”å°†åˆšæ‰åˆ›å»ºçš„<code>subject</code>å¯¹è±¡ä½œä¸ºå‚æ•°ä¼ å…¥ï¼›</li>
<li>è°ƒç”¨<code>connect()</code>å‡½æ•°ä½¿å¾—å¯è¿æ¥çš„Observableåºåˆ—å¼€å§‹å‘é€äº‹ä»¶ã€‚</li>
</ol>
<p>è§‚å¯Ÿæ‰“å°ç»“æœå¯ä»¥å‘ç°ï¼š</p>
<ol>
<li><code>multicast</code>æ‹¥æœ‰ä¸Šé¢<code>publish</code>ä¸€åˆ‡çš„èƒ½åŠ›ï¼›</li>
<li>é€šè¿‡å°†<code>subject</code>å¯¹è±¡ä¼ å…¥<code>multicast()</code>å‡½æ•°ï¼Œä½¿å¾—æ¯æ¬¡<code>subject</code>å¯¹è±¡éƒ½ä¼šé¦–å…ˆæ¥æ”¶åˆ°äº‹ä»¶ã€‚</li>
</ol>
<p>ç»¼ä¸Šï¼Œå¯è¿æ¥çš„Observableåºåˆ—åªæœ‰è¢«è°ƒç”¨äº†<code>connect()</code>æ–¹æ³•ä¹‹åæ‰ä¼šå¼€å§‹å‘é€äº‹ä»¶ï¼Œå¹¶ä¸”ç»´æŒå‘é€äº‹ä»¶çš„èŠ‚å¥ä¸å˜ï¼Œä¸è®ºåŒæ—¶æœ‰å¤šå°‘ä¸ªè®¢é˜…è€…æ˜¯æ–°è®¢é˜…è€…è¿˜æ˜¯è€è®¢é˜…è€…ï¼Œä»–ä»¬æ”¶åˆ°çš„äº‹ä»¶éƒ½æ˜¯ä¸€æ ·çš„ã€‚å¯è§å®ƒçš„å†…éƒ¨æ˜¯æœ‰ä¸€ä¸ª<code>Subject</code>çš„ã€‚</p>
<h3 id="é”™è¯¯å¤„ç†æ“ä½œ"><a href="#é”™è¯¯å¤„ç†æ“ä½œ" class="headerlink" title="é”™è¯¯å¤„ç†æ“ä½œ"></a>é”™è¯¯å¤„ç†æ“ä½œ</h3><p>é‡åˆ°é”™è¯¯äº‹ä»¶æ—¶è¿›è¡Œä¸€äº›å¤„ç†çš„æ“ä½œã€‚</p>
<h4 id="catchErrorJustReturn"><a href="#catchErrorJustReturn" class="headerlink" title="catchErrorJustReturn"></a>catchErrorJustReturn</h4><p>é‡åˆ°é”™è¯¯äº‹ä»¶æ—¶æ”¹æˆè¿”å›ä¸€ä¸ªnextç±»å‹äº‹ä»¶ï¼Œç„¶åå‘é€ä¸€ä¸ªå®Œæˆäº‹ä»¶ã€‚</p>
<p>ä¸¾ä¸ªğŸŒ°ï¼š</p>
<pre><code>let disposeBag = DisposeBag()

let sequenceThatFails = PublishSubject&lt;String&gt;()

sequenceThatFails
    .catchErrorJustReturn(&quot;ğŸ˜Š&quot;)
    .subscribe { print($0) }
    .disposed(by: disposeBag)

sequenceThatFails.onNext(&quot;ğŸ˜¬&quot;)
sequenceThatFails.onNext(&quot;ğŸ˜¨&quot;)
sequenceThatFails.onNext(&quot;ğŸ˜¡&quot;)
sequenceThatFails.onNext(&quot;ğŸ”´&quot;)
sequenceThatFails.onError(TestError.test)
</code></pre><p>ç»“æœæ˜¯ï¼š</p>
<pre><code>next(ğŸ˜¬)
next(ğŸ˜¨)
next(ğŸ˜¡)
next(ğŸ”´)
next(ğŸ˜Š)
completed
</code></pre><h4 id="catchError"><a href="#catchError" class="headerlink" title="catchError"></a>catchError</h4><p>é‡åˆ°é”™è¯¯äº‹ä»¶æ—¶è¿”å›å¦ä¸€ä¸ªObservableåºåˆ—ã€‚</p>
<p>ä¸¾ä¸ªğŸŒ°ï¼š</p>
<pre><code>let disposeBag = DisposeBag()

let sequenceThatFails = PublishSubject&lt;String&gt;()
let recoverySequence = PublishSubject&lt;String&gt;()

sequenceThatFails
    .catchError {
        print(&quot;Error:&quot;, $0)
        return recoverySequence
    }
    .subscribe { print($0) }
    .disposed(by: disposeBag)

sequenceThatFails.onNext(&quot;ğŸ˜¬&quot;)
sequenceThatFails.onNext(&quot;ğŸ˜¨&quot;)
sequenceThatFails.onNext(&quot;ğŸ˜¡&quot;)
sequenceThatFails.onNext(&quot;ğŸ”´&quot;)
sequenceThatFails.onError(TestError.test)

recoverySequence.onNext(&quot;ğŸ˜Š&quot;)
</code></pre><p>ç»“æœæ˜¯ï¼š</p>
<pre><code>next(ğŸ˜¬)
next(ğŸ˜¨)
next(ğŸ˜¡)
next(ğŸ”´)
Error: test
next(ğŸ˜Š)
</code></pre><h4 id="retry"><a href="#retry" class="headerlink" title="retry"></a>retry</h4><p>é‡åˆ°é”™è¯¯äº‹ä»¶æ—¶é‡æ–°è®¢é˜…æ­¤Observableåºåˆ—ã€‚</p>
<p>ä¸¾ä¸ªğŸŒ°ï¼š</p>
<pre><code>let disposeBag = DisposeBag()
var count = 1

let sequenceThatErrors = Observable&lt;String&gt;.create { observer in

    observer.onNext(&quot;ğŸ&quot;)
    observer.onNext(&quot;ğŸ&quot;)
    observer.onNext(&quot;ğŸŠ&quot;)

    if count == 1 {
        observer.onError(TestError.test)
        print(&quot;Error encountered&quot;)
        count += 1
    }

    observer.onNext(&quot;ğŸ¶&quot;)
    observer.onNext(&quot;ğŸ±&quot;)
    observer.onNext(&quot;ğŸ­&quot;)
    observer.onCompleted()

    return Disposables.create()
}

sequenceThatErrors
    .retry(3)
    .subscribe(onNext: { print($0) })
    .disposed(by: disposeBag)

-------

let disposeBag = DisposeBag()
var count = 1

let sequenceThatErrors = Observable&lt;String&gt;.create { observer in
    observer.onNext(&quot;ğŸ&quot;)
    observer.onNext(&quot;ğŸ&quot;)
    observer.onNext(&quot;ğŸŠ&quot;)

    if count &lt; 5 {
        observer.onError(TestError.test)
        print(&quot;Error encountered&quot;)
        count += 1
    }

    observer.onNext(&quot;ğŸ¶&quot;)
    observer.onNext(&quot;ğŸ±&quot;)
    observer.onNext(&quot;ğŸ­&quot;)
    observer.onCompleted()

    return Disposables.create()
}

sequenceThatErrors
    .retry(3)
    .subscribe(onNext: { print($0) })
    .disposed(by: disposeBag)
</code></pre><p>ç»“æœæ˜¯ï¼š</p>
<pre><code>ğŸ
ğŸ
ğŸŠ
Error encountered
ğŸ
ğŸ
ğŸŠ
ğŸ¶
ğŸ±
ğŸ­

-------

ğŸ
ğŸ
ğŸŠ
Error encountered
ğŸ
ğŸ
ğŸŠ
Error encountered
ğŸ
ğŸ
ğŸŠ
Error encountered
Received unhandled error: -&gt; test
</code></pre><h3 id="Debugæ“ä½œ"><a href="#Debugæ“ä½œ" class="headerlink" title="Debugæ“ä½œ"></a>Debugæ“ä½œ</h3><p>å¸®åŠ©debugçš„æ“ä½œã€‚</p>
<h4 id="debug"><a href="#debug" class="headerlink" title="debug"></a>debug</h4><p>æ‰“å°æ‰€æœ‰è¢«è®¢é˜…ï¼Œäº‹ä»¶å’Œè¢«é”€æ¯ã€‚</p>
<p>ä¸¾ä¸ªğŸŒ°ï¼š</p>
<pre><code>let disposeBag = DisposeBag()
var count = 1

let sequenceThatErrors = Observable&lt;String&gt;.create { observer in
    observer.onNext(&quot;ğŸ&quot;)
    observer.onNext(&quot;ğŸ&quot;)
    observer.onNext(&quot;ğŸŠ&quot;)

    if count &lt; 5 {
        observer.onError(TestError.test)
        print(&quot;Error encountered&quot;)
        count += 1
    }

    observer.onNext(&quot;ğŸ¶&quot;)
    observer.onNext(&quot;ğŸ±&quot;)
    observer.onNext(&quot;ğŸ­&quot;)
    observer.onCompleted()

    return Disposables.create()
}

sequenceThatErrors
    .retry(3)
    .debug()
    .subscribe(onNext: { print($0) })
    .disposed(by: disposeBag)
</code></pre><p>ç»“æœæ˜¯ï¼š</p>
<pre><code>2017-04-17 21:41:29.960: playground20.swift:42 (__lldb_expr_20) -&gt; subscribed
2017-04-17 21:41:29.963: playground20.swift:42 (__lldb_expr_20) -&gt; Event next(ğŸ)
ğŸ
2017-04-17 21:41:29.964: playground20.swift:42 (__lldb_expr_20) -&gt; Event next(ğŸ)
ğŸ
2017-04-17 21:41:29.964: playground20.swift:42 (__lldb_expr_20) -&gt; Event next(ğŸŠ)
ğŸŠ
Error encountered
2017-04-17 21:41:29.967: playground20.swift:42 (__lldb_expr_20) -&gt; Event next(ğŸ)
ğŸ
2017-04-17 21:41:29.967: playground20.swift:42 (__lldb_expr_20) -&gt; Event next(ğŸ)
ğŸ
2017-04-17 21:41:29.967: playground20.swift:42 (__lldb_expr_20) -&gt; Event next(ğŸŠ)
ğŸŠ
Error encountered
2017-04-17 21:41:29.969: playground20.swift:42 (__lldb_expr_20) -&gt; Event next(ğŸ)
ğŸ
2017-04-17 21:41:29.969: playground20.swift:42 (__lldb_expr_20) -&gt; Event next(ğŸ)
ğŸ
2017-04-17 21:41:29.970: playground20.swift:42 (__lldb_expr_20) -&gt; Event next(ğŸŠ)
ğŸŠ
Error encountered
2017-04-17 21:41:29.971: playground20.swift:42 (__lldb_expr_20) -&gt; Event error(test)
Received unhandled error: -&gt; test
2017-04-17 21:41:29.997: playground20.swift:42 (__lldb_expr_20) -&gt; isDisposed
</code></pre><h4 id="RxSwift-Resources-total"><a href="#RxSwift-Resources-total" class="headerlink" title="RxSwift.Resources.total"></a>RxSwift.Resources.total</h4><p>å±•ç¤ºäº†Rxå½“å‰æ‰€æœ‰èµ„æºä½¿ç”¨æ•°ï¼Œç”¨äºå¼€å‘æœŸé—´æ£€æŸ¥æ˜¯å¦å­˜åœ¨å†…å­˜æ³„æ¼ã€‚</p>
<p>ä¸¾ä¸ªğŸŒ°ï¼š</p>
<pre><code>{
    print(RxSwift.Resources.total)

    let disposeBag = DisposeBag()

    print(RxSwift.Resources.total)

    let variable = Variable(&quot;ğŸ&quot;)

    let subscription1 = variable.asObservable().subscribe(onNext: { print($0) })

    print(RxSwift.Resources.total)

    let subscription2 = variable.asObservable().subscribe(onNext: { print($0) })

    print(RxSwift.Resources.total)

    subscription1.dispose()

    print(RxSwift.Resources.total)

    subscription2.dispose()

    print(RxSwift.Resources.total)
}

print(RxSwift.Resources.total)
</code></pre><p>ç»“æœæ˜¯ï¼š</p>
<pre><code>0
2
ğŸ
8
ğŸ
10
9
8
0
</code></pre><p>å†çœ‹ä¸€çœ¼æœ€å¼€å§‹å‡ºç°è¿‡çš„å›¾ç‰‡ã€‚</p>
<p><img src="http://ocepn6hgq.bkt.clouddn.com/RxSwift-from-zero-to-one-first-lesson.png" alt="1"></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å»å¹´å…¬å¸é¡¹ç›®æé‡æ„æ—¶å­¦ä¹ å¹¶åº”ç”¨è¿‡ä¸€é˜µRACï¼Œæ„Ÿè§‰çœŸæ˜¯6çš„èµ·é£ã€‚è¿‘æ¥å¬è¯´åœ¨swiftä¸Šæœ‰ä¸€ä¸ªRxSwiftåº“å†™çš„æ£’æ£’çš„ï¼Œç‰¹åœ°å­¦ä¹ äº†ä¸‹ã€‚å†™ä¸‹ä¸€ç‚¹å­¦ä¹ ç¬”è®°ä»…ä¾›å‚è€ƒã€‚&lt;/p&gt;
&lt;p&gt;æœ¬ç¯‡æ–‡ç« ä¸»è¦åˆ†å››ä¸ªéƒ¨åˆ†ï¼šRxSwiftç®€ä»‹ï¼ŒRxSwiftä¸­çš„åŸºæœ¬æ¦‚å¿µï¼ŒRxSwiftåŸºæœ¬ç”¨æ³•ï¼ŒRxSwiftä¸­ä¸°å¯Œè€Œç¥å¥‡çš„æ“ä½œã€‚&lt;/p&gt;
&lt;p&gt;å…ˆæ¥ä¸€å¼ å›¾é•‡å¸–ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://ocepn6hgq.bkt.clouddn.com/RxSwift-from-zero-to-one-first-lesson.png&quot; alt=&quot;1&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="FRP" scheme="http://yoursite.com/categories/FRP/"/>
    
    
      <category term="RxSwift" scheme="http://yoursite.com/tags/RxSwift/"/>
    
  </entry>
  
  <entry>
    <title>RxSwift &amp; RxCocoa å…¥é—¨æ•™ç¨‹</title>
    <link href="http://yoursite.com/2017/03/21/Getting-Started-With-RxSwift-and-RxCocoa%E3%80%90%E8%AF%91%E3%80%91/"/>
    <id>http://yoursite.com/2017/03/21/Getting-Started-With-RxSwift-and-RxCocoaã€è¯‘ã€‘/</id>
    <published>2017-03-20T16:06:39.000Z</published>
    <updated>2017-03-22T02:59:06.000Z</updated>
    
    <content type="html"><![CDATA[<p>æœ¬æ–‡ç”±Ellen Shapiroäº16å¹´å‘è¡¨äº<a href="https://www.raywenderlich.com/" target="_blank" rel="external">raywenderlich</a>ï¼ŒåŸæ–‡å¯æŸ¥çœ‹<a href="https://www.raywenderlich.com/138547/getting-started-with-rxswift-and-rxcocoa" target="_blank" rel="external">Getting Started With RxSwift and RxCocoa</a>ã€‚</p>
<p>è‹¥èƒ½éšå¿ƒæ‰€æ¬²çš„æ§åˆ¶è‡ªå·±çš„ä»£ç è¾¾æˆé¢„æœŸçš„æ•ˆæœï¼Œæƒ³æ¥ä¸€å®šæ˜¯æå¥½çš„ã€‚</p>
<p>é¢å‘å¯¹è±¡ç¼–ç¨‹ä¸­å¤§éƒ¨åˆ†ç¨‹åºéƒ½æ˜¯<font color="green">å‘½ä»¤å¼</font>çš„ï¼šä½ çš„ä»£ç å‘Šè¯‰ä½ çš„ç¨‹åºå»å¹²ä»€ä¹ˆåŒæ—¶æœ‰å¤šç§æ–¹å¼æ¥ç›‘å¬å˜åŒ–ï¼ä½†æ˜¯é€šå¸¸ä½ åˆå¿…é¡»æ˜¾ç¤ºçš„å‘Šè¯‰ç³»ç»Ÿä»€ä¹ˆæ—¶å€™å‘ç”Ÿçš„å˜åŒ–ã€‚</p>
<p>è¿™æ ·å…¶å®ä¹Ÿè¿˜å¥½ï¼Œä¸è¿‡å¦‚æœèƒ½æå‰éƒ½è®¾ç½®å¥½ï¼Œåœ¨å‘ç”Ÿå˜åŒ–æ—¶ä»£ç èƒ½å¤Ÿè‡ªåŠ¨æ›´æ–°ä¼šä¸ä¼šæ„Ÿè§‰æ›´åŠ æ£’æ£’çš„ï¼Ÿè¿™å°±æ˜¯<font color="green">å“åº”å¼</font>ç¼–ç¨‹çš„åŸºæœ¬æ€æƒ³ï¼šä½ çš„åº”ç”¨ä¼šé’ˆå¯¹åº•å±‚æ•°æ®çš„æ”¹å˜è€Œåšå‡ºç›¸åº”çš„å“åº”ï¼Œè€Œä¸éœ€è¦ä½ å»ç›´æ¥å‘Šè¯‰å®ƒã€‚è¿™æ ·ä½¿å¾—å¯ä»¥å…¨å¿ƒå…³æ³¨äºé€»è¾‘å¤„ç†è€Œä¸éœ€è¦ç»´æŠ¤ä¸€å †çŠ¶æ€ã€‚</p>
<a id="more"></a>
<p>åœ¨Objective-Cæˆ–Swiftä¸­è¿™å…¶å®éƒ½å¯ä»¥å®ç°ï¼Œä¸»è¦å¯ä»¥é€šè¿‡ç³»ç»Ÿçš„KVOæœºåˆ¶ï¼Œåœ¨Swiftä¸­è¿˜å¯ä»¥ä½¿ç”¨didSetæ–¹æ³•ã€‚ç„¶è€Œå®é™…æ•ˆæœä½ æ‡‚çš„ã€‚ä¸ºäº†é¿å…è¿™äº›é—®é¢˜ï¼Œç°åœ¨åœ¨Objective-Cå’ŒSwiftä¸Šéƒ½æœ‰äº†ä¸€äº›æ¯”è¾ƒæˆç†Ÿçš„æ¡†æ¶ï¼Œæ¥å®ç°å“åº”å¼ç¼–ç¨‹ã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼šå¦‚æœæƒ³äº†è§£æ›´å¤šï¼Œå¼ºçƒˆæ¨èä½ çœ‹çœ‹è¿™ç¯‡æ–‡ç« <a href="https://www.raywenderlich.com/126522/reactivecocoa-vs-rxswift" target="_blank" rel="external">ReactiveCocoa vs RxSwift</a>ï¼Œå¹¶ä¸”æ­£æ–‡ä¸‹é¢çš„è¯„è®ºä¹Ÿå€¼å¾—ä¸€è¯»ã€‚</p>
</blockquote>
<p>ä»Šå¤©æˆ‘ä»¬å°†ä½¿ç”¨å…¶ä¸­ä¸€ä¸ªæ¡†æ¶ï¼Œ<font color="green">RxSwift</font>ï¼Œè¿˜æœ‰å®ƒçš„å°ä¼™ä¼´<font color="green">RxCocoa</font>ï¼Œé€šè¿‡å®ç°ä¸€ä¸ªè´­ä¹°å·§å…‹åŠ›çš„Appï¼Œå­¦ä¹ å¦‚ä½•ä»ä»¤äººæ¼ç«çš„å‘½ä»¤å¼ç¼–ç¨‹è¿‡æ¸¡åˆ°ä¼˜é›…çš„å“åº”å¼ç¼–ç¨‹ã€‚</p>
<h2 id="RxSwift-amp-RxCocoaæ˜¯ä»€ä¹ˆ"><a href="#RxSwift-amp-RxCocoaæ˜¯ä»€ä¹ˆ" class="headerlink" title="RxSwift &amp; RxCocoaæ˜¯ä»€ä¹ˆ?"></a>RxSwift &amp; RxCocoaæ˜¯ä»€ä¹ˆ?</h2><p><font color="green">RxSwift</font>å’Œ<font color="green">RxCocoa</font>æ˜¯<a href="http://reactivex.io/" target="_blank" rel="external">ReactiveX</a>ï¼ˆé€šå¸¸è¢«ç®€ç§°ä¸ºâ€œRxâ€ï¼‰è¯­è¨€å·¥å…·å…¨å¥—çš„ä¸€éƒ¨åˆ†ï¼Œè¿™ä¸ªå¥—ä»¶è·¨è¶Šäº†å¤šç§ç¼–ç¨‹è¯­è¨€å’Œå¹³å°ã€‚Rxèµ·æºäº.Net/C#ç”Ÿæ€ä½“ç³»ï¼Œä¸è¿‡ç°åœ¨å·²ç»éå¸¸å—Rubyã€JSã€å°¤å…¶æ˜¯Javaå’ŒAndroidå¼€å‘äººå‘˜çš„æ¬¢è¿äº†ã€‚</p>
<p><font color="green">RxSwift</font>æ˜¯ä¸€ä¸ªç”¨äºä¸Swiftè¯­è¨€äº¤äº’çš„æ¡†æ¶ï¼Œè€Œ<font color="green">RxCocoa</font>æ˜¯ä¸€ä¸ªé€šè¿‡åº”ç”¨å“åº”å¼æŠ€å·§æ¥ä½¿å¾—Cocoaçš„APIæ›´å®¹æ˜“ä½¿ç”¨çš„æ¡†æ¶ã€‚</p>
<p>Rxæ¡†æ¶æä¾›äº†ä¸€å¥—é€šç”¨çš„è¯æ±‡ï¼Œä»¥æ–¹ä¾¿åœ¨ä¸åŒçš„è¯­è¨€ä¸­æè¿°ç›¸åŒçš„ä»»åŠ¡ã€‚ç†è®ºä¸Šï¼Œè¿™ä½¿å¾—ä½ å¯ä»¥æ›´åŠ ä¸“æ³¨äºè¯­è¨€æœ¬èº«çš„è¯­æ³•ï¼Œè€Œä¸ä¼šæŠŠæ—¶é—´æµªè´¹åœ¨å°†ä¸€ä¸ªæ™®é€šä»»åŠ¡ä»ä¸€ç§è¯­è¨€è½¬æ¢åˆ°å¦ä¸€ç§æ–°è¯­è¨€ä¸Šã€‚</p>
<h3 id="Observables-and-Observers"><a href="#Observables-and-Observers" class="headerlink" title="Observables and Observers"></a>Observables and Observers</h3><p>æœ¬ç¯‡æ•™ç¨‹ä¸­éœ€è¦çŸ¥é“çš„ä¸¤ä¸ªåŸºæœ¬æ¦‚å¿µï¼š<font color="green">Observable</font>ï¼ˆè¢«è§‚å¯Ÿè€…ï¼‰å’Œ<font color="green">Observer</font>ï¼ˆè§‚å¯Ÿè€…ï¼‰ã€‚</p>
<ul>
<li><font color="green">Observable</font>æ˜¯å‘å‡ºå˜åŒ–é€šçŸ¥çš„å¯¹è±¡ï¼›</li>
<li><font color="green">Observer</font>æ˜¯è®¢é˜…äº†ä¸€ä¸ªObservableçš„å¯¹è±¡ï¼Œä»¥ä¾¿åœ¨Observableå˜åŒ–æ—¶æ¥æ”¶é€šçŸ¥</li>
</ul>
<p>å½“ç„¶å¯ä»¥åŒæ—¶æœ‰å¤šä¸ªObserverç›‘å¬åŒä¸€ä¸ªObservableã€‚è¿™æ„å‘³ç€å½“Observableå˜åŒ–æ—¶ï¼Œä¼šé€šçŸ¥åˆ°æ‰€æœ‰ç›¸å…³çš„Observerã€‚</p>
<h3 id="The-DisposeBag"><a href="#The-DisposeBag" class="headerlink" title="The DisposeBag"></a>The DisposeBag</h3><p>RxSwiftå’ŒRxCocoaè¿˜æœ‰ä¸€ä¸ªé¢å¤–çš„å·¥å…·æ¥å¸®åŠ©å¤„ç†ARCå’Œå†…å­˜ç®¡ç†ï¼Œå³ï¼š<font color="green">DisposeBag</font>ç±»ã€‚è¿™æ˜¯Observerå¯¹è±¡çš„ä¸€ä¸ªè™šæ‹Ÿâ€œåŒ…â€ï¼Œå½“å®ƒä»¬çš„çˆ¶å¯¹è±¡è¢«é‡Šæ”¾æ—¶ï¼Œè¿™ä¸ªè™šæ‹ŸåŒ…ä¹Ÿä¼šè¢«é”€æ¯ã€‚</p>
<p>å½“å¸¦æœ‰ä¸€ä¸ªDisposeBagå±æ€§çš„å¯¹è±¡è°ƒç”¨ææ„å‡½æ•°æ—¶ï¼Œè™šæ‹ŸåŒ…å°†ä¼šè¢«æ¸…ç©ºï¼Œä¸æ­¤åŒæ—¶æ¯ä¸€ä¸ªå¯é”€æ¯çš„Observerä¼šè‡ªåŠ¨å–æ¶ˆè®¢é˜…å®ƒæ‰€è§‚å¯Ÿçš„å¯¹è±¡ã€‚è¿™å…è®¸ARCå¯ä»¥åƒé€šå¸¸ä¸€æ ·å›æ”¶å†…å­˜ã€‚</p>
<p>å¦‚æœæ²¡æœ‰DisposeBagï¼Œå°±ä¼šäº§ç”Ÿä¸¤ç§ç»“æœï¼šæˆ–è€…Observerä¼šäº§ç”Ÿä¸€ä¸ªretain cycleï¼Œè¢«æ°¸ä¹…çš„ç»‘å®šåˆ°è¢«è§‚å¯Ÿå¯¹è±¡ä¸Šï¼›æˆ–è€…æ„å¤–åœ°è¢«é‡Šæ”¾æ—¶ï¼Œå¯¼è‡´ç¨‹åºå´©æºƒã€‚</p>
<p>æ‰€ä»¥ä¸ºäº†æ›´å¥½çš„é…åˆARCï¼Œè®°å¾—è®¾ç½®Observableå¯¹è±¡æ—¶ï¼Œä¸€å®šè¦å°†å®ƒä»¬æ·»åŠ åˆ°DisposeBagä¸­ã€‚è¿™æ ·å®ƒä»¬æ‰èƒ½å¾ˆå¥½åœ°è¢«æ¸…ç†æ‰ã€‚</p>
<h2 id="æ­£å¼å¼€å§‹"><a href="#æ­£å¼å¼€å§‹" class="headerlink" title="æ­£å¼å¼€å§‹"></a>æ­£å¼å¼€å§‹</h2><p>è®©æˆ‘ä»¬å»ä¹°å·§å…‹åŠ›å§ï¼é¦–å…ˆä¸‹è½½æœ¬æ•™ç¨‹çš„åˆå§‹å·¥ç¨‹<a href="https://koenig-media.raywenderlich.com/uploads/2016/10/Chocotastic-starter-s3-rxs-3b1.zip" target="_blank" rel="external">Chocotastic</a>ã€‚è§£å‹åç”¨Xcodeæ‰“å¼€Chocotastic.xcworkspaceæ–‡ä»¶ã€‚</p>
<p>æ„å»ºå¹¶è¿è¡Œç¨‹åºã€‚ä½ ä¼šçœ‹åˆ°ä»¥ä¸‹æ•ˆæœï¼Œåˆ—å‡ºäº†å‡ ç§ä½ å¯ä»¥ä»æ¬§æ´²è´­ä¹°åˆ°çš„å·§å…‹åŠ›ï¼Œä»¥åŠå„è‡ªçš„ä»·æ ¼ï¼š</p>
<p><img src="https://koenig-media.raywenderlich.com/uploads/2016/07/initial_landing.png" alt="1"></p>
<p>éšä¾¿ç‚¹å‡»ä¸€è¡Œï¼Œå¯¹åº”çš„å·§å…‹åŠ›å°†ä¼šæ·»åŠ åˆ°ä½ çš„è´­ç‰©è½¦ä¸­ï¼š</p>
<p><img src="https://koenig-media.raywenderlich.com/uploads/2016/07/added_chocolate.png" alt="2"></p>
<p>ç‚¹å‡»å³ä¸Šè§’ï¼Œä¼šè¿›å…¥åˆ°è´­ç‰©è½¦ç•Œé¢ï¼Œæ­¤æ—¶å¯ä»¥ç»“è´¦æˆ–è€…æ¸…ç©ºè´­ç‰©è½¦ï¼š</p>
<p><img src="https://koenig-media.raywenderlich.com/uploads/2016/07/checkout.png" alt="3"></p>
<p>å¦‚æœç‚¹å‡»ç»“è´¦æŒ‰é’®ï¼Œå°†æ˜¾ç¤ºä¸€ä¸ªä¿¡ç”¨å¡ä¿¡æ¯è¾“å…¥é¡µé¢ï¼š</p>
<p><img src="https://koenig-media.raywenderlich.com/uploads/2016/07/cc_form.png" alt="4"></p>
<p>åœ¨æœ¬æ•™ç¨‹çš„åé¢ï¼Œä½ å°†ä½¿ç”¨çº¯å“åº”å¼ç¼–ç¨‹æ¥è§£å†³è¿™äº›é—®é¢˜ã€‚å…ˆç‚¹å‡»CartæŒ‰é’®è¿”å›è´­ç‰©è½¦é¡µï¼Œç„¶åç‚¹å‡»ResetæŒ‰é’®è¿”å›ä¸»ç•Œé¢ï¼ŒåŒæ—¶è´­ç‰©è½¦å·²è¢«æ¸…ç©ºã€‚</p>
<h3 id="èµ·ç‚¹ï¼šéå“åº”å¼"><a href="#èµ·ç‚¹ï¼šéå“åº”å¼" class="headerlink" title="èµ·ç‚¹ï¼šéå“åº”å¼"></a>èµ·ç‚¹ï¼šéå“åº”å¼</h3><p>ç°åœ¨ä½ å·²ç»çŸ¥é“äº†è¿™ä¸ªç¨‹åºæ˜¯å¹²ä»€ä¹ˆçš„äº†ï¼Œæ¥çœ‹çœ‹å®ƒæ˜¯æ€ä¹ˆåšçš„ã€‚æ‰“å¼€<font color="green">ChocolatesOfTheWorldViewController.swift</font>æ–‡ä»¶ï¼Œåœ¨è¿™é‡Œä½ å¯ä»¥çœ‹åˆ°ä¸€äº›æ ‡å‡†çš„<font color="green">UITableViewDelegate</font>å’Œ<font color="green">UITableViewDataSource</font>çš„å®ç°æ–¹æ³•ã€‚</p>
<p>è¿˜æœ‰ä¸€ä¸ª<font color="green">updateCartButton()</font>æ–¹æ³•ï¼Œç”¨å½“å‰è´­ç‰©è½¦ä¸­çš„å·§å…‹åŠ›æ•°é‡æ¥æ›´æ–°è´­ç‰©è½¦æŒ‰é’®ã€‚è¿™ä¸ªæ–¹æ³•åœ¨ä¸¤ä¸ªåœ°æ–¹è¢«è°ƒç”¨ï¼š</p>
<p>åœ¨<font color="green">viewWillAppear(:)</font>å’Œ <font color="green">tableView(_:didSelectRowAt:)</font>ä¸­ã€‚<br>è¿™äº›éƒ½æ˜¯ä»¥<font color="green">å‘½ä»¤å¼</font>çš„æ–¹æ³•æ¥ä¿®æ”¹æ•°é‡ï¼šä½ å¿…é¡»æ˜¾ç¤ºè°ƒç”¨æ–¹æ³•æ¥æ›´æ–°è®¡æ•°ã€‚</p>
<p>æ­¤æ—¶ï¼Œä½ å¿…é¡»è·Ÿè¸ªä½ è¦æ”¹å˜å€¼çš„ä½ç½®ï¼Œä¸è¿‡å½“ä½ ä½¿ç”¨å“åº”å¼çš„æ–¹å¼æ¥é‡å†™è¿™äº›ä»£ç ä¹‹åï¼Œæ— è®ºæ•°é‡æ˜¯åœ¨å“ªæˆ–æ˜¯æ€æ ·æ”¹å˜äº†ï¼Œè´­ç‰©è½¦æŒ‰é’®éƒ½ä¼šè‡ªåŠ¨æ›´æ–°ã€‚</p>
<h2 id="RxSwiftï¼šè®©è´­ç‰©è½¦æ•°é‡æˆå“åº”å¼"><a href="#RxSwiftï¼šè®©è´­ç‰©è½¦æ•°é‡æˆå“åº”å¼" class="headerlink" title="RxSwiftï¼šè®©è´­ç‰©è½¦æ•°é‡æˆå“åº”å¼"></a>RxSwiftï¼šè®©è´­ç‰©è½¦æ•°é‡æˆå“åº”å¼</h2><p>æ‰€æœ‰å¼•ç”¨è´­ç‰©è½¦ä¸­ç‰©å“çš„æ–¹æ³•éƒ½æ˜¯ä½¿ç”¨çš„ä¸€ä¸ª<font color="green">ShoppingCart.sharedCart</font>å•ä¾‹ã€‚æ‰“å¼€<font color="green">ShoppingCart.swift</font>æ–‡ä»¶ï¼Œä½ èƒ½çœ‹åˆ°å•ä¾‹å®ä¾‹ä¸Šä¸€ä¸ªå˜é‡çš„æ ‡å‡†è®¾ç½®æ–¹å¼ï¼š</p>
<pre><code>var chocolates = [Chocolate]()
</code></pre><p>ç°åœ¨ï¼Œ<font color="green">chocolates</font>æ•°ç»„å†…å®¹å˜åŒ–æ—¶ä¸ä¼šè¢«è§‚å¯Ÿåˆ°ã€‚ä½ å¯ä»¥åœ¨å®ƒçš„å®šä¹‰ä¸­æ·»åŠ ä¸€ä¸ª<font color="green">didSet</font>é—­åŒ…ï¼Œä½†å®ƒåªæœ‰åœ¨æ•´ä¸ªæ•°ç»„å˜åŒ–æ—¶æ‰ä¼šè¢«è°ƒç”¨ï¼Œè€Œä¸æ˜¯å®ƒçš„ä»»æ„ä¸€ä¸ªå…ƒç´ å‘ç”Ÿæ”¹å˜ã€‚</p>
<p>å¹¸è¿çš„æ˜¯ï¼ŒRxSwiftæœ‰ä¸€ä¸ªè§£å†³æ–¹æ¡ˆã€‚ä½¿ç”¨ä¸‹é¢è¿™è¡Œä»£ç æ¥æ›¿ä»£åŸ<font color="green">chocolates</font>å˜é‡çš„åˆ›å»ºï¼š</p>
<pre><code>let chocolates: Variable&lt;[Chocolate]&gt; = Variable([])
</code></pre><blockquote>
<p>æ³¨æ„ï¼šå¦‚ä¸Šä¿®æ”¹ä¹‹åä¼šå‡ºç°å¾ˆå¤šç¼–è¯‘é”™è¯¯ï¼Œç¨åå°±ä¼šä¿®æ”¹ã€‚</p>
</blockquote>
<p>è¿™ç§è¯­æ³•ç¡®å®æœ‰ç‚¹éš¾ç†è§£ï¼Œæ‰€ä»¥ä¸‹é¢æˆ‘ä»¬æ¥æ…¢æ…¢äº†è§£åˆ°åº•å‘ç”Ÿäº†ä»€ä¹ˆã€‚</p>
<p>ä¸å°†<font color="green">chocolates</font>è®¾ç½®ä¸ºä¸€ä¸ªåŒ…å«<font color="green">Chocolate</font>å¯¹è±¡çš„æ•°ç»„ä¸åŒï¼Œå°†å…¶å®šä¹‰ä¸ºä¸€ä¸ªRxSwiftçš„<font color="green">Variable</font>ç±»å‹çš„å˜é‡ï¼Œå…¶ä¸­æ³›å‹ç±»å‹æŒ‡å®šä¸ºåŒ…å«<font color="green">Chocolate</font>å¯¹è±¡çš„æ•°ç»„ã€‚</p>
<p><font color="green">Variable</font>æ˜¯ä¸€ä¸ªç±»ï¼Œæ‰€ä»¥å®ƒä½¿ç”¨å¼•ç”¨è¯­ä¹‰â€“ä¹Ÿå°±æ˜¯è¯´<font color="green">chocolates</font>å¼•ç”¨äº†ä¸€ä¸ª<font color="green">Variable</font>çš„å®ä¾‹ã€‚</p>
<p><font color="green">Variable</font>æœ‰ä¸€ä¸ª<font color="green">value</font>å±æ€§ã€‚è¿™æ˜¯ä½ çš„<font color="green">Chocolate</font>å¯¹è±¡æ•°ç»„çš„å®é™…å­˜å‚¨ä½ç½®ã€‚</p>
<p><font color="green">Variable</font>çš„ç¥å¥‡ä¹‹å¤„æ¥è‡ªäºä¸€ä¸ªå«åš<font color="green">asObservable()</font>æ–¹æ³•ã€‚ä¸è¿‡å»ä½ éœ€è¦æ—¶åˆ»æ‰‹åŠ¨æ£€æŸ¥å€¼ä¸åŒçš„æ˜¯ï¼Œç°åœ¨ä½ å¯ä»¥æ·»åŠ ä¸€ä¸ªObserveræ¥è§‚å¯Ÿè¿™ä¸ªå€¼ï¼Œå½“å€¼å‘ç”Ÿå˜åŒ–æ—¶ï¼ŒObserverä¼šé€šçŸ¥ä½ ï¼Œä»¥ä¾¿ä½ å¯ä»¥å¯¹ä»»ä½•å˜åŒ–åšå‡ºå“åº”ã€‚</p>
<p>è¿™æ ·è®¾ç½®çš„ç¼ºç‚¹åœ¨äºå½“ä½ éœ€è¦è®¿é—®æˆ–æ”¹å˜chocolatesæ•°ç»„ä¸­çš„å…ƒç´ æ—¶ï¼Œä½ å¿…é¡»é€šè¿‡<font color="green">value</font>å±æ€§ï¼Œè€Œä¸èƒ½ç›´æ¥ä½¿ç”¨å®ƒï¼›è¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆç¼–è¯‘å™¨ä¼šæç¤ºä¸€å †é”™è¯¯ã€‚å¼€å§‹ä¿®æ”¹ã€‚</p>
<p>åœ¨<font color="green">ShoppingCart.swift</font>ä¸­ï¼Œæ‰¾åˆ°<font color="green">totalCost()</font>æ–¹æ³•ä¸­ä¸‹é¢è¿™è¡Œï¼š</p>
<pre><code>return chocolates.reduce(0) {
</code></pre><p>æ”¹æˆï¼š</p>
<pre><code>return chocolates.value.reduce(0) {
</code></pre><p>åœ¨<font color="green">itemCountString()</font>æ–¹æ³•ä¸­ï¼Œä¿®æ”¹è¿™è¡Œï¼š</p>
<pre><code>guard chocolates.count &gt; 0 else {
</code></pre><p>æ”¹æˆï¼š</p>
<pre><code>guard chocolates.value.count &gt; 0 else {
</code></pre><p>ç„¶åï¼Œ</p>
<pre><code>let setOfChocolates = Set&lt;Chocolate&gt;(chocolates)
</code></pre><p>æ”¹æˆï¼š</p>
<pre><code>let setOfChocolates = Set&lt;Chocolate&gt;(chocolates.value)
</code></pre><p>æœ€åï¼Œ</p>
<pre><code>let count: Int = chocolates.reduce(0) {
</code></pre><p>æ”¹æˆï¼š</p>
<pre><code>let count: Int = chocolates.value.reduce(0) {
</code></pre><p>åœ¨<font color="green">CartViewController.swift</font>ä¸­ï¼Œæ‰¾åˆ°<font color="green">reset()</font>æ–¹æ³•ä¸­ä¸‹é¢è¿™è¡Œï¼š</p>
<pre><code>ShoppingCart.sharedCart.chocolates = []
</code></pre><p>æ”¹æˆï¼š</p>
<pre><code>ShoppingCart.sharedCart.chocolates.value = []ã€
</code></pre><p>å›åˆ°<font color="green">ChocolatesOfTheWorldViewController.swift</font>ä¸­ï¼Œä¿®æ”¹<font color="green">updateCartButton()</font>æ–¹æ³•ä¸ºï¼š</p>
<pre><code>cartButton.title = &quot;\(ShoppingCart.sharedCart.chocolates.value.count) \u{1f36b}&quot;
</code></pre><p>åœ¨<font color="green">tableView(_:didSelectRowAt:)</font>æ–¹æ³•ä¸­ï¼Œä¿®æ”¹</p>
<pre><code>ShoppingCart.sharedCart.chocolates.append(chocolate)
</code></pre><p>ä¸º</p>
<pre><code>ShoppingCart.sharedCart.chocolates.value.append(chocolate)
</code></pre><p>æ­¤æ—¶é”™è¯¯å°±å…¨éƒ¨è¢«ä¿®å¤äº†ï¼Œå¹¶ä¸”<font color="green">chocolates</font>ä¹Ÿå¯ä»¥è¢«ç›‘å¬äº†ã€‚</p>
<p>åœ¨<font color="green">ChocolatesOfTheWorldViewController.swift</font>ä¸­ï¼Œæ·»åŠ å¦‚ä¸‹ä¸€ä¸ªå±æ€§</p>
<pre><code>let disposeBag = DisposeBag()
</code></pre><p>è¿™æ ·å°±åˆ›å»ºäº†ä¸€ä¸ª<font color="green">DisposeBag</font>å¯¹è±¡ï¼Œç”¨äºç¡®ä¿è®¾ç½®çš„Observeråœ¨deinit()ä¸­ä¼šè¢«æ¸…ç†æ‰ã€‚</p>
<p>åœ¨ <font color="green">//MARK: Rx Setup</font> æ³¨é‡Šä¸‹é¢æ·»åŠ ä»£ç ï¼š</p>
<pre><code>//MARK: Rx Setup

private func setupCartObserver() {
    //1
    ShoppingCart.sharedCart.chocolates.asObservable()
        .subscribe(onNext: { //2
            chocolates in
            self.cartButton.title = &quot;\(chocolates.count) \u{1f36b}&quot;
        })
        .addDisposableTo(disposeBag) //3
}
</code></pre><p>è¿™æ ·è®¾ç½®äº†ä¸€ä¸ªå“åº”å¼çš„Observeræ¥è‡ªåŠ¨æ›´æ–°è´­ç‰©è½¦ã€‚å¦‚ä½ æ‰€è§ï¼ŒRxSwiftä½¿ç”¨é“¾å¼å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯è¯´æ¯ä¸€ä¸ªå‡½æ•°éƒ½æ¥å—å‰ä¸€ä¸ªå‡½æ•°çš„ç»“æœã€‚</p>
<p>æ¥è§£é‡Šä¸€ä¸‹ä¸Šé¢çš„ä»£ç ï¼š</p>
<p>1.é¦–å…ˆï¼ŒæŠŠè´­ç‰©è½¦çš„<font color="green">chocolates</font>å˜é‡è®¾ç½®ä¸ºä¸€ä¸ªObservableã€‚</p>
<p>2.åœ¨è¿™ä¸ªObservableä¸Šè°ƒç”¨<font color="green">subscribe(onNext:)</font>æ–¹æ³•ï¼Œä»¥æ‰¾åˆ°Observableçš„å€¼çš„å˜åŒ–ã€‚<font color="green">subscribe(onNext:)</font>æ¥å—ä¸€ä¸ªæ¯å½“å€¼æ”¹å˜æ—¶å°±ä¼šæ‰§è¡Œçš„é—­åŒ…ä½œä¸ºå‚æ•°ã€‚é—­åŒ…çš„ä¼ å…¥å‚æ•°æ˜¯Observableçš„æ–°å€¼ã€‚ä½ å°†ä¼šæŒç»­æ¥æ”¶åˆ°å˜æ›´é€šçŸ¥ï¼Œç›´åˆ°ä½ å–æ¶ˆè®¢é˜…æˆ–è€…ä½ çš„è®¢é˜…è¢«ä¸¢å¼ƒã€‚ä»è¿™ä¸ªæ–¹æ³•å¾—åˆ°çš„æ˜¯ä¸€ä¸ªéµå®ˆäº†<font color="green">Disposable</font>çš„Observerå¯¹è±¡ï¼›</p>
<p>3.å°†ä¸Šä¸€æ­¥å¾—åˆ°çš„Observerå¯¹è±¡æ·»åŠ åˆ°<font color="green">disposeBag</font>ä¸­ä»¥ç¡®ä¿åœ¨è®¢é˜…å¯¹è±¡è¢«é‡Šæ”¾æ—¶ä½ çš„è®¢é˜…è¢«ä¸¢å¼ƒã€‚</p>
<p>æœ€åï¼Œåˆ é™¤å‘½ä»¤å¼çš„<font color="green">updateCartButton()</font>æ–¹æ³•ã€‚å½“ç„¶ï¼Œè¿™ä¼šå¯¼è‡´è°ƒç”¨è¿™ä¸ªæ–¹æ³•çš„åœ°æ–¹å‡ºç°é”™è¯¯ã€‚</p>
<p>è¦ä¿®å¤å®ƒä»¬ï¼Œæ•´ä¸ªåˆ é™¤<font color="green">viewWillAppear(:)</font>æ–¹æ³•ï¼Œåœ¨<font color="green">tableView(_:didSelectRowAt:)</font>æ–¹æ³•ä¸­åˆ é™¤<font color="green">updateCartButton()</font>çš„è°ƒç”¨ã€‚</p>
<p>è¿è¡Œä¸€ä¸‹ï¼Œä½ ä¼šçœ‹åˆ°ï¼š</p>
<p><img src="https://koenig-media.raywenderlich.com/uploads/2016/07/Simulator-Screen-Shot-Jul-4-2016-9.26.45-PM.png" alt="5"></p>
<p>ä½†æ˜¯æ³¨æ„å³ä¸Šè§’è´­ç‰©è½¦çš„æŒ‰é’®åªæ˜¾ç¤ºäº†â€™Itemâ€™ã€‚å½“ä½ ç‚¹å‡»äº†åˆ—è¡¨æ—¶ï¼Œä»€ä¹ˆä¹Ÿæ²¡æœ‰å‘ç”Ÿã€‚è¿™æ˜¯ä¸ºå•¥å‘¢ï¼Ÿ</p>
<p>å› ä¸ºåˆšæ‰åˆ›å»ºçš„æ–¹æ³•è¿˜æ²¡æœ‰è¢«è°ƒç”¨ï¼Œåœ¨<font color="green">viewDidLoad()</font>é‡Œé¢æ·»åŠ å¦‚ä¸‹ä»£ç ï¼š</p>
<pre><code>setupCartObserver()
</code></pre><p>å†æ¬¡è¿è¡Œ</p>
<p><img src="https://koenig-media.raywenderlich.com/uploads/2016/07/initial_landing.png" alt="1"></p>
<p>ç‚¹å‡»ä»»æ„ä¸€ä¸ªå·§å…‹åŠ›-ä½ ä¼šå‘ç°è´­ç‰©è½¦ä¸­å•†å“çš„æ•°é‡è‡ªåŠ¨æ›´æ–°äº†ï¼</p>
<p><img src="https://koenig-media.raywenderlich.com/uploads/2016/07/added_chocolate.png" alt="2"></p>
<p>æˆåŠŸï¼Œç°åœ¨æ‰€æœ‰çš„å·§å…‹åŠ›åˆéƒ½å¯ä»¥è¢«æ·»åŠ åˆ°è´­ç‰©è½¦ä¸­äº†ã€‚</p>
<p><img src="https://koenig-media.raywenderlich.com/uploads/2016/07/rage_chocolate1-1.png" alt="15"></p>
<h2 id="RxCocoaï¼šè®©TableViewæˆå“åº”å¼"><a href="#RxCocoaï¼šè®©TableViewæˆå“åº”å¼" class="headerlink" title="RxCocoaï¼šè®©TableViewæˆå“åº”å¼"></a>RxCocoaï¼šè®©TableViewæˆå“åº”å¼</h2><p>ç›®å‰ä¸ºæ­¢ï¼Œé€šè¿‡ä½¿ç”¨RxSwiftä½ å·²ç»è®©è´­ç‰©è½¦å˜æˆå“åº”å¼äº†ï¼Œç°åœ¨æ¥å­¦ä¹ ä½¿ç”¨RxCocoaè®©<font color="green">UITableView</font>ä¹Ÿå˜æˆå“åº”å¼ã€‚</p>
<p>RxCocoaæ‰©å±•äº†UIå…ƒç´ ä»¥æ”¯æŒå“åº”å¼APIã€‚è¿™è®©ä½ å¯ä»¥å¾ˆæ–¹ä¾¿çš„ä½¿ç”¨UITableViewï¼Œè€Œä¸éœ€è¦ç›´æ¥é‡å†™delegateæˆ–data sourceçš„æ–¹æ³•ã€‚</p>
<p>ä¸ºäº†æ¼”ç¤ºï¼Œåˆ é™¤<font color="green">UITableViewDataSource</font>å’Œ<font color="green">UITableViewDelegate</font>ä¸¤ä¸ªæ‹“å±•ä»¥åŠç›¸å…³çš„æ–¹æ³•ã€‚ç„¶åï¼Œåœ¨<font color="green">viewDidLoad()</font>æ–¹æ³•ä¸­åˆ é™¤å¯¹<font color="green">tableView.dataSource</font>å’Œ<font color="green">tableView.delegate</font>çš„è®¾ç½®ã€‚</p>
<p>è¿è¡Œç¨‹åºï¼Œä½ ä¼šçœ‹åˆ°å•¥ä¹Ÿæ²¡æœ‰äº†ï¼š</p>
<p><img src="https://koenig-media.raywenderlich.com/uploads/2016/07/no_chocolate_for_you.png" alt="7"></p>
<p>ä¸€ç‚¹ä¹Ÿä¸å¥½ç©ã€‚ç°åœ¨æ¥æŠŠå·§å…‹åŠ›æ‰¾å›æ¥å§ï¼</p>
<p>é¦–å…ˆï¼Œä¸ºäº†è·å¾—ä¸€ä¸ªå“åº”å¼çš„table viewï¼Œä½ éœ€è¦ä¸€äº›è®©table viewå“åº”çš„ä¸œè¥¿ã€‚è¿˜æ˜¯åœ¨<font color="green">ChocolatesOfTheWorldViewController.swift</font>æ–‡ä»¶ä¸­ï¼Œæ›´æ–°<font color="green">europeanChocolates</font>å±æ€§ï¼Œè®©å…¶ä½œä¸ºä¸€ä¸ªObservableå¯¹è±¡ï¼š</p>
<pre><code>let europeanChocolates = Observable.just(Chocolate.ofEurope)
</code></pre><p><font color="green">just(_:)</font>æ–¹æ³•ä¸ä¼šå¯¹Observableå¯¹è±¡çš„åº•å±‚å€¼åšä»»ä½•ä¿®æ”¹ï¼Œä½†ä½ ä»ç„¶éœ€è¦ä»¥Observableå€¼çš„æ–¹å¼æ¥è®¿é—®å®ƒã€‚</p>
<blockquote>
<p>æœ‰æ—¶ï¼Œè°ƒç”¨<font color="green">just(_:)</font>æ„å‘³ç€å¯èƒ½æ˜¯è¿‡åº¦åœ°ä½¿ç”¨å“åº”å¼ç¼–ç¨‹äº† â€“ æ¯•ç«Ÿï¼Œå¦‚æœä¸€ä¸ªå€¼ä»ä¸æ”¹å˜ï¼Œåˆä½•å¿…ä½¿ç”¨å“åº”å¼æŠ€æœ¯æ¥ç›‘æµ‹å®ƒçš„å˜åŒ–å‘¢ï¼Ÿåœ¨æœ¬ä¾‹ä¸­ï¼Œä½ å°†ä½¿ç”¨å®ƒæ¥è®¾ç½®å°†è¦æ”¹å˜çš„å•å…ƒæ ¼çš„å“åº”ï¼Œä¸è¿‡ç»å¸¸æ€è€ƒå¦‚ä½•ä½¿ç”¨Rxæ€»æ˜¯ä»¶å¥½äº‹ã€‚ä¸¾ä¸ªğŸŒ°ï¼Œè™½ç„¶ä½ æœ‰ä¸€ä¸ªé”¤å­ï¼Œä½†å¹¶ä¸æ„å‘³ç€æ¯ä¸€ä¸ªé—®é¢˜éƒ½æ˜¯ä¸€ä¸ªé’‰å­ã€‚</p>
</blockquote>
<p>ç°åœ¨ä½ å·²ç»è®©<font color="green">europeanChocolates</font>æˆä¸ºäº†ä¸€ä¸ªObservableï¼Œæ·»åŠ ä»¥ä¸‹ä»£ç ï¼š</p>
<pre><code>private func setupCellConfiguration() {
    //1
    europeanChocolates
        .bindTo(tableView
            .rx //2
            .items(cellIdentifier: ChocolateCell.Identifier,
                    cellType: ChocolateCell.self)) { // 3
              row, chocolate, cell in
              cell.configureWithChocolate(chocolate: chocolate) //4
            }
            .addDisposableTo(disposeBag) //5
}
</code></pre><p>ç¨å¾®è§£é‡Šä¸€ä¸‹ï¼š</p>
<p>1.è°ƒç”¨<font color="green">bindTo(_:)</font>å°†<font color="green">europeanChocolates</font>å¯è§‚å¯Ÿå¯¹è±¡å…³è”åˆ°table viewæ¯ä¸€è¡Œéƒ½ä¼šæ‰§è¡Œçš„ä»£ç ä¸Šï¼›</p>
<p>2.è°ƒç”¨<font color="green">rx</font>ï¼Œä½ å¯ä»¥è®¿é—®ä»»ä½•ç±»çš„RxCocoaæ‰©å±• â€“ åœ¨è¿™é‡Œå°±æ˜¯ä¸€ä¸ª<font color="green">UITableView</font>ï¼›</p>
<p>3.è°ƒç”¨Rxçš„<font color="green">items(cellIdentifier:cellType:)</font>æ–¹æ³•ï¼Œä¼ å…¥cell identifieråŠè¦ä½¿ç”¨çš„cellç±»å‹ã€‚è¿™è®©Rxæ¡†æ¶å¯ä»¥è°ƒç”¨dequeuingæ–¹æ³•ï¼›</p>
<p>4.å¯¹äºåˆ—è¡¨çš„æ¯ä¸€é¡¹ä¼ å…¥ä¸€ä¸ªé—­åŒ…ã€‚é—­åŒ…çš„å‚æ•°åŒ…æ‹¬è¡Œä¿¡æ¯ã€è¡Œå¯¹åº”çš„chocolateå¯¹è±¡ä»¥åŠå½“å‰cellï¼Œå†å»é…ç½®cellå°±éå¸¸ç®€å•äº†ï¼›</p>
<p>5.è·å–åˆ°<font color="green">bindTo(_:)</font>è¿”å›çš„Disposableï¼Œç„¶åæ·»åŠ åˆ°<font color="green">disposeBag</font>ä¸­ã€‚</p>
<p>å¯ä»¥å‘ç°ï¼Œé€šå¸¸æ˜¯éœ€è¦tableViewçš„ä¸‰ä¸ªdata sourceæ–¹æ³•æ‰èƒ½å®ç°çš„æ•ˆæœç°åœ¨ä¸€ä¸ªæ–¹æ³•å°±éƒ½åšå¥½äº†ã€‚åœ¨<font color="green">viewDidLoad()</font>æ–¹æ³•ä¸­æ·»åŠ ä¸€è¡Œæ¥è°ƒç”¨æ­¤æ–¹æ³•ï¼š</p>
<pre><code>setupCellConfiguration()
</code></pre><p>è¿è¡Œä¸€ä¸‹ï¼Œä¼šå‘ç°å·§å…‹åŠ›åˆå›æ¥äº†</p>
<p><img src="https://koenig-media.raywenderlich.com/uploads/2016/07/initial_landing.png" alt="1">    </p>
<p>ç„¶è€Œï¼Œå½“ç‚¹å‡»äº†ä¸€ä¸ªå·§å…‹åŠ›æ—¶ï¼Œä»–ä»¬å¹¶æ²¡æœ‰è¢«æ·»åŠ åˆ°è´­ç‰©è½¦ä¸­ã€‚ä¸ºä½•ä¹‹å‰çš„Rxæ–¹æ³•ä¸èµ·ä½œç”¨äº†å‘¢ï¼Ÿ</p>
<p>å…¶å®ä¸æ˜¯ï¼Œè€Œæ˜¯å› ä¸ºåˆ é™¤äº†<font color="green">tableView(_:didSelectRowAt:)</font>æ–¹æ³•ã€‚</p>
<p>ä¸ºäº†ä¿®å¤è¿™ä¸ªé—®é¢˜ï¼Œéœ€è¦ä½¿ç”¨RxCocoaæä¾›çš„å¦ä¸€ä¸ª<font color="green">UITableView</font>çš„æ‰©å±•æ–¹æ³•ï¼š<font color="green">modelSelected(_:)</font>ï¼Œå®ƒè¿”å›ä¸€ä¸ªä½ å¯ä»¥ç”¨æ¥è§‚å¯Ÿæ¨¡å‹å¯¹è±¡ä½•æ—¶è¢«é€‰ä¸­çš„Observableã€‚</p>
<p>æ·»åŠ ä»¥ä¸‹æ–¹æ³•ï¼š</p>
<pre><code>private func setupCellTapHandling() {
    tableView
        .rx
        .modelSelected(Chocolate.self) //1
        .subscribe(onNext: { //2
            chocolate in
            ShoppingCart.sharedCart.chocolates.value.append(chocolate) //3

            if let selectedRowIndexPath = self.tableView.indexPathForSelectedRow {
                self.tableView.deselectRow(at: selectedRowIndexPath, animated: true)
            } //4
        })
        .addDisposableTo(disposeBag) //5
}
</code></pre><p>è¯¦ç»†è¯´æ˜ä¸€ä¸‹ï¼š</p>
<p>1.è°ƒç”¨table viewçš„å“åº”å¼æ‹“å±•æ–¹æ³•<font color="green">modelSelected(_:)</font>ï¼Œä¼ å…¥Chocolateæ¨¡å‹ç±»å‹ä¾›åé¢ä½¿ç”¨ã€‚è¿™ä¸ªæ–¹æ³•ä¾ç„¶è¿”å›ä¸€ä¸ªObservableï¼›</p>
<p>2.è·å–åˆ°Observableåï¼Œè°ƒç”¨<font color="green">subscribe(onNext:)</font>æ–¹æ³•ï¼Œä¼ å…¥ä¸€ä¸ªåœ¨æ¨¡å‹è¢«é€‰ä¸­æ—¶ä¼šè¢«è°ƒç”¨çš„å°¾éšé—­åŒ…ï¼›</p>
<p>3.åœ¨å°¾éšé—­åŒ…ä¸­ï¼Œå°†é€‰ä¸­çš„å·§å…‹åŠ›æ·»åŠ åˆ°è´­ç‰©è½¦ä¸­ï¼›</p>
<p>4.è¿˜æ˜¯åœ¨é—­åŒ…ä¸­ï¼Œç¡®ä¿å½“å‰è¢«ç‚¹å‡»çš„å•å…ƒæ ¼é€‰ä¸­çŠ¶æ€è¢«å–æ¶ˆï¼›</p>
<p>5.<font color="green">subscribe(onNext:)</font>æ–¹æ³•è¿”å›ä¸€ä¸ªDisposableï¼Œæ·»åŠ è¿™ä¸ªDisposableåˆ°disposeBagä¸­ã€‚</p>
<p>æœ€åï¼Œåœ¨<font color="green">viewDidLoad()</font>ä¸­æ·»åŠ ä¸€è¡Œæ¥è°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼š</p>
<pre><code>setupCellTapHandling()
</code></pre><p>è¿è¡Œä¸€ä¸‹ï¼Œä½ ä¼šçœ‹åˆ°ç†Ÿæ‚‰çš„å·§å…‹åŠ›åˆ—è¡¨ï¼š</p>
<p><img src="https://koenig-media.raywenderlich.com/uploads/2016/07/initial_landing.png" alt="1">    </p>
<p>è€Œä¸”ç°åœ¨ä½ åˆå¯ä»¥å¾€è´­ç‰©è½¦ä¸­æ·»åŠ å·§å…‹åŠ›äº†ï¼</p>
<p><img src="https://koenig-media.raywenderlich.com/uploads/2016/07/added_chocolate.png" alt="2"></p>
<h2 id="RxSwift-and-Direct-Text-Input"><a href="#RxSwift-and-Direct-Text-Input" class="headerlink" title="RxSwift and Direct Text Input"></a>RxSwift and Direct Text Input</h2><p>RxSwiftå¦ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„ç‰¹æ€§æ˜¯å®ƒèƒ½å¤Ÿè·å–å¹¶å“åº”ç”¨æˆ·è¾“å…¥çš„æ–‡æœ¬ã€‚</p>
<p>ä¸ºäº†æ„Ÿå—ä¸€ä¸‹å“åº”å¼çš„å¤„ç†æ–‡æœ¬è¾“å…¥ï¼Œä½ å°†åœ¨ä¿¡ç”¨å¡è¾“å…¥é¡µé¢ä¸­æ·»åŠ ä¸€äº›ç®€å•çš„éªŒè¯å’Œå¡ç±»å‹æ£€æµ‹ã€‚</p>
<p>åœ¨éå“åº”å¼ç¼–ç¨‹ä¸­ä¿¡ç”¨å¡è¾“å…¥çš„å¤„ç†æ˜¯é€šè¿‡ä¸€äº›<font color="green">UITextFieldDelegate</font>çš„æ–¹æ³•æ¥å®ç°çš„ï¼Œé€šå¸¸æ¯ä¸ªæ–¹æ³•ä¸­éƒ½åŒ…å«å¤§é‡çš„<font color="green">if/else</font>è¯­å¥ï¼Œç”¨äºåˆ¤æ–­å½“å‰æ˜¯å“ªä¸ªtext fieldæ­£åœ¨è¢«ç¼–è¾‘ï¼Œä»è€Œå†³å®šåº”è¯¥æ‰§è¡Œä»€ä¹ˆæ“ä½œå’Œé€»è¾‘ã€‚</p>
<p>å“åº”å¼ç¼–ç¨‹ç›´æ¥å°†å¤„ç†é€»è¾‘è¿æ¥åˆ°æ¯ä¸ªtext fieldä¸Šï¼Œæ˜¯ä¸æ˜¯å¾ˆæ–¹ä¾¿ã€‚</p>
<p>åœ¨<font color="green">BillingInfoViewController.swift</font>ç±»ä¸­ï¼Œåœ¨é¡¶éƒ¨æ·»åŠ å¦‚ä¸‹ä»£ç ï¼š</p>
<pre><code>private let disposeBag = DisposeBag()
</code></pre><p>å’Œå‰é¢ä¸€æ ·ï¼Œé¦–å…ˆå®šä¹‰ä¸€ä¸ª<font color="green">DisposeBag</font>ã€‚</p>
<p>ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„äº‹æƒ…æ˜¯ï¼ŒåŸºäºå½“å‰å·²çŸ¥çš„<a href="https://en.wikipedia.org/wiki/Payment_card_number" target="_blank" rel="external">å¡ç‰‡ç±»å‹</a>ï¼Œå½“ç”¨æˆ·è¾“å…¥å¡å·æ—¶å±•ç¤ºä¸€ä¸‹æ­¤ä¿¡ç”¨å¡çš„ç±»å‹ã€‚</p>
<p>ä¸ºäº†å®ç°è¿™ä¸€ç›®çš„ï¼Œåœ¨ <font color="green">//MARK: - Rx Setup</font>ä¸‹é¢æ·»åŠ ä»¥ä¸‹ä»£ç ï¼š</p>
<pre><code>//MARK: - Rx Setup

private func setupCardImageDisplay() {
    cardType
        .asObservable()
        .subscribe(onNext: {
            cardType in
            self.creditCardImageView.image = cardType.image
        })
        .addDisposableTo(disposeBag)
}
</code></pre><p>ç¨åï¼Œä½ å°†ä½¿ç”¨è¿™ä¸ªæ–¹æ³•æ¥æ ¹æ®å¡ç±»å‹çš„æ”¹å˜å»æ›´æ–°å¡å›¾ç‰‡ã€‚å®ƒä¸ºå˜é‡çš„å€¼æ·»åŠ äº†ä¸€ä¸ªObserverï¼Œå¹¶é™„åŠ ä¸€ä¸ªåœ¨å€¼æ”¹å˜æ—¶ä¼šæ‰§è¡Œçš„é—­åŒ…ï¼ŒåŒæ—¶ç¡®ä¿Observerè¢«æ·»åŠ åˆ°<font color="green">disposeBag</font>ä¸­äº†ã€‚</p>
<p>ç°åœ¨åˆ°äº†æœ€æœ‰è¶£çš„éƒ¨åˆ†ï¼šæ–‡æœ¬æ”¹å˜å¤„ç†ã€‚</p>
<p>ç”±äºç”¨æˆ·å¯èƒ½ä¼šå¿«é€Ÿè¾“å…¥ï¼Œå› æ­¤ä½ å¯èƒ½ä¸å¸Œæœ›æ¯æ¬¡ç”¨æˆ·æŒ‰é”®éƒ½å»éªŒè¯ã€‚è¿™æ ·ä¼šå¯¼è‡´æ˜‚è´µçš„è®¡ç®—ç”šè‡³æ˜¯UIå¡é¡¿ã€‚</p>
<p>ä¸€ç§æ›´å¥½çš„æ–¹å¼æ˜¯<font color="green">é™åˆ¶</font>éªŒè¯çš„å¹…åº¦ï¼Œå³åªæœ‰ä¸€å®šçš„æ—¶é—´é—´éš”åå†å»éªŒè¯è¾“å…¥çš„å†…å®¹ã€‚è¿™æ ·ï¼Œå†å¿«çš„æ‰“å­—é€Ÿåº¦ä¹Ÿä¸ä¼šé˜»å¡æ•´ä¸ªç¨‹åºçš„è¿è¡Œã€‚</p>
<p>Throttlingæ˜¯RxSwiftçš„ä¸€ä¸ªç‰¹æ€§ã€‚å› ä¸ºåœ¨ä¸€äº›ä¸œè¥¿æ”¹å˜æ—¶ï¼Œé€šå¸¸æœ‰å¤§é‡çš„é€»è¾‘æ“ä½œã€‚è€Œä½¿ç”¨Throttlingç‰¹æ€§ï¼Œèƒ½å¤Ÿå‡å°‘è¿™äº›é€»è¾‘æ“ä½œå‘ç”Ÿçš„æ¬¡æ•°ã€‚</p>
<p>é¦–å…ˆï¼Œåœ¨<font color="green">BillingInfoViewController.swift</font>ä¸­çš„å…¶å®ƒå±æ€§å£°æ˜ä¸‹é¢æ·»åŠ å¦‚ä¸‹ä»£ç ï¼š</p>
<pre><code>private let throttleInterval = 0.1
</code></pre><p>è¿™é‡Œä»¥ç§’ä¸ºå•ä½ä¸ºèŠ‚æµ(throttle)é•¿åº¦å®šä¹‰äº†ä¸€ä¸ªå¸¸é‡ã€‚</p>
<p>ç„¶åæ·»åŠ å¦‚ä¸‹æ–¹æ³•ï¼š</p>
<pre><code>private func setupTextChangeHandling() {
    let creditCardValid = creditCardNumberTextField
        .rx
        .text //1
        .throttle(throttleInterval, scheduler: MainScheduler.instance) //2
        .map { self.validate(cardText: $0) } //3

    creditCardValid
        .subscribe(onNext: { self.creditCardNumberTextField.valid = $0 }) //4
        .addDisposableTo(disposeBag) //5
}
</code></pre><blockquote>
<p>æ³¨æ„ï¼šå¦‚æœåœ¨è®¾ç½®<font color="green">creditCardValid</font>æ—¶å¾—åˆ°ä¸€ä¸ªâ€Generic parameter R could not be inferredâ€œçš„ç¼–è¯‘é”™è¯¯ï¼Œæ”¹æˆè¿™æ ·å°±å¯ä»¥è§£å†³ï¼š<font color="green">let creditCardValid: Observable</font>ã€‚ç†è®ºä¸Šï¼Œç¼–è¯‘å™¨èƒ½æ¨å¯¼å‡ºå®ƒçš„ç±»å‹ï¼Œä½†å¶å°”è¿˜æ˜¯éœ€è¦ä¸€ç‚¹å¸®åŠ©ã€‚</p>
</blockquote>
<p>æ¥çœ‹çœ‹ä¸Šé¢ä»£ç åšäº†ä»€ä¹ˆï¼š</p>
<p>1.<font color="green">text</font>æ˜¯å¦å¤–ä¸€ä¸ªRxCocoaçš„æ‰©å±•(åœ¨ä½¿ç”¨ä¹‹å‰å¿…é¡»å…ˆè°ƒç”¨<font color="green">rx</font>)ï¼Œè¿™ä¸€æ¬¡ä¾›UITextFieldä½¿ç”¨ã€‚å®ƒå°†text fieldçš„å†…å®¹ä½œä¸ºä¸€ä¸ªObservableå€¼è¿”å›ï¼›</p>
<p>2.èŠ‚æµè¾“å…¥ï¼Œä½¿å¾—ä½ è®¾ç½®çš„éªŒè¯æ–¹å¼åªåœ¨è®¾ç½®çš„æ—¶é—´é—´éš”æ‰è¿è¡Œã€‚<font color="green">scheduler</font>å‚æ•°æ˜¯ä¸€ä¸ªæ›´é«˜çº§çš„æ¦‚å¿µï¼Œç®€å•åœ°è¯´å°±æ˜¯å®ƒç»‘å®šèƒ½åˆ°ä¸€ä¸ªçº¿ç¨‹ã€‚å› ä¸ºä½ å¸Œæœ›æ‰€æœ‰æ“ä½œéƒ½æ˜¯åœ¨ä¸»çº¿ç¨‹ä¸Šæ‰§è¡Œï¼Œæ‰€ä»¥ä½¿ç”¨<font color="green">MainScheduler</font>ï¼›</p>
<p>3.å°†è¢«èŠ‚æµçš„è¾“å…¥å€¼åº”ç”¨<font color="green">validate(cardText:)</font>æ¥è½¬æ¢å®ƒï¼Œæ­¤æ–¹æ³•å·²ç»ç”±å½“å‰ç±»æä¾›äº†ã€‚å¦‚æœè¾“å…¥çš„å¡å·æœ‰æ•ˆï¼Œåˆ™è§‚å¯Ÿåˆ°çš„å¸ƒå°”å€¼çš„æœ€ç»ˆå€¼ä¸º<font color="green">true</font>ï¼›</p>
<p>4.æ¥å—æ‰€åˆ›å»ºçš„Observableå€¼å¹¶è®¢é˜…å®ƒï¼Œæ ¹æ®ä¼ å…¥çš„å€¼æ¥æ›´æ–°text fieldçš„éªŒè¯ï¼›</p>
<p>5.å°†ç”Ÿæˆçš„Disposableæ·»åŠ åˆ°<font color="green">disposeBag</font>ä¸­ã€‚</p>
<p>å°†ä»¥ä¸‹ä»£ç æ·»åŠ åˆ°<font color="green">setupTextChangeHandling()</font>æ–¹æ³•ä¸‹é¢ï¼Œä»¥åˆ›å»ºæœ‰æ•ˆæ—¥æœŸå’Œå¡ç‰‡å®‰å…¨ä»£ç (CVV)çš„Observableå˜é‡ï¼š</p>
<pre><code>let expirationValid = expirationDateTextField
    .rx
    .text
    .throttle(throttleInterval, scheduler: MainScheduler.instance)
    .map { self.validate(expirationDateText: $0) }

expirationValid
    .subscribe(onNext: { self.expirationDateTextField.valid = $0 })
    .addDisposableTo(disposeBag)

let cvvValid = cvvTextField
    .rx
    .text
    .map { self.validate(cvvText: $0) }

cvvValid
    .subscribe(onNext: { self.cvvTextField.valid = $0 })
    .addDisposableTo(disposeBag)
</code></pre><p>ç°åœ¨ä½ å·²ç»ä¸ºä¸‰ä¸ªtext fieldçš„æœ‰æ•ˆæ€§è®¾ç½®äº†Observableå€¼ï¼Œæ·»åŠ å¦‚ä¸‹ä»£ç ï¼š</p>
<pre><code>let everythingValid = Observable
    .combineLatest(creditCardValid, expirationValid, cvvValid) {
        $0 &amp;&amp; $1 &amp;&amp; $2 //All must be true
}

everythingValid
    .bindTo(purchaseButton.rx.enabled)
    .addDisposableTo(disposeBag)
</code></pre><p>è¿™é‡Œä½¿ç”¨äº†Observableçš„<font color="green">combineLatest(_:)</font>æ–¹æ³•ä½¿ç”¨å‰é¢åˆ›å»ºçš„ä¸‰ä¸ªObservableç”Ÿæˆç¬¬å››ä¸ªï¼Œå³<font color="green">everythingValid</font>ï¼Œå…¶å€¼æ˜¯å¦ä¸ºtrueå–å†³äºå‰é¢ä¸‰ä¸ªè¾“å…¥å€¼æ˜¯å¦éƒ½æœ‰æ•ˆã€‚</p>
<p>ç„¶åå°†<font color="green">everythingValid</font>ç»‘å®šåˆ°UIButtonçš„å“åº”å¼æ‰©å±•çš„<font color="green">enabled</font>å±æ€§ä¸Šï¼Œè¿™æ ·è´­ä¹°æŒ‰é’®çš„çŠ¶æ€å°±ç”±<font color="green">everythingValid</font>çš„å€¼æ¥æ§åˆ¶äº†ã€‚</p>
<p>å¦‚æœæ‰€æœ‰çš„è¾“å…¥éƒ½æœ‰æ•ˆï¼Œé‚£ä¹ˆ<font color="green">everythingValid</font>çš„å†…éƒ¨å€¼å°±ä¸º<font color="green">true</font>ã€‚å¦åˆ™çš„è¯ï¼Œä¸º<font color="green">false</font>ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œè´­ä¹°æŒ‰é’®åªæœ‰åœ¨ä¿¡ç”¨å¡è¯¦ç»†ä¿¡æ¯æœ‰æ•ˆæ—¶æ‰å¯ç‚¹å‡»ã€‚</p>
<p>è®¾ç½®å¥½äº†ï¼Œæ¥ä¸‹æ¥å¯ä»¥åœ¨<font color="green">viewDidLoad()</font>æ–¹æ³•ä¸­å»è°ƒç”¨äº†ï¼š</p>
<pre><code>setupCardImageDisplay()
setupTextChangeHandling()
</code></pre><p>è·‘ä¸€ä¸‹ï¼Œè¦è¿›å…¥ä¿¡ç”¨å¡è¾“å…¥é¡µé¢ï¼Œéœ€è¦è‡³å°‘é€‰æ‹©ä¸€ä¸ªå·§å…‹åŠ›å°†å…¶æ·»åŠ åˆ°è´­ç‰©è½¦ï¼Œç„¶åç‚¹å‡»è´­ç‰©è½¦æŒ‰é’®è¿›å…¥è´­ç‰©è½¦ç•Œé¢ã€‚åªè¦è´­ç‰©è½¦ä¸­è‡³å°‘æœ‰ä¸€ä¸ªå·§å…‹åŠ›ï¼ŒcheckoutæŒ‰é’®å°±æ˜¯å¯ç”¨çš„ï¼š</p>
<p><img src="https://koenig-media.raywenderlich.com/uploads/2016/07/checkout.png" alt="3"></p>
<p>ç‚¹å‡»CheckoutæŒ‰é’®ï¼Œå°†è¿›å…¥ä¿¡ç”¨å¡è¾“å…¥é¡µé¢ï¼š</p>
<p><img src="https://koenig-media.raywenderlich.com/uploads/2016/07/cc_form.png" alt="4"></p>
<p>åœ¨å¡å·çš„text fieldä¸­è¾“å…¥<font color="green">4</font>â€“ä½ å°†çœ‹åˆ°å³ä¾§è¡¨ç¤ºå¡ç‰‡ç±»å‹çš„å›¾ç‰‡æ˜¾ç¤ºäº†Visaï¼š</p>
<p><img src="https://koenig-media.raywenderlich.com/uploads/2016/07/Simulator-Screen-Shot-Jul-4-2016-7.47.40-PM.png" alt="9"></p>
<p>åˆ é™¤4ï¼Œå¡ç‰‡ç±»å‹çš„å›¾ç‰‡å°†æ¢å¤æˆæœªçŸ¥çŠ¶æ€ã€‚è¾“å…¥<font color="green">55</font>ï¼Œå›¾ç‰‡å°†å˜æˆMasterCardï¼š</p>
<p><img src="https://koenig-media.raywenderlich.com/uploads/2016/07/Simulator-Screen-Shot-Jul-4-2016-7.47.36-PM.png" alt="12"></p>
<p>èµã€‚è¿™ä¸ªåº”ç”¨æ¶µç›–äº†ç¾å›½å››ç§ä¸»è¦çš„ä¿¡ç”¨å¡ç±»å‹(Visa, MasterCard, American Express, Discover)ã€‚å¦‚æœä½ æœ‰å…¶ä¸­ä¸€ç§å¡ï¼Œä½ å¯ä»¥è¾“å…¥å¡å·æ¥çœ‹çœ‹å›¾ç‰‡æ˜¯å¦æ­£ç¡®ä»¥åŠå¡å·æ˜¯å¦æœ‰æ•ˆã€‚</p>
<blockquote>
<p>å¦‚æœä½ æ²¡æœ‰ä»»ä½•ç¾å›½ä¿¡ç”¨å¡ï¼Œä½ å¯ä»¥ä½¿ç”¨<a href="https://www.paypalobjects.com/en_US/vhelp/paypalmanager_help/credit_card_numbers.htm" target="_blank" rel="external">Paypal</a>æä¾›çš„æµ‹è¯•å¡å¡å·ï¼Œè¿™äº›åº”è¯¥å¯ä»¥é€šè¿‡ç¨‹åºçš„æ‰€æœ‰æœ¬åœ°éªŒè¯ï¼Œå³ä½¿å¡å·å®é™…ä¸Šæ˜¯ä¸å¯ç”¨çš„ã€‚</p>
</blockquote>
<p>ä¸€æ—¦è¾“å…¥æœ‰æ•ˆçš„ä¿¡ç”¨å¡å¡å·ï¼ŒåŒæ—¶æœ‰æ•ˆæœŸå’Œcvvä¹Ÿæ˜¯æœ‰æ•ˆçš„ï¼Œé‚£ä¹ˆ<font color="green">Buy Chocolate!</font>æŒ‰é’®å°†å¯ä»¥è¢«ç‚¹å‡»ï¼š</p>
<p><img src="https://koenig-media.raywenderlich.com/uploads/2016/07/enabled_checkout.png" alt="13"></p>
<p>ç‚¹å‡»æŒ‰é’®çœ‹ä¸‹æ•ˆæœï¼š</p>
<p><img src="https://koenig-media.raywenderlich.com/uploads/2016/07/success.png" alt="14"></p>
<p>æ­å–œä½ ï¼æ„Ÿè°¢RxSwiftå’ŒRxCocoaï¼Œä½ å¯ä»¥éšå¿ƒæ‰€æ¬²çš„ä¹°å·§å…‹åŠ›äº†ã€‚</p>
<h2 id="ä½•å»ä½•ä»"><a href="#ä½•å»ä½•ä»" class="headerlink" title="ä½•å»ä½•ä»"></a>ä½•å»ä½•ä»</h2><p>æœ€ç»ˆçš„ä»£ç å¯ä»¥åœ¨<a href="https://koenig-media.raywenderlich.com/uploads/2016/10/Chocotastic-finished-s3-rxs-3b1.zip" target="_blank" rel="external">è¿™é‡Œ</a>æ‰¾åˆ°ã€‚</p>
<p>å¦‚æœä½ æƒ³æŒ‘æˆ˜ä¸€ä¸‹ï¼Œå¯ä»¥å°è¯•å°†ç¨‹åºä¸­çš„å…¶ä»–å‡ ä¸ªç±»ä¹Ÿæ”¹æˆå“åº”å¼ï¼š</p>
<ul>
<li><p>ä¿®æ”¹<font color="green">CartViewController</font>ç±»ï¼Œä½¿ç”¨å“åº”å¼çš„table viewï¼ˆè€Œä¸ç”¨labelï¼‰æ¥å±•ç¤ºè´­ç‰©è½¦çš„å†…å®¹ï¼›</p>
</li>
<li><p>å…è®¸ç”¨æˆ·ç›´æ¥ä»è´­ç‰©è½¦ä¸­æ·»åŠ æˆ–åˆ é™¤å·§å…‹åŠ›ï¼Œå¹¶èƒ½è‡ªåŠ¨æ›´æ–°ä»·æ ¼ã€‚</p>
</li>
</ul>
<p>ç°åœ¨ä½ å·²ç»ç¨å¾®æ„Ÿå—äº†ä¸‹Rxç¼–ç¨‹ï¼Œå¾ˆæœ‰æ„æ€æœ‰æœ¨æœ‰?!ä»¥ä¸‹æ˜¯ä¸€äº›èµ„æºï¼Œä»¥å¸®åŠ©ä½ ç»§ç»­å­¦ä¹ ï¼š</p>
<ul>
<li><a href="https://www.appbuilders.ch/" target="_blank" rel="external">RxSwift Slack</a></li>
<li><a href="https://github.com/ReactiveX/RxSwift/blob/master/Documentation/GettingStarted.md" target="_blank" rel="external">RxSwiftâ€™s Getting Started guide</a></li>
<li><a href="https://realm.io/news/slug-max-alexander-functional-reactive-rxswift/" target="_blank" rel="external">Max Alexanderâ€™s talk on Rx at Realm</a></li>
</ul>
<p>æœ€åï¼Œæˆ‘ä»¬çš„<a href="https://www.raywenderlich.com/u/icanzilb" target="_blank" rel="external">Marin Todorov</a>æœ‰ä¸€ä¸ªä¸é”™çš„åšå®¢<a href="http://rx-marin.com/" target="_blank" rel="external">rx_marin</a>ï¼Œé‡Œé¢æœ‰ä»–å­¦ä¹ å“åº”å¼ç¼–ç¨‹çš„ä¸€äº›å¿ƒå¾—ã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æœ¬æ–‡ç”±Ellen Shapiroäº16å¹´å‘è¡¨äº&lt;a href=&quot;https://www.raywenderlich.com/&quot;&gt;raywenderlich&lt;/a&gt;ï¼ŒåŸæ–‡å¯æŸ¥çœ‹&lt;a href=&quot;https://www.raywenderlich.com/138547/getting-started-with-rxswift-and-rxcocoa&quot;&gt;Getting Started With RxSwift and RxCocoa&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;è‹¥èƒ½éšå¿ƒæ‰€æ¬²çš„æ§åˆ¶è‡ªå·±çš„ä»£ç è¾¾æˆé¢„æœŸçš„æ•ˆæœï¼Œæƒ³æ¥ä¸€å®šæ˜¯æå¥½çš„ã€‚&lt;/p&gt;
&lt;p&gt;é¢å‘å¯¹è±¡ç¼–ç¨‹ä¸­å¤§éƒ¨åˆ†ç¨‹åºéƒ½æ˜¯&lt;font color=green&gt;å‘½ä»¤å¼&lt;/font&gt;çš„ï¼šä½ çš„ä»£ç å‘Šè¯‰ä½ çš„ç¨‹åºå»å¹²ä»€ä¹ˆåŒæ—¶æœ‰å¤šç§æ–¹å¼æ¥ç›‘å¬å˜åŒ–ï¼ä½†æ˜¯é€šå¸¸ä½ åˆå¿…é¡»æ˜¾ç¤ºçš„å‘Šè¯‰ç³»ç»Ÿä»€ä¹ˆæ—¶å€™å‘ç”Ÿçš„å˜åŒ–ã€‚&lt;/p&gt;
&lt;p&gt;è¿™æ ·å…¶å®ä¹Ÿè¿˜å¥½ï¼Œä¸è¿‡å¦‚æœèƒ½æå‰éƒ½è®¾ç½®å¥½ï¼Œåœ¨å‘ç”Ÿå˜åŒ–æ—¶ä»£ç èƒ½å¤Ÿè‡ªåŠ¨æ›´æ–°ä¼šä¸ä¼šæ„Ÿè§‰æ›´åŠ æ£’æ£’çš„ï¼Ÿè¿™å°±æ˜¯&lt;font color=green&gt;å“åº”å¼&lt;/font&gt;ç¼–ç¨‹çš„åŸºæœ¬æ€æƒ³ï¼šä½ çš„åº”ç”¨ä¼šé’ˆå¯¹åº•å±‚æ•°æ®çš„æ”¹å˜è€Œåšå‡ºç›¸åº”çš„å“åº”ï¼Œè€Œä¸éœ€è¦ä½ å»ç›´æ¥å‘Šè¯‰å®ƒã€‚è¿™æ ·ä½¿å¾—å¯ä»¥å…¨å¿ƒå…³æ³¨äºé€»è¾‘å¤„ç†è€Œä¸éœ€è¦ç»´æŠ¤ä¸€å †çŠ¶æ€ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="ç¿»è¯‘" scheme="http://yoursite.com/categories/%E7%BF%BB%E8%AF%91/"/>
    
    
      <category term="RxSwift" scheme="http://yoursite.com/tags/RxSwift/"/>
    
  </entry>
  
  <entry>
    <title>å•†å“è¯¦æƒ…é¡µå¤šä¸ªåˆ—è¡¨æ»‘åŠ¨æ•ˆæœå®ç°æ–¹æ¡ˆ</title>
    <link href="http://yoursite.com/2016/12/20/%E5%95%86%E5%93%81%E8%AF%A6%E6%83%85%E9%A1%B5%E5%A4%9A%E4%B8%AA%E5%88%97%E8%A1%A8%E6%BB%91%E5%8A%A8%E6%95%88%E6%9E%9C%E5%AE%9E%E7%8E%B0%E6%96%B9%E6%A1%88/"/>
    <id>http://yoursite.com/2016/12/20/å•†å“è¯¦æƒ…é¡µå¤šä¸ªåˆ—è¡¨æ»‘åŠ¨æ•ˆæœå®ç°æ–¹æ¡ˆ/</id>
    <published>2016-12-20T08:53:42.000Z</published>
    <updated>2017-02-22T02:26:31.000Z</updated>
    
    <content type="html"><![CDATA[<p>è¿‘æ¥é¡¹ç›®åŠŸèƒ½é‡æ–°æ‹†åˆ†ï¼Œä¸»è¦è´Ÿè´£å•†å“è¯¦æƒ…æ¨¡å—ï¼Œäºæ˜¯ä¹çœ‹äº†ä¸€ä¸‹ä¹‹å‰ä»£ç ï¼ŒçœŸæ˜¯ä¸€ç‰‡æ··ä¹±ï¼Œé‚å†³å®šåº”ç”¨MVVM+RACé‡æ„ä¸‹ã€‚</p>
<p>é¦–å…ˆçœ‹ä¸€ä¸‹ä¸‹é¢å››å¼ æˆªå›¾ï¼Œäº†è§£ä¸‹æƒ³è¦å®ç°çš„æ•ˆæœã€‚å› ä¸ºæ·˜å®å¤©çŒ«ç­‰å®¢æˆ·ç«¯å·²ç»å¯¹å•†å“è¯¦æƒ…é¡µå¤§æ”¹ç‰ˆï¼Œæ‰¾ä¸åˆ°ä¹‹å‰çš„æˆªå›¾äº†ï¼Œç”¨ç¾ä¸½è¯´çš„é¡µé¢ä¸¾ä¸ªä¾‹å­ã€‚</p>
<a id="more"></a>
<p><img src="http://ocepn6hgq.bkt.clouddn.com/goodsdetailsnapshot1.jpg" alt=""><br><img src="http://ocepn6hgq.bkt.clouddn.com/goodsdetailsnapshot2.jpg" alt=""><br><img src="http://ocepn6hgq.bkt.clouddn.com/goodsdetailsnapshot3.jpg" alt=""><br><img src="http://ocepn6hgq.bkt.clouddn.com/goodsdetailsnapshot4.jpg" alt=""> </p>
<p>æ•´ä¸ªé¡µé¢çš„ç»“æ„æ˜¯è¿™æ ·çš„ï¼šä¸Šé¢æ˜¯ä¸€äº›å•†å“çš„åŸºæœ¬ä¿¡æ¯ï¼Œä¸­é—´æ˜¯ä¸‰ä¸ªtabæ ‡ç­¾ï¼Œä¸‹é¢å¯¹åº”æ¯ä¸€ä¸ªæ ‡ç­¾åˆæœ‰ä¸€äº›é’ˆå¯¹å•†å“çš„ä¿¡æ¯ã€‚</p>
<p>äºæ˜¯å¾ˆè‡ªç„¶æƒ³åˆ°å››ä¸ªå•†å“ä¿¡æ¯é¡µåˆ†åˆ«å•ç‹¬åšæˆä¸€ä¸ªtableViewï¼Œtabåˆ‡æ¢åšæˆä¸€ä¸ªviewã€‚ä½†æ˜¯æ€ä¹ˆæ ·èƒ½å®ç°tableViewå¥—tableViewå‘¢ï¼Œéš¾ç‚¹åœ¨äºä¸‰ä¸ªtabé—´ä¸å…‰è¦å®ç°ç‚¹å‡»åˆ‡æ¢è¿˜è¦å®ç°æ»‘åŠ¨åˆ‡æ¢ï¼Œè¿™å°±å¿…é¡»è¦ä½¿ç”¨scrollViewäº†ã€‚</p>
<p>ç¬¬ä¸€ç§æ€è·¯æ˜¯å°†ä¸‹é¢çš„tableViewèåˆè¿›ä¸Šé¢çš„ã€‚</p>
<p>å…·ä½“å®ç°æœ‰ä¸¤ç§æ–¹å¼ï¼š</p>
<p>1 æ•´ä½“æ˜¯ä¸€ä¸ªtableViewï¼Œå°†ä¸‹é¢tabåˆ‡æ¢viewä»¥åŠscrollViewå°è£…è¿›ä¸€ä¸ªå¤§cellï¼ŒscrollViewä¸Šé¢æ˜¯ä¸‰ä¸ªå­tableViewï¼Œåˆ†åˆ«æ˜¾ç¤ºå¯¹åº”æ ‡ç­¾çš„å†…å®¹ã€‚ä½¿ç”¨æ—¶å°†è¿™ä¸ªcellæ”¾åˆ°æ•´ä½“tableViewçš„æœ€åä¸€ä¸ªå³å¯ï¼Œé«˜åº¦è®¾ç½®ä¸ºtableViewçš„é«˜åº¦ã€‚éš¾ç‚¹åœ¨äºé’ˆå¯¹tabæ˜¯å¦è¾¾åˆ°é¡µé¢é¡¶éƒ¨æ§åˆ¶cellä¸­çš„å‡ ä¸ªtableViewæ˜¯å¦å¯ä»¥æ»šåŠ¨ã€‚<br>å…·ä½“å®ç°çš„è¯å¯ä»¥åœ¨</p>
<pre><code>- (void)scrollViewDidScroll:(UIScrollView *)scrollView
</code></pre><p>æ–¹æ³•ä¸­åšåˆ¤æ–­ï¼Œç„¶ååœ¨å†…å¤–ä¸¤å±‚viewä¸­å‘é€é€šçŸ¥ï¼Œè™½ç„¶ä»£ç ç»“æ„ä¸æ˜¯å¾ˆä¼˜é›…ï¼Œä½†æ˜¯ä¹Ÿç®—æ˜¯å¤§è‡´å®ç°äº†ã€‚åªæ˜¯è¿™ç§æ–¹å¼æœ‰ä¸€ä¸ªç¡¬ä¼¤æ— æ³•è§£å†³ï¼šå†…å¤–ä¸¤å±‚tableViewå¯¼è‡´ä¼šæœ‰ä¸¤ä¸ªç³»ç»Ÿè‡ªå¸¦çš„æç¤ºæ¡ï¼Œåˆ†åˆ«æŒ‡ç¤ºå„è‡ªçš„é«˜åº¦ï¼Œæ— æ³•æŒ‡æ˜æ•´ä½“viewçš„é«˜åº¦ã€‚</p>
<p>2 ä»ç„¶æ•´ä½“æ˜¯ä¸€ä¸ªtableViewï¼Œå°†ä¸‹é¢tabåˆ‡æ¢viewä»¥åŠscrollViewå°è£…è¿›ä¸€ä¸ªå¤§cellï¼ŒscrollViewä¸Šé¢æ˜¯ä¸‰ä¸ªå­tableViewï¼Œåˆ†åˆ«æ˜¾ç¤ºå¯¹åº”æ ‡ç­¾çš„å†…å®¹ã€‚ä½¿ç”¨æ—¶ä¹Ÿæ˜¯å°†è¿™ä¸ªcellæ”¾åˆ°æ•´ä½“tableViewçš„æœ€åä¸€ä¸ªï¼ŒåŒºåˆ«åœ¨äºé¦–å…ˆå°†tableViewè®¾ç½®ä¸ºä¸å¯æ»šåŠ¨ï¼Œå…¶æ¬¡å¯¹è¿™ä¸ªcellçš„é«˜åº¦ä¸å†è®¾ç½®å›ºå®šå€¼ï¼Œè€Œæ˜¯æå‰æ ¹æ®éœ€è¦æ˜¾ç¤ºçš„å†…å®¹è®¡ç®—å‡ºå…¨éƒ¨æ˜¾ç¤ºçš„é«˜åº¦ï¼Œå³tableViewçš„contentSize.heightï¼Œå½“ç„¶é’ˆå¯¹ä¸‰ä¸ªä¸åŒçš„æ ‡ç­¾ä¼šæœ‰ä¸‰ä¸ªå€¼ï¼Œæ¯æ¬¡åˆ‡æ¢çš„æ—¶å€™reloadä¸€ä¸‹ï¼Œå°†cellé«˜åº¦è®¾ç½®æˆé‡Œé¢å½“å‰æ­£åœ¨æ˜¾ç¤ºçš„tableView.contentSize.heightï¼Œæ­¤æ—¶ç³»ç»Ÿè‡ªå¸¦çš„æç¤ºæ¡ä¹Ÿä¼šæŒ‡ç¤ºæ­£ç¡®çš„å¤§å°åŠä½ç½®ï¼Œè§£å†³äº†ä¸Šé¢1ä¸­çš„ç¡¬ä¼¤ã€‚ç„¶è€Œï¼Œè¿™å´å¯¼è‡´äº†å¦ä¸€ä¸ªç¡¬ä¼¤æ— æ³•è§£å†³ï¼šå½“ä¸‰ä¸ªä¸åŒæ ‡ç­¾å¯¹åº”çš„ä¸‰ä¸ªtableViewå†…å®¹é«˜åº¦ç›¸å·®å¾ˆå¤šæ—¶ï¼Œæ»‘åŠ¨æ—¶ä¼šå‡ºç°ä¸€ä¸ªåˆ—è¡¨æœ‰å†…å®¹è€Œå¦ä¸€ä¸ªåˆ—è¡¨æ— å†…å®¹åªèƒ½æ˜¾ç¤ºèƒŒæ™¯è‰²çš„å°´å°¬ã€‚</p>
<p>é‰´äºä¸Šé¢ç¬¬ä¸€ç§æ€è·¯æ€»æœ‰æ— æ³•è§£å†³çš„é—®é¢˜ï¼Œæˆ‘æ„è¯†åˆ°åº”è¯¥æ˜¯æ€è·¯é”™äº†ã€‚äºæ˜¯æœ‰äº†ä¸‹é¢çš„ã€‚</p>
<p>ç¬¬äºŒç§æ€è·¯æ˜¯å°†ä¸Šé¢çš„tableViewèåˆè¿›ä¸‹é¢çš„ã€‚</p>
<p>æ•´ä½“æ˜¯ä¸€ä¸ªscrollViewï¼Œé“ºæ»¡å…¨å±å¹•ï¼Œä¸Šé¢æ˜¯ä¸‰ä¸ªåŒ…å«tableViewçš„å­viewï¼Œåˆ†åˆ«æ˜¾ç¤ºå¯¹åº”æ ‡ç­¾çš„å†…å®¹ã€‚æœ€ä¸Šé¢çš„tableViewä¸å¯æ»šåŠ¨ï¼Œä¸”æ˜¯ä¸‹é¢tableViewçš„tableHeaderViewï¼Œtabåˆ‡æ¢viewæ˜¯ä¸‹é¢tableViewçš„sectionHeaderViewã€‚è¿™æ ·é¿å…äº†æ‰‹åŠ¨è®¡ç®—é«˜åº¦çš„å¤æ‚æ€§ã€‚å½“ç‚¹å‡»tabæˆ–è€…æ»‘åŠ¨scrollViewåˆ‡æ¢åˆ—è¡¨æ—¶ï¼Œå…ˆå°†è¿™ä¸¤ä¸ªviewä»åŸæ¥çš„çˆ¶è§†å›¾ä¸Šåˆ é™¤ï¼Œç„¶ååŠ åˆ°controllerçš„viewä¸Šï¼Œåˆ‡æ¢å®Œæˆçš„æ—¶å€™å†åŠ åˆ°å½“å‰æ˜¾ç¤ºçš„tableViewä¸Šã€‚è¿™äº›éƒ½å¯ä»¥é€šè¿‡ä»£ç†æ–¹æ³•å®ç°ã€‚å‡ ä¸ªå•ç‹¬å°è£…çš„è§†å›¾å¤§æ¦‚å¦‚ä¸‹ï¼š</p>
<pre><code>@property (nonatomic, strong) UIScrollView *fullScrollView;
@property (nonatomic, strong) GDUpGeneralInfomationView *upInfomationView;
@property (nonatomic, strong) GDMiddleTabSwitchView *tabSwitchView;
@property (nonatomic, strong) UIView &lt;GDDownInfomationViewProtocol&gt;*currentInfoView;
</code></pre><p>ç¬¬ä¸€ç§æ€è·¯ä¸­å‡ºç°çš„é—®é¢˜å…¨éƒ¨è§£å†³ï¼Œæ›´é‡è¦çš„æ˜¯ä¿æŒäº†å‡ ä¸ªè§†å›¾çš„ç‹¬ç«‹æ€§å’Œå®Œæ•´æ€§ï¼Œå¾ˆæ–¹ä¾¿æ‹“å±•åŠŸèƒ½æˆ–è€…å¤ç”¨ã€‚    </p>
<p>æ›´å¤šçš„å®ç°ç»†èŠ‚å°±ä¸è¯´äº†ï¼Œé¡¹ç›®å®Œæ•´ç‰ˆåœ°å€è¯·çŒ›æˆ³<a href="https://github.com/kaisayoung/GoodsDetailDemo.git" target="_blank" rel="external">è¿™é‡Œ</a>ã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;è¿‘æ¥é¡¹ç›®åŠŸèƒ½é‡æ–°æ‹†åˆ†ï¼Œä¸»è¦è´Ÿè´£å•†å“è¯¦æƒ…æ¨¡å—ï¼Œäºæ˜¯ä¹çœ‹äº†ä¸€ä¸‹ä¹‹å‰ä»£ç ï¼ŒçœŸæ˜¯ä¸€ç‰‡æ··ä¹±ï¼Œé‚å†³å®šåº”ç”¨MVVM+RACé‡æ„ä¸‹ã€‚&lt;/p&gt;
&lt;p&gt;é¦–å…ˆçœ‹ä¸€ä¸‹ä¸‹é¢å››å¼ æˆªå›¾ï¼Œäº†è§£ä¸‹æƒ³è¦å®ç°çš„æ•ˆæœã€‚å› ä¸ºæ·˜å®å¤©çŒ«ç­‰å®¢æˆ·ç«¯å·²ç»å¯¹å•†å“è¯¦æƒ…é¡µå¤§æ”¹ç‰ˆï¼Œæ‰¾ä¸åˆ°ä¹‹å‰çš„æˆªå›¾äº†ï¼Œç”¨ç¾ä¸½è¯´çš„é¡µé¢ä¸¾ä¸ªä¾‹å­ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="iOS" scheme="http://yoursite.com/categories/iOS/"/>
    
    
      <category term="UI" scheme="http://yoursite.com/tags/UI/"/>
    
  </entry>
  
  <entry>
    <title>AsyncDisplayKitæ•™ç¨‹: èŠ‚ç‚¹å±‚çº§ç»“æ„</title>
    <link href="http://yoursite.com/2016/09/19/AsyncDisplayKit-Tutorial-Node-Hierarchies%E3%80%90%E8%AF%91%E3%80%91/"/>
    <id>http://yoursite.com/2016/09/19/AsyncDisplayKit-Tutorial-Node-Hierarchiesã€è¯‘ã€‘/</id>
    <published>2016-09-19T02:16:25.000Z</published>
    <updated>2016-12-23T10:03:34.000Z</updated>
    
    <content type="html"><![CDATA[<p>æœ¬æ–‡ç”±RenÃ© Cacheauxäº15å¹´å‘è¡¨äº<a href="https://www.raywenderlich.com" target="_blank" rel="external">raywenderlich</a>ï¼ŒåŸæ–‡å¯æŸ¥çœ‹<a href="https://www.raywenderlich.com/107310/asyncdisplaykit-tutorial-node-hierarchies" target="_blank" rel="external">AsyncDisplayKit Tutorial: Node Hierarchies</a>ã€‚</p>
<p>AsyncDisplayKitæ˜¯ä¸€ä¸ªæœ€åˆä¸ºFacebookçš„<a href="https://www.facebook.com/paper" target="_blank" rel="external">Paper</a>é¡¹ç›®è€Œè®¾è®¡çš„iOSæ¡†æ¶ã€‚å®ƒä½¿è·å¾—æ¯”åº”ç”¨æ ‡å‡†viewæ›´æµç•…å“åº”æ›´å¿«é€Ÿçš„UIæˆä¸ºå¯èƒ½ã€‚</p>
<a id="more"></a>
<p>ä½ åº”è¯¥å·²ç»å­¦ä¹ è¿‡ä¸€ç‚¹AsyncDisplayKitçš„ç”¨æ³•äº†ï¼Œå¦‚æœæ²¡æœ‰ï¼Œè¯·ç§»æ­¥<a href="https://www.raywenderlich.com/86365/AsyncDisplayKit-tutorial-achieving-60-fps-scrolling" target="_blank" rel="external">è¿™é‡Œ</a>ï¼Œè¿™ç¯‡æ•™ç¨‹å°†å¸¦ä½ è¾¾åˆ°ä¸‹ä¸ªçº§åˆ«ã€‚</p>
<p>è¿™ç¯‡æ•™ç¨‹å°†é€šè¿‡æ¢ç´¢AsyncDisplayKitä¸­çš„èŠ‚ç‚¹å±‚çº§ç»“æ„æ¥è§£é‡Šæ€æ ·å……åˆ†ä½¿ç”¨è¿™ä¸ªåº“ã€‚å€Ÿæ­¤ï¼Œä½ å°†å¾—åˆ°æµç•…çš„æ»šåŠ¨è§†å›¾ï¼ŒåŒæ—¶ä¹Ÿèƒ½æ„å»ºçµæ´»ä¸”å¯å¤ç”¨çš„UIã€‚</p>
<p>AsyncDisplayKitä¸­ä¸€ä¸ªå…³é”®æ¦‚å¿µå°±æ˜¯èŠ‚ç‚¹(node)ï¼Œæ­£å¦‚ä½ å°†ä¼šå­¦åˆ°çš„ï¼ŒAsyncDisplayKitä¸­çš„èŠ‚ç‚¹æ˜¯åœ¨çº¿ç¨‹ä¸å®‰å…¨çš„UIView(å±‚)ä¸Šé¢æŠ½è±¡å‡ºæ¥çš„ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„å±‚ã€‚</p>
<p>å¥½æ¶ˆæ¯æ˜¯å¦‚æœä½ å·²ç»ç†Ÿç»ƒä½¿ç”¨UIKitï¼Œé‚£ä½ ä¼šå‘ç°ä½ å·²ç»çŸ¥é“äº†AsyncDisplayKitçš„å¤§éƒ¨åˆ†æ–¹æ³•å’Œå±æ€§ï¼Œå› ä¸ºå®ƒä»¬çš„APIå‡ ä¹ä¸€æ¨¡ä¸€æ ·ã€‚</p>
<p>è·Ÿéšæœ¬æ•™ç¨‹ï¼Œä½ å°†å­¦åˆ°ï¼š</p>
<ul>
<li>æ€æ ·æ„å»ºä½ è‡ªå·±çš„ASDisplayNodeå­ç±»</li>
<li>ä¸ºäº†æ›´å¥½çš„ç»„ç»‡å’Œé‡ç”¨æ€æ ·å°†èŠ‚ç‚¹å±‚çº§ç»“æ„æ”¾åˆ°ä¸€ä¸ªå•ç‹¬çš„å®¹å™¨èŠ‚ç‚¹ä¸­</li>
<li>æ€æ ·ä½¿ç”¨èŠ‚ç‚¹å±‚çº§ç»“æ„ä¼šæ¯”è§†å›¾å±‚çº§ç»“æ„æ›´å ä¼˜åŠ¿ï¼Œä»è€Œè‡ªåŠ¨å‡å°‘æ‹–æ…¢ä¸»çº¿ç¨‹çš„æœºä¼šï¼Œä¿æŒç”¨æˆ·ç•Œé¢æµç•…ä¸”å“åº”è¿…é€Ÿ</li>
</ul>
<p>ä½ è¦è¿™æ ·åšï¼šæ„å»ºä¸€ä¸ªåŒ…å«ä¸¤ä¸ªå­èŠ‚ç‚¹ï¼åˆ†åˆ«ç”¨äºæ˜¾ç¤ºå›¾ç‰‡å’Œæ ‡é¢˜ï¼çš„å®¹å™¨èŠ‚ç‚¹ï¼Œä½ ä¼šçœ‹åˆ°å®¹å™¨èŠ‚ç‚¹æ€æ ·è®¡ç®—å®ƒè‡ªå·±çš„å°ºå¯¸å’Œæ€æ ·å¸ƒå±€å®ƒçš„å­èŠ‚ç‚¹ã€‚æœ€åï¼Œä½ ä¼šå°†UIViewå®¹å™¨å­ç±»æ›¿æ¢æˆASDisplayNodeå­ç±»ã€‚</p>
<p>è¿™æ˜¯ä½ è¦æœ€ç»ˆè¾¾æˆçš„æ•ˆæœï¼š</p>
<p><img src="http://www.raywenderlich.com/wp-content/uploads/2015/07/ASDK_NodeHierarchies-7-e1434332214236.jpg" alt=""> </p>
<p>å¾ˆç‚«é…·æœ‰æœ¨æœ‰ï¼Ÿï¼UIè¶Šæµç•…ï¼Œæ•ˆæœå°±è¶Šå¥½ã€‚</p>
<p>æ³¨æ„ï¼šè¿™ç¯‡æ•™ç¨‹æ˜¯ä¸ºé‚£äº›å·²ç»æœ‰äº†ä¸€äº›AsyncDisplayKitåŸºç¡€çš„å·¥ç¨‹å¸ˆä»¬è€Œå†™çš„ï¼Œå¦‚æœä½ æ˜¯ç¬¬ä¸€æ¬¡æ¥è§¦è¿™ä¸ªæ¦‚å¿µï¼Œè¿˜æ˜¯å…ˆçœ‹çœ‹<a href="https://kaisayoung.github.io/undefined/%E7%BF%BB%E8%AF%91/2016-09-15-AsyncDisplayKit-Tutorial-Achieving-60-FPS-scrolling%E3%80%90%E8%AF%91%E3%80%91.html#more" target="_blank" rel="external">è¿™ä¸ª</a>ã€‚</p>
<h2 id="å¼€å§‹"><a href="#å¼€å§‹" class="headerlink" title="å¼€å§‹"></a>å¼€å§‹</h2><p>ä½ å°†è¦æ„å»ºçš„è¿™ä¸ªappé€šè¿‡å‘ˆç°ä¸€å¼ å¡ç‰‡æ¥å±•ç¤ºä¸–ç•Œè‘—åå¥‡è¿¹ä¹‹ä¸€ï¼æ³°å§¬é™µã€‚</p>
<p>é¦–å…ˆä¸‹è½½<a href="http://www.raywenderlich.com/wp-content/uploads/2015/06/Wonders-Starter.zip" target="_blank" rel="external">åˆå§‹å·¥ç¨‹</a>ï¼Œè¿™æ˜¯ä¸€ä¸ªä»…æœ‰ä¸€ä¸ªcontrollerçš„å¾ˆåŸºç¡€çš„å·¥ç¨‹ï¼Œç®€å•çœ‹ä¸€ä¸‹å°±è¡Œã€‚</p>
<p>æ‰“å¼€ViewController.swiftæ–‡ä»¶ï¼Œæ³¨æ„åˆ°controllerä¸­çš„å¸¸é‡å±æ€§è¢«å‘½åä¸ºcardã€‚å®ƒä¿å­˜äº†ä¸€ä¸ªæ³°å§¬é™µç›¸å…³ä¿¡æ¯çš„æ•°æ®æ¨¡å‹ï¼Œä½ å°†ä½¿ç”¨è¿™ä¸ªæ¨¡å‹æ¥åˆ›å»ºä¸€ä¸ªå¡ç‰‡èŠ‚ç‚¹å±•ç¤ºç»™ç”¨æˆ·ã€‚</p>
<p>ç¼–è¯‘è¿è¡Œä¸€ä¸‹ç¡®ä¿å·¥ç¨‹å¯ä»¥æ­£å¸¸å·¥ä½œï¼Œæ­£å¸¸æ¥è¯´ä½ åº”è¯¥ä¼šçœ‹åˆ°ä¸€ä¸ªç©ºçš„é»‘å±å¹•ï¼å°±æ˜¯ä¸€ä¸ªç©ºçš„ç”»å¸ƒã€‚</p>
<p><img src="http://www.raywenderlich.com/wp-content/uploads/2015/06/ASDK_NodeHierarchies-1.jpg" alt=""> </p>
<h2 id="åˆ›å»ºå¹¶å±•ç¤ºä¸€ä¸ªå®¹å™¨èŠ‚ç‚¹"><a href="#åˆ›å»ºå¹¶å±•ç¤ºä¸€ä¸ªå®¹å™¨èŠ‚ç‚¹" class="headerlink" title="åˆ›å»ºå¹¶å±•ç¤ºä¸€ä¸ªå®¹å™¨èŠ‚ç‚¹"></a>åˆ›å»ºå¹¶å±•ç¤ºä¸€ä¸ªå®¹å™¨èŠ‚ç‚¹</h2><p>ç°åœ¨ä½ å°†è¦æ„å»ºä½ çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹å±‚çº§ç»“æ„ï¼Œå’Œæ„å»ºä¸€ä¸ªUIViewå±‚çº§ç»“æ„ç›¸å½“ç±»ä¼¼ï¼Œæˆ‘ç›¸ä¿¡ä½ ä¸€å®šå¾ˆç†Ÿæ‚‰:]ã€‚</p>
<p>æ‰“å¼€Wonders-Bridging-Header.hæ–‡ä»¶ï¼Œæ·»åŠ å¦‚ä¸‹å¤´æ–‡ä»¶ï¼š</p>
<pre><code>#import &lt;AsyncDisplayKit/ASDisplayNode+Subclasses.h&gt;
</code></pre><p>ASDisplayNode+Subclasses.hæ–‡ä»¶æš´éœ²äº†ä¸€äº›ASDisplayNodeå†…éƒ¨çš„æ–¹æ³•ã€‚ä½ éœ€è¦å¯¼å…¥è¿™ä¸ªå¤´æ–‡ä»¶æ‰èƒ½é‡å†™ASDisplayNodeå­ç±»çš„æ–¹æ³•ï¼Œä½†æ˜¯è¦æ³¨æ„ä½ ä¹Ÿåªèƒ½åœ¨ä½ è‡ªå®šä¹‰çš„ASDisplayNodeå­ç±»ä¸­è°ƒç”¨è¿™äº›æ–¹æ³•ã€‚</p>
<p>æ‰“å¼€CardNode.swiftï¼Œå¢åŠ å¦‚ä¸‹ä»£ç ï¼š</p>
<pre><code>class CardNode: ASDisplayNode {}
</code></pre><p>è¿™æ ·å°±å£°æ˜äº†ä¸€ä¸ªæ–°çš„ASDisplayNodeå­ç±»ï¼Œä½ å°†ä¼šç”¨å®ƒä½œä¸ºä¸€ä¸ªå®¹å™¨åŒ…å«å¡ç‰‡çš„ç”¨æˆ·ç•Œé¢ã€‚</p>
<p>æ‰“å¼€ViewController.swiftï¼Œå®ç°viewDidLoad()æ–¹æ³•:</p>
<pre><code>override func viewDidLoad() {
      super.viewDidLoad()
      // Create, configure, and lay out container node
      let cardNode = CardNode()
      cardNode.backgroundColor = UIColor(white: 1.0, alpha: 0.27)
      let origin = CGPointZero
      let size = CGSize(width: 100, height: 100)
      cardNode.frame = CGRect(origin: origin, size: size)
      // Create container nodeâ€™s view and add to view hierarchy
      view.addSubview(cardNode.view)
}
</code></pre><p>è¿™æ®µä»£ç ç”¨ç¡¬ç¼–ç å®šä¹‰çš„å°ºå¯¸åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„å¡ç‰‡èŠ‚ç‚¹ï¼Œå®ƒä¼šä½äºå±å¹•çš„å·¦ä¸Šè§’ï¼Œå®½é«˜éƒ½æ˜¯100ã€‚</p>
<p>æˆ‘çŸ¥é“ä½ ä¼šæ„Ÿè§‰å¸ƒå±€å¾ˆå¥‡æ€ªï¼Œåˆ«æ‹…å¿ƒï¼Œç¨åå°±ä¼šä¿®æ”¹ã€‚ç¼–è¯‘è¿è¡Œä¸€ä¸‹ï¼š</p>
<p><img src="http://www.raywenderlich.com/wp-content/uploads/2015/06/ASDK_NodeHierarchies-2.jpg" alt=""> </p>
<p>æ­å–œä½ ï¼ä½ å·²ç»åˆ›å»ºäº†ä¸€ä¸ªè‡ªå®šä¹‰çš„èŠ‚ç‚¹å­ç±»å¹¶ä¸”æ˜¾ç¤ºåˆ°äº†å±å¹•ä¸Šã€‚ä¸‹ä¸€æ­¥å°±æ˜¯èµ‹äºˆå®ƒè®¡ç®—è‡ªèº«å°ºå¯¸çš„èƒ½åŠ›ã€‚åœ¨é‚£ä¹‹å‰ï¼Œä½ åº”è¯¥ç†è§£èŠ‚ç‚¹çš„å¸ƒå±€å¼•æ“æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚</p>
<h2 id="èŠ‚ç‚¹å¸ƒå±€å¼•æ“"><a href="#èŠ‚ç‚¹å¸ƒå±€å¼•æ“" class="headerlink" title="èŠ‚ç‚¹å¸ƒå±€å¼•æ“"></a>èŠ‚ç‚¹å¸ƒå±€å¼•æ“</h2><p>æ¥ä¸‹æ¥çš„ä»»åŠ¡å°±æ˜¯é€šè¿‡è°ƒç”¨èŠ‚ç‚¹çš„measure(constrainedSize:)æ–¹æ³•ä½¿å¾—èŠ‚ç‚¹å»è®¡ç®—è‡ªèº«çš„å°ºå¯¸ã€‚</p>
<p>å¾€æ–¹æ³•ä¸­ä¼ å…¥constrainedSizeå‚æ•°ï¼Œè¿™æ ·èŠ‚ç‚¹å°±å¯ä»¥æ ¹æ®è¿™ä¸ªçº¦æŸå°ºå¯¸è®¡ç®—å‡ºä¸€ä¸ªé€‚åˆçš„å°ºå¯¸ã€‚</p>
<p>é€šä¿—çš„è¯´ï¼Œè¿™æ„å‘³ç€è®¡ç®—å¾—åˆ°çš„å°ºå¯¸ä¸èƒ½å¤§äºæä¾›çš„çº¦æŸå°ºå¯¸ã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼Œçœ‹ä¸€ä¸‹ä¸‹é¢çš„ç¤ºæ„å›¾ï¼š</p>
<p><img src="http://www.raywenderlich.com/wp-content/uploads/2015/06/ASDK_measure.png" alt=""> </p>
<p>è¿™æ˜¾ç¤ºäº†ä¸€ä¸ªæœ‰ç¡®å®šå®½é«˜çš„çº¦æŸå°ºå¯¸ï¼Œè®¡ç®—å¾—åˆ°çš„å°ºå¯¸å’Œçº¦æŸå°ºå¯¸ç›¸æ¯”å®½åº¦æ˜¯ç›¸ç­‰çš„ï¼Œé«˜åº¦è¦å°ã€‚ä¹Ÿæœ‰å¯èƒ½å®½é«˜éƒ½ç›¸ç­‰ï¼Œæˆ–è€…å®½é«˜éƒ½å°äºã€‚ä½†æ˜¯ç»ä¸ä¼šå…è®¸å®½æˆ–é«˜è¶…è¿‡ã€‚</p>
<p>è¿™å…¶å®å°±ç±»ä¼¼äºUIViewä¸­çš„sizeThatFits(size:)æ–¹æ³•ï¼ŒåŒºåˆ«åœ¨äºmeasure(constrainedSize:)ä¼šä¿å­˜è®¡ç®—å¾—åˆ°çš„å°ºå¯¸ç»“æœï¼Œå…è®¸ä½ é€šè¿‡èŠ‚ç‚¹çš„calculatedSizeå±æ€§è·å¾—ç¼“å­˜å€¼ã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­ç¥é©¬æ—¶å€™è®¡ç®—å¾—åˆ°çš„å°ºå¯¸å®½å’Œé«˜éƒ½ä¼šå°äºçº¦æŸå°ºå¯¸ï¼Œè¯·çœ‹ä¸‹å›¾ï¼š</p>
<p><img src="http://www.raywenderlich.com/wp-content/uploads/2015/06/ASDK_constrained2.png" alt=""></p>
<p>ä¹‹æ‰€ä»¥AsyncDisplayKitå°†sizingçº³å…¥APIæ˜¯å› ä¸ºè®¡ç®—å°ºå¯¸ç»å¸¸ä¼šèŠ±è´¹å¯æ„ŸçŸ¥åˆ°çš„å¤§é‡æ—¶é—´ã€‚æ¯”å¦‚è¯´ä»ç£ç›˜è¯»å–ä¸€å¼ å›¾ç‰‡ç„¶åè®¡ç®—å°ºå¯¸å°±éå¸¸æ…¢ã€‚é€šè¿‡çº³å…¥åˆ°APIï¼Œå¹¶ä¸”æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä¹Ÿå°±æ„å‘³ç€è®¡ç®—å¯ä»¥æ”¾åˆ°åå°çº¿ç¨‹äº†ï¼é…·å§ã€‚è¿™æ˜¯ä¸€ä¸ªä½¿å¾—UIå¦‚é»„æ²¹èˆ¬é¡ºæ»‘çš„è´´å¿ƒçš„å°ç‰¹æ€§ï¼Œå‡å°‘äº†ç”¨æˆ·é‡åˆ°å¡çš„ä¸€bçš„æƒ…å†µã€‚</p>
<p>ä¸€ä¸ªèŠ‚ç‚¹å¦‚æœä¹‹å‰æ²¡è®¡ç®—è¿‡æ²¡æœ‰ç¼“å­˜å€¼æˆ–è€…çº¦æŸå°ºå¯¸æ”¹å˜äº†å°±ä¼šå»è¿›è¡Œå°ºå¯¸è®¡ç®—ã€‚</p>
<p>ç”¨ç¨‹åºå‘˜çš„æœ¯è¯­æ¥è¯´ï¼Œå®ƒä¼šåƒè¿™æ ·å·¥ä½œï¼š</p>
<ul>
<li><p>measure(constrainedSize:)æˆ–è€…è¿”å›ä¸€ä¸ªç¼“å­˜å€¼æˆ–è€…é€šè¿‡è°ƒç”¨calculateSizeThatFits(constrainedSize:)å»è®¡ç®—å°ºå¯¸</p>
</li>
<li><p>åœ¨ä½ è‡ªå®šä¹‰çš„ASDisplayNodeå­ç±»ä¸­ä½ å°†æ‰€æœ‰çš„å°ºå¯¸è®¡ç®—é€»è¾‘æ”¾åˆ°calculateSizeThatFits(constrainedSize:)ä¸­</p>
</li>
</ul>
<p>æ³¨æ„ï¼šcalculateSizeThatFits(constrainedSize:)æ˜¯ASDisplayNodeå†…éƒ¨çš„æ–¹æ³•ï¼Œä½ ä¸åº”è¯¥åœ¨ä½ çš„å­ç±»å¤–è°ƒç”¨å®ƒã€‚</p>
<h2 id="è®¡ç®—ä¸€ä¸ªèŠ‚ç‚¹çš„å°ºå¯¸"><a href="#è®¡ç®—ä¸€ä¸ªèŠ‚ç‚¹çš„å°ºå¯¸" class="headerlink" title="è®¡ç®—ä¸€ä¸ªèŠ‚ç‚¹çš„å°ºå¯¸"></a>è®¡ç®—ä¸€ä¸ªèŠ‚ç‚¹çš„å°ºå¯¸</h2><p>ç°åœ¨ä½ å·²ç»ç†è§£äº†è¿™ä¸ªæ–¹æ³•ï¼Œè¯¥å»å®é™…åº”ç”¨äº†ã€‚</p>
<p>æ‰“å¼€CardNode.swiftï¼Œä¿®æ”¹æˆå¦‚ä¸‹ï¼š</p>
<pre><code>class CardNode: ASDisplayNode {

      override func calculateSizeThatFits(constrainedSize: CGSize) -&gt; CGSize {
        return CGSize(width: constrainedSize.width * 0.2, height: constrainedSize.height * 0.2)
      }

}
</code></pre><p>ç°åœ¨è¿™ä¸ªæ–¹æ³•è¿”å›äº†ä¸€ä¸ªå°ºå¯¸å®½é«˜éƒ½æ˜¯æä¾›çš„çº¦æŸå°ºå¯¸çš„20%ï¼Œå› æ­¤ï¼Œå®ƒå å¯ç”¨ç©ºé—´çš„4%ã€‚</p>
<p>æ‰“å¼€ViewController.swiftï¼Œåˆ é™¤viewDidLoad()æ–¹æ³•å®ç°ï¼Œå®ç°createCardNode(containerRect:)æ–¹æ³•ï¼š</p>
<pre><code>/* Delete this method

override func viewDidLoad() {
      super.viewDidLoad()
      // 1
      let cardNode = CardNode()
      cardNode.backgroundColor = UIColor(white: 1.0, alpha: 0.27)
      let origin = CGPointZero
      let size = CGSize(width: 100, height: 100)
      cardNode.frame = CGRect(origin: origin, size: size)

      // 2
      view.addSubview(cardNode.view)
}    
*/

func createCardNode(containerRect containerRect: CGRect) -&gt; CardNode {
      // 3
      let cardNode = CardNode()
      cardNode.backgroundColor = UIColor(white: 1.0, alpha: 0.27)
      cardNode.measure(containerRect.size)

      // 4
      let size = cardNode.calculatedSize
      let origin = containerRect.originForCenteredRectWithSize(size)
      cardNode.frame = CGRect(origin: origin, size: size)
      return cardNode
}
</code></pre><p>è¿˜æ˜¯ç¨å¾®è§£é‡Šä¸€ä¸‹ï¼š</p>
<ol>
<li>åˆ é™¤æ—§çš„åˆ›å»ºï¼Œé…ç½®ï¼Œå¸ƒå±€å®¹å™¨èŠ‚ç‚¹çš„æ–¹æ³•</li>
<li>åˆ é™¤æ—§çš„åˆ›å»ºå®¹å™¨èŠ‚ç‚¹çš„è§†å›¾å’Œå°†å…¶æ·»åŠ åˆ°è§†å›¾å±‚çº§ç»“æ„çš„æ–¹æ³•</li>
<li>createCardNode(containerRect:)æ–¹æ³•åˆ›å»ºäº†ä¸€ä¸ªå’Œæ—§çš„å®¹å™¨èŠ‚ç‚¹æ‹¥æœ‰åŒæ ·èƒŒæ™¯è‰²çš„æ–°çš„å¡ç‰‡èŠ‚ç‚¹ï¼Œå¹¶ä¸”ä½¿ç”¨ä¸€ä¸ªå¤–ç•Œæä¾›çš„å®¹å™¨çŸ©å½¢æ¥çº¦æŸå¡ç‰‡èŠ‚ç‚¹çš„å°ºå¯¸ï¼Œå› æ­¤å¡ç‰‡èŠ‚ç‚¹ä¸ä¼šå¤§äºcontainerRectçš„size</li>
<li>ä½¿ç”¨originForCenteredRectWithSize(size:)æ–¹æ³•å°†å¡ç‰‡å±…ä¸­æ˜¾ç¤º</li>
</ol>
<p>åœ¨è¿™ä¸ªæ–¹æ³•ä¸‹é¢ï¼Œé‡æ–°å®ç°viewDidLoad()æ–¹æ³•ï¼š</p>
<pre><code>override func viewDidLoad() {
      super.viewDidLoad()
      let cardNode = createCardNode(containerRect: UIScreen.mainScreen().bounds)
      view.addSubview(cardNode.view)
}
</code></pre><p>å½“controllerçš„viewåŠ è½½æ—¶ï¼ŒcreateCardNode(containerRect:)æ–¹æ³•åˆ›å»ºå¹¶è®¾ç½®äº†ä¸€ä¸ªæ–°çš„CardNodeï¼Œè¿™ä¸ªå¡ç‰‡èŠ‚ç‚¹çš„å°ºå¯¸ä¸èƒ½å¤§äºä¸»å±å¹•çš„å¤§å°ã€‚</p>
<p>æ³¨æ„åœ¨æ­¤æ—¶ï¼Œcontrollerçš„viewè¿˜æ²¡æœ‰è¢«å¸ƒå±€ã€‚å› æ­¤å¦‚æœä½¿ç”¨controllerçš„viewçš„bounds sizeæ˜¯ä¸å®‰å…¨çš„ï¼Œå› æ­¤ä½¿ç”¨ä¸»å±å¹•çš„bounds sizeæ¥çº¦æŸå¡ç‰‡èŠ‚ç‚¹çš„å°ºå¯¸ã€‚</p>
<p>å½“ç„¶ï¼Œè¿™ç§æ–¹æ³•ä¸å¤Ÿä¼˜é›…ï¼Œåˆ«æ€¥ï¼Œç¨åä¼šä¿®æ”¹ã€‚å…ˆè¿™ä¹ˆç”¨ç€ã€‚</p>
<p>ç¼–è¯‘è¿è¡Œä¸€ä¸‹ï¼Œä½ ä¼šçœ‹åˆ°èŠ‚ç‚¹å±…ä¸­æ˜¾ç¤ºäº†ã€‚</p>
<p><img src="http://www.raywenderlich.com/wp-content/uploads/2015/06/ASDK_NodeHierarchies-3.jpg" alt=""></p>
<h2 id="å¼‚æ­¥è®¾ç½®ä¸å¸ƒå±€èŠ‚ç‚¹"><a href="#å¼‚æ­¥è®¾ç½®ä¸å¸ƒå±€èŠ‚ç‚¹" class="headerlink" title="å¼‚æ­¥è®¾ç½®ä¸å¸ƒå±€èŠ‚ç‚¹"></a>å¼‚æ­¥è®¾ç½®ä¸å¸ƒå±€èŠ‚ç‚¹</h2><p>æœ‰æ—¶å¸ƒå±€å¤æ‚çš„å±‚çº§ç»“æ„ä¼šå ç”¨å¤§é‡çš„æ—¶é—´ï¼Œå¦‚æœå‘ç”Ÿåœ¨ä¸»çº¿ç¨‹ï¼Œè¿™å°±ä¼šé˜»å¡ç”¨æˆ·äº¤äº’ã€‚è¦æ˜¯ä½ æœŸæœ›æœ‰è‰¯å¥½çš„ç”¨æˆ·ä½“éªŒï¼Œå°±ä¸èƒ½æœ‰ä»»ä½•å¯æ„ŸçŸ¥åˆ°çš„ç­‰å¾…æ—¶é—´ã€‚</p>
<p>åŸºäºè¿™ä¸ªåŸå› ï¼Œä½ è¦æŠŠåˆ›å»ºï¼Œè®¾ç½®ï¼Œå¸ƒå±€éƒ½æ”¾å…¥åå°çº¿ç¨‹ï¼Œè¿™æ ·å°±é¿å…äº†é˜»å¡ä¸»çš„UIçº¿ç¨‹ã€‚</p>
<p>åœ¨createCardNode(containerRect:)å’ŒviewDidLoad():ä¹‹é—´å®ç°addCardViewAsynchronously(containerRect:)æ–¹æ³•ï¼š</p>
<pre><code>func addCardViewAsynchronously(containerRect containerRect: CGRect) {
      dispatch_async(dispatch_get_global_queue(QOS_CLASS_BACKGROUND, 0)) {
        let cardNode = self.createCardNode(containerRect: containerRect)
        dispatch_async(dispatch_get_main_queue()) {
             self.view.addSubview(cardNode.view)
        }
      }
}
</code></pre><p>addCardViewAsynchronously(containerRect:)æ–¹æ³•åœ¨åå°çº¿ç¨‹åˆ›å»ºäº†CardNodeï¼å› ä¸ºnodeæ˜¯çº¿ç¨‹å®‰å…¨çš„æ‰€ä»¥æ²¡æœ‰é—®é¢˜ï¼åœ¨åˆ›å»ºï¼Œé…ç½®ï¼Œå¸ƒå±€ä¹‹åï¼Œå›åˆ°ä¸»çº¿ç¨‹å¥½å°†nodeçš„viewå¢åŠ åˆ°controllerçš„viewå±‚çº§ç»“æ„ä¸­ï¼æ¯•ç«Ÿï¼ŒUIKitä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„å˜›ã€‚:]</p>
<p>æ³¨æ„ï¼šä¸€æ—¦ä½ åˆ›å»ºäº†èŠ‚ç‚¹çš„è§†å›¾ï¼Œä¹‹åå†ä½¿ç”¨èŠ‚ç‚¹å°±åªèƒ½åœ¨ä¸»çº¿ç¨‹äº†ã€‚</p>
<p>é‡æ–°å®ç°viewDidLoad()æ–¹æ³•ï¼š</p>
<pre><code>override func viewDidLoad() {
      super.viewDidLoad()
      addCardViewAsynchronously(containerRect: UIScreen.mainScreen().bounds)
}
</code></pre><p>ä¸å†é˜»å¡ä¸»çº¿ç¨‹ï¼Œä¿è¯äº†ç”¨æˆ·ç•Œé¢ååº”çµæ•ã€‚</p>
<p>ç¼–è¯‘è¿è¡Œä¸€ä¸‹ï¼Œæ˜¾ç¤ºè¿˜å’Œä¹‹å‰ä¸€æ ·ï¼Œä½†æ˜¯æ‰€æœ‰çš„è®¡ç®—å·¥ä½œéƒ½æ”¾åˆ°åå°çº¿ç¨‹äº†ï¼é…·ï¼:]</p>
<p><img src="http://www.raywenderlich.com/wp-content/uploads/2015/06/ASDK_NodeHierarchies-3.jpg" alt=""></p>
<h2 id="ç”¨controllerçš„viewå°ºå¯¸å»çº¦æŸèŠ‚ç‚¹çš„å°ºå¯¸"><a href="#ç”¨controllerçš„viewå°ºå¯¸å»çº¦æŸèŠ‚ç‚¹çš„å°ºå¯¸" class="headerlink" title="ç”¨controllerçš„viewå°ºå¯¸å»çº¦æŸèŠ‚ç‚¹çš„å°ºå¯¸"></a>ç”¨controllerçš„viewå°ºå¯¸å»çº¦æŸèŠ‚ç‚¹çš„å°ºå¯¸</h2><p>è¿˜è®°å¾—åˆšæ‰æˆ‘è¯´ç›¸æ¯”ä¾èµ–äºå±å¹•å°ºå¯¸ä¼šç”¨ä¸€ç§æ›´ä¼˜é›…çš„æ–¹å¼å»è®¡ç®—èŠ‚ç‚¹çš„å°ºå¯¸å§ï¼Ÿç°åœ¨æ¥å…‘ç°æ‰¿è¯ºï¼</p>
<p>æ‰“å¼€ViewController.swiftï¼Œå¢åŠ ä¸€ä¸ªå±æ€§ï¼š</p>
<pre><code>var cardViewSetupStarted = false
</code></pre><p>ç„¶åç”¨viewWillLayoutSubviews():æ–¹æ³•ä»£æ›¿viewDidLoad()æ–¹æ³•ï¼š</p>
<pre><code>/* Delete this method
override func viewDidLoad() {
      super.viewDidLoad()
      addCardViewAsynchronously(containerRect: UIScreen.mainScreen().bounds)
}
*/

override func viewWillLayoutSubviews() {
      super.viewWillLayoutSubviews()
      if !cardViewSetupStarted {
        addCardViewAsynchronously(containerRect: view.bounds)
        cardViewSetupStarted = true
      }
}
</code></pre><p>æ›¿æ¢æ‰ä½¿ç”¨ä¸»å±å¹•çš„bounds sizeï¼Œä¸Šé¢çš„ä»£ç ä½¿ç”¨controllerçš„viewçš„bounds sizeæ¥çº¦æŸå¡ç‰‡èŠ‚ç‚¹çš„å°ºå¯¸ã€‚</p>
<p>ç°åœ¨ä¹‹æ‰€æœ‰å¯ä»¥å®‰å…¨çš„ä½¿ç”¨controllerçš„viewçš„bounds sizeæ˜¯å› ä¸ºåœ¨viewWillLayoutSubviews()æ–¹æ³•å‘ç”Ÿçš„æ—¶å€™ï¼Œcontrollerçš„viewå·²ç»è¢«è®¾ç½®äº†å°ºå¯¸å¤§å°ã€‚</p>
<p>è¿™æ ·åšä¹‹æ‰€ä»¥æ›´ä¼˜ç§€æ˜¯å› ä¸ºä¸€ä¸ªcontrollerçš„viewå¯ä»¥æ˜¯ä»»ä½•å°ºå¯¸ï¼Œä½ ä¸èƒ½åŸºäºcontrolleræ­£å¥½é“ºæ»¡æ•´ä¸ªå±å¹•è¿™æ ·ä¸€ä¸ªäº‹å®å»åšäº‹æƒ…ã€‚</p>
<p><img src="http://www.raywenderlich.com/wp-content/uploads/2015/06/screen_size_tyranny.png" alt=""></p>
<p>viewå¯èƒ½è¢«å¸ƒå±€å¤šæ¬¡ï¼Œå› æ­¤viewWillLayoutSubviews()æ–¹æ³•å¯èƒ½ä¼šè¢«è°ƒç”¨å¤šæ¬¡ã€‚ä½†æ˜¯ä½ åªæ˜¯å¸Œæœ›åˆ›å»ºå¡ç‰‡èŠ‚ç‚¹ä¸€æ¬¡ï¼Œæ‰€ä»¥è¦åŠ ä¸€ä¸ªcardViewSetupStartedå˜é‡æ¥æ ‡è¯†ä¸€ä¸‹ã€‚</p>
<p>å†æ¬¡ç¼–è¯‘è¿è¡Œä¸€ä¸‹ï¼Œå¥½å§ï¼Œç•Œé¢è¿˜æ˜¯æ²¡å˜åŒ–ï¼š</p>
<p><img src="http://www.raywenderlich.com/wp-content/uploads/2015/06/ASDK_NodeHierarchies-3.jpg" alt=""></p>
<h2 id="èŠ‚ç‚¹å±‚çº§ç»“æ„"><a href="#èŠ‚ç‚¹å±‚çº§ç»“æ„" class="headerlink" title="èŠ‚ç‚¹å±‚çº§ç»“æ„"></a>èŠ‚ç‚¹å±‚çº§ç»“æ„</h2><p>å½“å‰åœ¨å±å¹•ä¸Šæœ‰äº†ä¸€ä¸ªç©ºçš„å®¹å™¨å¡ç‰‡èŠ‚ç‚¹ã€‚ç°åœ¨ä½ è¦å±•ç¤ºä¸€äº›å†…å®¹ï¼Œæ–¹æ³•å°±æ˜¯å¢åŠ ä¸€äº›å­èŠ‚ç‚¹ï¼Œæ¥ä¸‹æ¥çš„éƒ¨åˆ†æè¿°äº†ä½ å°†è¦æ„å»ºçš„ç®€å•çš„èŠ‚ç‚¹å±‚çº§ç»“æ„ã€‚</p>
<p><img src="http://www.raywenderlich.com/wp-content/uploads/2015/06/ASDK_Nodes.png" alt=""></p>
<p>å¢åŠ å­èŠ‚ç‚¹çš„è¿‡ç¨‹ä¼šç›¸å½“ç†Ÿæ‚‰å› ä¸ºå…¶å®å’Œæ·»åŠ å­è§†å›¾å¼‚æ›²åŒå·¥ã€‚</p>
<p>ç¬¬ä¸€æ­¥æ˜¯å¢åŠ ä¸€ä¸ªå›¾åƒèŠ‚ç‚¹ï¼Œä½†é¦–å…ˆï¼Œä½ åº”è¯¥çŸ¥é“å®¹å™¨èŠ‚ç‚¹æ˜¯æ€æ ·å¸ƒå±€å®ƒçš„å­èŠ‚ç‚¹çš„ã€‚</p>
<p><strong>å­èŠ‚ç‚¹å¸ƒå±€</strong></p>
<p>ä½ ç°åœ¨çŸ¥é“æ€æ ·æµ‹é‡å®¹å™¨èŠ‚ç‚¹çš„å°ºå¯¸ä»¥åŠæ€æ ·ä½¿ç”¨è®¡ç®—å¾—åˆ°çš„å°ºå¯¸(calculated size)æ¥å¸ƒå±€å®¹å™¨èŠ‚ç‚¹çš„è§†å›¾ã€‚ä½†æ˜¯å®¹å™¨èŠ‚ç‚¹æ€æ ·å¸ƒå±€å­èŠ‚ç‚¹å‘¢ï¼Ÿ</p>
<p>å¯ä»¥åˆ†ä¸¤æ­¥èµ°ï¼š</p>
<ol>
<li>é¦–å…ˆï¼Œåœ¨calculateSizeThatFits(constrainedSize:)æ–¹æ³•ä¸­è®¡ç®—æ¯ä¸€ä¸ªå­èŠ‚ç‚¹çš„å°ºå¯¸ï¼Œè¿™ä¿è¯äº†æ¯ä¸ªå­èŠ‚ç‚¹ç¼“å­˜äº†ä¸€ä¸ªè®¡ç®—åçš„å°ºå¯¸ã€‚</li>
<li>åœ¨UIKitçš„å¸ƒå±€ä¼ é€’åˆ°ä¸»çº¿ç¨‹æœŸé—´ï¼ŒAsyncDisplayKitä¼šåœ¨ä½ è‡ªå®šä¹‰çš„ASDisplayNodeå­ç±»ä¸­è°ƒç”¨layout()æ–¹æ³•ï¼Œlayout()ç±»ä¼¼äºUIViewä¸­çš„layoutSubviews()ï¼ŒåŒºåˆ«åœ¨äºlayout()ä¸æ˜¯å¿…é¡»å»è®¡ç®—å®ƒçš„æ‰€æœ‰å­©å­çš„å°ºå¯¸ï¼Œä»…ä»…æ˜¯è·å–æ¯ä¸ªå­èŠ‚ç‚¹çš„ç¼“å­˜è®¡ç®—å¥½çš„å°ºå¯¸(calculated size)ã€‚</li>
</ol>
<p>è¿˜å›åˆ°UIï¼Œæ³°å§¬é™µå¡ç‰‡çš„å°ºå¯¸åº”è¯¥ç­‰äºå›¾åƒçš„å°ºå¯¸ï¼Œæ ‡é¢˜æ–‡å­—åº”è¯¥é€‚åº”åœ¨è¿™ä¸ªå°ºå¯¸ä¸­ã€‚æœ€ç®€å•çš„åšæ³•æ˜¯è®¡ç®—å›¾åƒèŠ‚ç‚¹çš„å°ºå¯¸ç„¶åç”¨ç»“æœå»çº¦æŸæ–‡æœ¬èŠ‚ç‚¹çš„å°ºå¯¸ã€‚</p>
<p>è¿™å°±æ˜¯å¸ƒå±€å¡ç‰‡çš„å­èŠ‚ç‚¹æ‰€éœ€è¦çš„é€»è¾‘ï¼Œç°åœ¨ç”¨ä»£ç å®ç°ã€‚:]</p>
<h2 id="å¢åŠ ä¸€ä¸ªå­èŠ‚ç‚¹"><a href="#å¢åŠ ä¸€ä¸ªå­èŠ‚ç‚¹" class="headerlink" title="å¢åŠ ä¸€ä¸ªå­èŠ‚ç‚¹"></a>å¢åŠ ä¸€ä¸ªå­èŠ‚ç‚¹</h2><p>æ‰“å¼€CardNode.swiftåœ¨calculateSizeThatFits(constrainedSize:)æ–¹æ³•ä¹‹ä¸Šå¢åŠ å¦‚ä¸‹ä»£ç ï¼š</p>
<pre><code>// 1
let imageNode: ASImageNode

// 2
init(card: Card) {
      imageNode = ASImageNode()
      super.init()
      setUpSubnodesWithCard(card)
      buildSubnodeHierarchy()
}

// 3
func setUpSubnodesWithCard(card: Card) {
      // Set up image node
      imageNode.image = card.image
}

// 4
func buildSubnodeHierarchy() {
      addSubnode(imageNode)
}
</code></pre><p>ç…§ä¾‹è¿˜æ˜¯ç¨å¾®è§£é‡Šä¸‹ï¼š</p>
<ol>
<li>å›¾åƒèŠ‚ç‚¹å±æ€§ï¼šè¿™ä¸€è¡Œå¢åŠ äº†ä¸€ä¸ªä¿å­˜å¡ç‰‡çš„å›¾åƒå­èŠ‚ç‚¹çš„å±æ€§ã€‚</li>
<li>è‡ªå®šä¹‰çš„åˆå§‹åŒ–æ–¹æ³•ï¼šéœ€è¦ä¸€ä¸ªå¡ç‰‡æ¨¡å‹å¯¹è±¡æ¥ä¿å­˜å›¾åƒå’Œæ ‡é¢˜ã€‚</li>
<li>å­èŠ‚ç‚¹è®¾ç½®ï¼šç”¨å·¥ç¨‹ä¸€å¼€å§‹å°±å­˜åœ¨çš„å¡ç‰‡æ¨¡å‹å¯¹è±¡æ¥è®¾ç½®å­èŠ‚ç‚¹ã€‚</li>
<li>å®¹å™¨çš„å±‚çº§ç»“æ„ï¼šå°±åƒç»„ç»‡è§†å›¾å±‚çº§é‚£æ ·ç»„ç»‡èŠ‚ç‚¹å±‚çº§ï¼ŒæŠŠæ‰€æœ‰å­èŠ‚ç‚¹åŠ åˆ°è‡ªèº«ä¸Šã€‚</li>
</ol>
<p>æ¥ä¸‹æ¥ï¼Œé‡æ–°å®ç°calculateSizeThatFits(constrainedSize:)æ–¹æ³•ï¼š</p>
<pre><code>override func calculateSizeThatFits(constrainedSize: CGSize) -&gt; CGSize {
      // 1 
      imageNode.measure(constrainedSize)

      // 2 
      let cardSize = imageNode.calculatedSize

      // 3 
      return cardSize
}
</code></pre><p>æ¥ä¸‹æ¥ï¼Œé‡å†™layout()æ–¹æ³•:</p>
<pre><code>override func layout() {
    imageNode.frame = CGRect(origin: CGPointZero, size: imageNode.calculatedSize).integral
}
</code></pre><p>è¿™ä¸ªé€»è¾‘å°†å›¾åƒæ”¾åˆ°å¡ç‰‡èŠ‚ç‚¹çš„å·¦ä¸Šè§’ï¼Œå¹¶ä¸”ç¡®å®šå›¾åƒèŠ‚ç‚¹çš„frameéƒ½æ˜¯æ•´æ•°ï¼Œé¿å…äº†è¾¹ç•Œå±•ç¤ºé—®é¢˜ã€‚</p>
<p>æ³¨æ„ä¸€ä¸‹è¿™ä¸ªæ–¹æ³•æ€æ ·åœ¨å¸ƒå±€æ—¶ä½¿ç”¨å›¾åƒèŠ‚ç‚¹ç¼“å­˜çš„è®¡ç®—å¥½çš„å°ºå¯¸(calculated size)ã€‚</p>
<p>å› ä¸ºå›¾åƒèŠ‚ç‚¹çš„å°ºå¯¸å†³å®šäº†å¡ç‰‡èŠ‚ç‚¹çš„å°ºå¯¸ï¼Œå›¾åƒä¼šé“ºæ»¡æ•´ä¸ªå¡ç‰‡ã€‚</p>
<p>å›åˆ°ViewController.swiftï¼Œåœ¨createCardNode(containerRect:)æ–¹æ³•ä¸­ï¼Œåˆå§‹åŒ–CardNodeæ–¹æ³•ä¿®æ”¹æˆï¼š</p>
<pre><code>let cardNode = CardNode(card: card)
</code></pre><p>ç¼–è¯‘è¿è¡Œï¼Œæ„Ÿå—ä¸‹ç¥é©¬å«ç¾ä¸½å£®è§‚ï¼:]</p>
<p><img src="http://www.raywenderlich.com/wp-content/uploads/2015/06/ASDK_NodeHierarchies-6.jpg" alt=""></p>
<p>æ£’æ£’çš„ï¼Œä½ å·²ç»æˆåŠŸçš„åˆ›å»ºäº†ä¸€ä¸ªå­˜åœ¨ä¸€ä¸ªèŠ‚ç‚¹å±‚çº§ç»“æ„çš„å®¹å™¨èŠ‚ç‚¹ã€‚è™½ç„¶å¾ˆç®€å•ï¼Œä½†å®ƒä¹Ÿæ˜¯ä¸€ä¸ªèŠ‚ç‚¹å±‚çº§ç»“æ„ï¼</p>
<h2 id="å¢åŠ æ›´å¤šå­èŠ‚ç‚¹"><a href="#å¢åŠ æ›´å¤šå­èŠ‚ç‚¹" class="headerlink" title="å¢åŠ æ›´å¤šå­èŠ‚ç‚¹"></a>å¢åŠ æ›´å¤šå­èŠ‚ç‚¹</h2><p>å˜¿ï¼æ¥ä¸‹æ¥æˆ‘ä»¬å¢åŠ æ ‡é¢˜å‘Šè¯‰ç”¨æˆ·è¿™æ˜¯ä¸ªå•¥ã€‚</p>
<p>è‡³å°‘éœ€è¦å¦ä¸€ä¸ªå­èŠ‚ç‚¹æ¥ä¿å­˜æ ‡é¢˜ã€‚</p>
<p>æ‰“å¼€CardNode.swiftå¢åŠ ä¸€ä¸ªæ–°å±æ€§ï¼š</p>
<pre><code>let titleTextNode: ASTextNode
</code></pre><p>åœ¨åˆå§‹åŒ–æ–¹æ³•ä¸­èµ‹åˆå€¼ï¼Œåœ¨super.init()ä¹‹ä¸Šæ·»åŠ ï¼š</p>
<pre><code>titleTextNode = ASTextNode()
</code></pre><p>åœ¨setUpSubnodesWithCard(card:)æ–¹æ³•ä¸­æ·»åŠ ï¼š</p>
<pre><code>titleTextNode.attributedString = NSAttributedString.attributedStringForTitleText(card.name) 
</code></pre><p>è¿™ä¸€è¡Œä»£ç ç»™æ–‡æœ¬èŠ‚ç‚¹ä¸€ä¸ªå¸¦æœ‰å±æ€§çš„å­—ç¬¦ä¸²ä¿å­˜å¡ç‰‡çš„æ ‡é¢˜ã€‚attributedStringForTitleText(text:)æ˜¯ä¸€ä¸ªå¸®åŠ©æ–¹æ³•ï¼Œå¾ˆç®€å•ä½ å¯ä»¥è‡ªå·±å»çœ‹çœ‹ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œåœ¨buildSubnodeHierarchy()æ–¹æ³•çš„æœ€åæ·»åŠ ï¼š</p>
<pre><code>addSubnode(titleTextNode)
</code></pre><p>ç„¶ååœ¨calculateSizeThatFits(constrainedSize:)æ–¹æ³•å†…ï¼Œåœ¨è¿”å›ä¹‹å‰æ·»åŠ ï¼š</p>
<pre><code>titleTextNode.measure(cardSize)
</code></pre><p>åœ¨layout()æ–¹æ³•ä¸­æ·»åŠ :</p>
<pre><code>titleTextNode.frame =
FrameCalculator.titleFrameForSize(titleTextNode.calculatedSize, containerFrame: imageNode.frame)
</code></pre><p>FrameCalculatoråˆæ˜¯ä¸€ä¸ªå¸®åŠ©å·¥å…·ç±»ã€‚</p>
<p>ç¼–è¯‘è¿è¡Œï¼Œç°åœ¨æ˜¾ç¤ºæ³°å§¬é™µæ²¡æœ‰ä»»ä½•é—®é¢˜äº†ã€‚</p>
<p><img src="http://www.raywenderlich.com/wp-content/uploads/2015/06/ASDK_NodeHierarchies-7-e1434332214236.jpg" alt=""></p>
<p>å›é¡¾ä¸€ä¸‹ä½ æ˜¯æ€æ ·å®ç°çš„ï¼è¿™æ˜¯ä¸€ä¸ªå……å®çš„èŠ‚ç‚¹å±‚çº§ç»“æ„ï¼Œä¸€ä¸ªå®¹å™¨èŠ‚ç‚¹æœ‰ä¸¤ä¸ªå­èŠ‚ç‚¹ã€‚</p>
<h2 id="ä½•å»ä½•ä»"><a href="#ä½•å»ä½•ä»" class="headerlink" title="ä½•å»ä½•ä»"></a>ä½•å»ä½•ä»</h2><p>å¦‚æœä½ æ„¿æ„çœ‹çœ‹æœ€åçš„å·¥ç¨‹ï¼Œå¯ä»¥åœ¨è¿™é‡Œ<a href="http://www.raywenderlich.com/wp-content/uploads/2015/06/Wonders-Final.zip" target="_blank" rel="external">ä¸‹è½½</a>ã€‚</p>
<p>è¦æƒ³å­¦ä¹ æ›´å¤šå¯ä»¥åˆ°AsyncDisplayKitçš„<a href="https://github.com/facebook/AsyncDisplayKit" target="_blank" rel="external">Githubä»“åº“</a>çœ‹ä¸€äº›<a href="https://github.com/facebook/AsyncDisplayKit/tree/master/examples" target="_blank" rel="external">ğŸŒ°å·¥ç¨‹</a>ã€‚</p>
<p>è¿™ä¸ªåº“å®Œå…¨å¼€æºï¼Œæ‰€ä»¥å¦‚æœä½ å¥½å¥‡æ€æ ·å®ç°çš„è¯å¯ä»¥çœ‹çœ‹æºç ã€‚</p>
<p>æ€»ç»“ä¸€ä¸‹ï¼šé€šè¿‡ä½¿ç”¨èŠ‚ç‚¹å°†ä¸€éƒ¨åˆ†å·¥ä½œè½¬ç§»åˆ°åå°çº¿ç¨‹èƒ½ç¡®ä¿è·å¾—æ›´æµç•…ååº”æ›´çµæ•çš„UIç•Œé¢ï¼Œè€Œè¿™é€šè¿‡UIKitæ˜¯ä¸å¯èƒ½å®ç°çš„ã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æœ¬æ–‡ç”±RenÃ© Cacheauxäº15å¹´å‘è¡¨äº&lt;a href=&quot;https://www.raywenderlich.com&quot;&gt;raywenderlich&lt;/a&gt;ï¼ŒåŸæ–‡å¯æŸ¥çœ‹&lt;a href=&quot;https://www.raywenderlich.com/107310/asyncdisplaykit-tutorial-node-hierarchies&quot;&gt;AsyncDisplayKit Tutorial: Node Hierarchies&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;AsyncDisplayKitæ˜¯ä¸€ä¸ªæœ€åˆä¸ºFacebookçš„&lt;a href=&quot;https://www.facebook.com/paper&quot;&gt;Paper&lt;/a&gt;é¡¹ç›®è€Œè®¾è®¡çš„iOSæ¡†æ¶ã€‚å®ƒä½¿è·å¾—æ¯”åº”ç”¨æ ‡å‡†viewæ›´æµç•…å“åº”æ›´å¿«é€Ÿçš„UIæˆä¸ºå¯èƒ½ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="ç¿»è¯‘" scheme="http://yoursite.com/categories/%E7%BF%BB%E8%AF%91/"/>
    
    
      <category term="AsyncDisplayKit" scheme="http://yoursite.com/tags/AsyncDisplayKit/"/>
    
  </entry>
  
  <entry>
    <title>AsyncDisplayKitæ•™ç¨‹: è¾¾åˆ°60FPSçš„æ»šåŠ¨å¸§ç‡</title>
    <link href="http://yoursite.com/2016/09/15/AsyncDisplayKit-Tutorial-Achieving-60-FPS-scrolling%E3%80%90%E8%AF%91%E3%80%91/"/>
    <id>http://yoursite.com/2016/09/15/AsyncDisplayKit-Tutorial-Achieving-60-FPS-scrollingã€è¯‘ã€‘/</id>
    <published>2016-09-15T13:17:27.000Z</published>
    <updated>2016-12-23T10:18:55.000Z</updated>
    
    <content type="html"><![CDATA[<p>å¤©å¢å²æœˆäººå¢è‚‰ï¼Œä»Šå¤©æ˜¯ä¸­ç§‹ã€‚<br>æœ¬æ–‡ç”±RenÃ© Cacheauxäº14å¹´å‘è¡¨äº<a href="https://www.raywenderlich.com" target="_blank" rel="external">raywenderlich</a>ï¼ŒåŸæ–‡å¯æŸ¥çœ‹<a href="https://www.raywenderlich.com/86365/asyncdisplaykit-tutorial-achieving-60-fps-scrolling" target="_blank" rel="external">AsyncDisplayKit Tutorial: Achieving 60 FPS scrolling</a>ã€‚<br>Facebookçš„<a href="https://www.facebook.com/paper" target="_blank" rel="external">Paper</a>å›¢é˜Ÿåˆ›é€ äº†å¦ä¸€ä¸ªéå¸¸æ£’çš„åº“ï¼š<a href="https://github.com/facebook/AsyncDisplayKit" target="_blank" rel="external">AsyncDisplayKit</a>ã€‚è¿™ä¸ªåº“å…è®¸ä½ å°†å›¾ç‰‡è§£ç ï¼Œå¸ƒå±€ï¼Œæ¸²æŸ“ç­‰æ“ä½œæ”¾åˆ°åå°çº¿ç¨‹ï¼Œè¿™æ ·ä¸ä¼šé˜»å¡ç”¨æˆ·äº¤äº’ï¼Œä»è€Œä½¿ç”¨æˆ·ç•Œé¢å“åº”è¶…çº§çµæ•ã€‚æœ¬æ•™ç¨‹å°±æ˜¯ä¸“é—¨ä»‹ç»å®ƒçš„ï¼Œå¥½å¥½å­¦å­¦å§ã€‚<br><a id="more"></a><br>ä¸¾ä¸ªä¾‹å­ï¼Œå¯¹äºéå¸¸å¤æ‚çš„ç•Œé¢ä½ å¯ä»¥åº”ç”¨AsyncDisplayKitåº“æ¥æ„å»ºä¸èˆ¬é¡ºæ»‘ï¼Œæ¯ç§’60å¸§çš„æ»‘åŠ¨ä½“éªŒï¼Œè€Œé€šè¿‡UIKitæ¥ä¼˜åŒ–ä¸è¶³ä»¥æˆ˜èƒœè¿™æ ·çš„æŒ‘æˆ˜ã€‚</p>
<p>åœ¨æœ¬ç¯‡æ•™ç¨‹ä¸­ï¼Œä½ å°†åº”ç”¨AsyncDisplayKitåˆ°ä¸€ä¸ªä¸»è¦æ˜¯æœ‰UICollectionViewæ»‘åŠ¨é—®é¢˜çš„å·¥ç¨‹ä¸­æ¥æ˜¾è‘—æé«˜å®ƒçš„æ€§èƒ½ã€‚ä½ å°†å­¦åˆ°æ€æ ·å°†AsyncDisplayKitåº”ç”¨åˆ°ç°å­˜é¡¹ç›®ä¸­ã€‚</p>
<p>æ³¨æ„ï¼šåœ¨æ­£å¼å¼€å§‹æœ¬ç¯‡æ•™ç¨‹ä¹‹å‰ï¼Œä½ åº”è¯¥å·²ç»å¾ˆç†Ÿæ‚‰Swiftï¼ŒCore Animationï¼ŒCore Graphicsï¼ŒGCDï¼ŒNSOperationï¼ŒBlockã€‚<br>ä½ å¯ä»¥åœ¨æœ¬ç½‘ç«™ä¸Šå­¦ä¹ <a href="https://www.raywenderlich.com/115253/swift-2-tutorial-a-quick-start" target="_blank" rel="external">Swift</a> <a href="https://www.raywenderlich.com/115279/swift-2-tutorial-part-2-a-simple-ios-app" target="_blank" rel="external">2</a> <a href="https://www.raywenderlich.com/115300/swift-2-tutorial-part-3-tuples-protocols-delegates-and-table-views" target="_blank" rel="external">æ•™ç¨‹</a>ã€‚å¦‚æœä½ æƒ³å¤ä¹ ä¸€ä¸‹æˆ–è€…æ˜¯æ·±å…¥ç ”ç©¶è¿™äº›è¯é¢˜ï¼Œå»ºè®®æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://developer.apple.com/library/mac/documentation/Cocoa/Conceptual/CoreAnimation_guide/Introduction/Introduction.html" target="_blank" rel="external">Coreã€€Animation Programming Guide</a>ï¼Œ<a href="https://developer.apple.com/library/mac/documentation/GraphicsImaging/Conceptual/drawingwithquartz2d/Introduction/Introduction.html" target="_blank" rel="external">Quartz 2D Programming Guide</a>ã€‚ï¼·ï¼·ï¼¤ï¼£ï¼’ï¼ï¼‘ï¼’ä¸­æœ‰ä¸€ç¯‡<a href="https://developer.apple.com/videos/wwdc/2012/#238" target="_blank" rel="external">iOS App Performance: Graphics and Animations</a>æ˜¯å¦ä¸€ä¸ªæˆ‘å¼ºçƒˆæ¨èçš„ä¼˜ç§€çš„å­¦ä¹ èµ„æºï¼Œä½ å¯ä»¥å¤šçœ‹å‡ éç›¸ä¿¡æ¯æ¬¡éƒ½ä¼šæœ‰æ–°æ”¶è·çš„ã€‚</p>
<h2 id="å¼€å§‹"><a href="#å¼€å§‹" class="headerlink" title="å¼€å§‹"></a>å¼€å§‹</h2><p>åœ¨å¼€å§‹ä¹‹å‰ï¼Œå…ˆçœ‹ä¸€çœ¼AsyncDisplayKitçš„<a href="https://code.facebook.com/posts/721586784561674/introducing-asyncdisplaykit-for-smooth-and-responsive-apps-on-ios/" target="_blank" rel="external">å®˜æ–¹ä»‹ç»</a>ã€‚è¿™ä¼šè®©ä½ æœ‰ä¸€ä¸ªå¤§æ¦‚äº†è§£è¿™ä¸ªåº“æ˜¯ä»€ä¹ˆï¼Œè§£å†³äº†ç¥é©¬é—®é¢˜ã€‚</p>
<p>å‡†å¤‡å¥½äº†çš„è¯ï¼Œé¦–å…ˆä¸‹è½½<a href="http://www.raywenderlich.com/wp-content/uploads/2015/04/Layers-Start.zip" target="_blank" rel="external">åˆå§‹åŒ–å·¥ç¨‹</a>ã€‚ï¼ˆè¯‘è€…è¯´æ˜ï¼šä½œè€…æ˜¯åº”ç”¨Xcode6.3å’ŒiOS8.3SDKç¼–è¯‘çš„å·¥ç¨‹ï¼Œå¦‚æœä½ ç”¨æ›´æ–°çš„Xcodeç‰ˆæœ¬ï¼Œå¯èƒ½ä¼šæŠ¥é”™ï¼Œå¯¹åº”ä¿®æ”¹ä¸€ä¸‹Swiftæºç å³å¯ã€‚ï¼‰</p>
<p>æ³¨æ„ï¼šå†™è¿™ç¯‡æ•™ç¨‹çš„æ—¶å€™AsyncDisplayKitè¿˜åªæ˜¯1.0ç‰ˆæœ¬ï¼Œä¸”å·²ç»åŠ å…¥åˆ°å·¥ç¨‹ä¸­ã€‚</p>
<p>è¿™ä¸ªappé€šè¿‡UICollectionViewæ¥å±•ç¤ºä¸åŒçš„çƒ­å¸¦é›¨æ—åŠ¨ç‰©ã€‚æ¯ä¸€å¼ ä¿¡æ¯å¡ç‰‡åŒ…å«ä¸€ä¸ªçƒ­å¸¦é›¨æ—åŠ¨ç‰©çš„å›¾ç‰‡ï¼Œåå­—å’Œæè¿°ï¼Œå¡ç‰‡çš„èƒŒæ™¯æ˜¯æ¨¡ç³ŠåŒ–äº†çš„ç…§ç‰‡ã€‚è¿˜æœ‰ä¸€ä¸ªæ¸å˜æ˜¯ä¸ºäº†ä¿è¯æ–‡å­—æ›´åŠ æ¸…æ™°å¯è§ã€‚</p>
<p><img src="http://www.raywenderlich.com/wp-content/uploads/2014/11/iOS-Simulator-Screen-Shot-7-Nov-2014-21.10.03.png" alt=""> </p>
<p>æ‰“å¼€å·¥ç¨‹ï¼ŒæŒ‰ç…§ä»¥ä¸‹æŒ‡å¼•ä½ å°†ä¼šçœ‹åˆ°åº”ç”¨AsyncDisplayKitæ‰€å¸¦æ¥çš„æœ€æ¿€åŠ¨äººå¿ƒçš„ç›Šå¤„ã€‚</p>
<ul>
<li>æœ€å¥½åœ¨çœŸæœºä¸Šè¿è¡Œè¿™ä¸ªappï¼Œå› ä¸ºåœ¨æ¨¡æ‹Ÿå™¨ä¸Šå¾ˆéš¾çœ‹å‡ºæ¥æ€§èƒ½çš„æé«˜ã€‚</li>
<li>è¿™ä¸ªappè™½ç„¶æ˜¯é€šç”¨å„ä¸ªè®¾å¤‡ä¸Šçš„ï¼Œä½†æ˜¯æœ€å¥½è¿˜æ˜¯è·‘åœ¨iPadä¸Šã€‚</li>
<li>æœ€åï¼Œä¸ºäº†æ›´å®¹æ˜“æ„Ÿå—åˆ°è¿™ä¸ªåº“å¸¦æ¥çš„å˜åŒ–ï¼Œåœ¨ä¸€äº›æ¯”è¾ƒè€çš„è®¾å¤‡ä¸Šè¿è¡Œè¿™ä¸ªappï¼Œæ¯”å¦‚è¯´ç¬¬ä¸‰ä»£iPadã€‚</li>
</ul>
<p><img src="http://www.raywenderlich.com/wp-content/uploads/2014/10/IMG_0002.png" alt=""> </p>
<p>æ»‘åŠ¨è¿™ä¸ªcollection viewï¼Œæ³¨æ„é‚£å¯æ€œçš„å¸§ç‡ã€‚åœ¨ç¬¬ä¸‰ä»£iPadä¸Šï¼Œå·®ä¸å¤šä¹Ÿå°±æ˜¯15-20FPSã€‚å¾ˆæ˜æ˜¾ï¼Œcollection viewæ‰äº†å¾ˆå¤šå¸§ï¼Œåœ¨æœ¬ç¯‡æ•™ç¨‹çš„æœ€åï¼Œæ»‘åŠ¨æ—¶ä¼šæåº¦æ¥è¿‘60FPSã€‚</p>
<p>æ³¨æ„ï¼šä½ çœ‹åˆ°çš„æ‰€æœ‰å›¾ç‰‡éƒ½æ˜¯åœ¨æœ¬åœ°çš„ï¼Œè€Œæ²¡æœ‰é€šè¿‡ç½‘ç»œè·å–çš„ã€‚</p>
<h2 id="æµ‹é‡ååº”çµæ•åº¦"><a href="#æµ‹é‡ååº”çµæ•åº¦" class="headerlink" title="æµ‹é‡ååº”çµæ•åº¦"></a>æµ‹é‡ååº”çµæ•åº¦</h2><p>åœ¨åº”ç”¨AsyncDisplayKitåˆ°ä¸€ä¸ªå·²å­˜çš„å·¥ç¨‹ä¸­ä¹‹å‰ï¼Œä½ åº”è¯¥é€šè¿‡Instrumentsæ¥æµ‹é‡ä¸€ä¸‹UIçš„è¡¨ç°ã€‚è¿™æ ·ä¿®æ”¹äº†ä¹‹åæ‰å¥½æœ‰ä¸ªå¯¹æ¯”ã€‚</p>
<p>æœ€é‡è¦çš„æ˜¯ï¼Œä½ æƒ³è¦å‘ç°ä½ çš„åº”ç”¨æ˜¯CPUå—é™è¿˜æ˜¯GPUå—é™ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåˆ°åº•æ˜¯CPUè¿˜æ˜¯GPUé˜»ç¢äº†ä½ çš„appè¿è¡Œåœ¨ä¸€ä¸ªé«˜å¸§ç‡ä¸Šã€‚è¿™äº›ä¿¡æ¯èƒ½å‘Šè¯‰ä½ AsyncDisplayKitçš„å“ªäº›ç‰¹æ€§å¯ä»¥ç”¨æ¥ä¼˜åŒ–ä½ çš„appã€‚</p>
<p>ç»è¿‡æµ‹é‡ä½ ä¼šå‘ç°æ»‘åŠ¨æ€§èƒ½æ˜¯CPUå—é™çš„ã€‚ä½ èƒ½çŒœå‡ºåˆ°åº•æ˜¯ä»€ä¹ˆåŸå› å¯¼è‡´æ‰å¸§ä¹ˆï¼Ÿ<br>å°±æ˜¯å› ä¸ºå¯¹èƒŒæ™¯å›¾ç‰‡è¿›è¡Œæ¨¡ç³ŠåŒ–å¤„ç†é˜»å¡äº†ä¸»çº¿ç¨‹ä»è€Œå¯¼è‡´æ‰å¸§çš„ã€‚</p>
<h2 id="å‡†å¤‡åº”ç”¨AsyncDisplayKit"><a href="#å‡†å¤‡åº”ç”¨AsyncDisplayKit" class="headerlink" title="å‡†å¤‡åº”ç”¨AsyncDisplayKit"></a>å‡†å¤‡åº”ç”¨AsyncDisplayKit</h2><p>åº”ç”¨AsyncDisplayKitåˆ°ä¸€ä¸ªå·¥ç¨‹ä¸­å½’æ ¹ç»“åº•å°±æ˜¯ç”¨nodeå±‚çº§ç»“æ„ä»£æ›¿åŸæœ‰çš„viewå±‚çº§ç»“æ„æˆ–layeræ ‘ã€‚å±•ç¤ºnodeå°±æ˜¯AsyncDisplayKitåº“çš„å…³é”®ã€‚å®ƒä»¬ä½äºviewä¹‹ä¸Šï¼Œè€Œä¸”æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä¹Ÿå°±æ˜¯è¯´åŸæ¥åªèƒ½åœ¨ä¸»çº¿ç¨‹åšçš„äº‹æƒ…ç°åœ¨æœ‰ä¸€éƒ¨åˆ†å¯ä»¥ä¸åœ¨ä¸»çº¿ç¨‹åšäº†ã€‚è¿™æ ·ä½¿å¾—ä¸»çº¿ç¨‹æœ‰æ›´å¤šçš„ç²¾åŠ›èƒ½åº”å¯¹å…¶ä»–çš„æ“ä½œæ¯”å¦‚è¯´å¤„ç†è§¦æ‘¸äº‹ä»¶æˆ–è€…å¤„ç†collection viewçš„æ»šåŠ¨ã€‚</p>
<p>ä¹Ÿå°±æ˜¯æ‰€ç¬¬ä¸€æ­¥åº”è¯¥æ˜¯ç§»é™¤åŸæœ‰çš„viewå±‚çº§ç»“æ„ã€‚</p>
<p><strong>ç§»é™¤viewå±‚çº§ç»“æ„</strong></p>
<p>æ‰“å¼€RainforestCardCell.swiftæ–‡ä»¶ï¼Œåœ¨awakeFromNib()æ–¹æ³•ä¸­åˆ é™¤æ‰€æœ‰ addSubview(â€¦)ï¼Œå˜æˆè¿™æ ·ï¼š</p>
<p>override func awakeFromNib() {<br>super.awakeFromNib()<br>contentView.layer.borderColor = UIColor(hue: 0, saturation: 0, brightness: 0.85, alpha: 0.2).CGColor<br>contentView.layer.borderWidth = 1<br>}</p>
<p>ç„¶åä¿®æ”¹layoutSubviews()æ–¹æ³•ï¼š</p>
<p>override func layoutSubviews() {<br>super.layoutSubviews()<br>}</p>
<p>ä¿®æ”¹configureCellDisplayWithCardInfo(cardInfo:)æ–¹æ³•ï¼š</p>
<p>func configureCellDisplayWithCardInfo(cardInfo: RainforestCardInfo) {<br>//MARK: Image Size Section<br>let image = UIImage(named: cardInfo.imageName)!<br>featureImageSizeOptional = image.size<br>}</p>
<p>æ¥ç€å°†cellå…¶å®ƒå±æ€§åˆ é™¤æ‰ï¼Œåªç•™ä¸‹ä¸€ä¸ªï¼š</p>
<p>class RainforestCardCell: UICollectionViewCell {<br>var featureImageSizeOptional: CGSize?<br>â€¦<br>}</p>
<p>æœ€åï¼Œç¼–è¯‘è¿è¡Œä¸€ä¸‹ï¼Œä½ ä¼šçœ‹åˆ°ç¥é©¬éƒ½æ²¡æœ‰äº†ï¼š</p>
<p><img src="http://www.raywenderlich.com/wp-content/uploads/2014/10/IMG_0001.jpg" alt=""> </p>
<p>ç°åœ¨ï¼Œcelléƒ½ç©ºäº†ï¼Œå†æ»šåŠ¨çœŸçš„æ˜¯è¶…çº§æµç•…ã€‚ä½ çš„ç›®æ ‡å°±æ˜¯ç”¨nodeä»£æ›¿viewæ¥æ·»åŠ å†…å®¹ è€Œä»ç„¶ä¿æŒè¿™æ ·çš„æµç•…åº¦ã€‚</p>
<p>æœ€å¥½ç”¨Instrumentsçš„ Core Animationæ¥æ£€æµ‹æ¯ä¸€æ­¥ä¿®æ”¹ä¹‹åçš„appï¼Œè¿™æ ·èƒ½ç›´è§‚çš„æ„Ÿå—åˆ°ä¿®æ”¹å¯¹å¸§ç‡å¸¦æ¥çš„å½±å“ã€‚</p>
<p><strong>å¢åŠ ä¸€ä¸ªå ä½å†…å®¹</strong></p>
<p>åœ¨RainforestCardCellä¸­æ·»åŠ ä¸€ä¸ªCALayerç±»å‹çš„å˜é‡å‘½åä¸ºplaceholerlayerã€‚</p>
<p>class RainforestCardCell: UICollectionViewCell {<br>var featureImageSizeOptional: CGSize?<br>var placeholderLayer: CALayer!<br>â€¦<br>}</p>
<p>ä¹‹æ‰€ä»¥éœ€è¦ä¸€ä¸ªå ä½å±‚æ˜¯å› ä¸ºå±•ç¤ºå†…å®¹éœ€è¦å¼‚æ­¥è¿›è¡Œä¸€äº›å¤„ç†ï¼Œè€Œé‚£æ˜¯éœ€è¦ä¸€ç‚¹æ—¶é—´çš„ï¼Œå¦‚æœä¸åŠ ç”¨æˆ·é¦–å…ˆä¼šçœ‹åˆ°ä¸€å †ç©ºçš„cellï¼Œæ˜¾ç„¶ä¸æ˜¯é‚£ä¹ˆä»¤äººæ„‰æ‚¦ã€‚</p>
<p>åœ¨awakeFromNib()å’ŒlayoutSubviews()æ–¹æ³•ä¸­ï¼Œåˆ†åˆ«ä¿®æ”¹æˆä¸‹é¢çš„æ ·å­ï¼š</p>
<p>override func awakeFromNib() {<br>super.awakeFromNib()<br>placeholderLayer = CALayer()<br>placeholderLayer.contents = UIImage(named: â€œcardPlaceholderâ€)!.CGImage<br>placeholderLayer.contentsGravity = kCAGravityCenter<br>placeholderLayer.contentsScale = UIScreen.mainScreen().scale<br>placeholderLayer.backgroundColor = UIColor(hue: 0, saturation: 0, brightness: 0.85, alpha: 1).CGColor<br>contentView.layer.addSublayer(placeholderLayer)<br>}</p>
<p>override func layoutSubviews() {<br>super.layoutSubviews()<br>placeholderLayer?.frame = bounds<br>}</p>
<p>å†ç¼–è¯‘è¿è¡Œä¸€ä¸‹ï¼Œçœ‹çœ‹æ˜¯ä¸æ˜¯èˆ’æœå¤šäº†<br><img src="http://www.raywenderlich.com/wp-content/uploads/2014/10/IMG_0003.png" alt=""><br>æ²¡æœ‰UIViewåšæ”¯æŒçš„CALayerå½“æ”¹å˜frameæ—¶é»˜è®¤æ˜¯æœ‰éšå¼åŠ¨ç”»çš„ã€‚ä¸ºäº†ä¿®å¤ï¼Œå¯åšå‡ºå¦‚ä¸‹ä¿®æ”¹ï¼š<br>override func layoutSubviews() {<br>super.layoutSubviews()<br>CATransaction.begin()<br>CATransaction.setValue(kCFBooleanTrue, forKey: kCATransactionDisableActions)<br>placeholderLayer?.frame = bounds<br>CATransaction.commit()<br>}</p>
<p>ç¼–è¯‘è¿è¡Œä¸€ä¸‹çœ‹çœ‹æ˜¯ä¸æ˜¯è§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚ç°åœ¨å ä½å±‚ä¸å†æœ‰åŠ¨ç”»äº†ã€‚</p>
<h2 id="ä½ çš„ç¬¬ä¸€ä¸ªNode"><a href="#ä½ çš„ç¬¬ä¸€ä¸ªNode" class="headerlink" title="ä½ çš„ç¬¬ä¸€ä¸ªNode"></a>ä½ çš„ç¬¬ä¸€ä¸ªNode</h2><p>é‡æ„appçš„ç¬¬ä¸€æ­¥å°±æ˜¯åœ¨æ¯ä¸ªcellä¸­å¢åŠ ä¸€ä¸ªèƒŒæ™¯å›¾ç‰‡nodeã€‚åœ¨è¿™ä¸€å°èŠ‚ä¸­ï¼Œä½ å°†å­¦åˆ°ï¼š</p>
<ul>
<li>åˆ›å»ºï¼Œå¸ƒå±€ï¼Œå°†ä¸€ä¸ªå›¾åƒnodeæ·»åŠ åˆ°cellä¸Š</li>
<li>ç”¨nodeå’Œä»–ä»¬çš„layerå¤„ç†cellçš„é‡ç”¨</li>
<li>æ¨¡ç³Šå›¾åƒnode</li>
</ul>
<p>é¦–å…ˆæ‰“å¼€Layers-Bridging-Header.hå¯¼å…¥å¤´æ–‡ä»¶</p>
<p>#import <asyncdisplaykit asyncdisplaykit.h=""></asyncdisplaykit></p>
<p>è¿™æ ·ä½¿å¾—AsyncDisplayKitçš„ç±»åœ¨æ‰€æœ‰swiftæ–‡ä»¶ä¸­éƒ½å¯ç”¨äº†ã€‚</p>
<p>ç¼–è¯‘ä¸€ä¸‹ç¡®ä¿ä¸€åˆ‡æ­£å¸¸ã€‚</p>
<p><strong>Collection Viewç›¸å…³</strong></p>
<p>ç°åœ¨æ¥çœ‹ä¸€ä¸‹collectionviewç›¸å…³ç»„ä»¶ã€‚</p>
<ul>
<li>View Controllerï¼šRainforestViewControllerç±»ä»…ä»…æ˜¯å¾—åˆ°å†…å®¹æ•°ç»„ç„¶åå®ç°UICollectionViewå¿…è¦çš„datasourceæ–¹æ³•ï¼Œæ— éœ€èŠ±å¤ªå¤šæ—¶é—´è§‚çœ‹ã€‚</li>
<li>Data Sourceï¼šä½ å°†è¦èŠ±è´¹å¤§éƒ¨åˆ†æ—¶é—´åœ¨cellç±»ä¸Šé¢ï¼Œä¹Ÿå°±æ˜¯RainforestCardCellã€‚controlleré€šè¿‡è°ƒç”¨configureCellDisplayWithCardInfo(cardInfo:)æ–¹æ³•å°†äººå¸¦é›¨æ—å¡ç‰‡ä¿¡æ¯ä¼ ç»™cellã€‚ç„¶åcellç”¨è¿™äº›ä¿¡æ¯é…ç½®è‡ªèº«ã€‚</li>
<li>Cellï¼šåœ¨configureCellDisplayWithCardInfo(cardInfo:)æ–¹æ³•ä¸­ï¼Œcellåˆ›å»ºï¼Œé…ç½®ï¼Œå¸ƒå±€ï¼Œæ·»åŠ nodeåˆ°è‡ªèº«ä¹‹ä¸Šã€‚ä¹Ÿå°±æ˜¯è¯´æ¯å½“controllerä»é˜Ÿåˆ—ä¸­å–å‡ºä¸€ä¸ªcellï¼Œè¿™ä¸ªcellå°±ä¼šåˆ›å»ºå¹¶æ·»åŠ åˆ°è‡ªèº«ä¸Šä¸€ä¸ªæ–°çš„nodeå±‚çº§ç»“æ„ã€‚</li>
</ul>
<p>å¦‚æœä½ ä½¿ç”¨viewä»£æ›¿nodeï¼Œå‡ºäºæ€§èƒ½åŸå› çš„è€ƒè™‘è¿™å°±ä¸æ˜¯æœ€å¥½çš„ç­–ç•¥ã€‚å› ä¸ºä½ å¯ä»¥å¼‚æ­¥çš„åˆ›å»ºï¼Œé…ç½®ï¼Œå¸ƒå±€nodeï¼Œç”šè‡³å¯ä»¥å¼‚æ­¥ç»˜åˆ¶nodeï¼Œä»è€Œæ€§èƒ½ä¼šæå‡å¾ˆå¤šã€‚éš¾ç‚¹åœ¨äºå½“cellå‡†å¤‡é‡ç”¨æ—¶å¦‚ä½•å–æ¶ˆæ­£åœ¨å¼‚æ­¥è¿›è¡Œçš„æ´»åŠ¨ç„¶åç§»é™¤æ—§çš„nodeã€‚<br>æ³¨æ„ï¼šæœ¬æ•™ç¨‹ä¸­æ·»åŠ nodeåˆ°cellçš„è¿™ä¸ªç­–ç•¥è¿˜ç®—OKï¼Œè¿™å¯¹äºç²¾é€šAsyncDisplayKitæ¥è¯´æ˜¯ä¸ªå¥½çš„å¼€ç«¯ã€‚ç„¶è€Œï¼Œåœ¨å®é™…å¼€å‘ä¸­ï¼Œä½ æœ€å¥½ä½¿ç”¨ASRangeControlleræ¥ç¼“å­˜ä½ çš„nodeï¼Œè¿™æ ·ä½ å°±ä¸ç”¨æ¯å½“cellé‡ç”¨æ—¶éƒ½é‡å»ºå®ƒçš„nodeå±‚çº§ç»“æ„ã€‚ASRangeControllerè¶…å‡ºäº†æœ¬æ•™ç¨‹çš„èŒƒå›´ï¼Œå¯ä»¥çœ‹çœ‹ASRangeController.hæ–‡ä»¶ä¸­çš„æ³¨é‡Šäº†è§£æ›´å¤šã€‚<br>è¿˜æœ‰ä¸€ç‚¹ï¼š1.1ç‰ˆçš„AsyncDisplayKitåŒ…å«æœ‰ASCollectionViewç±»ã€‚ä½¿ç”¨ ASCollectionViewä¼šè®©æœ¬appä¸­çš„æ•´ä¸ªcollection viewéƒ½ç”±nodeæ¥å¤„ç†ã€‚è€Œåœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæ¯ä¸ªcelléƒ½ä¼šåŒ…å«ä¸€ä¸ªnodeå±‚çº§ç»“æ„ã€‚å¦‚ä¸Šé¢æ‰€è§£é‡Šçš„ï¼Œè¿™æ ·å¯ä»¥ï¼Œä½†å¦‚æœä½¿ç”¨æ•´ä¸ªcollection viewéƒ½åº”ç”¨nodeå°†ä¼šæ›´å¥½ã€‚å±Œçˆ†çš„ASCollectionView!<br>å¥½äº†ï¼Œä¸BBäº†ï¼Œå¼€å§‹å†™ä»£ç äº†ã€‚<br><strong>æ·»åŠ èƒŒæ™¯å›¾åƒNode</strong><br>ç°åœ¨ä½ è¦ç»å†ç”¨nodeé…ç½®celläº†ï¼Œä¸€æ­¥ä¸€æ­¥æ¥å°±å¥½ã€‚<br>æ‰“å¼€RainforestCardCell.swiftæ–‡ä»¶ï¼Œä¿®æ”¹configureCellDisplayWithCardInfo(cardInfo:)æ–¹æ³•ä¸ºï¼š<br>func configureCellDisplayWithCardInfo(cardInfo: RainforestCardInfo) {<br>//MARK: Image Size Section<br>let image = UIImage(named: cardInfo.imageName)!<br>featureImageSizeOptional = image.size</p>
<p>//MARK: Node Creation Section<br>let backgroundImageNode = ASImageNode()<br>backgroundImageNode.image = image<br>backgroundImageNode.contentMode = .ScaleAspectFill<br>}<br>è¿™æ ·å°±åˆ›å»ºå¹¶é…ç½®äº†ä¸€ä¸ªASImageNodeç±»å‹çš„å¸¸é‡ï¼Œåå­—æ˜¯backgroundImageNodeã€‚<br>æ³¨æ„ï¼šç¡®ä¿//MARK: æ³¨é‡Šéƒ¨åˆ†ä¹ŸåŒ…å«äº†ï¼Œè¿™æ ·æ›´å®¹æ˜“è·Ÿéšæœ¬æ•™ç¨‹ã€‚</p>
<p>AsyncDisplayKitåº“æœ‰å¥½å‡ ç§nodeç±»å‹ï¼Œæ¯”å¦‚è¯´ASImageNodeï¼Œå½“ä½ éœ€è¦æ˜¾ç¤ºå›¾ç‰‡æ—¶å¯ä»¥ç”¨å®ƒã€‚å®ƒåŸºæœ¬ç›¸å½“äº UIImageViewï¼Œé™¤äº†ASImageNodeé»˜è®¤æ˜¯å¼‚æ­¥åœ°è§£ç å›¾ç‰‡ã€‚<br>åœ¨ configureCellDisplayWithCardInfo(cardInfo:)æ–¹æ³•çš„æœ€åæ·»åŠ å¦‚ä¸‹ä¸€è¡Œï¼š</p>
<p>backgroundImageNode.layerBacked = true<br>è¿™æ ·ä¿è¯backgroundImageNodeæ˜¯ä¸€ä¸ªç”±layeråšæ”¯æŒï¼ˆlayer-backedï¼‰çš„nodeã€‚</p>
<p>Nodeç”±UIViewæˆ–è€…æ˜¯CALayerçš„å®ä¾‹åšæ”¯æŒéƒ½å¯ä»¥ã€‚å½“éœ€è¦èƒ½å¤Ÿå¤„ç†äº‹ä»¶ï¼ˆæ¯”å¦‚è¯´è§¦æ‘¸äº‹ä»¶ï¼‰æ—¶ï¼Œä½ å°±éœ€è¦ä¸€ä¸ªUIViewåšæ”¯æŒçš„nodeã€‚åä¹‹ï¼Œå¦‚æœä»…ä»…æ˜¯ç”¨äºå±•ç¤ºå†…å®¹ï¼Œç”¨layeråšæ”¯æŒçš„nodeå°±å¯ä»¥ï¼å®ƒä¼šæ›´åŠ è½»é‡çº§ï¼Œå› æ­¤åˆèƒ½è·å¾—å°å°çš„æ€§èƒ½æå‡ã€‚</p>
<p>å› ä¸ºæœ¬æ•™ç¨‹ä¸­çš„appä¸éœ€è¦å¤„ç†äº‹ä»¶ï¼Œæ‰€ä»¥ä½ å°†æ‰€æœ‰çš„nodeéƒ½è®¾ç½®ä¸ºç”±layeråšæ”¯æŒçš„å°±å¥½ã€‚åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œç”±äºbackgroundImageNodeæ˜¯ç”±layeråšæ”¯æŒçš„ï¼ŒAsyncDisplayKitä¼šä¸ºé›¨æ—åŠ¨ç‰©å›¾åƒçš„å†…å®¹åˆ›å»ºä¸€ä¸ª CALayerã€‚<br>åœ¨configureCellDisplayWithCardInfo(cardInfo:)æ–¹æ³•çš„æœ€ä¸‹é¢æ·»åŠ å¦‚ä¸‹ä»£ç ï¼š<br>//MARK: Node Layout Section<br>backgroundImageNode.frame = FrameCalculator.frameForContainer(featureImageSize: image.size)</p>
<p>è¿™é‡Œä½¿ç”¨FrameCalculatorä¸ºbackgroundImageNodeå¸ƒå±€ã€‚<br>FrameCalculatoræ˜¯ä¸€ä¸ªå¸®åŠ©ç±»ï¼Œé€šè¿‡è¿”å›æ¯ä¸ªnodeçš„frameåŒ…å«äº†cellçš„å¸ƒå±€ã€‚æ³¨æ„æ‰€æœ‰å†…å®¹éƒ½æ˜¯æ‰‹åŠ¨å¸ƒå±€çš„ï¼Œè€Œæ²¡æœ‰ä½¿ç”¨Auto Layoutåšçº¦æŸã€‚å¦‚æœä½ éœ€è¦æ„å»ºè‡ªé€‚åº”å¸ƒå±€æˆ–è€…æœ¬åœ°åŒ–é©±åŠ¨çš„å¸ƒå±€ï¼Œé‚£å°±è¦å°å¿ƒäº†ï¼Œå› ä¸ºä¸èƒ½ç»™nodeæ·»åŠ çº¦æŸã€‚<br>æ¥ä¸‹æ¥ï¼Œæ·»åŠ ä»£ç åˆ°configureCellDisplayWithCardInfo(cardInfo:)æ–¹æ³•åº•éƒ¨ï¼š<br>//MARK: Node Layer and Wrap Up Section<br>self.contentView.layer.addSublayer(backgroundImageNode.layer)</p>
<p>è¿™å°±å°†backgroundImageNodeçš„layeræ·»åŠ åˆ°cellçš„contentViewçš„layerä¸Šäº†ã€‚<br>æ³¨æ„ï¼ŒAsyncDisplayKitä¼šä¸ºbackgroundImageNodeåˆ›å»ºä¸€ä¸ªlayerã€‚ç„¶è€Œï¼Œä½ å¿…é¡»è¦å°†è¿™ä¸ªnodeæ”¾åˆ°ä¸€ä¸ª layer treeä¸­æ‰èƒ½åœ¨å±å¹•ä¸Šæ˜¾ç¤ºã€‚è¿™ä¸ªnodeå°†ä¼šè¢«å¼‚æ­¥ç»˜åˆ¶ï¼Œæ‰€ä»¥ç›´åˆ°ç»˜åˆ¶å®Œæˆï¼Œå®ƒçš„å†…å®¹éƒ½ä¸ä¼šæ˜¾ç¤ºï¼Œå³ä½¿å®ƒçš„layerå·²ç»åœ¨ä¸€ä¸ªlayeræ ‘ä¸­ã€‚<br>ä»æŠ€æœ¯è§’åº¦æ¥è¯´ï¼Œlayerä¸€ç›´éƒ½å­˜åœ¨ã€‚ä½†æ¸²æŸ“å›¾åƒæ˜¯å¼‚æ­¥è¿›è¡Œçš„ã€‚layerå¼€å§‹æ—¶å¹¶æ²¡æœ‰å†…å®¹ï¼ˆä¾‹å¦‚æ˜¯é€æ˜çš„ï¼‰ã€‚ä¸€æ—¦æ¸²æŸ“å®Œæˆï¼Œlayerçš„contentså°±ä¼šæ›´æ–°ä¸ºåŒ…å«å›¾åƒå†…å®¹ã€‚<br>æ­¤æ—¶æ­¤åˆ»ï¼Œcellçš„contentViewçš„layerä¼šåŒ…å«ä¸¤ä¸ªå­å±‚ï¼šå ä½å±‚å’Œnodeçš„layerã€‚åœ¨nodeå®Œæˆç»˜åˆ¶å‰ï¼Œåªæœ‰å ä½å›¾ä¼šæ˜¾ç¤ºã€‚<br>æ³¨æ„åˆ°configureCellDisplayWithCardInfo(cardInfo:)æ–¹æ³•æ¯å½“cellä»é˜Ÿåˆ—ä¸­è¢«å–å‡ºæ—¶éƒ½ä¼šè¢«è°ƒç”¨ã€‚æ¯æ¬¡cellè¢«å›æ”¶ï¼Œcellçš„contentViewçš„layeréƒ½ä¼šå¢åŠ ä¸€ä¸ªæ–°çš„å­å±‚ã€‚å…ˆä¸è¦æ‹…å¿ƒï¼Œå¾ˆå¿«ä¼šè§£å†³è¿™ä¸ªé—®é¢˜ã€‚<br>å›åˆ°RainforestCardCell.swiftçš„å¼€å¤´ï¼Œæ·»åŠ ä¸€ä¸ªASImageNodeç±»å‹çš„å˜é‡ï¼š<br>class RainforestCardCell: UICollectionViewCell {<br>var featureImageSizeOptional: CGSize?<br>var placeholderLayer: CALayer!<br>var backgroundImageNode: ASImageNode? ///&lt; ADD THIS LINE<br>â€¦<br>}</p>
<p>ä¹‹æ‰€ä»¥éœ€è¦è¿™ä¸ªå±æ€§æ˜¯å› ä¸ºå¿…é¡»è¦å°†backgroundImageNodeçš„å¼•ç”¨ä¿ç•™ä½ï¼Œå¦åˆ™ARCä¼šè‡ªåŠ¨å°†å…¶é‡Šæ”¾ï¼Œä¹Ÿå°±ä¸ä¼šæœ‰ä¸œè¥¿æ˜¾ç¤ºäº†ã€‚nodeè™½ç„¶ä¿ç•™äº†å®ƒä»¬è‡ªå·±çš„layerçš„å¼•ç”¨ï¼Œä½†æ˜¯åè¿‡æ¥layerå¹¶æ²¡æœ‰ä¿ç•™å®ƒä»¬ä»å±çš„nodeçš„å¼•ç”¨â€”â€”å› æ­¤å³ä½¿nodeçš„layerå·²ç»åœ¨ä¸€ä¸ªlayer treeä¸­ï¼Œä½ ä¾ç„¶éœ€è¦ä¿ç•™nodeã€‚<br>åœ¨configureCellDisplayWithCardInfo(cardInfo:)æ–¹æ³•åº•éƒ¨çš„Node Layer and Wrap Up Sectionçš„æœ€åï¼Œä¿®æ”¹å¦‚ä¸‹ï¼š<br>self.backgroundImageNode = backgroundImageNode<br>ä»¥ä¸‹æ˜¯configureCellDisplayWithCardInfo(cardInfo:)æ–¹æ³•çš„å®Œæ•´ç‰ˆï¼š<br>func configureCellDisplayWithCardInfo(cardInfo: RainforestCardInfo) {<br>//MARK: Image Size Section<br>let image = UIImage(named: cardInfo.imageName)!<br>featureImageSizeOptional = image.size</p>
<p>//MARK: Node Creation Section<br>let backgroundImageNode = ASImageNode()<br>backgroundImageNode.image = image<br>backgroundImageNode.contentMode = .ScaleAspectFill<br>backgroundImageNode.layerBacked = true</p>
<p>//MARK: Node Layout Section<br>backgroundImageNode.frame = FrameCalculator.frameForContainer(featureImageSize: image.size)</p>
<p>//MARK: Node Layer and Wrap Up Section<br>self.contentView.layer.addSublayer(backgroundImageNode.layer)<br>self.backgroundImageNode = backgroundImageNode<br>}<br>ç¼–è¯‘å¹¶è¿è¡Œï¼Œè§‚å¯ŸAsyncDisplayKitæ˜¯å¦‚ä½•å¼‚æ­¥åœ°ä½¿ç”¨å›¾åƒè®¾ç½®layerçš„contentsçš„ã€‚è¿™ä½¿å¾—ä½ èƒ½å¤Ÿå½“CPUåœ¨åå°ç»˜åˆ¶layerçš„å†…å®¹çš„åŒæ—¶æµç•…çš„æ»‘åŠ¨ç•Œé¢ã€‚<br><img src="http://www.raywenderlich.com/wp-content/uploads/2014/10/IMG_0006.png" alt=""><br>å¦‚æœä½ æ˜¯è¿è¡Œåœ¨æ—§è®¾å¤‡ä¸Šï¼Œæ³¨æ„å›¾åƒæ˜¯å¦‚ä½•å‡ºç°çš„â€”â€”è¿™æ˜¯çˆ†ç±³èŠ±ç‰¹æ•ˆï¼Œä½†ä¸æ€»æ˜¯å—æ¬¢è¿ï¼æœ¬æ•™ç¨‹çš„æœ€åä¸€èŠ‚ä¼šå»æ‰è¿™ä¸ªä¸ä»¤äººæ„‰å¿«çš„å¼¹å‡ºæ•ˆæœï¼Œæ›¿æ¢æˆè®©å›¾åƒéå¸¸å‹å¥½åœ°æ·¡å…¥ï¼Œéå¸¸é…·ã€‚<br>å¦‚ä¹‹å‰æ‰€è®¨è®ºçš„ï¼Œæ¯å½“cellè¢«é‡ç”¨æ—¶æ–°çš„nodeå°±ä¼šè¢«åˆ›å»ºã€‚è¿™å¹¶ä¸å¾ˆç†æƒ³å› ä¸ºè¿™æ„å‘³ç€æ¯å½“cellè¢«é‡ç”¨æ—¶å°±ä¼šå¢åŠ ä¸€ä¸ªlayerã€‚<br>å¦‚æœä½ æƒ³çœ‹çœ‹å­å±‚å †ç§¯å¤ªå¤šçš„ç»“æœï¼Œé‚£å°±å¤šä¸Šä¸‹æ»‘åŠ¨å‡ æ¬¡ï¼Œç„¶ååŠ ä¸ªæ–­ç‚¹æ‰“å°cellçš„contentViewçš„layerçš„sublayerså±æ€§ã€‚ä½ åº”è¯¥ä¼šçœ‹åˆ°å¾ˆå¤šlayerï¼Œè¿™å¹¶ä¸å¥½ã€‚<br><strong>å¤„ç†cellçš„é‡ç”¨</strong><br>è¿˜æ˜¯åœ¨cellç±»ä¸­ï¼Œæ·»åŠ ä¸€ä¸ªå«åšcontentLayerçš„CALayerç±»å‹çš„å˜é‡ã€‚æ³¨æ„æ˜¯å¯é€‰ç±»å‹ï¼š<br>class RainforestCardCell: UICollectionViewCell {<br>var featureImageSizeOptional: CGSize?<br>var placeholderLayer: CALayer!<br>var backgroundImageNode: ASImageNode?<br>var contentLayer: CALayer? ///&lt; ADD THIS LINE<br>â€¦<br>}<br>ä½ å°†ä½¿ç”¨è¿™ä¸ªå±æ€§ç§»é™¤cellçš„contentViewçš„layer treeä¸­æ—§çš„node layerã€‚è™½ç„¶ä½ ä¹Ÿå¯ä»¥ç®€å•çš„é€šè¿‡è®¿é—®nodeçš„layerå±æ€§æ¥è·å¾—ï¼Œä½†ä¸Šé¢çš„å†™æ³•æ›´æ¸…æ™°ã€‚<br>åœ¨configureCellDisplayWithCardInfo(cardInfo:)æ–¹æ³•æœ€åæ·»åŠ ä»£ç :<br>self.contentLayer = backgroundImageNode.layer<br>ç„¶åï¼Œä¿®æ”¹prepareForReuse()æ–¹æ³•ï¼š<br>override func prepareForReuse() {<br>super.prepareForReuse()<br>backgroundImageNode?.preventOrCancelDisplay = true<br>}<br>å› ä¸ºAsyncDisplayKitèƒ½å¤Ÿå¼‚æ­¥åœ°ç»˜åˆ¶nodeï¼Œæ‰€ä»¥ä½ èƒ½å¤Ÿé˜»æ­¢æœªå¼€å§‹çš„ç»˜åˆ¶ä¹Ÿèƒ½å¤Ÿå–æ¶ˆä»»ä½•åœ¨è¿›è¡Œä¸­çš„ç»˜åˆ¶ã€‚æ— è®ºæ˜¯ä½ éœ€è¦é˜»æ­¢è¿˜æ˜¯å–æ¶ˆç»˜åˆ¶ï¼Œå°†preventOrCancelDisplayå±æ€§è®¾ç½®ä¸ºtrueå³å¯ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œä½ è¦åœ¨cellè¢«é‡ç”¨å‰å–æ¶ˆä»»ä½•æ­£åœ¨è¿›è¡Œçš„ç»˜åˆ¶æ´»åŠ¨ã€‚<br>æ¥ä¸‹æ¥ï¼Œæ·»åŠ å¦‚ä¸‹ä»£ç åˆ°prepareForReuse()å°¾éƒ¨ï¼š<br>contentLayer?.removeFromSuperlayer()</p>
<p>è¿™å°±å°†contentLayerä»å…¶çˆ¶layerï¼ˆä¹Ÿå°±æ˜¯contentViewçš„layerï¼‰ä¸­ç§»é™¤äº†ã€‚</p>
<p>æ¯å½“ä¸€ä¸ªcellè¢«å›æ”¶ï¼Œä¸Šé¢ä»£ç å°±ç§»é™¤äº†æ—§çš„nodeçš„layerï¼Œå› è€Œè§£å†³äº†å †ç§¯é—®é¢˜ã€‚å› æ­¤åœ¨ä»»ä½•æ—¶é—´ï¼Œæœ€å¤šåªæœ‰ä¸¤ä¸ªå­layerï¼šå ä½å±‚å’Œ nodeçš„layerã€‚</p>
<p>ç»§ç»­æ·»åŠ å¦‚ä¸‹ä»£ç ï¼š</p>
<p>contentLayer = nil<br>backgroundImageNode = nil</p>
<p>è¿™ç¡®ä¿cellé‡Šæ”¾å®ƒä»¬çš„å¼•ç”¨ï¼Œè¿™æ ·ARCæ‰å¥½åšæ¸…ç†å·¥ä½œã€‚<br>ç¼–è¯‘å¹¶è¿è¡Œã€‚è¿™æ¬¡ï¼Œä¸ä¼šå†æœ‰layerå †ç§¯çš„é—®é¢˜ï¼Œä¸”æ‰€æœ‰ä¸å¿…è¦çš„ç»˜åˆ¶éƒ½ä¼šè¢«å–æ¶ˆã€‚<br><img src="http://www.raywenderlich.com/wp-content/uploads/2014/10/IMG_0006.png" alt=""></p>
<p>ç»ˆäºè¯¥åŠ ç‚¹å„¿æ¨¡ç³Šæ•ˆæœäº†ï¼Œå®è´ï¼Œæ˜¯æ¨¡ç³Šå‘€ã€‚</p>
<p><img src="http://www.raywenderlich.com/wp-content/uploads/2014/11/asyncscroll.png" alt=""></p>
<p><strong>æ¨¡ç³Šå›¾åƒ</strong></p>
<p>è¦æ¨¡ç³Šå›¾åƒï¼Œéœ€è¦æ·»åŠ ä¸€ä¸ªé¢å¤–çš„æ­¥éª¤åˆ°å›¾åƒnodeæ˜¾ç¤ºè¿‡ç¨‹ä¸­ã€‚<br>è¿˜æ˜¯åœ¨cellçš„configureCellDisplayWithCardInfo(cardInfo:)æ–¹æ³•ä¸­ï¼Œåœ¨è®¾ç½®backgroundImageNode.layerBackedçš„åé¢ï¼Œæ·»åŠ å¦‚ä¸‹ä»£ç ï¼š</p>
<p>backgroundImageNode.imageModificationBlock = { input in<br>if input == nil {<br>return input<br>}<br>if let blurredImage = input.applyBlurWithRadius(<br>30,<br>tintColor: UIColor(white: 0.5, alpha: 0.3),<br>saturationDeltaFactor: 1.8,<br>maskImage: nil,<br>didCancel:{ return false }) {<br>return blurredImage<br>} else {<br>return image<br>}<br>}</p>
<p>ASImageNodeçš„imageModificationBlockç»™äº†ä½ ä¸€ä¸ªåœ¨æ˜¾ç¤ºä¹‹å‰å»å¤„ç†åº•å±‚çš„å›¾åƒçš„æœºä¼šã€‚è¿™æ˜¯éå¸¸å®ç”¨çš„åŠŸèƒ½ã€‚<br>åœ¨ä¸Šé¢çš„ä»£ç é‡Œï¼Œä½ ä½¿ç”¨imageModificationBlockæ¥ä¸ºcellçš„èƒŒæ™¯å›¾åƒåº”ç”¨æ¨¡ç³Šæ•ˆæœã€‚å…³é”®ç‚¹åœ¨äºå›¾åƒnodeå°†ä¼šåœ¨åå°ç»˜åˆ¶å®ƒçš„å†…å®¹å¹¶æ‰§è¡Œè¿™ä¸ªé—­åŒ…ï¼Œè€Œä¸»çº¿ç¨‹ä¾ç„¶é¡ºæ»‘æµç•…ã€‚è¿™ä¸ªé—­åŒ…æ¥å—åŸå§‹çš„UIImageå¹¶è¿”å›ä¸€ä¸ªç»è¿‡å¤„ç†çš„UIImageã€‚<br>ä¸Šé¢çš„ä»£ç ä½¿ç”¨äº†UIImageçš„æ¨¡ç³Šcategoryï¼Œå®ƒç”±Appleåœ¨WWDC2013 æä¾›ï¼Œä½¿ç”¨äº†Accelerate frameworkåœ¨CPUä¸Šæ¨¡ç³Šå›¾åƒã€‚å› ä¸ºæ¨¡ç³Šä¼šæ¶ˆè€—å¾ˆå¤šæ—¶é—´å’Œå†…å­˜ï¼Œè¿™ä¸ªç‰ˆæœ¬çš„categoryè¢«ä¿®æ”¹ä¸ºåŒ…å«äº†å–æ¶ˆæœºåˆ¶ã€‚è¿™ä¸ªæ¨¡ç³Šæ–¹æ³•ä¼šå®šæœŸè°ƒç”¨didCancelé—­åŒ…æ¥å†³å®šæ˜¯å¦åº”è¯¥è¦åœæ­¢æ¨¡ç³Šã€‚<br>æš‚æ—¶ï¼Œä¸Šé¢çš„ä»£ç ç»™didCancelç®€å•åœ°è¿”å›falseï¼Œç¨åä¼šä¿®æ”¹ã€‚</p>
<p>æ³¨æ„ï¼šè¿˜è®°å¾—ç¬¬ä¸€æ¬¡è¿è¡Œappæ—¶collection viewé‚£å¯æ€œçš„æ»‘åŠ¨æ•ˆæœå—ï¼Ÿå°±æ˜¯åº”ä¸ºæ¨¡ç³Šæ–¹æ³•é˜»å¡äº†ä¸»çº¿ç¨‹ã€‚é€šè¿‡ä½¿ç”¨AsyncDisplayKitå°†æ¨¡ç³Šæ”¾å…¥åå°ï¼Œèƒ½æ˜¾è‘—æé«˜collection viewçš„æ»‘åŠ¨æ€§èƒ½ã€‚ç®€ç›´å¤©å£¤ä¹‹åˆ«ã€‚</p>
<p>ç¼–è¯‘å¹¶è¿è¡Œï¼Œè§‚å¯Ÿæ¨¡ç³Šæ•ˆæœï¼š</p>
<p><img src="http://www.raywenderlich.com/wp-content/uploads/2014/10/IMG_0009.png" alt=""></p>
<p>æ„Ÿå—ä¸‹æ­¤æ—¶æ»‘åŠ¨collection viewæœ‰å¤šæµç•…ã€‚<br>å½“collection viewä»é˜Ÿåˆ—ä¸­å–å‡ºä¸€ä¸ªcellæ—¶ï¼Œä¸€ä¸ªæ¨¡ç³Šæ“ä½œå°†åœ¨åå°çº¿ç¨‹å¼€å§‹ã€‚å½“ç”¨æˆ·å¿«é€Ÿæ»‘åŠ¨æ—¶ï¼Œcollection viewä¼šé‡ç”¨æ¯ä¸ªcellå¾ˆå¤šæ¬¡ï¼ŒåŒæ—¶ä¼šå¼€å§‹è®¸å¤šæ¨¡ç³Šæ“ä½œã€‚æˆ‘ä»¬çš„ç›®æ ‡æ˜¯åœ¨cellå‡†å¤‡è¢«é‡ç”¨æ—¶å–æ¶ˆæ­£åœ¨è¿›è¡Œä¸­çš„æ¨¡ç³Šæ“ä½œã€‚<br>ä½ å·²ç»åœ¨prepareForReuse()é‡Œå–æ¶ˆäº†nodeçš„ç»˜åˆ¶ï¼Œä½†ä¸€æ—¦æ§åˆ¶æƒè¢«ç§»äº¤ç»™å¤„ç†å›¾åƒä¿®æ”¹çš„é—­åŒ…ï¼Œä½ è¿˜éœ€è¦å“åº”nodeçš„preventOrCancelDisplayä¿¡å·ã€‚</p>
<p><strong>å–æ¶ˆæ¨¡ç³Š</strong></p>
<p>ä¸ºäº†å–æ¶ˆè¿›è¡Œä¸­çš„æ¨¡ç³Šæ“ä½œï¼Œä½ éœ€è¦å®ç°æ¨¡ç³Šæ–¹æ³•çš„didCancelé—­åŒ…ã€‚<br>æ·»åŠ ä¸€ä¸ªæ•æ‰åˆ—è¡¨åˆ°imageModificationBlockä»¥æ•æ‰ä¸€ä¸ªbackgroundImageNodeçš„å¼±å¼•ç”¨ï¼š<br>backgroundImageNode.imageModificationBlock = { [weak backgroundImageNode] input in<br>â€¦<br>}</p>
<p>ç”¨å¼±å¼•ç”¨æ˜¯ä¸ºäº†é¿å…å¾ªç¯å¼•ç”¨ã€‚ä¿®æ”¹imageModificationBlockå¦‚ä¸‹ï¼š</p>
<p>backgroundImageNode.imageModificationBlock = { [weak backgroundImageNode] input in<br>if input == nil {<br>return input<br>}<br>// ADD FROM HEREâ€¦<br>let didCancelBlur: () -&gt; Bool = {<br>var isCancelled = true<br>// 1<br>if let strongBackgroundImageNode = backgroundImageNode {<br>// 2<br>let isCancelledClosure = {<br>isCancelled = strongBackgroundImageNode.preventOrCancelDisplay<br>}<br>// 3<br>if NSThread.isMainThread() {<br>isCancelledClosure()<br>} else {<br>dispatch_sync(dispatch_get_main_queue(), isCancelledClosure)<br>}<br>}<br>return isCancelled<br>}<br>// â€¦TO HERE<br>â€¦<br>}</p>
<p>ç¨å¾®è§£é‡Šä¸€ä¸‹ï¼š</p>
<ol>
<li>è·å¾—ä¸€ä¸ªå¯¹backgroundImageNodeçš„å¼ºå¼•ç”¨ã€‚å¦‚æœæ­¤å¤„ä»£ç æ‰§è¡Œæ—¶backgroundImageNodeå·²ç»ä¸ºç©ºï¼Œé‚£ä¹ˆisCancelledå°†ä¿æŒä¸ºtrueï¼Œç„¶åæ¨¡ç³Šæ“ä½œå°†ä¼šè¢«å–æ¶ˆã€‚å¦‚æœæ²¡æœ‰nodeéœ€è¦æ˜¾ç¤ºæ—¶ï¼Œè‡ªç„¶æ²¡æœ‰å¿…è¦ç»§ç»­è¿›è¡Œæ¨¡ç³Šæ“ä½œã€‚</li>
<li>ä¹‹æ‰€ä»¥ä¼šå°†å–æ¶ˆæ£€æŸ¥åŒ…åœ¨é—­åŒ…é‡Œæ˜¯å› ä¸ºä¸€æ—¦nodeåˆ›å»ºäº†å®ƒçš„layeræˆ–viewï¼Œä»¥åå°±åªèƒ½åœ¨ä¸»çº¿ç¨‹è®¿é—®nodeçš„å±æ€§ã€‚ç”±äºä½ éœ€è¦è®¿é—®preventOrCancelDisplayï¼Œæ‰€ä»¥å¿…é¡»åœ¨ä¸»çº¿ç¨‹ä¸­æ£€æŸ¥ã€‚</li>
<li>æœ€åï¼Œç¡®ä¿isCancelledClosureæ˜¯åœ¨ä¸»çº¿ç¨‹è¢«è°ƒç”¨ï¼Œåœ¨didCancelBluré—­åŒ…è¿”å›ä¹‹å‰è®¾ç½®å¥½isCancelledã€‚ </li>
</ol>
<p>åœ¨è°ƒç”¨applyBlurWithRadius(â€¦)æ–¹æ³•å¤„ï¼Œä¿®æ”¹ä¼ é€’ç»™didCancelçš„å‚æ•°ï¼š</p>
<p>if let blurredImage = input.applyBlurWithRadius(<br>30,<br>tintColor: UIColor(white: 0.5, alpha: 0.3),<br>saturationDeltaFactor: 1.8,<br>maskImage: nil,<br>didCancel: didCancelBlur) {<br>â€¦<br>}</p>
<p>ç¼–è¯‘å¹¶è¿è¡Œï¼Œä½ å¯èƒ½æ²¡æœ‰æ³¨æ„åˆ°æœ‰å¤šå¤§å·®åˆ«ï¼Œä½†ç°åœ¨ä»»ä½•åœ¨cellç¦»å¼€å±å¹•æ—¶è¿˜æœªå®Œæˆçš„æ¨¡ç³Šéƒ½ä¼šè¢«å–æ¶ˆäº†ã€‚è¿™å°±æ„å‘³ç€è®¾å¤‡æ¯”ä¹‹å‰åšå¾—æ›´å°‘äº†ã€‚ä½ å¯èƒ½è§‚å¯Ÿåˆ°è½»å¾®çš„æ€§èƒ½æå‡ï¼Œç‰¹åˆ«æ˜¯åœ¨è¾ƒæ…¢çš„è®¾å¤‡å¦‚ç¬¬ä¸‰ä»£iPadä¸Šè¿è¡Œæ—¶ã€‚</p>
<p><img src="http://www.raywenderlich.com/wp-content/uploads/2014/10/IMG_0009.png" alt=""></p>
<p>å½“ç„¶äº†ï¼Œè‹¥æ²¡æœ‰ä¸œè¥¿åœ¨å‰é¢ï¼Œä¹Ÿå°±è°ˆä¸ä¸Šä»€ä¹ˆèƒŒæ™¯ã€‚ä½ çš„å¡ç‰‡éœ€è¦å†…å®¹ã€‚é€šè¿‡ä¸‹é¢å››ä¸ªå°èŠ‚ï¼Œä½ å°†å­¦ä¼šï¼š</p>
<ul>
<li><p>åˆ›å»ºä¸€ä¸ªä¼šå°†æ‰€æœ‰çš„å­nodeç»˜åˆ¶åˆ°ä¸€ä¸ªå•ç‹¬çš„CALayeré‡Œçš„å®¹å™¨nodeï¼›</p>
</li>
<li><p>æ„å»ºä¸€ä¸ªnodeå±‚çº§ç»“æ„ï¼›</p>
</li>
<li><p>åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„ASDisplayNodeå­ç±»ï¼›</p>
</li>
<li><p>åœ¨åå°æ„å»ºå¹¶å¸ƒå±€nodeå±‚çº§ç»“æ„ã€‚</p>
</li>
</ul>
<p>æ‰€æœ‰è¿™äº›åšå®Œåï¼Œä½ å°±ä¼šå¾—åˆ°ä¸€ä¸ªçœ‹èµ·æ¥å’Œåº”ç”¨AsyncDisplayKitä¹‹å‰ä¸€æ ·çš„appï¼Œç„¶è€Œå´æœ‰ç€é»„æ²¹èˆ¬é¡ºæ»‘çš„æ»‘åŠ¨ä½“éªŒã€‚</p>
<h2 id="Rasterizedå®¹å™¨Node"><a href="#Rasterizedå®¹å™¨Node" class="headerlink" title="Rasterizedå®¹å™¨Node"></a>Rasterizedå®¹å™¨Node</h2><p>æˆªæ­¢ç›®å‰ï¼Œä½ ä¸€ç›´åœ¨æ“ä½œcellå†…çš„ä¸€ä¸ªå•ç‹¬çš„nodeã€‚æ¥ä¸‹æ¥ï¼Œä½ å°†åˆ›å»ºä¸€ä¸ªå®¹å™¨nodeï¼Œå®ƒä¼šåŒ…å«æ‰€æœ‰çš„å¡ç‰‡å†…å®¹ã€‚</p>
<p><strong>å¢åŠ å®¹å™¨Node</strong>  </p>
<p>åœ¨configureCellDisplayWithCardInfo(cardInfo:)æ–¹æ³•ä¸­ï¼Œåœ¨Node Layout Sectionä¹‹å‰backgroundImageNode.imageModificationBlockä¹‹åï¼Œå¢åŠ å¦‚ä¸‹ä»£ç ï¼š</p>
<p>//MARK: Container Node Creation Section<br>let containerNode = ASDisplayNode()<br>containerNode.layerBacked = true<br>containerNode.shouldRasterizeDescendants = true<br>containerNode.borderColor = UIColor(hue: 0, saturation: 0, brightness: 0.85, alpha: 0.2).CGColor<br>containerNode.borderWidth = 1</p>
<p>è¿™å°±åˆ›å»ºå¹¶é…ç½®äº†ä¸€ä¸ªå«åšcontainerNodeçš„ASDisplayNodeå¸¸é‡ã€‚æ³¨æ„è¿™ä¸ªå®¹å™¨çš„shouldRasterizeDescendantså±æ€§ï¼Œè¿™æ˜¯ä¸€ä¸ªå…³äºnodeå¦‚ä½•å·¥ä½œçš„æš—ç¤ºä»¥åŠä¸€ä¸ªä½¿å®ƒä»¬å·¥ä½œå¾—æ›´å¥½åœ°æœºä¼šã€‚<br>æ­£å¦‚å•è¯ â€œdescendantsï¼ˆå­å­™ï¼‰â€ æ‰€æš—ç¤ºçš„ï¼Œä½ å¯ä»¥åˆ›å»ºAsyncDisplayKit Nodeçš„å±‚çº§ç»“æ„æˆ–æ ‘ï¼Œå°±å¦‚ä½ å¯ä»¥åˆ›å»ºCore Animation Layerçš„å±‚çº§ç»“æ„ä¸€æ ·ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœä½ æœ‰ä¸€ä¸ªéƒ½æ˜¯ç”±Layeræ”¯æŒçš„nodeçš„å±‚çº§ç»“æ„ï¼Œé‚£ä¹ˆAsyncDisplayKitå°†ä¼šä¸ºæ¯ä¸ªnodeåˆ›å»ºä¸€ä¸ªå•ç‹¬çš„CALayerï¼Œlayerå±‚çº§ç»“æ„ä¼šæ˜ å°„nodeå±‚æ¬¡ç»“æ„ã€‚<br>è¿™å¬èµ·æ¥å¾ˆç†Ÿæ‚‰ï¼šå®ƒç±»ä¼¼äºå½“ä½ ä½¿ç”¨æ™®é€šçš„UIKitæ—¶ï¼Œlayerå±‚çº§ç»“æ„ä¼šæ˜ å°„viewå±‚æ¬¡ç»“æ„ã€‚ç„¶è€Œï¼Œè¿™ä¸ªlayerçš„æ ˆæœ‰ä¸€äº›ä¸åŒçš„ç»“æœï¼š</p>
<ul>
<li>é¦–å…ˆï¼Œå› ä¸ºæ˜¯å¼‚æ­¥æ¸²æŸ“ï¼Œä½ ä¼šçœ‹åˆ°layeré€ä¸ªæ˜¾ç¤ºã€‚å½“AsyncDisplayKitç»˜åˆ¶å®Œæˆä¸€ä¸ªlayerï¼Œå®ƒä¼šç«‹åˆ»åˆ¶ä½œlayerçš„æ˜¾ç¤ºå†…å®¹ã€‚æ‰€ä»¥å¦‚æœä½ æœ‰ä¸€ä¸ªlayerçš„ç»˜åˆ¶æ¯”å…¶ä»– layerè€—æ—¶æ›´é•¿ï¼Œé‚£ä¹ˆå®ƒå°†ä¼šåœ¨å®ƒä»¬ä¹‹åæ˜¾ç¤ºã€‚ç”¨æˆ·ä¼šçœ‹åˆ°é›¶ç¢çš„layerç»„ä»¶ï¼Œè¿™ä¸ªè¿‡ç¨‹é€šå¸¸æ˜¯ä¸å¯è§çš„ï¼Œå› ä¸ºCore Animationä¼šåœ¨æ˜¾ç¤ºä»»ä½•ä¸œè¥¿ä¹‹å‰çš„runloopä¸­é‡ç»˜æ‰€æœ‰å¿…é¡»çš„ layerã€‚</li>
<li>ç¬¬äºŒï¼Œlayerå¤ªå¤šäº†ä»¥åå¯èƒ½ä¼šå¼•èµ·æ€§èƒ½é—®é¢˜ã€‚æ¯ä¸ªCALayeréƒ½éœ€è¦ä¸€å—å†…å­˜æ¥å­˜å‚¨å®ƒçš„åƒç´ ä½å›¾å’Œå†…å®¹ã€‚åŒæ ·ï¼ŒCore Animationå¿…é¡»é€šè¿‡XPCå°†æ¯ä¸ªlayerå‘ç»™æ¸²æŸ“æœåŠ¡å™¨ã€‚æœ€åï¼Œæ¸²æŸ“æœåŠ¡å™¨å¯èƒ½éœ€è¦é‡ç»˜ä¸€äº›layerä»¥å¤åˆå®ƒä»¬ï¼Œä¾‹å¦‚å½“æ··åˆlayeræ—¶ã€‚é€šå¸¸æ¥è¯´ï¼Œæ›´å¤šçš„layeræ„å‘³ç€Core Animationæ›´å¤šçš„å·¥ä½œã€‚æ‰€ä»¥é™åˆ¶layerçš„ä½¿ç”¨æ•°é‡æœ‰è®¸å¤šå¥½å¤„ã€‚</li>
</ul>
<p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒAsyncDisplayKitæœ‰ä¸€ä¸ªæ–¹ä¾¿çš„ç‰¹æ€§ï¼šå®ƒå…è®¸ä½ ç»˜åˆ¶ä¸€ä¸ªnodeå±‚çº§ç»“æ„åˆ°ä¸€ä¸ªå•ç‹¬çš„layerå®¹å™¨ä¸­ã€‚è¿™å°±æ˜¯shouldRasterizeDescendantsæ‰€åšçš„ã€‚å½“ä½ è®¾ç½®äº†è¿™ä¸ªï¼Œé‚£ä¹ˆåœ¨å®Œæˆæ‰€æœ‰çš„Subnodeçš„ç»˜åˆ¶ä¹‹å‰ï¼ŒASDisplayNodeå°†ä¸ä¼šè®¾ç½®layerçš„contentsã€‚<br>æ‰€ä»¥åœ¨ä¹‹å‰çš„æ­¥éª¤é‡Œï¼Œè®¾ç½®å®¹å™¨nodeçš„shouldRasterizeDescendantsä¸ºtrueæœ‰ä¸¤ä¸ªå¥½å¤„ï¼š</p>
<ul>
<li>å®ƒç¡®ä¿å¡ç‰‡ä¸€æ¬¡æ˜¾ç¤ºæ‰€æœ‰çš„nodeï¼Œå°±å¦‚åŒæ—§çš„åŒæ­¥ç»˜åˆ¶ï¼›</li>
<li>è€Œä¸”å®ƒé€šè¿‡å…‰æ …åŒ–layeræ ˆåˆ°ä¸€ä¸ªå•ç‹¬çš„layerå¹¶æœ€å°åŒ–æœªæ¥çš„åˆæˆæ¶ˆè€—è€Œæé«˜äº†æ•ˆç‡ã€‚</li>
</ul>
<p>å”¯ä¸€çš„ç¼ºç‚¹æ˜¯ï¼Œç”±äºä½ å°†æ‰€æœ‰çš„layeræ”¾å…¥ä¸€ä¸ªä½å›¾ï¼Œä½ å°±ä¸èƒ½åœ¨ä¹‹åå•ç‹¬ç»™æŸä¸€ä¸ªnodeåŠ åŠ¨ç”»äº†ã€‚</p>
<p>è¦äº†è§£æ›´å¤šï¼Œè¯·çœ‹shouldRasterizeDescendantsåœ¨å¤´æ–‡ä»¶ ASDisplayNode.hé‡Œçš„æ³¨é‡Šã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œåœ¨Container Node Creation Sectionä¹‹åï¼Œä¿®æ”¹ä»£ç ï¼š<br>//MARK: Node Hierarchy Section<br>containerNode.addSubnode(backgroundImageNode)</p>
<p>æ³¨æ„ï¼šæ·»åŠ nodeçš„é¡ºåºå¾ˆé‡è¦ï¼Œå°±å¦‚åŒsubviewå’Œsublayerã€‚æœ€å…ˆæ·»åŠ çš„nodeä¼šåœ¨ä¹‹åæ·»åŠ çš„åé¢æ˜¾ç¤ºã€‚</p>
<p>ä¿®æ”¹Node Layout Sectionçš„ç¬¬ä¸€è¡Œï¼š</p>
<p>//MARK: Node Layout Section<br>containerNode.frame = FrameCalculator.frameForContainer(featureImageSize: image.size)</p>
<p>æœ€åï¼Œç”¨FrameCalculatorå¸ƒå±€backgroundImageNodeï¼š</p>
<p>backgroundImageNode.frame = FrameCalculator.frameForBackgroundImage(containerBounds: containerNode.bounds)</p>
<p>è¿™æ ·å°±è®¾ç½®backgroundImageNodeå……æ»¡æ•´ä¸ªcontainerNodeã€‚</p>
<p>ä½ å‡ ä¹å®Œæˆäº†æ–°çš„nodeå±‚çº§ç»“æ„ï¼Œä½†å› ä¸ºç°åœ¨å®¹å™¨nodeæ˜¯å®¹å™¨äº†æ‰€ä»¥é¦–å…ˆä½ éœ€è¦æ­£ç¡®åœ°è®¾ç½®layerçš„å±‚çº§ç»“æ„ã€‚</p>
<p><strong>ç®¡ç†å®¹å™¨Nodeçš„å±‚</strong></p>
<p>åœ¨Node Layer and Wrap Up Sectionéƒ¨åˆ†ï¼Œä¿®æ”¹å¦‚ä¸‹ï¼š</p>
<p>// Replace the following lineâ€¦<br>// self.contentView.layer.addSublayer(backgroundImageNode.layer)<br>// â€¦with this line:<br>self.contentView.layer.addSublayer(containerNode.layer)</p>
<p>åˆ é™¤ä¸‹é¢backgroundImageNodeå±æ€§çš„å¼•ç”¨ï¼š</p>
<p>self.backgroundImageNode = backgroundImageNode</p>
<p>å› ä¸ºç°åœ¨cellä»…ä»…éœ€è¦ä¿ç•™ä¸€ä¸ªå®¹å™¨nodeçš„å¼•ç”¨ï¼Œæ‰€ä»¥ä¿®æ”¹å¦‚ä¸‹ï¼š</p>
<p>// Replace the following lineâ€¦<br>// self.contentLayer = backgroundImageNode.layer<br>// â€¦with this line:<br>self.contentLayer = containerNode.layer    </p>
<p>å¢åŠ ä¸€ä¸ªå¯é€‰çš„ASDisplayNodeç±»å‹å˜é‡å‘½åä¸ºcontainerNodeï¼š</p>
<p>class RainforestCardCell: UICollectionViewCell {<br>var featureImageSizeOptional: CGSize?<br>var placeholderLayer: CALayer!<br>var backgroundImageNode: ASImageNode?<br>var contentLayer: CALayer?<br>var containerNode: ASDisplayNode? ///&lt; ADD THIS LINE<br>â€¦<br>}</p>
<p>è®°ä½ä½ éœ€è¦ä¿ç•™ä½ è‡ªå·±çš„nodeï¼Œå¦åˆ™å®ƒä»¬ä¼šç«‹å³è¢«é‡Šæ”¾ã€‚</p>
<p>å›åˆ°configureCellDisplayWithCardInfo(cardInfo:)æ–¹æ³•ï¼Œåœ¨Node Layer and Wrap Up Sectionçš„æœ€åï¼Œåšä¸€ä¸ªèµ‹å€¼ï¼š</p>
<p>self.containerNode = containerNode</p>
<p>ç¼–è¯‘å¹¶è¿è¡Œï¼Œæ¨¡ç³Šçš„å›¾åƒå°†ä¼šå†æ­¤æ˜¾ç¤ºï¼ä½†è¿˜æœ‰æœ€åä¸€ä»¶äº‹è¦å»æ”¹å˜ï¼Œå› ä¸ºç°åœ¨æœ‰äº†æ–°çš„nodeå±‚çº§ç»“æ„ã€‚å›å¿†ä¹‹å‰cellé‡ç”¨æ—¶ä½ æ§åˆ¶å›¾åƒnodeåœæ­¢æ˜¾ç¤ºã€‚ç°åœ¨ä½ éœ€è¦è®©æ•´ä¸ª nodeå±‚çº§ç»“æ„éƒ½åœæ­¢æ˜¾ç¤ºã€‚</p>
<p><strong>ç”¨æ–°çš„Nodeå±‚çº§ç»“æ„å¤„ç†cellé‡ç”¨</strong></p>
<p>åœ¨prepareForReuse()æ–¹æ³•ä¸­ï¼Œä¿®æ”¹å¦‚ä¸‹ï¼š</p>
<p>override func prepareForReuse() {<br>super.prepareForReuse()</p>
<p>// Replace this lineâ€¦<br>// backgroundImageNode?.preventOrCancelDisplay = true<br>// â€¦with this line:<br>containerNode?.recursiveSetPreventOrCancelDisplay(true)</p>
<p>contentLayer?.removeFromSuperlayer()<br>â€¦<br>}</p>
<p>å½“ä½ éœ€è¦å–æ¶ˆä¸€æ•´ä¸ªnodeå±‚æ¬¡ç»“æ„çš„ç»˜åˆ¶æ—¶ç”¨recursiveSetPreventOrCancelDisplay()ï¼Œè¿™ä¸ªæ–¹æ³•å°†ä¼šç»™å½“å‰nodeä»¥åŠå®ƒæ‰€æœ‰çš„å­nodeè®¾ç½®preventOrCancelDisplayå€¼ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œç»§ç»­ä¿®æ”¹ï¼š</p>
<p>override func prepareForReuse() {<br>â€¦<br>contentLayer = nil</p>
<p>// Replace this lineâ€¦<br>// backgroundImageNode = nil<br>// â€¦with this line:<br>containerNode = nil<br>}</p>
<p>åˆ é™¤backgroundImageNodeå±æ€§ï¼š</p>
<p>class RainforestCardCell: UICollectionViewCell {<br>var featureImageSizeOptional: CGSize?<br>var placeholderLayer: CALayer!<br>// var backgroundImageNode: ASImageNode? ///&lt; REMOVE THIS LINE<br>var contentLayer: CALayer?<br>var containerNode: ASDisplayNode?<br>â€¦<br>}<br>ç¼–è¯‘å¹¶è¿è¡Œï¼Œappå‘ˆç°å¦‚ä¹‹å‰ä¸€æ ·ï¼Œä½†ç°åœ¨ä½ çš„å›¾åƒnodeåœ¨å®¹å™¨nodeä¸­ï¼Œè€Œé‡ç”¨ä¾ç„¶å’Œå®ƒåº”æœ‰çš„æ–¹å¼ä¸€æ ·ã€‚</p>
<p><img src="http://www.raywenderlich.com/wp-content/uploads/2014/10/IMG_0009.png" alt=""></p>
<h2 id="cellçš„å†…å®¹"><a href="#cellçš„å†…å®¹" class="headerlink" title="cellçš„å†…å®¹"></a>cellçš„å†…å®¹</h2><p>ç›®å‰ä¸ºæ­¢ä½ æœ‰äº†ä¸€ä¸ªnodeå±‚çº§ç»“æ„ï¼Œä½†å®¹å™¨å†…è¿˜åªæœ‰ä¸€ä¸ªnodeâ€”â€”å›¾åƒnodeã€‚ç°åœ¨æ˜¯æ—¶å€™è®¾ç½®nodeå±‚çº§ç»“æ„å»å¤åˆ¶åœ¨æ·»åŠ AsyncDisplayKitä¹‹å‰æ—¶åº”ç”¨çš„è§†å›¾å±‚çº§ç»“æ„äº†ã€‚è¿™æ„å‘³ç€æ·»åŠ textå’Œä¸€ä¸ªæœªæ¨¡ç³Šçš„ç‰¹å¾å›¾åƒã€‚</p>
<p><strong>å¢åŠ ç‰¹å¾å›¾åƒ</strong><br>è¦æ·»åŠ ç‰¹å¾å›¾åƒäº†ï¼Œå®ƒæ˜¯ä¸€ä¸ªæœªæ¨¡ç³Šçš„å›¾åƒï¼Œæ˜¾ç¤ºåœ¨å¡ç‰‡çš„é¡¶éƒ¨ã€‚<br>æ‰“å¼€cellæ–‡ä»¶å¹¶æ‰¾åˆ°configureCellDisplayWithCardInfo(cardInfo:)æ–¹æ³•ï¼Œåœ¨Node Creation Sectionçš„åº•éƒ¨ï¼Œæ·»åŠ å¦‚ä¸‹ä»£ç ï¼š</p>
<p>let featureImageNode = ASImageNode()<br>featureImageNode.layerBacked = true<br>featureImageNode.contentMode = .ScaleAspectFit<br>featureImageNode.image = image</p>
<p>è¿™å°±åˆ›å»ºå¹¶é…ç½®äº†ä¸€ä¸ªå«åšfeatureImageNodeçš„ASImageNodeçš„å¸¸é‡ã€‚å®ƒè¢«è®¾ç½®ä¸ºç”±layeræ”¯æŒï¼Œè‡ªé€‚åº”ç¼©æ”¾ï¼Œå¹¶è®¾ç½®æ˜¾ç¤ºå›¾åƒï¼Œè¿™æ¬¡ä¸éœ€è¦æ¨¡ç³Šã€‚</p>
<p>åœ¨Node Hierarchy Sectionçš„æœ€åï¼Œå°†featureImageNodeè®¾ä¸ºcontainerNodeçš„ä¸€ä¸ªå­nodeã€‚<br>containerNode.addSubnode(featureImageNode)</p>
<p>åœ¨Node Layout Sectionï¼Œå¸ƒå±€featureImageNode<br>featureImageNode.frame = FrameCalculator.frameForFeatureImage(featureImageSize: image.size, containerFrameWidth: containerNode.frame.size.width)</p>
<p>ç¼–è¯‘å¹¶è¿è¡Œï¼Œä½ ä¼šçœ‹åˆ°ç‰¹å¾å›¾åƒæ˜¾ç¤ºåœ¨å¡ç‰‡çš„é¡¶éƒ¨ï¼Œä½äºæ¨¡ç³Šå›¾åƒçš„ä¸Šæ–¹ã€‚æ³¨æ„ç‰¹å¾å›¾åƒå’Œæ¨¡ç³Šå›¾åƒæ˜¯åœ¨åŒä¸€æ—¶é—´è·³å‡ºçš„ã€‚è¿™æ˜¯ä½ ä¹‹å‰æ·»åŠ çš„shouldRasterizeDescendantsåœ¨èµ·ä½œç”¨ã€‚</p>
<p><img src="http://www.raywenderlich.com/wp-content/uploads/2014/10/IMG_0015.png" alt=""></p>
<p><strong>å¢åŠ æ ‡é¢˜æ–‡å­—</strong><br>æ¥ä¸‹æ¥æ·»åŠ æ–‡å­—labelï¼Œç”¨æ¥æ˜¾ç¤ºåŠ¨ç‰©çš„åå­—å’Œæè¿°ã€‚é¦–å…ˆæ¥åŠ¨ç‰©åå­—å§ã€‚<br>ç»§ç»­åœ¨configureCellDisplayWithCardInfo(cardInfo:)ä¸­ï¼Œæ‰¾åˆ°Node Creation Sectionã€‚æ·»åŠ ä¸‹åˆ—ä»£ç åˆ°è¿™èŠ‚å°¾éƒ¨ï¼Œå°±åœ¨åˆ›å»ºfeatureImageNodeä¹‹åï¼š</p>
<p>let titleTextNode = ASTextNode()<br>titleTextNode.layerBacked = true<br>titleTextNode.backgroundColor = UIColor.clearColor()<br>titleTextNode.attributedString = NSAttributedString.attributedStringForTitleText(cardInfo.name)</p>
<p>è¿™å°±åˆ›å»ºäº†ä¸€ä¸ªå«åštitleTextNodeçš„ASTextNodeç±»å‹å¸¸é‡ã€‚<br>ASTextNodeæ˜¯å¦ä¸€ä¸ªAsyncDisplayKitæä¾›çš„nodeå­ç±»ï¼Œç”¨äºæ˜¾ç¤ºæ–‡æœ¬ã€‚å®ƒæ˜¯ä¸€ä¸ªåŸºäºUILabelæ•ˆæœçš„nodeã€‚å®ƒæ¥å—ä¸€ä¸ªattributed stringï¼Œç”±TextKitæ”¯æŒï¼Œæ‹¥æœ‰å¦‚æ–‡æœ¬é“¾æ¥ç­‰è®¸å¤šç‰¹æ€§ã€‚è¦å­¦åˆ°æ›´å¤šå…³äºè¿™ä¸ªNodeçš„åŠŸèƒ½ï¼Œå»çœ‹çœ‹ASTextNode.hå§ã€‚<br>åˆå§‹é¡¹ç›®åŒ…å«æœ‰ä¸€ä¸ªNSAttributedStringçš„æ‰©å±•ï¼Œå®ƒæä¾›äº†ä¸€ä¸ªå·¥å‚æ–¹æ³•å»ç”Ÿæˆä¸€ä¸ªå±æ€§å­—ç¬¦ä¸²ç”¨äºå°†titleå’Œdescriptionæ–‡æœ¬æ˜¾ç¤ºåœ¨é›¨æ—å¡ç‰‡ä¸Šã€‚ä¸Šé¢çš„ä»£ç ä½¿ç”¨äº†è¿™ä¸ªæ‰©å±•çš„attributedStringForTitleText(â€¦)æ–¹æ³•ã€‚<br>åœ¨Node Hierarchy Sectionçš„æœ€åï¼Œæ·»åŠ ï¼š<br>containerNode.addSubnode(titleTextNode)</p>
<p>è¿™æ ·å°±å°†titleTextNodeå¢åŠ åˆ°äº†nodeå±‚çº§ç»“æ„ä¸­ï¼Œå› ä¸ºå®ƒæ˜¯æœ€åä¸€ä¸ªæ·»åŠ çš„æ‰€ä»¥å®ƒä¼šåœ¨æœ€ä¸Šé¢ã€‚</p>
<p>åœ¨Node Layout Sectionçš„æœ€åï¼Œæ·»åŠ ï¼š<br>titleTextNode.frame = FrameCalculator.frameForTitleText(containerBounds: containerNode.bounds, featureImageFrame: featureImageNode.frame)</p>
<p>è¿™æ ·å°±å®Œæˆäº†titleTextNodeçš„å¸ƒå±€ã€‚<br>ç¼–è¯‘å¹¶è¿è¡Œï¼Œä½ å°±æœ‰äº†ä¸€ä¸ªæ˜¾ç¤ºåœ¨ç‰¹å¾å›¾åƒé¡¶éƒ¨çš„æ ‡é¢˜ã€‚å†æ¬¡è¯´æ˜ï¼Œlabelåªä¼šåœ¨æ•´ä¸ªcellå‡†å¤‡å¥½æ¸²æŸ“æ—¶æ‰æ¸²æŸ“ã€‚</p>
<p><img src="http://www.raywenderlich.com/wp-content/uploads/2014/10/IMG_0017.png" alt=""></p>
<p><strong>å¢åŠ æè¿°æ–‡å­—</strong></p>
<p>å’Œå¢åŠ æ ‡é¢˜æ–‡å­—å·®ä¸å¤šã€‚<br>åœ¨configureCellDisplayWithCardInfo(cardInfo:)æ–¹æ³•ä¸­åˆ›å»ºnodeï¼š</p>
<p>let descriptionTextNode = ASTextNode()<br>descriptionTextNode.layerBacked = true<br>descriptionTextNode.backgroundColor = UIColor.clearColor()<br>descriptionTextNode.attributedString = NSAttributedString.attributedStringForDescriptionText(cardInfo.description)</p>
<p>æ·»åŠ åˆ°nodeå±‚çº§ç»“æ„ä¸­ï¼š</p>
<p>containerNode.addSubnode(descriptionTextNode)</p>
<p>å¸ƒå±€ï¼š</p>
<p>descriptionTextNode.frame = FrameCalculator.frameForDescriptionText(containerBounds: containerNode.bounds, featureImageFrame: featureImageNode.frame)</p>
<p>ç¼–è¯‘å¹¶è¿è¡Œï¼Œä½ å°±ä¹Ÿèƒ½çœ‹åˆ°æè¿°æ–‡å­—äº†ã€‚</p>
<p><img src="http://www.raywenderlich.com/wp-content/uploads/2014/10/IMG_0018.png" alt=""></p>
<h2 id="è‡ªå®šä¹‰Nodeå­ç±»"><a href="#è‡ªå®šä¹‰Nodeå­ç±»" class="headerlink" title="è‡ªå®šä¹‰Nodeå­ç±»"></a>è‡ªå®šä¹‰Nodeå­ç±»</h2><p>ç°åœ¨ä½ å·²ç»ä½¿ç”¨äº†ASImageNodeå’ŒASTextNodeã€‚ç°åœ¨æ¥å­¦ä¹ ä¸‹å¦‚ä½•åˆ›å»ºnodeå­ç±»å§ã€‚</p>
<p><strong>åˆ›å»ºä¸€ä¸ªæ¸å˜çš„Nodeç±»</strong></p>
<p>æ¥ä¸‹æ¥ï¼Œä½ å°†ç”¨GradientView.swiftä¸­çš„Core Graphicsä»£ç æ¥æ„å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„æ¸å˜çš„nodeã€‚æ¸å˜ä¼šæ˜¾ç¤ºåœ¨ç‰¹å¾å›¾åƒçš„åº•éƒ¨ä»¥ä¾¿è®©æ ‡é¢˜çœ‹èµ·æ¥æ›´åŠ æ˜æ˜¾ã€‚</p>
<p>æ‰“å¼€Layers-Bridging-Header.hæ–‡ä»¶ï¼Œæ·»åŠ å¦‚ä¸‹ï¼š</p>
<p>#import <asyncdisplaykit _asdisplaylayer.h=""></asyncdisplaykit></p>
<p>è¿™ä¸€æ­¥æ˜¯å¿…éœ€çš„å› ä¸ºè¿™ä¸ªç±»æ²¡æœ‰åŒ…å«åœ¨åº“çš„ä¸»å¤´æ–‡ä»¶é‡Œã€‚ä½ åœ¨å­ç±»åŒ–ä»»ä½•ASDisplayNodeæˆ–_ASDisplayLayeræ—¶éƒ½éœ€è¦è®¿é—®è¿™ä¸ªç±»ã€‚</p>
<p>åˆ›å»ºä¸€ä¸ªç»§æ‰¿è‡ªASDisplayNodeçš„å­ç±»GradientNodeï¼Œå¢åŠ å¦‚ä¸‹æ–¹æ³•ï¼š</p>
<p>class func drawRect(bounds: CGRect, withParameters parameters: NSObjectProtocol!,<br>isCancelled isCancelledBlock: asdisplaynode_iscancelled_block_t!, isRasterizing: Bool) {</p>
<p>}</p>
<p>å¦‚åŒUIViewæˆ–CALayerï¼Œä½ å¯ä»¥å­ç±»åŒ–ASDisplayNodeå»åšè‡ªå®šä¹‰ç»˜åˆ¶ã€‚ä½ å¯ä»¥ç»˜åˆ¶åˆ°UIViewçš„layeræˆ–æ˜¯å•ç‹¬çš„CALayerï¼Œè¿™å–å†³äºå®é™…æƒ…å†µã€‚æŸ¥çœ‹ASDisplayNode+Subclasses.hä»¥è·å–æ›´å¤šå…³äºå­ç±»åŒ–ASDisplayNodeçš„ä¿¡æ¯ã€‚<br>å¦å¤–ï¼ŒASDisplayNodeçš„ç»˜åˆ¶æ–¹æ³•æ¯”åœ¨UIViewå’ŒCALayeré‡Œçš„æ¥å—æ›´å¤šå‚æ•°ï¼Œç»™ä½ æä¾›æ–¹æ³•å°‘åšå·¥ä½œï¼Œå¹¶æ›´æœ‰æ•ˆç‡ã€‚<br>è¦ä¸ºä½ è‡ªå®šä¹‰Display Nodeå¡«å……å†…å®¹ï¼Œä½ éœ€è¦å®ç°æ¥è‡ª_ASDisplayLayerDelegateåè®®çš„drawRect(â€¦)æˆ–displayWithParameters(â€¦)ã€‚åœ¨ç»§ç»­ä¹‹å‰ï¼Œçœ‹çœ‹_ASDisplayLayer.hä¸­è¿™äº›æ–¹æ³•å’Œå®ƒä»¬çš„å‚æ•°ã€‚æœç´¢ _ASDisplayLayerDelegateï¼Œé‡ç‚¹çœ‹çœ‹å¤´æ–‡ä»¶æ³¨é‡Šé‡Œå…³äºdrawRect(â€¦)çš„æè¿°ã€‚<br>å› ä¸ºæ¸å˜å›¾ä½äºç‰¹å¾å›¾çš„ä¸Šæ–¹ï¼Œä½¿ç”¨Core Graphicsç»˜åˆ¶ï¼Œæ‰€ä»¥ä½ éœ€è¦ä½¿ç”¨drawRect(â€¦)ã€‚<br>æ‰“å¼€GradientView.swiftå¹¶æ‹·è´drawRect(â€¦)çš„å†…å®¹åˆ°GradientNode.swiftçš„drawRect(â€¦)ä¸­ï¼Œå¦‚ä¸‹ï¼š</p>
<p>class func drawRect(bounds: CGRect, withParameters parameters: NSObjectProtocol!,<br>isCancelled isCancelledBlock: asdisplaynode_iscancelled_block_t!, isRasterizing: Bool) {<br>let myContext = UIGraphicsGetCurrentContext()<br>CGContextSaveGState(myContext)<br>CGContextClipToRect(myContext, bounds)</p>
<p>let componentCount: Int = 2<br>let locations: [CGFloat] = [0.0, 1.0]<br>let components: [CGFloat] = [0.0, 0.0, 0.0, 1.0,<br>0.0, 0.0, 0.0, 0.0]<br>let myColorSpace = CGColorSpaceCreateDeviceRGB()<br>let myGradient = CGGradientCreateWithColorComponents(myColorSpace, components,<br>locations, componentCount)</p>
<p>let myStartPoint = CGPoint(x: bounds.midX, y: bounds.maxY)<br>let myEndPoint = CGPoint(x: bounds.midX, y: bounds.midY)<br>CGContextDrawLinearGradient(myContext, myGradient, myStartPoint,<br>myEndPoint, UInt32(kCGGradientDrawsAfterEndLocation))</p>
<p>CGContextRestoreGState(myContext)<br>}</p>
<p>ç°åœ¨å¯ä»¥åˆ é™¤GradientView.swiftäº†ã€‚</p>
<p><strong>å¢åŠ æ¸å˜Node</strong></p>
<p>æ‰“å¼€RainforestCardCell.swiftæ–‡ä»¶ï¼Œæ‰¾åˆ°configureCellDisplayWithCardInfo(cardInfo:)æ–¹æ³•ï¼Œåœ¨Node Creation Sectionçš„åº•ä¸‹ï¼Œå¢åŠ ä»£ç ï¼š</p>
<p>let gradientNode = GradientNode()<br>gradientNode.opaque = false<br>gradientNode.layerBacked = true</p>
<p>åœ¨Node Hierarchy Sectionï¼Œä¿®æ”¹å¦‚ä¸‹ï¼š</p>
<p>//MARK: Node Hierarchy Section<br>containerNode.addSubnode(backgroundImageNode)<br>containerNode.addSubnode(featureImageNode)<br>containerNode.addSubnode(gradientNode) ///&lt; ADD THIS LINE<br>containerNode.addSubnode(titleTextNode)<br>containerNode.addSubnode(descriptionTextNode)</p>
<p>åœ¨Node Layout Sectionåº•ä¸‹:</p>
<p>gradientNode.frame = FrameCalculator.frameForGradient(featureImageFrame: featureImageNode.frame)</p>
<p>ç¼–è¯‘è¿è¡Œä¸€ä¸‹ï¼Œçœ‹çœ‹æ•ˆæœï¼<br><img src="http://www.raywenderlich.com/wp-content/uploads/2014/10/IMG_0019.png" alt=""><br><strong>çˆ†ç±³èŠ±æ•ˆæœ</strong><br>å¦‚ä¹‹å‰æåˆ°çš„ï¼Œcellçš„nodeå†…å®¹ä¼šåœ¨å®Œæˆç»˜åˆ¶æ—¶â€œå¼¹å‡ºâ€ã€‚è¿™ä¸æ˜¯å¾ˆç†æƒ³ã€‚æ‰€ä»¥ç°åœ¨æ¥ä»¥ä¿®å¤è¿™ä¸ªé—®é¢˜ã€‚ä½†é¦–å…ˆï¼Œæ›´åŠ æ·±å…¥å­¦ä¹ AsyncDisplayKitä»¥çœ‹çœ‹å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚<br>åœ¨configureCellDisplayWithCardInfo(cardInfo:)çš„Container Node Creation Sectionï¼Œå…³é—­å®¹å™¨nodeçš„shouldRasterizeDescendantsï¼š<br>containerNode.shouldRasterizeDescendants = false</p>
<p>ç¼–è¯‘å¹¶è¿è¡Œï¼Œä½ ä¼šæ³¨æ„åˆ°ç°åœ¨å®¹å™¨å±‚çº§ç»“æ„é‡Œä¸åŒçš„nodeä¸€ä¸ªæ¥ä¸€ä¸ªçš„å¼¹å‡ºã€‚é¦–å…ˆæ˜¯æ–‡å­—ï¼Œç„¶åæ˜¯ç‰¹å¾å›¾ï¼Œå†ç„¶åæ˜¯æ¨¡ç³ŠèƒŒæ™¯å›¾ã€‚<br>å½“shouldRasterizeDescendantsè¢«å…³é—­åï¼ŒAsyncDisplayKitå°±ä¸æ˜¯ç»˜åˆ¶ä¸€ä¸ªå®¹å™¨layeräº†ï¼Œå®ƒä¼šåˆ›å»ºä¸€ä¸ªèƒ½å¤Ÿåæ˜ å¡ç‰‡nodeå±‚çº§ç»“æ„çš„layer treeã€‚è®°å¾—çˆ†ç±³èŠ±ç‰¹æ•ˆçš„å‡ºç°æ˜¯å› ä¸ºæ¯ä¸ªlayeréƒ½åœ¨å®ƒç»˜åˆ¶å®Œæˆåç«‹å³å‡ºç°ï¼Œè€ŒæŸäº›layeræ¯”å…¶ä»–çš„èŠ±è´¹æ›´å¤šæ—¶é—´åœ¨ç»˜åˆ¶ä¸Šã€‚<br>è¿™ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ï¼Œä½†å®ƒè¯´æ˜äº†AsyncDisplayKitçš„å·¥ä½œæ–¹å¼ã€‚æˆ‘ä»¬ä¸æƒ³è¦è¿™ä¸ªè¡Œä¸ºï¼Œæ‰€ä»¥è¿˜æ˜¯å°†shouldRasterizeDescendantsæ‰“å¼€ï¼š<br>containerNode.shouldRasterizeDescendants = true</p>
<p>ç°åœ¨æ¥æƒ³æƒ³æ€ä¹ˆæ ·å»æ‰çˆ†ç±³èŠ±ç‰¹æ•ˆã€‚é¦–å…ˆï¼Œçœ‹çœ‹nodeå¦‚ä½•åœ¨åå°è¢«æ„å»ºã€‚</p>
<h2 id="åœ¨åå°æ„å»ºNode"><a href="#åœ¨åå°æ„å»ºNode" class="headerlink" title="åœ¨åå°æ„å»ºNode"></a>åœ¨åå°æ„å»ºNode</h2><p>é™¤äº†å¼‚æ­¥åœ°ç»˜åˆ¶ï¼Œä½¿ç”¨AsyncDisplayKitï¼Œä½ åŒæ ·å¯ä»¥å¼‚æ­¥åœ°åˆ›å»ºã€é…ç½®ä»¥åŠå¸ƒå±€ã€‚æ·±å‘¼å¸ä¸€ä¸‹ï¼Œå› ä¸ºè¿™å°±æ˜¯ä½ æ¥ä¸‹æ¥è¦åšçš„äº‹æƒ…ã€‚<br><strong>åˆ›å»ºä¸€ä¸ªNodeæ„å»ºoperation</strong><br>ä½ è¦å°†nodeå±‚çº§ç»“æ„çš„æ„é€ åŒ…è£…åˆ°ä¸€ä¸ªNSOperationä¸­ã€‚è¿™æ ·åšå¾ˆæ£’ï¼Œå› ä¸ºæ“ä½œèƒ½å¾ˆå®¹æ˜“çš„åœ¨ä¸åŒçš„æ“ä½œé˜Ÿåˆ—ä¸Šæ‰§è¡Œï¼ŒåŒ…æ‹¬åå°é˜Ÿåˆ—ã€‚<br>æ‰“å¼€ RainforestCardCell.swift ã€‚ç„¶åæ·»åŠ å¦‚ä¸‹æ–¹æ³•ï¼š<br>func nodeConstructionOperationWithCardInfo(cardInfo: RainforestCardInfo, image: UIImage) -&gt; NSOperation {<br>let nodeConstructionOperation = NSBlockOperation()<br>nodeConstructionOperation.addExecutionBlock {<br>// TODO: Add node hierarchy construction<br>}<br>return nodeConstructionOperation<br>}</p>
<p>ç»˜åˆ¶å¹¶ä¸æ˜¯å”¯ä¸€ä¼šæ‹–æ…¢ä¸»çº¿ç¨‹çš„æ“ä½œã€‚å¯¹äºå¤æ‚çš„å±å¹•æ¥è¯´ï¼Œå¸ƒå±€è®¡ç®—ä¹Ÿæœ‰å¯èƒ½å˜çš„æ˜‚è´µã€‚ç›®å‰ä¸ºæ­¢ï¼Œæœ¬å·¥ç¨‹çš„å½“å‰çŠ¶æ€ï¼Œç¼“æ…¢çš„nodeå¸ƒå±€ä¼šå¼•èµ·collection viewä¸¢å¸§ã€‚<br>60 FPSæ„å‘³ç€ä½ æœ‰å¤§çº¦17msçš„æ—¶é—´è®©ä½ çš„cellå‡†å¤‡å¥½æ˜¾ç¤ºï¼Œå¦åˆ™ä¸€ä¸ªæˆ–å¤šä¸ªå¸§å°±ä¼šè¢«ä¸¢æ‰ã€‚è¿™åœ¨æœ‰å¾ˆå¤šå¾ˆå¤æ‚çš„cellçš„table viewå’Œcollection viewä¸­æ˜¯éå¸¸å¸¸è§çš„ï¼Œæ»‘åŠ¨æ—¶ä¸¢å¸§å°±æ˜¯è¿™ä¸ªåŸå› ã€‚<br>AsyncDisplayKitå‰æ¥æ•‘æ´ï¼<br>ä½ å°†ä½¿ç”¨ä¸Šé¢çš„nodeConstructionOperationå°†æ‰€æœ‰nodeå±‚çº§ç»“æ„çš„æ„å»ºä»¥åŠå¸ƒå±€ä»ä¸»çº¿ç¨‹åˆ†ç¦»å¹¶æ”¾å…¥åå°NSOperationQueueï¼Œè¿›ä¸€æ­¥ç¡®ä¿collection viewèƒ½å°½é‡ä»¥æ¥è¿‘60 FPSçš„å¸§ç‡æ»‘åŠ¨ã€‚<br>è­¦å‘Šï¼šä½ å¯ä»¥åœ¨åå°è®¿é—®å¹¶è®¾ç½®nodeçš„å±æ€§ï¼Œä½†åªèƒ½åœ¨nodeçš„layeræˆ–viewæœªè¢«åˆ›å»ºä¹‹å‰ï¼Œä¹Ÿå°±æ˜¯å½“ä½ ç¬¬ä¸€æ¬¡è®¿é—®nodeçš„layeræˆ–viewå±æ€§æ—¶ã€‚<br>ä¸€æ—¦nodeçš„layeræˆ–viewè¢«åˆ›å»ºï¼Œä½ å°±å¿…é¡»åœ¨ä¸»çº¿ç¨‹æ‰èƒ½è®¿é—®å’Œè®¾ç½®nodeçš„å±æ€§äº†ï¼Œå› ä¸ºnodeå°†ä¼šè½¬å‘è¿™äº›è°ƒç”¨åˆ°å®ƒçš„layeræˆ–viewä¸Šã€‚å¦‚æœä½ å¾—åˆ°ä¸€ä¸ªå´©æºƒlogæ˜¾ç¤ºâ€œIncorrect display node thread affinityâ€ï¼Œé‚£å°±æ„å‘³ç€nodeåœ¨åˆ›å»ºäº†layeræˆ–viewä¹‹åï¼Œä½ ä¾ç„¶å°è¯•åœ¨åå°è®¿é—®æˆ–è®¾ç½®nodeçš„å±æ€§ã€‚<br>ä¿®æ”¹nodeConstructionOperationæ“ä½œblockå¦‚ä¸‹ï¼š<br>nodeConstructionOperation.addExecutionBlock {<br>[weak self, unowned nodeConstructionOperation] in<br>if nodeConstructionOperation.cancelled {<br>return<br>}<br>if let strongSelf = self {<br>// TODO: Add node hierarchy construction<br>}<br>}<br>å½“è¿™ä¸ªæ“ä½œè¿è¡Œæ—¶ï¼Œcellå¯èƒ½å·²ç»è¢«é‡Šæ”¾äº†ã€‚é‚£æ ·çš„è¯ï¼Œå°±ä¸éœ€è¦åšä»»ä½•å·¥ä½œäº†ã€‚ç±»ä¼¼çš„ï¼Œå¦‚æœæ“ä½œè¢«å–æ¶ˆäº†ï¼Œé‚£ä¸€æ ·ä¹Ÿæ²¡æœ‰å·¥ä½œè¦åšäº†ã€‚<br>ä¹‹æ‰€ä»¥å¯¹nodeConstructionOperationä½¿ç”¨unownedå¼•ç”¨ä¹Ÿæ˜¯ä¸ºäº†é¿å…åœ¨æ“ä½œå’Œæ‰§è¡Œé—­åŒ…ä¹‹é—´äº§ç”Ÿä¿ç•™ç¯ã€‚<br>ç°åœ¨æ‰¾åˆ°configureCellDisplayWithCardInfo(cardInfo:)ã€‚å°†ä»»ä½•åœ¨Image Size Sectionä¹‹åçš„ä»£ç ç§»åŠ¨åˆ°nodeConstructionOperationçš„æ‰§è¡Œé—­åŒ…é‡Œã€‚å°†ä»£ç æ”¾åœ¨strongSelfçš„æ¡ä»¶è¯­å¥é‡Œï¼Œå³TODOçš„ä½ç½®ã€‚ä¹‹å configureCellDisplayWithCardInfo(cardInfo:)æ–¹æ³•å°†çœ‹èµ·æ¥å¦‚ä¸‹ï¼š</p>
<p>func configureCellDisplayWithCardInfo(cardInfo: RainforestCardInfo) {<br>//MARK: Image Size Section<br>let image = UIImage(named: cardInfo.imageName)!<br>featureImageSizeOptional = image.size<br>}<br>ä½ å°†ä¼šæœ‰ä¸€äº›ç¼–è¯‘é”™è¯¯ã€‚è¿™æ˜¯å› ä¸ºæ“ä½œblockä¸­çš„selfæ˜¯ä¸€ä¸ªå¼±å¼•ç”¨ï¼Œå› æ­¤æ˜¯å¯é€‰çš„ã€‚ä½†ä½ æœ‰ä¸€ä¸ªå¯¹selfçš„å¼ºå¼•ç”¨ï¼Œå› ä¸ºä»£ç åœ¨å¯é€‰ç»‘å®šè¯­å¥å†…ã€‚æ‰€ä»¥æ›¿æ¢é”™è¯¯çš„å‡ è¡Œæˆä¸‹é¢çš„æ ·å­ï¼š<br>strongSelf.contentView.layer.addSublayer(containerNode.layer)<br>strongSelf.contentLayer = containerNode.layer<br>strongSelf.containerNode = containerNode</p>
<p>æœ€åï¼Œæ·»åŠ å¦‚ä¸‹ä»£ç åˆ°ä½ åˆšæ”¹åŠ¨çš„ä¸‰è¡Œä¹‹ä¸‹ï¼š</p>
<p>containerNode.setNeedsDisplay()</p>
<p>ç¼–è¯‘ç¡®ä¿æ²¡æœ‰é”™è¯¯ã€‚å¦‚æœä½ ç°åœ¨è¿è¡Œï¼Œé‚£ä¹ˆåªæœ‰å ä½å›¾ä¼šæ˜¾ç¤ºï¼Œå› ä¸ºnodeçš„åˆ›å»ºæ“ä½œè¿˜æ²¡æœ‰å®é™…è¢«ä½¿ç”¨ã€‚ç°åœ¨æ¥æ·»åŠ å®ƒã€‚<br><strong>ä½¿ç”¨Nodeåˆ›å»ºæ“ä½œ</strong></p>
<p>æ‰“å¼€RainforestCardCell.swiftæ–‡ä»¶ï¼Œæ·»åŠ æ–°å±æ€§ï¼š<br>class RainforestCardCell: UICollectionViewCell {<br>var featureImageSizeOptional: CGSize?<br>var placeholderLayer: CALayer!<br>var contentLayer: CALayer?<br>var containerNode: ASDisplayNode?<br>var nodeConstructionOperation: NSOperation? ///&lt; ADD THIS LINE<br>â€¦<br>}</p>
<p>è¿™æ ·å¢åŠ äº†ä¸€ä¸ªNSOperationç±»å‹å¯é€‰å˜é‡ã€‚<br>å½“cellå‡†å¤‡å›æ”¶æ—¶ï¼Œä½ å°†ä½¿ç”¨è¿™ä¸ªå±æ€§å»å–æ¶ˆnodeçš„æ„å»ºã€‚è¿™åœ¨ç”¨æˆ·éå¸¸å¿«é€Ÿåœ°æ»‘åŠ¨collection viewæ—¶å‘ç”Ÿï¼Œç‰¹åˆ«æ˜¯å¦‚æœå¸ƒå±€è¿˜éœ€è¦ä¸€äº›è®¡ç®—æ—¶é—´çš„è¯ã€‚<br>åœ¨prepareForReuse()ä¸­æ·»åŠ å¦‚ä¸‹æŒ‡ç¤ºçš„ä»£ç ï¼š<br>override func prepareForReuse() {<br>super.prepareForReuse()</p>
<p>// ADD FROM HEREâ€¦<br>if let operation = nodeConstructionOperation {<br>operation.cancel()<br>}<br>// â€¦TO HERE</p>
<p>containerNode?.recursiveSetPreventOrCancelDisplay(true)<br>contentLayer?.removeFromSuperlayer()<br>contentLayer = nil<br>containerNode = nil<br>}<br>è¿™å°±åœ¨cellè¢«é‡ç”¨æ—¶å–æ¶ˆäº†æ“ä½œï¼Œæ‰€ä»¥å¦‚æœnodeåˆ›å»ºè¿˜æ²¡å®Œæˆï¼Œå®ƒå°±ä¸ä¼šå®Œæˆäº†ã€‚<br>ç°åœ¨æ‰¾åˆ°configureCellDisplayWithCardInfo(cardInfo:)æ–¹æ³•ï¼Œæ·»åŠ ä»£ç ï¼š<br>func configureCellDisplayWithCardInfo(cardInfo: RainforestCardInfo) {<br>// ADD FROM HEREâ€¦<br>if let oldNodeConstructionOperation = nodeConstructionOperation {<br>oldNodeConstructionOperation.cancel()<br>}<br>// â€¦TO HERE</p>
<p>//MARK: Image Size Section<br>let image = UIImage(named: cardInfo.imageName)!<br>featureImageSizeOptional = image.size<br>}<br>è¿™ä¸ªcellç°åœ¨ä¼šåœ¨å®ƒå‡†å¤‡é‡ç”¨å¹¶å¼€å§‹é…ç½®æ—¶ï¼Œå–æ¶ˆä»»ä½•è¿›è¡Œä¸­çš„nodeæ„é€ æ“ä½œã€‚è¿™ç¡®ä¿äº†æ“ä½œè¢«å–æ¶ˆï¼Œå³ä½¿cellåœ¨å‡†å¤‡å¥½é‡ç”¨å‰å°±è¢«é‡æ–°é…ç½®ã€‚<br>ç¼–è¯‘ä¸€ä¸‹ä»¥ç¡®ä¿æ²¡æœ‰é”™è¯¯ã€‚<br><strong>è¿è¡Œåœ¨ä¸»çº¿ç¨‹</strong><br>AsyncDisplayKitå…è®¸ä½ åœ¨éä¸»çº¿ç¨‹åšè®¸å¤šå·¥ä½œã€‚ä½†å½“å®ƒè¦é¢å¯¹UIKitå’ŒCoreAnimationæ—¶ï¼Œä½ è¿˜æ˜¯éœ€è¦åœ¨ä¸»çº¿ç¨‹åšã€‚ç›®å‰ä¸ºæ­¢ï¼Œä½ ä»ä¸»çº¿ç¨‹ç§»èµ°äº†æ‰€æœ‰çš„nodeåˆ›å»ºã€‚ä½†è¿˜æœ‰ä¸€ä»¶äº‹éœ€è¦è¢«æ”¾åœ¨ä¸»çº¿ç¨‹â€”â€”å³è®¾ç½®CoreAnimationçš„layerå±‚çº§ç»“æ„ã€‚<br>åœ¨RainforestCardCell.swiftä¸­ï¼Œæ‰¾åˆ°nodeConstructionOperationWithCardInfo(cardInfo:image:)å¹¶æ›¿æ¢Node Layer and Wrap Up Sectionä¸ºå¦‚ä¸‹ä»£ç ï¼š<br>// 1<br>dispatch_async(dispatch_get_main_queue()) { [weak nodeConstructionOperation] in<br>if let strongNodeConstructionOperation = nodeConstructionOperation {<br>// 2<br>if strongNodeConstructionOperation.cancelled {<br>return<br>}</p>
<p>// 3<br>if strongSelf.nodeConstructionOperation !== strongNodeConstructionOperation {<br>return<br>}</p>
<p>// 4<br>if containerNode.preventOrCancelDisplay {<br>return<br>}</p>
<p>// 5<br>//MARK: Node Layer and Wrap Up Section<br>strongSelf.contentView.layer.addSublayer(containerNode.layer)<br>containerNode.setNeedsDisplay()<br>strongSelf.contentLayer = containerNode.layer<br>strongSelf.containerNode = containerNode<br>}<br>}<br>ç¨å¾®è§£é‡Šä¸€ä¸‹ï¼š</p>
<ol>
<li>å›å¿†å½“nodeçš„layerå±æ€§ç¬¬ä¸€æ¬¡è¢«è®¿é—®æ—¶ï¼Œæ‰€æœ‰çš„layeréƒ½ä¼šè¢«åˆ›å»ºã€‚è¿™å°±æ˜¯ä¸ºä½•ä½ å¿…é¡»è¿è¡Œåœ¨ä¸»çº¿ç¨‹ã€‚</li>
<li>æ“ä½œè¢«æ£€æŸ¥ä»¥ç¡®å®šæ˜¯å¦åœ¨æ·»åŠ åˆ°layerå±‚çº§ç»“æ„ä¹‹å‰å°±å·²ç»å–æ¶ˆäº†ã€‚åœ¨æ“ä½œå®Œæˆå‰ï¼Œcellè¢«é‡ç”¨æˆ–è€…é‡æ–°é…ç½®ï¼Œå°±å¾ˆå¯èƒ½ä¼šå‡ºç°è¿™æ ·çš„æƒ…å†µï¼Œé‚£ä½ å°±ä¸åº”è¯¥æ·»åŠ layeräº†ã€‚</li>
<li>ä½œä¸ºä¸€ä¸ªä¿æŠ¤æªæ–½ï¼Œç¡®ä¿nodeå½“å‰çš„nodeConstructionOperationå’Œè¢«è°ƒåº¦åˆ°æ­¤é—­åŒ…ä¸­çš„æ“ä½œæ˜¯åŒä¸€ä¸ªNSOperationã€‚</li>
<li>å¦‚æœcontainerNodeçš„preventOrCancelæ˜¯trueå°±ç«‹å³è¿”å›ã€‚å¦‚æœæ„é€ æ“ä½œå®Œæˆï¼Œä½†nodeçš„ç»˜åˆ¶è¢«å–æ¶ˆäº†ï¼Œä½ ä¾ç„¶ä¸æƒ³å°†nodeçš„layeræ˜¾ç¤ºåˆ°cellä¸­ã€‚</li>
<li>æœ€åï¼Œæ·»åŠ nodeçš„layeråˆ°å±‚çº§ç»“æ„ä¸­ï¼Œå¦‚æœå¿…è¦è¿™å°†åˆ›å»ºlayerã€‚ </li>
</ol>
<p>ç¼–è¯‘ä¸€ä¸‹ä»¥ç¡®ä¿ä¸€åˆ‡OKã€‚</p>
<p><strong>å¼€å§‹Nodeåˆ›å»ºæ“ä½œ</strong></p>
<p>ä½ ä¾ç„¶æ²¡æœ‰å®é™…åˆ›å»ºå’Œå¼€å§‹æ“ä½œï¼Œç°åœ¨æ¥åšã€‚<br>ç»§ç»­åœ¨RainforestCardCell.swifté‡Œï¼Œæ”¹å˜configureCellDisplayWithCardInfo(cardInfo:)çš„æ–¹æ³•ç­¾åä¸ºï¼š<br>func configureCellDisplayWithCardInfo(cardInfo: RainforestCardInfo, nodeConstructionQueue: NSOperationQueue)</p>
<p>è¿™é‡Œæ·»åŠ äº†ä¸€ä¸ªæ–°çš„å‚æ•°nodeConstructionQueueã€‚å®ƒå°±æ˜¯ä¸€ä¸ªç”¨äºå°†nodeåˆ›å»ºæ“ä½œå…¥é˜Ÿçš„NSOperationQueueã€‚</p>
<p>åœ¨configureCellDisplayWithCardInfo(cardInfo:nodeConstructionQueue:)åº•éƒ¨ï¼Œæ·»åŠ å¦‚ä¸‹ä»£ç ï¼š<br>let newNodeConstructionOperation = nodeConstructionOperationWithCardInfo(cardInfo, image: image)<br>nodeConstructionOperation = newNodeConstructionOperation<br>nodeConstructionQueue.addOperation(newNodeConstructionOperation)<br>è¿™å°±åˆ›å»ºäº†ä¸€ä¸ªnodeæ„é€ æ“ä½œï¼Œå°†å…¶ä¿ç•™åœ¨nodeConstructionOperationå±æ€§ä¸­ï¼Œå¹¶å°†å…¶æ·»åŠ åˆ°ä¼ å…¥çš„é˜Ÿåˆ—ä¸­ã€‚<br>æœ€åï¼Œæ‰“å¼€RainforestViewController.swiftï¼Œç»™RainforestViewControlleræ·»åŠ ä¸€ä¸ªå«åšnodeConstructionQueueçš„åˆå§‹åŒ–ä¸ºå¸¸é‡çš„å±æ€§ï¼Œå¦‚ä¸‹ï¼š<br>class RainforestViewController: UICollectionViewController {<br>let rainforestCardsInfo = getAllCardInfo()<br>let nodeConstructionQueue = NSOperationQueue() ///&lt; ADD THIS LINE<br>â€¦<br>}<br>åœ¨collectionView(collectionView:cellForItemAtIndexPath indexPath:)æ–¹æ³•ä¸­ï¼š<br>cell.configureCellDisplayWithCardInfo(cardInfo, nodeConstructionQueue: nodeConstructionQueue)<br>cellå°†ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„nodeæ„é€ æ“ä½œå¹¶å°†å…¶æ·»åŠ åˆ°Controllerçš„æ“ä½œé˜Ÿåˆ—é‡Œå¹¶å‘è¿è¡Œã€‚è®°ä½åœ¨cellå‡ºé˜Ÿæ—¶å°±ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„nodeå±‚çº§ç»“æ„ã€‚è¿™å¹¶ä¸ç†æƒ³ï¼Œä½†ä¹Ÿè¿˜è¡Œã€‚å¦‚æœä½ è¦ç¼“å­˜nodeå¹¶é‡ç”¨ï¼Œçœ‹çœ‹ASRangeControllerå§ã€‚<br>å‘œå‘¼ï¼ŒOKï¼Œç°åœ¨ç¼–è¯‘å¹¶è¿è¡Œï¼ä½ å°†çœ‹åˆ°å’Œä¹‹å‰ä¸€æ ·çš„æ•ˆæœï¼Œä½†ç°åœ¨å¸ƒå±€å’Œæ¸²æŸ“éƒ½æ²¡åœ¨ä¸»çº¿ç¨‹æ‰§è¡Œäº†ã€‚é…·ï¼æˆ‘æ‰“èµŒä½ ä»æ¥æ²¡æœ‰æƒ³è¿‡æœ‰ä¸€å¤©èƒ½åšåˆ°è¿™æ ·çš„äº‹æƒ…ã€‚è¿™å°±æ˜¯AsyncDisplayKitçš„å¨åŠ›ã€‚ä½ å¯ä»¥å°†è¶Šæ¥è¶Šå¤šä¸å¿…éœ€åœ¨ä¸»çº¿ç¨‹çš„æ“ä½œä»ä¸»çº¿ç¨‹ç§»é™¤ï¼Œè¿™å°†ç»™ä¸»çº¿ç¨‹æ›´å¤šèµ„æºå»å¤„ç†ç”¨æˆ·äº¤äº’ï¼Œè®©ä½ çš„appå¦‚é»„æ²¹èˆ¬é¡ºæ»‘ã€‚<br><img src="http://www.raywenderlich.com/wp-content/uploads/2014/10/IMG_0019.png" alt=""></p>
<h2 id="cellä¸­çš„æ·¡å…¥æ•ˆæœ"><a href="#cellä¸­çš„æ·¡å…¥æ•ˆæœ" class="headerlink" title="cellä¸­çš„æ·¡å…¥æ•ˆæœ"></a>cellä¸­çš„æ·¡å…¥æ•ˆæœ</h2><p>ç°åœ¨æ˜¯æœ‰è¶£çš„éƒ¨åˆ†ã€‚åœ¨è¿™ä¸ªç®€çŸ­çš„å°èŠ‚ï¼Œä½ å°†å­¦åˆ°ï¼š</p>
<ul>
<li>ç”¨è‡ªå®šä¹‰çš„layerå­ç±»æ¥æ”¯æŒnodeï¼›</li>
<li>å°†éšå¼åŠ¨ç”»åº”ç”¨åˆ°node layerä¸Šã€‚<br>è¿™å°†ä¼šç¡®ä¿ä½ ç§»é™¤çˆ†ç±³èŠ±ç‰¹æ•ˆå¹¶æœ€ç»ˆå¸¦æ¥è‰¯å¥½çš„æ·¡å…¥åŠ¨ç”»ã€‚<br><strong>åˆ›å»ºä¸€ä¸ªæ–°çš„Layerå­ç±»</strong><br>åˆ›å»ºä¸€ä¸ª_ASDisplayLayerçš„å­ç±»å‘½åä¸ºAnimatedContentsDisplayLayerï¼Œå¢åŠ å¦‚ä¸‹æ–¹æ³•ï¼š<br>override func actionForKey(event: String!) -&gt; CAAction! {<br>if let action = super.actionForKey(event) {<br>return action<br>}</li>
</ul>
<p>if event == â€œcontentsâ€ &amp;&amp; contents == nil {<br>let transition = CATransition()<br>transition.duration = 0.6<br>transition.type = kCATransitionFade<br>return transition<br>}</p>
<p>return nil<br>}<br>Layeræœ‰ä¸€ä¸ªcontentså±æ€§å‘Šè¯‰ç³»ç»Ÿä¸ºè¿™ä¸ªlayerç»˜åˆ¶ä»€ä¹ˆã€‚AsyncDisplayKitåœ¨æœ€ç»ˆåœ¨ä¸»çº¿ç¨‹è®¾ç½®contentsä¹‹å‰åœ¨åå°æ¸²æŸ“contentsã€‚<br>è¿™æ®µä»£ç å°†ä¼šæ·»åŠ ä¸€ä¸ªè¿‡æ¸¡åŠ¨ç”»ï¼Œè¿™æ ·contentsä¼šæ·¡å…¥åˆ°Viewä¸­ã€‚ä½ å¯ä»¥åœ¨Appleçš„<a href="https://developer.apple.com/library/mac/documentation/cocoa/conceptual/CoreAnimation_guide/ReactingtoLayerChanges/ReactingtoLayerChanges.html" target="_blank" rel="external">Core Animation Programming Guide</a>ä¸­æ‰¾åˆ°æ›´å¤šå…³äºéšå¼LayeråŠ¨ç”»ä»¥åŠCAActionçš„ä¿¡æ¯.ã€‚<br>ç¼–è¯‘ä»¥ç¡®ä¿æ²¡æœ‰é”™è¯¯ã€‚<br><strong>åœ¨å®¹å™¨Nodeä¸­æ·¡å…¥</strong><br>ä½ å·²ç»è®¾ç½®å¥½ä¸€ä¸ªå½“å…¶contentsè¢«è®¾ç½®æ—¶æ·¡å…¥çš„layerï¼Œç°åœ¨æ¥ä½¿ç”¨ã€‚<br>æ‰“å¼€RainforestCardCell.swiftï¼Œåœ¨nodeConstructionOperationWithCardInfo(cardInfo:image:)æ–¹æ³•ä¸­ï¼Œåœ¨Container Node Creation Sectionçš„å¼€å¤´ï¼Œæ”¹åŠ¨å¦‚ä¸‹ï¼š<br>// REPLACE THIS LINEâ€¦<br>// let containerNode = ASDisplayNode()<br>// â€¦WITH THIS LINE:<br>let containerNode = ASDisplayNode(layerClass: AnimatedContentsDisplayLayer.self)<br>è¿™ä¼šå‘Šè¯‰å®¹å™¨nodeä½¿ç”¨ AnimatedContentsDisplayLayerå®ä¾‹ä½œä¸ºå…¶æ”¯æŒçš„layerï¼Œå› æ­¤è‡ªåŠ¨å¸¦æ¥æ·¡å…¥çš„æ•ˆæœã€‚<br>æ³¨æ„ï¼šåªæœ‰ _ASDisplayLayer çš„å­ç±»æ‰èƒ½è¢«å¼‚æ­¥åœ°ç»˜åˆ¶ã€‚<br>ç¼–è¯‘å¹¶è¿è¡Œ,ä½ å°†çœ‹åˆ°å®¹å™¨nodeä¼šåœ¨å…¶ç»˜åˆ¶å¥½ä¹‹åæ·¡å…¥å‡ºç°ã€‚<br><img src="http://www.raywenderlich.com/wp-content/uploads/2014/10/IMG_0023.png" alt=""></p>
<h2 id="ä½•å»ä½•ä»"><a href="#ä½•å»ä½•ä»" class="headerlink" title="ä½•å»ä½•ä»"></a>ä½•å»ä½•ä»</h2><p>æ­å–œä½ ï¼å½“ä½ éœ€è¦æ„å»ºé«˜æ€§èƒ½çš„å¯ä»¥æ»‘åŠ¨çš„ç”¨æˆ·ç•Œé¢çš„æ—¶å€™ï¼Œä½ æœ‰äº†å¦å¤–ä¸€ä¸ªå·¥å…·ã€‚<br>åœ¨æœ¬æ•™ç¨‹é‡Œï¼Œä½ é€šè¿‡æ›¿æ¢è§†å›¾å±‚çº§ç»“æ„ä¸ºä¸€ä¸ªæ …æ ¼åŒ–çš„AsyncDisplayKit Nodeå±‚çº§ç»“æ„ï¼Œæ˜¾è‘—æ”¹å–„äº†ä¸€ä¸ªæ€§èƒ½å¾ˆå·®çš„collection viewçš„æ»‘åŠ¨æ€§èƒ½ã€‚å¤šä¹ˆä»¤äººæ¿€åŠ¨ï¼<br>è¿™åªæ˜¯ä¸€ä¸ªä¾‹å­è€Œå·²ã€‚AsyncDisplayKitæ‰¿è¯ºèƒ½æé«˜UIæ€§èƒ½åˆ°ä¸€å®šæ°´å¹³ï¼Œè€Œé€šè¿‡æ™®é€šçš„UIKitä¼˜åŒ–å¾€å¾€éš¾ä»¥è¾¾åˆ°ã€‚<br>å®é™…è¯´æ¥ï¼Œè¦å……åˆ†åˆ©ç”¨ AsyncDisplayKitï¼Œä½ éœ€è¦å¯¹æ ‡å‡†çš„UIKitçœŸæ­£çš„æ€§èƒ½ç“¶é¢ˆæ‰€åœ¨æœ‰è¶³å¤Ÿçš„äº†è§£ã€‚AsyncDisplayKitå¾ˆæ£’çš„ä¸€ç‚¹æ˜¯å®ƒå¼•å‘æˆ‘ä»¬æ¢è®¨è¿™äº›é—®é¢˜å¹¶æ€è€ƒæˆ‘ä»¬çš„appèƒ½å¦‚ä½•åœ¨ç‰©ç†çš„æé™ä¸Šæ›´å¿«ä»¥åŠæ›´å…·å“åº”æ€§ã€‚<br>AsyncDisplayKitæ˜¯æ¢è®¨æ­¤æ€§èƒ½å‰æ²¿çš„ä¸€ä¸ªéå¸¸å¼ºå¤§çš„å·¥å…·ã€‚æ˜æ™ºåœ°ä½¿ç”¨å®ƒã€‚<br>è¿™ä»…ä»…æ˜¯AsyncDisplayKitçš„ä¸€ä¸ªå¼€å§‹ï¼å®ƒçš„ä½œè€…å’Œè´¡çŒ®è€…æ¯å¤©éƒ½åœ¨æ„å»ºæ–°çš„ç‰¹æ€§ã€‚è¯·å…³æ³¨1.1 ç‰ˆä¸­çš„ASCollectionViewä»¥åŠASMultiplexImageNodeã€‚ä»å¤´æ–‡ä»¶ä¸­å¯çœ‹åˆ°â€œASMultiplexImageNodeæ˜¯ä¸€ä¸ªå›¾åƒ Nodeï¼Œå®ƒèƒ½åŠ è½½å¹¶æ˜¾ç¤ºä¸€ä¸ªå›¾åƒçš„å¤šä¸ªç‰ˆæœ¬ã€‚ä¾‹å¦‚ï¼Œå®ƒå¯ä»¥åœ¨é«˜åˆ†è¾¨ç‡çš„å›¾åƒè¿˜åœ¨æ¸²æŸ“æ—¶å…ˆæ˜¾ç¤ºä¸€ä¸ªä½åˆ†è¾¨ç‡çš„å›¾åƒã€‚â€ éå¸¸é…·ï¼Œå¯¹å§ :]<br>ä½ å¯ä»¥åœ¨æ­¤ä¸‹è½½æœ€ç»ˆçš„Xcode<a href="https://cdn3.raywenderlich.com/wp-content/uploads/2014/11/Layers-Finished-7.3.zip" target="_blank" rel="external">å·¥ç¨‹</a>ã€‚<br>AsyncDisplayKitçš„æŒ‡å¯¼åœ¨<a href="http://asyncdisplaykit.org/guide/" target="_blank" rel="external">è¿™é‡Œ</a>ï¼ŒAsyncDisplayKitçš„Githubä»“åº“åœ¨<a href="https://github.com/facebook/AsyncDisplayKit" target="_blank" rel="external">è¿™é‡Œ</a>ã€‚<br>è¿™ä¸ªåº“çš„ä½œè€…åœ¨æ”¶é›†APIè®¾è®¡çš„åé¦ˆã€‚ä½ å¯ä»¥åœ¨Facebookä¸Šçš„Paper Engineering Community groupä¸­åˆ†äº«ä½ çš„æƒ³æ³•ï¼Œæˆ–è€…ç›´æ¥å‚ä¸åˆ°AsyncDisplayKitçš„å¼€å‘ä¸­ã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å¤©å¢å²æœˆäººå¢è‚‰ï¼Œä»Šå¤©æ˜¯ä¸­ç§‹ã€‚&lt;br&gt;æœ¬æ–‡ç”±RenÃ© Cacheauxäº14å¹´å‘è¡¨äº&lt;a href=&quot;https://www.raywenderlich.com&quot;&gt;raywenderlich&lt;/a&gt;ï¼ŒåŸæ–‡å¯æŸ¥çœ‹&lt;a href=&quot;https://www.raywenderlich.com/86365/asyncdisplaykit-tutorial-achieving-60-fps-scrolling&quot;&gt;AsyncDisplayKit Tutorial: Achieving 60 FPS scrolling&lt;/a&gt;ã€‚&lt;br&gt;Facebookçš„&lt;a href=&quot;https://www.facebook.com/paper&quot;&gt;Paper&lt;/a&gt;å›¢é˜Ÿåˆ›é€ äº†å¦ä¸€ä¸ªéå¸¸æ£’çš„åº“ï¼š&lt;a href=&quot;https://github.com/facebook/AsyncDisplayKit&quot;&gt;AsyncDisplayKit&lt;/a&gt;ã€‚è¿™ä¸ªåº“å…è®¸ä½ å°†å›¾ç‰‡è§£ç ï¼Œå¸ƒå±€ï¼Œæ¸²æŸ“ç­‰æ“ä½œæ”¾åˆ°åå°çº¿ç¨‹ï¼Œè¿™æ ·ä¸ä¼šé˜»å¡ç”¨æˆ·äº¤äº’ï¼Œä»è€Œä½¿ç”¨æˆ·ç•Œé¢å“åº”è¶…çº§çµæ•ã€‚æœ¬æ•™ç¨‹å°±æ˜¯ä¸“é—¨ä»‹ç»å®ƒçš„ï¼Œå¥½å¥½å­¦å­¦å§ã€‚&lt;br&gt;
    
    </summary>
    
      <category term="ç¿»è¯‘" scheme="http://yoursite.com/categories/%E7%BF%BB%E8%AF%91/"/>
    
    
      <category term="AsyncDisplayKit" scheme="http://yoursite.com/tags/AsyncDisplayKit/"/>
    
  </entry>
  
  <entry>
    <title>MVVM &amp; ReactiveCocoaå…¥é—¨æ•™ç¨‹ï¼ç¬¬äºŒéƒ¨åˆ†</title>
    <link href="http://yoursite.com/2016/09/05/MVVM-Tutorial-with-ReactiveCocoa-Part-2-2%E3%80%90%E8%AF%91%E3%80%91/"/>
    <id>http://yoursite.com/2016/09/05/MVVM-Tutorial-with-ReactiveCocoa-Part-2-2ã€è¯‘ã€‘/</id>
    <published>2016-09-05T01:58:06.000Z</published>
    <updated>2016-09-06T06:29:22.000Z</updated>
    
    <content type="html"><![CDATA[<p>æœ¬æ–‡ç”±Colin Eberhardtäº14å¹´å‘è¡¨äº<a href="https://www.raywenderlich.com" target="_blank" rel="external">raywenderlich</a>ï¼ŒåŸæ–‡å¯æŸ¥çœ‹<a href="https://www.raywenderlich.com/74131/mvvm-tutorial-with-reactivecocoa-part-2" target="_blank" rel="external">MVVM Tutorial with ReactiveCocoa: Part 2/2</a>ã€‚</p>
<p>Model-View-ViewModel (MVVM) æ˜¯ä¸€ç§æ­£åœ¨é€æ¸æˆä¸ºModel-View-Controller (MVC)çš„æ›¿ä»£æ–¹æ¡ˆçš„UIè®¾è®¡æ¨¡å¼ã€‚</p>
<p>åœ¨æœ¬æ•™ç¨‹çš„<a href="https://kaisayoung.github.io/undefined/iOS/2016-09-02-MVVM-Tutorial-with-ReactiveCocoa-Part-1-2%E3%80%90%E8%AF%91%E3%80%91.html#more" target="_blank" rel="external">ç¬¬ä¸€éƒ¨åˆ†</a>ä¸­ï¼Œä½ å·²ç»è§è¯†åˆ°ReactiveCocoaæ˜¯æ€æ ·æ‰®æ¼”â€˜èƒ¶æ°´â€™çš„è§’è‰²æ¥å°†ViewModelç»‘å®šåˆ°ç›¸åº”çš„Viewä¸Šã€‚</p>
<a id="more"></a>
<p><img src="http://www.raywenderlich.com/wp-content/uploads/2014/06/MVVMReactiveCocoa.png" alt=""> </p>
<p>ä¸‹é¢æ˜¯ä½ è¦æ„å»ºçš„åº”ç”¨æœ€ç»ˆè¿è¡Œåçš„æ ·å­ï¼Œå®ƒæ˜¯ä¸€ä¸ªFlickræœç´¢appã€‚</p>
<p><img src="http://www.raywenderlich.com/wp-content/uploads/2014/06/FinishedApp.png" alt=""></p>
<p>åœ¨æœ¬ç¯‡ç¬¬äºŒéƒ¨åˆ†ä¸­ï¼Œä½ å°†çœ‹åˆ°èƒ½æ€æ ·åˆ©ç”¨ç¨‹åºä¸­çš„ViewModelæ¥é©±åŠ¨ä¸åŒcontrollerä¸­çš„navigationã€‚</p>
<p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œä½ æ‰€å¼€å‘çš„åº”ç”¨å…è®¸ä½ åº”ç”¨ä¸€ä¸ªç®€å•çš„å­—ç¬¦ä¸²æ¥æœç´¢Flickrã€‚å¦‚æœä½ éœ€è¦å½“å‰å·¥ç¨‹çš„ä¸€ä¸ªå¤‡ä»½ï¼ŒçŒ›å‡»<a href="http://www.raywenderlich.com/wp-content/uploads/2014/06/FlickrSearchPart1Project1.zip" target="_blank" rel="external">è¿™é‡Œ</a>ã€‚</p>
<p>ä¸€ä¸ªModelå±‚çš„æœåŠ¡åˆ©ç”¨ReactiveCocoaæ¥æä¾›æœç´¢ç»“æœï¼Œè€ŒViewModelä»…ä»…æ˜¯æ‰“å°å‡ºæ¥ã€‚</p>
<p>ç°åœ¨åˆ°äº†è§£å†³æ€æ ·è·³è½¬åˆ°æœç´¢ç»“æœé¡µé—®é¢˜çš„æ—¶é—´äº†ã€‚</p>
<h3 id="å£°æ˜ViewModelå¯¼èˆª"><a href="#å£°æ˜ViewModelå¯¼èˆª" class="headerlink" title="å£°æ˜ViewModelå¯¼èˆª"></a>å£°æ˜ViewModelå¯¼èˆª</h3><p>å½“ä¸€ä¸ªFlickræœç´¢æˆåŠŸè¿”å›æœŸæœ›çš„æ•°æ®ï¼Œåº”ç”¨å¯¼èˆªè¦è·³è½¬åˆ°ä¸€ä¸ªå±•ç¤ºæœç´¢ç»“æœçš„æ–°çš„controlleré¡µé¢ã€‚</p>
<p>å½“å‰åº”ç”¨åªæœ‰ä¸€ä¸ªViewModelï¼Œæ˜¯RWTFlickrSearchViewModelç±»ã€‚ä¸ºäº†å®ç°æœŸæœ›çš„æ•ˆæœï¼Œéœ€è¦å¢åŠ ä¸€ä¸ªæ–°çš„ViewModelæ¥ä¸ºæœç´¢ç»“æœViewæä¾›æ”¯æŒã€‚</p>
<p>åœ¨ViewModelåˆ†ç»„ä¸­å¢åŠ ä¸€ä¸ªç»§æ‰¿è‡ªNSObjectçš„å­ç±»å‘½åä¸ºRWTSearchResultsViewModelï¼Œç„¶åä¿®æ”¹å¦‚ä¸‹ï¼š</p>
<pre><code>@import Foundation;
#import &quot;RWTViewModelServices.h&quot;
#import &quot;RWTFlickrSearchResults.h&quot;

@interface RWTSearchResultsViewModel : NSObject

- (instancetype)initWithSearchResults:(RWTFlickrSearchResults *)results services:(id&lt;RWTViewModelServices&gt;)services;

@property (strong, nonatomic) NSString *title;
@property (strong, nonatomic) NSArray *searchResults;

@end
</code></pre><p>ä¸Šé¢æ·»åŠ äº†å‡ ä¸ªæè¿°Viewçš„å±æ€§å’Œä¸€ä¸ªä»¥RWTFlickrSearchResultsæ¨¡å‹å¯¹è±¡ï¼ˆç”±Modelå±‚çš„æœåŠ¡è¿”å›ï¼‰æ„å»ºçš„åˆå§‹åŒ–æ–¹æ³•ã€‚</p>
<p>æ‰“å¼€RWTSearchResultsViewModel.mæ–‡ä»¶ï¼Œå®ç°åˆå§‹åŒ–æ–¹æ³•ï¼š</p>
<pre><code>- (instancetype)initWithSearchResults:(RWTFlickrSearchResults *)results services:(id&lt;RWTViewModelServices&gt;)services {
      if (self = [super init]) {
        _title = results.searchString;
        _searchResults = results.photos;
      }
      return self;
}
</code></pre><p>è¿™æ ·å°±å®Œæˆäº†RWTSearchResultsViewModelç±»ã€‚</p>
<p>å¦‚æœä½ å›å¿†ä¸€ä¸‹ç¬¬ä¸€éƒ¨åˆ†ï¼ŒViewModelæ˜¯åœ¨å…¶ç›¸å¯¹åº”çš„Viewå‡ºç°ä¹‹å‰å°±å·²ç»æ„å»ºå¥½äº†ç„¶åâ€˜é©±åŠ¨â€™æ•´ä¸ªå·¥ç¨‹çš„ã€‚ä¸‹ä¸€æ­¥å°±æ˜¯ç»™ViewåŒ¹é…ä¸Šå¯¹åº”çš„ViewModelã€‚</p>
<p>æ‰“å¼€RWTSearchResultsViewController.hæ–‡ä»¶ï¼Œå¯¼å…¥ViewModelå¤´æ–‡ä»¶ï¼Œå¢åŠ åˆå§‹åŒ–æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<pre><code>#import &quot;RWTSearchResultsViewModel.h&quot;

@interface RWTSearchResultsViewController : UIViewController

- (instancetype)initWithViewModel:(RWTSearchResultsViewModel *)viewModel;

@end
</code></pre><p>æ‰“å¼€RWTSearchResultsViewController.mæ–‡ä»¶ï¼Œåœ¨ç±»æ‹“å±•ä¸­å¢åŠ ç§æœ‰å±æ€§ï¼š</p>
<pre><code>@property (strong, nonatomic) RWTSearchResultsViewModel *viewModel;
</code></pre><p>ç„¶åå®ç°åˆå§‹åŒ–æ–¹æ³•ï¼š</p>
<pre><code>- (instancetype)initWithViewModel:(RWTSearchResultsViewModel *)viewModel {
      if (self = [super init]) {
        _viewModel = viewModel;
      }
      return self;
}
</code></pre><p>åœ¨è¿™ä¸€æ­¥ï¼Œä½ è¦å…³æ³¨äºnavigationæ˜¯æ€æ ·å·¥ä½œçš„ã€‚ä¸€ä¼šå„¿å†æ¥ç»™è¿™ä¸ªcontrollerç»‘å®šViewModelã€‚</p>
<p>æ•´ä¸ªå·¥ç¨‹ç°åœ¨æœ‰äº†ä¸¤ä¸ªViewModelï¼Œä½†æ˜¯ä½ é‡åˆ°äº†ä¸€ä¸ªéš¾é¢˜ï¼šæ€æ ·ä»ä¸€ä¸ªViewModelåˆ‡æ¢åˆ°å¦ä¸€ä¸ªï¼Œç„¶ååŒæ—¶ç”¨å¯¼èˆªè·³è½¬åˆ°å®ƒä»¬å„è‡ªå¯¹åº”çš„controllerå‘¢ï¼Ÿ</p>
<p>ViewModelä¸èƒ½å¯¹Viewæœ‰ç›´æ¥å¼•ç”¨ï¼Œæ‰€ä»¥åˆ°åº•åº”è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ</p>
<p>å…¶å®ç­”æ¡ˆå°±å­˜åœ¨äºRWTViewModelServicesåè®®ä¸­ã€‚å®ƒå½“å‰è¢«ç”¨äºè·å¾—ä¸€ä¸ªModelå±‚çš„å¼•ç”¨ï¼Œç°åœ¨è¿˜ç”¨è¿™ä¸ªåè®®æ¥å…è®¸ViewModelåˆå§‹åŒ–å¯¼èˆªã€‚</p>
<p>æ‰“å¼€RWTViewModelServices.hæ–‡ä»¶å¢åŠ ä¸€ä¸ªæ–°çš„åè®®æ–¹æ³•ï¼š</p>
<pre><code>- (void)pushViewModel:(id)viewModel;
</code></pre><p>æ¦‚å¿µä¸Šè®²ï¼Œæ˜¯ViewModelå±‚é©±åŠ¨æ•´ä¸ªåº”ç”¨ï¼›è¿™ä¸€å±‚ä¸­çš„é€»è¾‘å†³å®šViewä¸Šå±•ç¤ºä»€ä¹ˆï¼Œä¹Ÿå†³å®šäº†ä½•æ—¶ä»¥ä½•ç§æ–¹æ³•ä½¿å¯¼èˆªå‡ºç°ï¼ˆå®ç°é¡µé¢è·³è½¬ï¼‰ã€‚</p>
<p>è¿™ä¸ªæ–¹æ³•å…è®¸ViewModelå±‚åˆå§‹åŒ–å¯¼èˆªï¼šâ€˜pushingâ€™åˆ°ä¸€ä¸ªæ–°çš„ViewModelå’Œä¸€ä¸ªUINavigationControllerå…è®¸ä½ â€˜pushingâ€™åˆ°ä¸€ä¸ªæ–°çš„Controllerå…¶å®å¼‚æ›²åŒå·¥ã€‚</p>
<p>åœ¨å®Œæˆåè®®å®ç°æ—¶ï¼Œè¿˜è¦åœ¨ViewModelå±‚åšäº›äº‹æƒ…ã€‚</p>
<p>æ‰“å¼€RWTFlickrSearchViewModel.mæ–‡ä»¶å¯¼å…¥æ–°å¢åŠ çš„ViewModelå¤´æ–‡ä»¶ï¼š</p>
<pre><code>#import &quot;RWTSearchResultsViewModel.h&quot;
</code></pre><p>ç„¶åæ›´æ–°executeSearchSignalæ–¹æ³•å®ç°ï¼š</p>
<pre><code>- (RACSignal *)executeSearchSignal {
      return [[[self.services getFlickrSearchService]
        flickrSearchSignal:self.searchText]
        doNext:^(id result) {
            RWTSearchResultsViewModel *resultsViewModel =
            [[RWTSearchResultsViewModel alloc] initWithSearchResults:result services:self.services];
            [self.services pushViewModel:resultsViewModel];
        }];
}
</code></pre><p>ä¸Šé¢æ–¹æ³•ä¸­ä¸ºå½“æœç´¢å‘½ä»¤æ‰§è¡Œæ—¶åˆ›å»ºçš„ä¿¡å·å¢åŠ äº†ä¸€ä¸ªdoNextçš„æ“ä½œã€‚doNext blockä¸­åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„ViewModelæ¥å±•ç¤ºæœç´¢ç»“æœï¼Œç„¶åé€šè¿‡ViewModelçš„serviceså®ç°pushã€‚</p>
<p>ç°åœ¨åˆ°äº†æ›´æ–°ä»£ç æ¥å®ç°åè®®çš„æ—¶å€™äº†ï¼Œè¿™æ ·å½“ä¸€ä¸ªViewModelè¢«pushä¹Ÿä¼šå¯¼èˆªåˆ°å¿…è¦çš„controllerä¸Šã€‚ä¸ºäº†å®ç°æ¬¡ï¼Œéœ€è¦æœ‰ä¸€ä¸ªnavigation controllerçš„å¼•ç”¨ã€‚</p>
<p>æ‰“å¼€RWTViewModelServicesImpl.hæ–‡ä»¶å¢åŠ åˆå§‹åŒ–æ–¹æ³•ï¼š</p>
<pre><code>- (instancetype)initWithNavigationController:(UINavigationController *)navigationController;
</code></pre><p>æ‰“å¼€RWTViewModelServicesImpl.mæ–‡ä»¶å¯¼å…¥å¤´æ–‡ä»¶ï¼š</p>
<pre><code>@property (weak, nonatomic) UINavigationController *navigationController;
</code></pre><p>ç„¶åå®ç°åˆå§‹åŒ–æ–¹æ³•ï¼š</p>
<pre><code>- (instancetype)initWithNavigationController:(UINavigationController *)navigationController {
      if (self = [super init]) {
        _searchService = [RWTFlickrSearchImpl new];
        _navigationController = navigationController;
      }
      return self;
}
</code></pre><p>è¿™æ ·ç®€å•æ›´æ–°åˆå§‹åŒ–æ–¹æ³•å°±å­˜å‚¨äº†ä¸€ä¸ªnavigation controllerçš„å¼•ç”¨ã€‚</p>
<p>æœ€åï¼Œå¢åŠ æ–°æ–¹æ³•ï¼š</p>
<pre><code>- (void)pushViewModel:(id)viewModel {
  id viewController;

  if ([viewModel isKindOfClass:RWTSearchResultsViewModel.class]) {
    viewController = [[RWTSearchResultsViewController alloc] initWithViewModel:viewModel];
  } else {
       NSLog(@&quot;an unknown ViewModel was pushed!&quot;);
  }

  [self.navigationController pushViewController:viewController animated:YES];
}
</code></pre><p>ä¸Šé¢çš„æ–¹æ³•è¿ç”¨è¿™ç§æ–¹å¼æ¥è®©ViewModelå†³å®šéœ€è¦å±•ç¤ºå“ªä¸ªViewã€‚</p>
<p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œåªæœ‰ä¸€å¯¹å…·ä½“çš„ViewModel-Viewï¼Œä¸è¿‡æˆ‘ç¡®ä¿¡ä½ èƒ½çœ‹å‡ºæ¥æ€ä¹ˆæ ·æ‹“å±•æ›´å¤šã€‚navigationControllerä¼špushåˆ°ç»“æœViewé¡µã€‚</p>
<p>æœ€åä¸€æ­¥ï¼šæ‰“å¼€RWTAppDelegate.mæ–‡ä»¶ï¼Œåœ¨createInitialViewControlleræ–¹æ³•ä¸­æ‰¾åˆ°RWTViewModelServicesImplå®ä¾‹è¢«åˆ›å»ºçš„åœ°æ–¹ï¼Œæ›´æ–°ä»£ç ä»¥é€šè¿‡åˆå§‹åŒ–æ–¹æ³•å°†navigation controllerä¼ è¿›å»ã€‚</p>
<pre><code>self.viewModelServices = [[RWTViewModelServicesImpl alloc] initWithNavigationController:self.navigationController];
</code></pre><p>è¿è¡Œä¸€ä¸‹ï¼Œè¾“å…¥ä¸€äº›å†…å®¹ï¼Œç‚¹å‡»â€˜Goâ€™æŒ‰é’®è§‚å¯Ÿåº”ç”¨ä¼šè¿‡æ¸¡åˆ°æ–°çš„ViewModelï¼Viewã€‚</p>
<p><img src="http://www.raywenderlich.com/wp-content/uploads/2014/06/BlankView.png" alt=""></p>
<p>æ–°é¡µé¢æ˜¯ç©ºçš„ï¼ä¸ç”¨æ²®ä¸§ï¼Œä½ å¾ˆå¿«å°±ä¼šæ·»åŠ å†…å®¹çš„ã€‚</p>
<p>ä½ ç°åœ¨æœ‰äº†ä¸€ä¸ªæ‹¥æœ‰å¤šä¸ªViewModelçš„åº”ç”¨ï¼Œè€Œä¸”é€šè¿‡ViewModelå±‚æ¥æ§åˆ¶æ‰€æœ‰controllerçš„è·³è½¬ã€‚</p>
<p>å®Œæˆçš„å·®ä¸å¤šäº†ï¼Œç°åœ¨å¼€å§‹UIç»‘å®šã€‚</p>
<h3 id="æ¸²æŸ“ç»“æœåˆ—è¡¨"><a href="#æ¸²æŸ“ç»“æœåˆ—è¡¨" class="headerlink" title="æ¸²æŸ“ç»“æœåˆ—è¡¨"></a>æ¸²æŸ“ç»“æœåˆ—è¡¨</h3><p>å±•ç¤ºæœç´¢ç»“æœçš„Viewï¼Œä¹Ÿå°±æ˜¯RWTSearchResultsViewControllerä¸­ï¼Œæœ‰ä¸€ä¸ªåœ¨xibä¸­åˆå§‹åŒ–çš„UITableViewã€‚ä¸‹ä¸€æ­¥å°±æ˜¯ç”¨è¿™ä¸ªè¡¨æ¥å±•ç¤ºViewModelçš„å†…å®¹ã€‚</p>
<p>æ‰“å¼€RWTSearchResultsViewController.mæ–‡ä»¶ï¼Œæ‰¾åˆ°ç±»çš„æ‹“å±•ï¼Œæ›´æ–°ä»£ç ä»¥å®ç°UITableViewDataSourceåè®®ã€‚</p>
<pre><code>@interface RWTSearchResultsViewController () &lt;UITableViewDataSource&gt;
</code></pre><p>ç„¶åé‡å†™viewDidLoadæ–¹æ³•ï¼š</p>
<pre><code>- (void)viewDidLoad {
      [super viewDidLoad];

      [self.searchResultsTable registerClass:UITableViewCell.class
              forCellReuseIdentifier:@&quot;cell&quot;];
      self.searchResultsTable.dataSource = self;

      [self bindViewModel];
}
</code></pre><p>åœ¨ä¸‹é¢æ·»åŠ bindViewModelæ–¹æ³•ï¼š</p>
<pre><code>- (void)bindViewModel {
      self.title = self.viewModel.title;
}
</code></pre><p>æ­¤æ—¶ï¼Œè¿™ä¸ªæ–¹æ³•å¹¶æ²¡æœ‰åšå¾ˆå¤šäº‹æƒ…ã€‚è¿™ä¸ªViewModelæœ‰ä¸¤ä¸ªå±æ€§ï¼šä¸€ä¸ªtitleæ˜¾ç¤ºåœ¨å¯¼èˆªæ¡ä¸Šï¼Œå¦ä¸€ä¸ªsearchResultsæ•°ç»„å°†ä¼šæ¸²æŸ“åœ¨tableä¸Šã€‚</p>
<p>é‚£æ€ä¹ˆæ ·å°†è¿™ä¸ªæ•°ç»„ç»‘å®šåˆ°table viewä¸Šå‘¢ï¼Ÿä¸å¹¸çš„æ˜¯ï¼Œæ²¡æœ‰ç°æˆçš„ç­”æ¡ˆã€‚</p>
<p>ReactiveCocoaèƒ½ç»‘å®šç®€å•çš„å±æ€§åˆ°UIKitå­æ§ä»¶ä¸Šï¼Œä½†æ˜¯ä¸èƒ½å¤„ç†å¤æ‚çš„æƒ…å†µï¼Œæ¯”å¦‚è¯´å°†æ•°æ®æ”¾å…¥table viewä¸­ã€‚æˆ‘çŸ¥é“ï¼Œè¿™å¾ˆä»¤äººæ‰«å…´ã€‚</p>
<p>ä½†æ˜¯æ²¡å¿…è¦ææ…Œï¼Œå› ä¸ºæœ‰å¦å¤–ä¸€ç§æ–¹æ³•ã€‚æ˜¯æ—¶å€™å·èµ·è¢–å­å¤§å¹²ä¸€åœºäº†ã€‚</p>
<p>è¿˜æ˜¯åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­ï¼Œå¢åŠ è¿™ä¸¤ä¸ªå¿…é¡»çš„åè®®æ–¹æ³•ï¼š</p>
<pre><code>- (NSInteger)tableView:(UITableView *)tableView
 numberOfRowsInSection:(NSInteger)section {
      return self.viewModel.searchResults.count;
}

- (UITableViewCell *)tableView:(UITableView *)tableView
     cellForRowAtIndexPath:(NSIndexPath *)indexPath {
      UITableViewCell *cell = [tableView dequeueReusableCellWithIdentifier:@&quot;cell&quot;];
      cell.textLabel.text = [self.viewModel.searchResults[indexPath.row] title];
      return cell;
}
</code></pre><p>ç¬¬ä¸€ä¸ªæ–¹æ³•è¯´æ˜æœ‰å¤šå°‘æ¡æœç´¢ç»“æœï¼Œç¬¬äºŒä¸ªæ–¹æ³•ç”¨cellçš„titleå±æ€§æ¥å±•ç¤ºæ¥è‡ªViewModelä¸­çš„æ•°æ®ã€‚</p>
<p>è¿è¡Œä¸€ä¸‹ï¼Œå¯ä»¥çœ‹åˆ°ç°åœ¨åˆ—è¡¨ä¸­æœ‰æ•°æ®äº†ã€‚</p>
<p><img src="http://www.raywenderlich.com/wp-content/uploads/2014/06/PopulatedTable.png" alt=""></p>
<h3 id="æ›´å¥½çš„Table-Viewç»‘å®š"><a href="#æ›´å¥½çš„Table-Viewç»‘å®š" class="headerlink" title="æ›´å¥½çš„Table Viewç»‘å®š"></a>æ›´å¥½çš„Table Viewç»‘å®š</h3><p>table viewç¼ºå°‘ç»‘å®šçš„è¯ä¼šè¿…é€Ÿå¯¼è‡´åŸæœ¬å·²ç»ç˜¦èº«çš„controllerå†æ¬¡è‡ƒè‚¿ã€‚</p>
<p>è¿™ä¸ªé—®é¢˜å›°æ‰°äº†æˆ‘ï¼Œæ‰€ä»¥æˆ‘å†³å®šè¦è§£å†³å®ƒã€‚</p>
<p>æ¦‚å¿µä¸Šæ¥è¯´ï¼ŒViewModelä¸­çš„searchResultsæ•°ç»„ä¸­çš„æ¯ä¸€é¡¹éƒ½åº”è¯¥ä¹Ÿæ˜¯ä¸€ä¸ªViewModelï¼Œæ¯ä¸€ä¸ªcellæˆä¸ºç›¸åº”ViewModelå®ä¾‹æ‰€å¯¹åº”çš„Viewã€‚</p>
<p>åœ¨æœ€è¿‘çš„ä¸€ç¯‡<a href="http://www.scottlogic.com/blog/2014/05/11/reactivecocoa-tableview-binding.html" target="_blank" rel="external">åšå®¢</a>ä¸­æˆ‘åˆ›é€ äº†ä¸€ä¸ªé€šç”¨çš„ç»‘å®šå¸®åŠ©ç±»ï¼Œå‘½åä¸ºCETableViewBindingHelperï¼Œå®ƒä¼šå¸®åŠ©ä½ å®ç°datasourceåè®®ä¸­å¿…è¦çš„æ–¹æ³•ï¼Œä»è€Œå…è®¸ä½ ç”¨æ¯ä¸ªå­ViewModelå®šä¹‰ç›¸åº”çš„Viewã€‚ä½ èƒ½åœ¨å½“å‰å·¥ç¨‹çš„Utilåˆ†ç»„ä¸­æ‰¾åˆ°è¿™ä¸ªå¸®åŠ©ç±»ã€‚</p>
<p>CETableViewBindingHelperç±»çš„åˆå§‹åŒ–ç±»æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<pre><code>+ (instancetype) bindingHelperForTableView:(UITableView *)tableView
                              sourceSignal:(RACSignal *)source
                          selectionCommand:(RACCommand *)selection
                              templateCell:(UINib *)templateCellNib;
</code></pre><p>ä¸ºäº†å°†ä¸€ä¸ªæ•°ç»„å’Œä¸€ä¸ªviewè¿›è¡Œç»‘å®šï¼Œä½ åªéœ€è¦ç®€å•åˆ›å»ºä¸€ä¸ªè¿™ä¸ªå¸®åŠ©ç±»çš„å®ä¾‹ã€‚4ä¸ªå‚æ•°åˆ†åˆ«ä¸ºï¼š</p>
<ol>
<li>å°†è¦å±•ç¤ºViewModelæ•°ç»„å†…å®¹çš„tableview</li>
<li>ä¼ æ’­æ•°ç»„å˜åŒ–çš„æ•°æ®æºä¿¡å·</li>
<li>ä¸€ä¸ªå¯é€‰çš„å‘½ä»¤å½“ä¸€ä¸ªrowè¢«é€‰ä¸­æ—¶å»æ‰§è¡Œ</li>
<li>cellçš„nib</li>
</ol>
<p>ç»™å®šnibæ–‡ä»¶çš„cellå¿…é¡»å®ç°äº†CEReactiveViewåè®®ã€‚</p>
<p>å·¥ç¨‹å·²ç»åŒ…å«äº†ä¸€ä¸ªä½ å¯ä»¥ç”¨äºæ¸²æŸ“æœç´¢ç»“æœçš„cellã€‚<br>æ‰“å¼€RWTSearchResultsTableViewCell.hæ–‡ä»¶ï¼Œå¯¼å…¥å¿…è¦çš„åè®®ï¼š</p>
<pre><code>#import &quot;CEReactiveView.h&quot;
</code></pre><p>ç„¶åå»åº”ç”¨å®ƒã€‚</p>
<pre><code>@interface RWTSearchResultsTableViewCell : UITableViewCell &lt;CEReactiveView&gt;
</code></pre><p>ä¸‹ä¸€æ­¥å°±æ˜¯å®ç°è¿™ä¸ªåè®®ã€‚æ‰“å¼€RWTSearchResultsTableViewCell.mæ–‡ä»¶å¢åŠ å¦‚ä¸‹ä»£ç ï¼š</p>
<pre><code>#import &lt;SDWebImage/UIImageView+WebCache.h&gt;
#import &quot;RWTFlickrPhoto.h&quot;
</code></pre><p>ç„¶åå¢åŠ ä»¥ä¸‹æ–¹æ³•ï¼š</p>
<pre><code>- (void)bindViewModel:(id)viewModel {
      RWTFlickrPhoto *photo = viewModel;
      self.titleLabel.text = photo.title;

      self.imageThumbnailView.contentMode = UIViewContentModeScaleToFill;

      [self.imageThumbnailView setImageWithURL:photo.url];
}
</code></pre><p>å½“å‰RWTSearchResultsViewModelä¸­çš„searchResultså±æ€§æ˜¯åŒ…å«äº†RWTFlickrPhotoå®ä¾‹çš„æ•°ç»„ï¼Œè€Œæ²¡æœ‰ç”¨ViewModelå»åŒ…è£¹è¿™äº›Modelå¯¹è±¡ï¼Œviewå¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚</p>
<p>æ³¨æ„ï¼šæœ‰æ—¶å€™æœ‰ä¸€äº›viewåªæ˜¯ç”¨æ¥å±•ç¤ºè€Œä¸éœ€è¦è¿›è¡Œç”¨æˆ·äº¤äº’ï¼Œæ­¤æ—¶ç›´æ¥å°†Modelå¯¹è±¡æš´éœ²ç»™Viewä¹Ÿæ˜¯æ²¡æœ‰é—®é¢˜çš„ã€‚ä¿æŒç®€å•ï¼Œæ— éœ€å¢åŠ ä¸å¿…è¦çš„å¤æ‚åº¦ã€‚</p>
<p>ä½ åˆšåˆšæ·»åŠ çš„bindViewModelæ–¹æ³•åŒæ—¶ä½¿ç”¨äº†SDWebImageåº“ã€‚å®ƒä¼šåœ¨åå°çº¿ç¨‹è¿›è¡Œå›¾ç‰‡ä¸‹è½½å’Œè§£ç ï¼Œä»è€Œæé«˜scrollçš„æ€§èƒ½ã€‚</p>
<p>æœ€åä¸€æ­¥æ˜¯ç”¨åˆšæ‰è¯´çš„ç»‘å®šå¸®åŠ©ç±»æ¥æ¸²æŸ“tableã€‚</p>
<p>æ‰“å¼€RWTSearchResultsViewController.mæ–‡ä»¶å¯¼å…¥å¸®åŠ©ç±»ï¼š</p>
<pre><code>#import &quot;CETableViewBindingHelper.h&quot;
</code></pre><p>åœ¨å½“å‰æ–‡ä»¶ä¸­ï¼Œç§»é™¤UITableDataSourceåè®®çš„å®ç°ä¸ä¸¤ä¸ªä»£ç†æ–¹æ³•ã€‚</p>
<p>æ¥ç€ï¼Œåœ¨ç±»çš„æ‹“å±•é‡Œå¢åŠ ä¸€ä¸ªç§æœ‰å±æ€§ï¼š</p>
<pre><code>@property (strong, nonatomic) CETableViewBindingHelper *bindingHelper;
</code></pre><p>ç„¶ååœ¨viewDidLoadæ–¹æ³•ä¸­åˆ é™¤ä¸å†éœ€è¦çš„ä»£ç ï¼Œæ”¹æˆä¸‹é¢çš„æ ·å­ï¼š</p>
<pre><code>- (void)viewDidLoad {
      [super viewDidLoad]; 
      [self bindViewModel];
}
</code></pre><p>æœ€åï¼Œåœ¨bindViewModelæ–¹æ³•çš„æœ€åæ·»åŠ å¦‚ä¸‹ä»£ç ï¼š</p>
<pre><code>UINib *nib = [UINib nibWithNibName:@&quot;RWTSearchResultsTableViewCell&quot; bundle:nil];

self.bindingHelper =
      [CETableViewBindingHelper bindingHelperForTableView:self.searchResultsTable
                                             sourceSignal:RACObserve(self.viewModel, searchResults)
                                         selectionCommand:nil
                                             templateCell:nib];
</code></pre><p>è¿™æ ·ä»nibæ–‡ä»¶ä¸­åˆ›å»ºä¸€ä¸ªUINibçš„å®ä¾‹æ¥æ„å»ºè¿™ä¸ªç»‘å®šå¸®åŠ©å¯¹è±¡ï¼Œè€ŒsourceSignalæ˜¯ç”±è§‚å¯ŸViewModelä¸­çš„searchResultså±æ€§çš„å˜åŒ–è€Œåˆ›å»ºçš„ã€‚</p>
<p>å†è¿è¡Œä¸€ä¸‹ï¼Œå¯ä»¥æ¬£èµä¸€ä¼šå„¿æ–°UIäº†ï¼š</p>
<p><img src="http://www.raywenderlich.com/wp-content/uploads/2014/06/UsingTheBindingHelper.png" alt=""></p>
<p>è¿™æ˜¯ä¸€ä¸ªç›¸å½“ä¼˜é›…çš„å°†table viewå’Œæ•°ç»„è¿›è¡Œç»‘å®šçš„æ–¹æ³•ã€‚</p>
<h3 id="æŸ¥è¯¢è¯„è®ºå’Œå–œçˆ±æ•°é‡"><a href="#æŸ¥è¯¢è¯„è®ºå’Œå–œçˆ±æ•°é‡" class="headerlink" title="æŸ¥è¯¢è¯„è®ºå’Œå–œçˆ±æ•°é‡"></a>æŸ¥è¯¢è¯„è®ºå’Œå–œçˆ±æ•°é‡</h3><p>cellåº”è¯¥åœ¨å³ä¸‹æ–¹å±•ç¤ºæ¯å¼ ç…§ç‰‡çš„è¯„è®ºå’Œå–œçˆ±æ•°é‡ã€‚ç„¶è€Œï¼Œç°åœ¨ä»…ä»…æ˜¯å±•ç¤ºäº†â€˜123â€™çš„å‡æ•°æ®ã€‚</p>
<p>ä½ åº”è¯¥åœ¨å°†å…¶æ›¿æ¢æˆçœŸæ­£çš„å€¼ä¹‹å‰å…ˆåœ¨Modelå±‚æ·»åŠ è¿™ä¸ªåŠŸèƒ½ã€‚é¦–å…ˆå¢åŠ ä¸€ä¸ªè¡¨ç¤ºFlickr APIæŸ¥è¯¢ç»“æœçš„Modelå¯¹è±¡ã€‚</p>
<p>åœ¨Modelåˆ†ç»„ä¸­åˆ›å»ºä¸€ä¸ªç»§æ‰¿è‡ªNSObjectçš„å­ç±»RWTFlickrPhotoMetadataï¼Œæ‰“å¼€.hæ–‡ä»¶å¢åŠ å¦‚ä¸‹å±æ€§ï¼š</p>
<pre><code>@property (nonatomic) NSUInteger favorites;
@property (nonatomic) NSUInteger comments;
</code></pre><p>ç„¶åæ‰“å¼€.mæ–‡ä»¶å¢åŠ descriptionæ–¹æ³•çš„å®ç°ï¼š</p>
<pre><code>- (NSString *)description {
      return [NSString stringWithFormat:@&quot;metadata: comments=%lU, faves=%lU&quot;,
              self.comments, self.favorites];
}
</code></pre><p>å½“ç„¶è¿™ä¸ªæ–¹æ³•è¿˜æ˜¯ä¸ºäº†æµ‹è¯•æ—¶è¾“å‡ºæ—¥å¿—çš„æ–¹ä¾¿ã€‚</p>
<h3 id="ä¸ºå¯è§CellæŸ¥è¯¢å…ƒæ•°æ®"><a href="#ä¸ºå¯è§CellæŸ¥è¯¢å…ƒæ•°æ®" class="headerlink" title="ä¸ºå¯è§CellæŸ¥è¯¢å…ƒæ•°æ®"></a>ä¸ºå¯è§CellæŸ¥è¯¢å…ƒæ•°æ®</h3><p>ä½ å¯ä»¥æ‹“å±•å½“å‰çš„ä»£ç ä»¥å®ç°ä¸ºæ‰€æœ‰æœç´¢çš„ç»“æœæŸ¥è¯¢å…ƒæ•°æ®ã€‚</p>
<p>ç„¶åï¼Œå¦‚æœä¸€æ¬¡ç»“æœä¸­æœ‰100å¼ ç…§ç‰‡ï¼Œè¿™æ ·å°±ä¼šäº§ç”Ÿ200çš„APIè¯·æ±‚ï¼Œæˆ–è€…è¯´æ¯å¼ ç…§ç‰‡æœ‰ä¸¤ä¸ªè¯·æ±‚ã€‚å¾ˆæ˜¾ç„¶ï¼Œè¿™æ˜¯ç›¸å½“ä¸åˆç†çš„ã€‚</p>
<p>äº‹å®ä¸Šï¼Œä½ åªéœ€è¦ä¸ºå½“å‰è¡¨ä¸­æ­£åœ¨å¯è§çš„cellæŸ¥è¯¢å…ƒæ•°æ®ã€‚æ‰€ä»¥æ€ä¹ˆå®ç°å‘¢ï¼Ÿä½ éœ€è¦ä¸€ä¸ªæ¸…æ¥šè‡ªèº«æ˜¯å¦å¯è§çš„ViewModelã€‚</p>
<p>å½“å‰RWTSearchResultsViewModelæš´éœ²äº†ä¸€ä¸ªåŒ…å«RWTFlickrPhotoå®ä¾‹é›†åˆçš„æ•°ç»„ç”¨äºä¸ºViewæä¾›æ•°æ®ï¼Œè¿™äº›Modelå±‚çš„å¯¹è±¡ç›´æ¥æš´éœ²ç»™äº†Viewã€‚ä¸ºäº†å¢åŠ å¯è§çš„æ¦‚å¿µï¼Œä½ éœ€è¦ç”¨ViewModelæ¥åŒ…è£¹è¿™äº›modelå¯¹è±¡ã€‚</p>
<p>åœ¨ViewModelåˆ†ç»„ä¸­æ·»åŠ ä¸€ä¸ªNSObjectçš„å­ç±»å‘½åä¸ºRWTSearchResultsItemViewModelã€‚æ‰“å¼€å¤´æ–‡ä»¶æ›´æ–°å¦‚ä¸‹ï¼š</p>
<pre><code>@import Foundation;
#import &quot;RWTFlickrPhoto.h&quot;
#import &quot;RWTViewModelServices.h&quot;

@interface RWTSearchResultsItemViewModel : NSObject

- (instancetype) initWithPhoto:(RWTFlickrPhoto *)photo services:(id&lt;RWTViewModelServices&gt;)services;

@property (nonatomic) BOOL isVisible;
@property (strong, nonatomic) NSString *title;
@property (strong, nonatomic) NSURL *url;
@property (strong, nonatomic) NSNumber *favorites;
@property (strong, nonatomic) NSNumber *comments;

@end
</code></pre><p>ä»åˆå§‹åŒ–æ–¹æ³•ä¸­å¯ä»¥çœ‹å‡ºï¼ŒViewModelåŒ…è£¹äº†ä¸€ä¸ªRWTFlickrPhotoçš„æ¨¡å‹å¯¹è±¡ã€‚</p>
<p>ViewModelçš„å±æ€§åŒ…æ‹¬å¦‚ä¸‹ä½œç”¨ï¼š</p>
<ul>
<li>æš´éœ²Modelçš„åŸºæœ¬å±æ€§ï¼ˆtitleï¼Œurlï¼‰</li>
<li>å½“å…ƒæ•°æ®è¢«æŸ¥è¯¢åˆ°æ—¶åŠ¨æ€æ›´æ–°</li>
<li>isVisibleç”¨äºè¡¨æ˜è¿™ä¸ªViewModelå½“å‰æ˜¯å¦å¯è§ã€‚</li>
</ul>
<p>æ‰“å¼€RWTSearchResultsItemViewModel.mæ–‡ä»¶ï¼Œå¯¼å…¥å¤´æ–‡ä»¶ï¼š</p>
<pre><code>#import &lt;ReactiveCocoa/ReactiveCocoa.h&gt;
#import &lt;ReactiveCocoa/RACEXTScope.h&gt;
#import &quot;RWTFlickrPhotoMetadata.h&quot;
</code></pre><p>åœ¨ä¸‹é¢å¢åŠ ä¸€ä¸ªç±»æ‹“å±•å¹¶ä¸”æ·»åŠ å‡ ä¸ªç§æœ‰å±æ€§ï¼š</p>
<pre><code>@interface RWTSearchResultsItemViewModel ()

@property (weak, nonatomic) id&lt;RWTViewModelServices&gt; services;
@property (strong, nonatomic) RWTFlickrPhoto *photo;

@end
</code></pre><p>å®ç°åˆå§‹åŒ–æ–¹æ³•ï¼š</p>
<pre><code>- (instancetype)initWithPhoto:(RWTFlickrPhoto *)photo services:(id&lt;RWTViewModelServices&gt;)services {
      self = [super init];
      if (self) {
        _title = photo.title;
        _url = photo.url;
        _services = services;
        _photo = photo;

        [self initialize];
      }
      return  self;
}
</code></pre><p>titleå’Œurlå±æ€§ä»Modelå¯¹è±¡ä¸­è·å–ï¼Œç„¶åé€šè¿‡ç§æœ‰å±æ€§å­˜å‚¨äº†serviceså’Œphotoå‚æ•°çš„å¼•ç”¨ã€‚</p>
<p>æ¥ç€å¢åŠ initializeæ–¹æ³•ã€‚å‡†å¤‡å¥½ï¼Œæ¥ä¸‹æ¥æ˜¯è§è¯å¥‡è¿¹çš„æ—¶åˆ»ï¼</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">- (void)initialize &#123;</div><div class="line">  RACSignal *fetchMetadata =</div><div class="line">    [RACObserve(self, isVisible)</div><div class="line">     filter:^BOOL(NSNumber *visible) &#123;</div><div class="line">       return [visible boolValue];</div><div class="line">     &#125;];</div><div class="line"> </div><div class="line">  @weakify(self)</div><div class="line">  [fetchMetadata subscribeNext:^(id x) &#123;</div><div class="line">    @strongify(self)</div><div class="line">    [[[self.services getFlickrSearchService] flickrImageMetadata:self.photo.identifier]</div><div class="line">     subscribeNext:^(RWTFlickrPhotoMetadata *x) &#123;</div><div class="line">       self.favorites = @(x.favorites);</div><div class="line">       self.comments = @(x.comments);</div><div class="line">     &#125;];</div><div class="line">  &#125;];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æ­¤æ–¹æ³•çš„ç¬¬ä¸€éƒ¨åˆ†åˆ›å»ºäº†ä¸€ä¸ªå«åšfetchMetadataçš„ä¿¡å·ç”¨äºè§‚å¯ŸisVisibleå±æ€§å¹¶ä¸”è¿‡æ»¤å‡ºæ¥â€™trueâ€™çš„å€¼ã€‚ä½œä¸ºç»“æœï¼Œå½“isVisibleå±æ€§å˜ä¸ºtrueæ—¶ï¼Œè¿™ä¸ªä¿¡å·ä¼šå‘é€ä¸€ä¸ªnextçš„å€¼ã€‚</p>
<p>ç¬¬äºŒéƒ¨åˆ†è®¢é˜…äº†è¿™ä¸ªä¿¡å·ä»¥ä¸ºäº†è§¦å‘flickrImageMetadataæ–¹æ³•è¿›è¡Œè¯·æ±‚ã€‚å½“é‡Œé¢çš„ä¿¡å·å‘é€ä¸€ä¸ªnextäº‹ä»¶ï¼Œfavoriteså’Œcommentsä¼šæ›´æ–°ç»“æœã€‚</p>
<p>æ€»ä¹‹å‘¢ï¼Œå½“isVisibleå˜ä¸ºtrueï¼ŒFlickr APIè¯·æ±‚ä¼šè¢«è§¦å‘ï¼Œcommentså’Œfavoriteså±æ€§ç¨åä¼šè¢«æ›´æ–°ã€‚ </p>
<p>ä¸ºäº†å°†è¿™ä¸ªViewModelæŠ•å…¥ä½¿ç”¨ï¼Œæ‰“å¼€RWTSearchResultsViewModel.mæ–‡ä»¶å¯¼å…¥ä»¥ä¸‹å¤´æ–‡ä»¶ï¼š</p>
<pre><code>#import &lt;LinqToObjectiveC/NSArray+LinqExtensions.h&gt;
#import &quot;RWTSearchResultsItemViewModel.h&quot;
</code></pre><p>åœ¨åˆå§‹åŒ–æ–¹æ³•ä¸­ï¼Œå»æ‰å½“å‰è®¾ç½®_searchResultsçš„ä»£ç ï¼Œä»¥ä¸‹é¢çš„ä»£æ›¿ï¼š</p>
<pre><code>_searchResults =
      [results.photos linq_select:^id(RWTFlickrPhoto *photo) {
        return [[RWTSearchResultsItemViewModel alloc]
                  initWithPhoto:photo services:services];
  }];
</code></pre><p>è¿™æ ·å°±ç”¨ViewModelåŒ…è£¹äº†æ¯ä¸€ä¸ªModelå¯¹è±¡ã€‚</p>
<p>æœ€åä¸€æ­¥å°±æ˜¯é€šè¿‡Viewæ¥è®¾ç½®isVisibleå±æ€§ç„¶åä½¿ç”¨è¿™äº›æ–°å±æ€§ã€‚</p>
<p>æ‰“å¼€RWTSearchResultsTableViewCell.mæ–‡ä»¶ï¼Œå¯¼å…¥æ–°çš„å¤´æ–‡ä»¶ï¼š</p>
<pre><code>#import &quot;RWTSearchResultsItemViewModel.h&quot;
</code></pre><p>ç„¶åæ”¹å˜bindViewModelæ–¹æ³•ä¸­çš„ç¬¬ä¸€è¡Œæ¥ä½¿ç”¨æ–°æ·»åŠ çš„ViewModelï¼š</p>
<pre><code>RWTSearchResultsItemViewModel *photo = viewModel;
</code></pre><p>è¿˜æ˜¯è¿™ä¸ªæ–¹æ³•ï¼Œæ·»åŠ å¦‚ä¸‹ï¼š</p>
<pre><code>[RACObserve(photo, favorites) subscribeNext:^(NSNumber *x) {
      self.favouritesLabel.text = [x stringValue];
      self.favouritesIcon.hidden = (x == nil);
}];

[RACObserve(photo, comments) subscribeNext:^(NSNumber *x) {
      self.commentsLabel.text = [x stringValue];
      self.commentsIcon.hidden = (x == nil);
}];

photo.isVisible = YES;
</code></pre><p>è¿™æ ·å°±è§‚å¯Ÿäº†æ–°çš„commentså’Œfavoriteså±æ€§ï¼Œç„¶åç”¨äºæ›´æ–°ç›¸åº”çš„labelå’Œå›¾ç‰‡ã€‚</p>
<p>æœ€åï¼Œå°†ViewModelçš„isVisibleå±æ€§è®¾ä¸ºYESã€‚</p>
<p>æœ€ç»ˆç‰ˆæœ¬çš„å·¥ç¨‹å¯åˆ°<a href="https://github.com/ColinEberhardt/ReactiveFlickrSearch" target="_blank" rel="external">è¿™é‡Œ</a>ä¸‹è½½ã€‚</p>
<p>PSï¼š</p>
<ol>
<li>åŸä½œè€…åœ¨åšå®¢ä¸­è¿˜åŠ å…¥äº†ä¸€äº›UIæ•ˆæœï¼Œä½†å’ŒMVVMæ— å…³ï¼Œæ•…æ²¡æœ‰ç¿»è¯‘ã€‚</li>
<li>æœ€ç»ˆç‰ˆçš„å·¥ç¨‹ä¸­è¿˜æœ‰ä¸€äº›åŠŸèƒ½ä½†æ˜¯åšå®¢å¹¶æ²¡æœ‰ç»†è‡´è®²è§£ï¼Œå¯è‡ªè¡ŒæŸ¥çœ‹ã€‚</li>
</ol>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æœ¬æ–‡ç”±Colin Eberhardtäº14å¹´å‘è¡¨äº&lt;a href=&quot;https://www.raywenderlich.com&quot;&gt;raywenderlich&lt;/a&gt;ï¼ŒåŸæ–‡å¯æŸ¥çœ‹&lt;a href=&quot;https://www.raywenderlich.com/74131/mvvm-tutorial-with-reactivecocoa-part-2&quot;&gt;MVVM Tutorial with ReactiveCocoa: Part 2/2&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;Model-View-ViewModel (MVVM) æ˜¯ä¸€ç§æ­£åœ¨é€æ¸æˆä¸ºModel-View-Controller (MVC)çš„æ›¿ä»£æ–¹æ¡ˆçš„UIè®¾è®¡æ¨¡å¼ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨æœ¬æ•™ç¨‹çš„&lt;a href=&quot;https://kaisayoung.github.io/undefined/iOS/2016-09-02-MVVM-Tutorial-with-ReactiveCocoa-Part-1-2%E3%80%90%E8%AF%91%E3%80%91.html#more&quot;&gt;ç¬¬ä¸€éƒ¨åˆ†&lt;/a&gt;ä¸­ï¼Œä½ å·²ç»è§è¯†åˆ°ReactiveCocoaæ˜¯æ€æ ·æ‰®æ¼”â€˜èƒ¶æ°´â€™çš„è§’è‰²æ¥å°†ViewModelç»‘å®šåˆ°ç›¸åº”çš„Viewä¸Šã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="ç¿»è¯‘" scheme="http://yoursite.com/categories/%E7%BF%BB%E8%AF%91/"/>
    
    
      <category term="MVVM" scheme="http://yoursite.com/tags/MVVM/"/>
    
  </entry>
  
  <entry>
    <title>MVVM &amp; ReactiveCocoaå…¥é—¨æ•™ç¨‹ï¼ç¬¬ä¸€éƒ¨åˆ†</title>
    <link href="http://yoursite.com/2016/09/02/MVVM-Tutorial-with-ReactiveCocoa-Part-1-2%E3%80%90%E8%AF%91%E3%80%91/"/>
    <id>http://yoursite.com/2016/09/02/MVVM-Tutorial-with-ReactiveCocoa-Part-1-2ã€è¯‘ã€‘/</id>
    <published>2016-09-02T15:26:54.000Z</published>
    <updated>2016-09-04T17:27:05.000Z</updated>
    
    <content type="html"><![CDATA[<p>æœ¬æ–‡ç”±Colin Eberhardtäº14å¹´å‘è¡¨äº<a href="https://www.raywenderlich.com" target="_blank" rel="external">raywenderlich</a>ï¼ŒåŸæ–‡å¯æŸ¥çœ‹<a href="https://www.raywenderlich.com/74106/mvvm-tutorial-with-reactivecocoa-part-1" target="_blank" rel="external">MVVM Tutorial with ReactiveCocoa: Part 1/2</a>ï¼Œä¹‹å‰å·²ç»æœ‰è¿‡ä¸€ç¯‡è¿˜ä¸é”™çš„ç¿»è¯‘åœ¨<a href="http://www.cnblogs.com/panyuluoye/p/4979740.html" target="_blank" rel="external">è¿™é‡Œ</a>ï¼Œä½†æ˜¯è²Œä¼¼åªç¿»è¯‘äº†ç¬¬ä¸€éƒ¨åˆ†ï¼Œäºæ˜¯æˆ‘æƒ³åˆ°è¦ç¿»è¯‘ç¬¬äºŒéƒ¨åˆ†ï¼Œé¡ºä¾¿ä¹Ÿé‡æ–°ç¿»è¯‘ä¸‹ç¬¬ä¸€éƒ¨åˆ†å½“ä½œå¤ä¹ ã€‚<br><a id="more"></a><br>ä½ å¯èƒ½ä¹‹å‰å·²ç»åœ¨Twitterä¸Šè§è¿‡è¿™ä¸ªç¬‘è¯ï¼š</p>
<blockquote>
<p>â€œiOS Architecture, where MVC stands for Massive View Controllerâ€</p>
</blockquote>
<p>åœ¨iOSå¼€å‘åœˆå†…è¿™æ— ç–‘æ˜¯ä¸€ä¸ªè½»æ¾çš„ç¬‘è¯ï¼Œä½†æ˜¯æˆ‘ç¡®å®šä½ åœ¨å®é™…å¼€å‘ä¸­å·²ç»é‡åˆ°è¿™ä¸ªé—®é¢˜ï¼šview controllerè‡ƒè‚¿ä¸å ªä¸”éš¾ä»¥ç®¡ç†ã€‚</p>
<p>è¿™ç¯‡MVVMçš„æ•™ç¨‹æä¾›äº†ä¸€ç§æ–°çš„æ„å»ºåº”ç”¨çš„æ–¹å¼ï¼Œå³Modelï¼Viewï¼ViewModelï¼Œæˆ–è€…ç§°ä¹‹ä¸ºMVVMã€‚è¿™ç§æ–¹å¼ï¼Œå†ä½¿ç”¨ä¸ŠReactiveCocoaï¼Œæä¾›äº†ä¸€ç§æå¥½çš„æ›¿ä»£MVCçš„é€‰æ‹©æ€§ï¼Œå¯ä¿è¯view controllerè½»é‡åŒ–ã€‚</p>
<p>è·Ÿç€è¿™ç¯‡MVVMæ•™ç¨‹ï¼Œä½ å°†è¦æ„å»ºä¸€ä¸ªç®€å•çš„Flickræœç´¢ç¨‹åºï¼Œæ•ˆæœå¦‚ä¸‹ï¼š</p>
<p><img src="http://www.raywenderlich.com/wp-content/uploads/2014/06/FinishedApp.png" alt=""> </p>
<p>åœ¨å¼€å§‹å†™ä»£ç ä¹‹å‰ï¼Œå…ˆæ¥äº†è§£ä¸€ç‚¹åŸç†ã€‚</p>
<h3 id="ReactiveCocoaç®€çŸ­ä»‹ç»"><a href="#ReactiveCocoaç®€çŸ­ä»‹ç»" class="headerlink" title="ReactiveCocoaç®€çŸ­ä»‹ç»"></a>ReactiveCocoaç®€çŸ­ä»‹ç»</h3><p>è¿™ç¯‡æ•™ç¨‹ä¸»è¦æ˜¯ä»‹ç»MVVMçš„ï¼Œå‡è®¾ä½ å·²ç»å¯¹ReactiveCocoaæœ‰äº†ä¸€ç‚¹äº†è§£ã€‚<br>å¦‚æœæ²¡æœ‰çš„è¯å¯é¦–å…ˆæŸ¥çœ‹è¿™ä¸¤ç¯‡æ— å¾€è€Œä¸èƒœçš„å…¥é—¨ä»‹ç»ã€‚</p>
<p><a href="https://www.raywenderlich.com/62699/reactivecocoa-tutorial-pt1" target="_blank" rel="external">ReactiveCocoa Tutorial â€“ The Definitive Introduction: Part 1/2</a></p>
<p><a href="https://www.raywenderlich.com/62796/reactivecocoa-tutorial-pt2" target="_blank" rel="external">ReactiveCocoa Tutorial â€“ The Definitive Introduction: Part 2/2</a></p>
<p>ReactiveCocoaåšå¤§ç²¾æ·±ï¼Œæˆ‘åªæ˜¯åšä¸€ä¸ªç®€çŸ­æ¦‚æ‹¬ã€‚</p>
<p>åœ¨ReactiveCocoaä¸­æœ€æ ¸å¿ƒçš„å†…å®¹æ˜¯ä¿¡å·ï¼Œå³RACSignalç±»ï¼Œä¿¡å·ä¼šå‘é€ä¸€ç³»åˆ—åŒ…æ‹¬ä¸‰ç§ç±»å‹ï¼šnextï¼Œcompletedï¼Œerrorçš„äº‹ä»¶æµã€‚</p>
<p>è¿ç”¨æ­¤ï¼Œå¯ä»¥æ›¿ä»£delegateï¼Œtarget-actionï¼Œkvoï¼Œnotificationç­‰æ–¹å¼ã€‚</p>
<p>è¿ç”¨ä¿¡å·APIåˆ›å»ºçš„ä»£ç å¯è¯»æ€§æ›´å¥½ä¸€äº›ï¼Œä½†æ˜¯çœŸæ­£å¼ºå¤§ä¹‹å¤„åœ¨äºä½ å¯ä»¥å¯¹è¿™äº›ä¿¡å·è¿›è¡Œå¾ˆå¤šé«˜çº§åˆ«çš„æ“ä½œï¼Œè¿™äº›æ“ä½œä½¿å¾—ä½ èƒ½å¤Ÿä»¥ä¸€ç§é«˜æ•ˆç®€æ´çš„æ–¹å¼å®Œæˆå¤æ‚çš„è¿‡è™‘ï¼Œè½¬æ¢ï¼Œä¿¡å·ç»“åˆç­‰ã€‚</p>
<p>åœ¨MVVMçš„è®¾è®¡æ¨¡å¼ä¸­ï¼ŒReactiveCocoaèµ·ç€ç‰¹æ®Šçš„ä½œç”¨ï¼Œå®ƒæä¾›äº†èƒ½å¤Ÿå°†ViewModelç»‘å®šåˆ°Viewä¸Šçš„èƒ¶æ°´ã€‚</p>
<h3 id="MVVMæ¨¡å¼ä»‹ç»"><a href="#MVVMæ¨¡å¼ä»‹ç»" class="headerlink" title="MVVMæ¨¡å¼ä»‹ç»"></a>MVVMæ¨¡å¼ä»‹ç»</h3><p>Modelï¼Viewï¼ViewModelæ˜¯ä¸€ç§UIè®¾è®¡æ¨¡å¼ï¼Œå®ƒæ˜¯MV*å¤§å®¶åº­ä¸­çš„ä¸€å‘˜ï¼Œå…¶ä»–è¿˜åŒ…æ‹¬Model View Controll(MVC)ï¼ŒModel View Presenter(MVP)ç­‰ç­‰ã€‚</p>
<p>è¿™äº›UIè®¾è®¡æ¨¡å¼éƒ½è‡´åŠ›äºå°†UIé€»è¾‘å’Œä¸šåŠ¡é€»è¾‘ç›¸åˆ†ç¦»ï¼Œä»è€Œä½¿ç¨‹åºæ›´åŠ å®¹æ˜“å¼€å‘å’Œæµ‹è¯•ã€‚</p>
<p>ä¸ºäº†æ›´å¥½çš„ç†è§£MVVMè¿™ç§è®¾è®¡æ¨¡å¼ï¼Œæˆ‘ä»¬çœ‹çœ‹å®ƒæ˜¯æ€ä¹ˆæ¥çš„ã€‚</p>
<p>MVCæ˜¯æœ€æ—©çš„UIè®¾è®¡æ¨¡å¼ï¼Œå¯è¿½æº¯åˆ°Smalltalkè¯­è¨€ä¸­ã€‚ä¸‹é¢è¿™å¹…å›¾è¯´æ˜äº†MVCæ¨¡å¼çš„ä¸»è¦ç»„æˆéƒ¨åˆ†ï¼š</p>
<p><img src="http://www.raywenderlich.com/wp-content/uploads/2014/06/MVCPattern-2.png" alt=""> </p>
<p>è¿™ä¸ªæ¨¡å¼å°†UIåˆ†æˆModel(è¡¨ç¤ºç¨‹åºçŠ¶æ€)ã€View(ç”±UIæ§ä»¶ç»„æˆ)ã€Controller(å¤„ç†ç”¨æˆ·äº¤äº’ä¸æ›´æ–°model)ã€‚MVCæ¨¡å¼çš„æœ€å¤§é—®é¢˜æ˜¯å®ƒä¼šä»¤äººç›¸å½“å›°æƒ‘ã€‚å®ƒçš„æ¦‚å¿µçœ‹èµ·æ¥å¾ˆå¥½ï¼Œä½†å½“æˆ‘ä»¬å®ç°MVCæ—¶ï¼Œå°±ä¼šäº§ç”Ÿä¸Šå›¾è¿™ç§åœ¨Modelï¼ŒViewï¼ŒControllerä¹‹é—´çš„ç¯çŠ¶å…³ç³»ã€‚è¿™ç§ç›¸äº’å…³ç³»å°†ä¼šå¯¼è‡´ç›¸å½“çš„æ··ä¹±ã€‚</p>
<p>æœ€è¿‘Martin Fowlerä»‹ç»äº†MVCæ¨¡å¼çš„ä¸€ä¸ªå˜ç§ï¼Œè¿™ç§æ¨¡å¼å‘½åä¸ºMVVMï¼Œå¹¶è¢«å¾®è½¯å¹¿æ³›é‡‡ç”¨å¹¶æ¨å¹¿ã€‚</p>
<p>ä¸ä¹…ä»¥å‰Martin Fowlerä»‹ç»äº†MVCæ¨¡å¼çš„ä¸€ä¸ªå˜ç§ï¼Œè¿™ç§æ¨¡å¼å‘½åä¸ºMVVMï¼Œå¹¶è¢«å¾®è½¯å¹¿æ³›é‡‡ç”¨å¹¶æ¨å¹¿ã€‚</p>
<p><img src="http://www.raywenderlich.com/wp-content/uploads/2014/06/MVVMPattern.png" alt=""></p>
<p>è¿™ä¸ªæ¨¡å¼çš„æ ¸å¿ƒæ˜¯ViewModelï¼Œå®ƒæ˜¯ä¸€ç§ç‰¹æ®Šçš„modelç±»å‹ï¼Œç”¨äºè¡¨ç¤ºç¨‹åºçš„UIçŠ¶æ€ã€‚</p>
<p>å®ƒåŒ…å«äº†æè¿°æ¯ä¸ªUIæ§ä»¶çŠ¶æ€çš„å±æ€§ã€‚ä¾‹å¦‚ï¼Œæ–‡æœ¬è¾“å…¥æ¡†çš„å½“å‰æ–‡æœ¬ï¼Œæˆ–è€…ä¸€ä¸ªç‰¹å®šæŒ‰é’®æ˜¯å¦å¯è¢«ç‚¹å‡»ï¼›å®ƒåŒæ ·æš´éœ²äº†è§†å›¾å¯ä»¥æ‰§è¡Œçš„è¡Œä¸ºï¼Œå¦‚æŒ‰é’®ç‚¹å‡»æˆ–æ‰‹åŠ¿ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥å°†ViewModelçœ‹ä½œæ˜¯è§†å›¾çš„æ¨¡å‹(model-of-the-view)ã€‚MVVMæ¨¡å¼ä¸­çš„ä¸‰éƒ¨åˆ†æ¯”MVCæ›´åŠ ç®€æ´ï¼Œä¸‹é¢æ˜¯ä¸€äº›ä¸¥æ ¼çš„é™åˆ¶ï¼š</p>
<ol>
<li><p>Viewå¼•ç”¨ViewModelï¼Œä½†åè¿‡æ¥ä¸è¡Œã€‚</p>
</li>
<li><p>ViewModelå¼•ç”¨Modelï¼Œä½†åè¿‡æ¥ä¸è¡Œã€‚</p>
</li>
</ol>
<p>å¦‚æœæˆ‘ä»¬ç ´åäº†è¿™äº›è§„åˆ™ï¼Œä¾¿é”™è¯¯çš„åº”ç”¨äº†MVVMã€‚</p>
<p>è¿™ä¸ªæ¨¡å¼æœ‰ä¸€äº›ç«‹ç«¿è§å½±çš„ä¼˜åŠ¿ï¼š</p>
<ol>
<li><p>è½»é‡çš„è§†å›¾ï¼šæ‰€æœ‰çš„UIé€»è¾‘éƒ½è½¬ç§»åˆ°ViewModelä¸­ã€‚</p>
</li>
<li><p>ä¾¿äºæµ‹è¯•ï¼šæˆ‘ä»¬å¯ä»¥åœ¨æ²¡æœ‰è§†å›¾çš„æƒ…å†µä¸‹è¿è¡Œæ•´ä¸ªç¨‹åºï¼Œè¿™æ ·å¤§å¤§åœ°å¢åŠ äº†å®ƒçš„å¯æµ‹è¯•æ€§ã€‚</p>
</li>
</ol>
<p>ç°åœ¨ä½ å¯èƒ½æ³¨æ„åˆ°ä¸€ä¸ªé—®é¢˜ã€‚å¦‚æœViewå¼•ç”¨äº†ViewModelï¼Œä½†æ˜¯åè¿‡æ¥ViewModelæ²¡æœ‰å¼•ç”¨Viewï¼Œé‚£ViewModelå¦‚ä½•æ›´æ–°Viewå‘¢ï¼Ÿå•Šå“ˆï¼Œè¿™å°±å¾—é MVVMæ¨¡å¼çš„ç§å¯†æ­¦å™¨äº†ã€‚</p>
<h3 id="MVVMå’Œæ•°æ®ç»‘å®š"><a href="#MVVMå’Œæ•°æ®ç»‘å®š" class="headerlink" title="MVVMå’Œæ•°æ®ç»‘å®š"></a>MVVMå’Œæ•°æ®ç»‘å®š</h3><p>MVVMæ¨¡å¼ä¾èµ–äºæ•°æ®ç»‘å®šï¼Œå®ƒæ˜¯ä¸€ä¸ªæ¡†æ¶çº§åˆ«çš„ç‰¹æ€§ï¼Œç”¨äºè‡ªåŠ¨è¿æ¥å¯¹è±¡å±æ€§å’ŒUIæ§ä»¶ã€‚</p>
<p>ä¾‹å¦‚ï¼Œåœ¨å¾®è½¯çš„WPFæ¡†æ¶ä¸­ï¼Œä¸‹é¢çš„æ ‡ç­¾å°†ä¸€ä¸ªTextFieldçš„Textå±æ€§ç»‘å®šåˆ°ViewModelçš„Usernameå±æ€§ä¸­ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;TextField Text=â€&#123;DataBinding Path=Username, Mode=TwoWay&#125;â€/&gt;</div></pre></td></tr></table></figure>
<p>WPFæ¡†æ¶å°†è¿™ä¸¤ä¸ªå±æ€§ç»‘å®šåˆ°ä¸€èµ·ã€‚</p>
<p>è¿™ç§åŒå‘ç»‘å®šæœºåˆ¶èƒ½å¤Ÿä¿è¯ViewModelä¸­çš„Usernameå±æ€§å˜åŒ–æ—¶èƒ½å¤Ÿä¼ é€’åˆ°TextFieldä¸­çš„Textå±æ€§ï¼Œåè¿‡æ¥å½“ç”¨æˆ·æ“ä½œTextFieldæ—¶ä¹Ÿèƒ½ååº”åˆ°ViewModelä¸­ã€‚</p>
<p>ç„¶è€Œä¸å¹¸çš„æ˜¯ï¼ŒiOSæ²¡æœ‰æ•°æ®ç»‘å®šæ¡†æ¶ï¼Œå¹¸è¿çš„æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡ReactiveCocoaæ¥å®ç°è¿™ä¸€åŠŸèƒ½ã€‚</p>
<p>æˆ‘ä»¬ä»iOSå¼€å‘çš„è§’åº¦æ¥çœ‹çœ‹MVVMæ¨¡å¼ï¼ŒViewControlleråŠå…¶ç›¸å…³çš„UI(nib, stroyboardæˆ–çº¯ä»£ç çš„View)ä¸€èµ·ç»„æˆäº†View:</p>
<p><img src="http://www.raywenderlich.com/wp-content/uploads/2014/06/MVVMReactiveCocoa.png" alt=""></p>
<p>â€¦â€¦è€ŒReactiveCocoaå°†Viewå’ŒViewModelè¿›è¡Œäº†ç»‘å®šã€‚</p>
<p>å¦‚æœä½ æ„Ÿè§‰è¿˜OKï¼Œé‚£æˆ‘ä»¬å¼€å§‹æ–°çš„å¾ç¨‹ã€‚</p>
<h3 id="å¼€å§‹æ–°å·¥ç¨‹"><a href="#å¼€å§‹æ–°å·¥ç¨‹" class="headerlink" title="å¼€å§‹æ–°å·¥ç¨‹"></a>å¼€å§‹æ–°å·¥ç¨‹</h3><p>é¦–å…ˆä»<a href="http://www.raywenderlich.com/wp-content/uploads/2014/06/FlickrSearchStarterProject1.zip" target="_blank" rel="external">FlickrSearchStarterProject.zip</a>ä¸­ä¸‹è½½å¯åŠ¨é¡¹ç›®ã€‚</p>
<p>ä¸‹è½½ä¸‹æ¥åpod installä¸€ä¸‹ï¼Œç„¶åæ‰“å¼€å·¥ç¨‹ï¼Œrunä¸€ä¸‹åæ•ˆæœå¦‚ä¸‹å›¾ï¼š</p>
<p><img src="http://www.raywenderlich.com/wp-content/uploads/2014/06/first-launch.jpg" alt=""></p>
<p>èŠ±ç‚¹æ—¶é—´å…ˆç†Ÿæ‚‰ä¸€ä¸‹å·¥ç¨‹çš„ç»“æ„ï¼š</p>
<p><img src="http://www.raywenderlich.com/wp-content/uploads/2014/06/EmptyInterface.png" alt=""></p>
<p>Modelå’ŒViewModelåˆ†ç»„ç›®å‰æ˜¯ç©ºçš„ï¼Œæˆ‘ä»¬ä¸€ä¼šå„¿ä¼šå¾€é‡Œé¢æ·»åŠ ä¸œè¥¿ã€‚Viewåˆ†ç»„åŒ…å«ï¼š</p>
<ul>
<li><p>RWTFlickSearchViewControllerï¼šç¨‹åºçš„ä¸»å±å¹•ï¼ŒåŒ…å«ä¸€ä¸ªæœç´¢çš„text fieldå’Œä¸€ä¸ªGO buttonã€‚</p>
</li>
<li><p>RWTRecentSearchItemTableViewCellï¼šç”¨äºåœ¨ä¸»é¡µä¸­æ˜¾ç¤ºæœ€è¿‘æœç´¢ç»“æœçš„table cell</p>
</li>
<li><p>RWTSearchResultsViewControllerï¼šæœç´¢ç»“æœé¡µï¼Œæ˜¾ç¤ºæ¥è‡ªFlickrçš„å›¾ç‰‡çš„tableview</p>
</li>
<li><p>RWTSearchResultsTableViewCellï¼šæ¸²æŸ“æ¥è‡ªFlickrçš„å•ä¸ªå›¾ç‰‡çš„table cell</p>
</li>
</ul>
<p>ç°åœ¨æ¥å¢åŠ ç¬¬ä¸€ä¸ªViewModelï¼</p>
<h3 id="ç¬¬ä¸€ä¸ªViewModel"><a href="#ç¬¬ä¸€ä¸ªViewModel" class="headerlink" title="ç¬¬ä¸€ä¸ªViewModel"></a>ç¬¬ä¸€ä¸ªViewModel</h3><p>åœ¨ViewModelåˆ†ç»„ä¸­æ·»åŠ ä¸€ä¸ªç»§æ‰¿è‡ªNSObjectçš„æ–°ç±»RWTFlickrSearchViewModelã€‚</p>
<p>ç„¶ååœ¨è¯¥ç±»çš„å¤´æ–‡ä»¶ä¸­ï¼Œæ·»åŠ å‡ ä¸ªå±æ€§ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">@interface RWTFlickrSearchViewModel : NSObject</div><div class="line"></div><div class="line">@property (strong, nonatomic) NSString *searchText;</div><div class="line">@property (strong, nonatomic) NSString *title;</div><div class="line"> </div><div class="line">@end</div></pre></td></tr></table></figure>
<p>searchTextå±æ€§è¡¨ç¤ºtext fieldä¸­æ˜¾ç¤ºçš„æ–‡æœ¬ï¼Œtitleå±æ€§è¡¨ç¤ºå¯¼èˆªæ¡ä¸Šçš„æ ‡é¢˜ã€‚</p>
<p>æ‰“å¼€RWTFlickrSearchViewModel.mæ–‡ä»¶æ·»åŠ ä»¥ä¸‹ä»£ç ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">@implementation RWTFlickrSearchViewModel</div><div class="line"> </div><div class="line">- (instancetype)init &#123;</div><div class="line">  self = [super init];</div><div class="line">  if (self) &#123;</div><div class="line">    [self initialize];</div><div class="line">  &#125;</div><div class="line">  return self;</div><div class="line">&#125;</div><div class="line"> </div><div class="line">- (void)initialize &#123;</div><div class="line">  self.searchText = @&quot;search text&quot;;</div><div class="line">  self.title = @&quot;Flickr Search&quot;;</div><div class="line">&#125;</div><div class="line"> </div><div class="line">@end</div></pre></td></tr></table></figure>
<p>è¿™æ®µä»£ç ç®€å•åœ°è®¾ç½®äº†ViewModelçš„åˆå§‹çŠ¶æ€ã€‚</p>
<p>ä¸‹ä¸€æ­¥å°±æ˜¯å°†ViewModelè¿æ¥åˆ°Viewä¸Šã€‚è®°ä½Viewä¿ç•™äº†ä¸€ä¸ªå¯¹ViewModelçš„å¼•ç”¨ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ·»åŠ ä¸€ä¸ªç»™å®šViewModelæ¥æ„é€ Viewçš„åˆå§‹åŒ–æ–¹æ³•æ˜¯ç†æ‰€å½“ç„¶çš„ã€‚</p>
<p>æ³¨æ„ï¼šåœ¨MVVMæ¨¡å¼ä¸‹ï¼ŒControllerä¹Ÿå˜æˆäº†Viewçš„ä¸€å‘˜ï¼Œè¿™å’Œç³»ç»Ÿçš„UIKitçš„ä½¿ç”¨æ–¹æ³•å¤§ç›¸å¾„åº­ã€‚</p>
<p>æ‰“å¼€RWTFlickrSearchViewController.hï¼Œå¹¶å¯¼å…¥ViewModelå¤´æ–‡ä»¶ï¼Œç„¶åæ·»åŠ åˆå§‹åŒ–æ–¹æ³•ï¼š</p>
<pre><code>@interface RWTFlickrSearchViewController : UIViewController

- (instancetype)initWithViewModel:(RWTFlickrSearchViewModel *)viewModel;

@end
</code></pre><p>åœ¨RWTFlickrSearchViewController.mä¸­ï¼Œåœ¨ç±»çš„æ‰©å±•ä¸­æ·»åŠ ä»¥ä¸‹ç§æœ‰å±æ€§ï¼š</p>
<pre><code>@property (weak, nonatomic) RWTFlickrSearchViewModel *viewModel;
</code></pre><p>ç„¶åæ·»åŠ åˆå§‹åŒ–æ–¹æ³•ï¼š</p>
<pre><code>- (instancetype)initWithViewModel:(RWTFlickrSearchViewModel *)viewModel {
  self = [super init];
  if (self) {
  _viewModel = viewModel;
  }
  return self;
}
</code></pre><p>è¿™å°±åœ¨Viewä¸­å­˜å‚¨äº†ä¸€ä¸ªViewModelçš„å¼•ç”¨ã€‚</p>
<p>æ³¨æ„ï¼šè¿™åªæ˜¯ä¸€ä¸ªå¼±å¼•ç”¨ã€‚</p>
<p>æ¥ä¸‹æ¥åœ¨viewDidLoadçš„æœ€åæ·»åŠ ä¸‹é¢ä»£ç ï¼š</p>
<pre><code>[self bindViewModel];
</code></pre><p>è¯¥æ–¹æ³•çš„å®ç°å¦‚ä¸‹ï¼š</p>
<pre><code>- (void)bindViewModel {
 self.title = self.viewModel.title;
 self.searchTextField.text = self.viewModel.searchText;
}
</code></pre><p>ä»¥ä¸Šçš„ä»£ç åœ¨UIåˆå§‹åŒ–çš„æ—¶å€™æ‰§è¡Œï¼Œå°†ViewModelçš„çŠ¶æ€åº”ç”¨åˆ°Viewä¸Šã€‚</p>
<p>æœ€åä¸€æ­¥æ˜¯åˆ›å»ºä¸€ä¸ªViewModelçš„å®ä¾‹å¯¹è±¡ï¼Œå¹¶å°†å…¶æä¾›ç»™Viewã€‚</p>
<p>åœ¨RWTAppDelegate.mä¸­ï¼Œå¯¼å…¥ViewModelå¤´æ–‡ä»¶ï¼Œç„¶åæ·»åŠ ä¸€ä¸ªç§æœ‰å±æ€§ï¼š</p>
<pre><code>@property (strong, nonatomic) RWTFlickrSearchViewModel *viewModel;
</code></pre><p>ä½ ä¼šå‘ç°è¿™ä¸ªç±»ä¸­å·²ç»æœ‰äº†ä¸€ä¸ªcreateInitialViewControlleræ–¹æ³•ï¼Œç”¨ä»¥ä¸‹ä»£ç æ¥æ›´æ–°å®ƒï¼š</p>
<pre><code>- (UIViewController *)createInitialViewController {
   self.viewModel = [RWTFlickrSearchViewModel new];
   return [[RWTFlickrSearchViewController alloc] initWithViewModel:self.viewModel];
}
</code></pre><p>è¿™ä¸ªæ–¹æ³•åˆ›å»ºäº†ä¸€ä¸ªViewModelå®ä¾‹ï¼Œç„¶åæ„é€ å¹¶è¿”å›äº†Viewã€‚è¿™ä¸ªviewä½œä¸ºç¨‹åºnavigation controllerçš„åˆå§‹è§†å›¾ã€‚</p>
<p>é‡æ–°runä¸€ä¸‹ä¼šå‘ç°Viewç°åœ¨å·²ç»æœ‰äº†ä¸€äº›çŠ¶æ€ï¼š</p>
<p><img src="http://www.raywenderlich.com/wp-content/uploads/2014/06/ViewWithState.png" alt=""></p>
<p>è¿™æ ·æˆ‘ä»¬å°±å¾—åˆ°äº†ç¬¬ä¸€ä¸ªViewModelã€‚ä¸è¿‡ä»ç„¶æœ‰è®¸å¤šä¸œè¥¿è¦å­¦çš„ã€‚ä½ å¯èƒ½å·²ç»å‘ç°äº†æˆ‘ä»¬è¿˜æ²¡æœ‰ä½¿ç”¨ReactiveCocoaã€‚åˆ°ç›®å‰ä¸ºæ­¢ï¼Œç”¨æˆ·åœ¨è¾“å…¥æ¡†ä¸Šçš„è¾“å…¥æ“ä½œä¸ä¼šå½±å“åˆ°ViewModelã€‚</p>
<h3 id="æ£€æµ‹æœ‰æ•ˆçš„æœç´¢çŠ¶æ€"><a href="#æ£€æµ‹æœ‰æ•ˆçš„æœç´¢çŠ¶æ€" class="headerlink" title="æ£€æµ‹æœ‰æ•ˆçš„æœç´¢çŠ¶æ€"></a>æ£€æµ‹æœ‰æ•ˆçš„æœç´¢çŠ¶æ€</h3><p>åœ¨è¿™ä¸€éƒ¨åˆ†ï¼Œå°†ä½¿ç”¨ReactiveCocoaæ¥ç»‘å®šViewModelå’ŒViewï¼Œä»è€Œå°†text fieldå’Œbuttonè¿æ¥åˆ°ViewModelã€‚</p>
<p>åœ¨RWTFlickrSearchViewController.mä¸­ï¼Œæ›´æ–°bindViewModelæ–¹æ³•ã€‚</p>
<pre><code>- (void)bindViewModel {
   self.title = self.viewModel.title;
   RAC(self.viewModel, searchText) = self.searchTextField.rac_textSignal;
}
</code></pre><p>åœ¨ReactiveCocoaä¸­ï¼Œä½¿ç”¨äº†categoryå°†rac_textSignalå±æ€§æ·»åŠ åˆ°UITextFieldç±»ä¸­ã€‚å®ƒæ˜¯ä¸€ä¸ªä¿¡å·ï¼Œåœ¨text fieldæ¯æ¬¡æ›´æ–°æ—¶ä¼šå‘é€ä¸€ä¸ªåŒ…å«å½“å‰æ–‡æœ¬çš„nextäº‹ä»¶ã€‚<br>RACå®æ˜¯ä¸€ä¸ªç»‘å®šæ“ä½œï¼Œä¸Šé¢çš„ä»£ç ä¼šä½¿ç”¨rac_textSignalå‘å‡ºçš„nextä¿¡å·æ¥æ›´æ–°viewModelçš„searchTextå±æ€§ã€‚</p>
<p>æœç´¢æŒ‰é’®åº”è¯¥åªæœ‰åœ¨ç”¨æˆ·è¾“å…¥æœ‰æ•ˆæ—¶æ‰å¯ç‚¹å‡»ã€‚ä¸ºäº†æ–¹ä¾¿èµ·è§ï¼Œæˆ‘ä»¬ä»¥è¾“å…¥å­—ç¬¦å¤§äº3æ—¶è¾“å…¥æœ‰æ•ˆä¸ºå‡†ã€‚åœ¨RWTFlickrSearchViewModel.mä¸­å¯¼å…¥ä»¥ä¸‹å¤´æ–‡ä»¶ã€‚</p>
<p>ç®€è€Œè¨€ä¹‹ï¼Œè¿™æ ·ç¡®ä¿äº†searchTextå±æ€§æ€»æ˜¯èƒ½åæ˜ å½“å‰çš„UIçŠ¶æ€ã€‚å¦‚æœä½ å·²ç»æ‡µé€¼äº†ï¼Œè¿˜æ˜¯ä¹–ä¹–çš„å…ˆå»çœ‹çœ‹æ–‡ç« å¼€å¤´æåˆ°çš„ä¸¤ç¯‡ReactiveCocoaå…¥é—¨ä»‹ç»å§ã€‚</p>
<p>æœç´¢æŒ‰é’®åº”è¯¥åªæœ‰åœ¨ç”¨æˆ·è¾“å…¥å†…å®¹æœ‰æ•ˆæ—¶æ‰å¯ç‚¹å‡»ã€‚ä¸ºäº†æ–¹ä¾¿èµ·è§ï¼Œæˆ‘ä»¬ä»¥è¾“å…¥å­—ç¬¦æ•°å¤§äº3æ—¶æœ‰æ•ˆä¸ºå‡†ã€‚åœ¨RWTFlickrSearchViewModel.mä¸­æ·»åŠ ä»¥ä¸‹å¤´æ–‡ä»¶ã€‚</p>
<pre><code>#import &lt;ReactiveCocoa/ReactiveCocoa.h&gt;
</code></pre><p>ç„¶åæ›´æ–°åˆå§‹åŒ–æ–¹æ³•ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">- (void)initialize &#123;</div><div class="line">  self.title = @&quot;Flickr Search&quot;;</div><div class="line"> </div><div class="line">  RACSignal *validSearchSignal =</div><div class="line">    [[RACObserve(self, searchText)</div><div class="line">      map:^id(NSString *text) &#123;</div><div class="line">         return @(text.length &gt; 3);</div><div class="line">      &#125;]</div><div class="line">      distinctUntilChanged];</div><div class="line"> </div><div class="line">  [validSearchSignal subscribeNext:^(id x) &#123;</div><div class="line">    NSLog(@&quot;search text is valid %@&quot;, x);</div><div class="line">  &#125;];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è¿è¡Œç¨‹åºç„¶ååœ¨è¾“å…¥æ¡†ä¸­è¾“å…¥ä¸€äº›å­—ç¬¦ï¼Œåœ¨æ§åˆ¶å°ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¾“å…¥çš„å†…å®¹å…¨éƒ¨è½¬æ¢æˆäº†æœ‰æ•ˆæˆ–è€…æ— æ•ˆçš„çŠ¶æ€ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">2014-05-27 18:03:26.299 RWTFlickrSearch[13392:70b] search text is valid 0</div><div class="line">2014-05-27 18:03:28.379 RWTFlickrSearch[13392:70b] search text is valid 1</div><div class="line">2014-05-27 18:03:29.811 RWTFlickrSearch[13392:70b] search text is valid 0</div></pre></td></tr></table></figure>
<p>ä¸Šé¢çš„ä»£ç ä½¿ç”¨RACObserveå®ä»ViewModelçš„searchTextå±æ€§åˆ›å»ºäº†ä¸€ä¸ªä¿¡å·ï¼ˆè¿™æ˜¯ReactiveCocoaå¯¹KVOçš„å°è£…ï¼‰ã€‚mapæ“ä½œå°†textè½¬åŒ–ä¸ºä¸€ä¸ªtrueæˆ–falseå€¼çš„æµã€‚</p>
<p>æœ€åï¼ŒdistinctUntilChangesç¡®ä¿ä¿¡å·åªæœ‰åœ¨çŠ¶æ€æ”¹å˜æ—¶æ‰å‘å‡ºå€¼ã€‚</p>
<p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ReactiveCocoaè¢«ç”¨äºå°†Viewç»‘å®šåˆ°ViewModelï¼Œç¡®ä¿äº†è¿™ä¸¤è€…æ˜¯åŒæ­¥çš„ã€‚æ›´è¿›ä¸€æ­¥åœ°ï¼ŒReactiveCocoaåœ¨ViewModelçš„å†…éƒ¨ç”¨äºè§‚å¯Ÿè‡ªå·±çš„çŠ¶æ€åŠæ‰§è¡Œå…¶å®ƒæ“ä½œã€‚</p>
<p>è¿™å°±æ˜¯MVVMæ¨¡å¼çš„åŸºæœ¬æ¨¡å¼ã€‚ReactiveCocoaç”¨äºç»‘å®šViewå’ŒViewModelæ˜¯è‡³å…³é‡è¦çš„ï¼Œä½†åœ¨ç¨‹åºçš„å…¶å®ƒå±‚ä¹Ÿéå¸¸æœ‰ç”¨ã€‚</p>
<h3 id="æ·»åŠ æœç´¢å‘½ä»¤"><a href="#æ·»åŠ æœç´¢å‘½ä»¤" class="headerlink" title="æ·»åŠ æœç´¢å‘½ä»¤"></a>æ·»åŠ æœç´¢å‘½ä»¤</h3><p>åœ¨è¿™ä¸€éƒ¨åˆ†ä½ å°†ä½¿ç”¨validSearchSignalæ¥åˆ›å»ºä¸€ä¸ªå—æ§äºViewçš„æ“ä½œã€‚</p>
<p>æ‰“å¼€RWTFlickrSearchViewModel.hå¹¶æ·»åŠ ä»¥ä¸‹å¤´æ–‡ä»¶ï¼š</p>
<pre><code>#import &lt;ReactiveCocoa/ReactiveCocoa.h&gt;
</code></pre><p>æ·»åŠ ä»¥ä¸‹å±æ€§ï¼š</p>
<pre><code>@property (strong, nonatomic) RACCommand *executeSearch;
</code></pre><p>RACCommandæ˜¯ReactiveCocoaä¸­ç”¨äºè¡¨ç¤ºUIæ“ä½œçš„ä¸€ä¸ªç±»ã€‚å®ƒç”±ä¸€ä¸ªä»£è¡¨UIæ“ä½œç»“æœçš„ä¿¡å·å’Œè¡¨æ˜è¿™ä¸ªæ“ä½œå½“å‰æ˜¯å¦æ­£åœ¨è¢«æ‰§è¡Œçš„çŠ¶æ€ç»„æˆã€‚</p>
<p>åœ¨RWTFlickrSearchViewModel.mçš„initializeæ–¹æ³•çš„æœ€åæ·»åŠ ä»¥ä¸‹ä»£ç ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">self.executeSearch =</div><div class="line">  [[RACCommand alloc] initWithEnabled:validSearchSignal</div><div class="line">    signalBlock:^RACSignal *(id input) &#123;</div><div class="line">      return  [self executeSearchSignal];</div><div class="line">    &#125;];</div></pre></td></tr></table></figure>
<p>è¿™åˆ›å»ºäº†ä¸€ä¸ªå½“validSearchSignalå‘é€trueæ—¶å¯ç”¨çš„commandã€‚å¦å¤–ï¼Œåœ¨ä¸‹é¢æ·»åŠ executeSearchSignalæ–¹æ³•ä»¥æä¾›è¿™ä¸ªcommandæ‰€æ‰§è¡Œçš„æ“ä½œã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">- (RACSignal *)executeSearchSignal &#123;</div><div class="line">  return [[[[RACSignal empty]</div><div class="line">           logAll]</div><div class="line">           delay:2.0]</div><div class="line">           logAll];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>åœ¨è¿™ä¸ªæ–¹æ³•ä¸­ï¼Œä¼šæ‰§è¡Œä¸€äº›ä¸šåŠ¡é€»è¾‘æ“ä½œä½œä¸ºcommandæ‰§è¡Œçš„ç»“æœï¼Œå¹¶é€šè¿‡ä¿¡å·å¼‚æ­¥è¿”å›ç»“æœã€‚</p>
<p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œä¸Šé¢ä»…ä»…æ˜¯ä¸€ä¸ªå‡è£…çš„å®ç°ï¼šç©ºä¿¡å·ä¼šç«‹å³å®Œæˆã€‚delayæ“ä½œä¼šå°†å…¶æ‰€æ¥æ”¶åˆ°çš„nextæˆ–completeäº‹ä»¶å»¶è¿Ÿä¸¤ç§’æ‰§è¡Œã€‚ä¸ºäº†ä½¿ä»£ç æ›´é€¼çœŸè¿™æ˜¯ä¸€ä¸ªç‹¡çŒ¾çš„ç­–ç•¥ã€‚</p>
<p>æœ€åä¸€æ­¥æ˜¯å°†è¿™ä¸ªå‘½ä»¤è¿æ¥åˆ°Viewä¸­ã€‚æ‰“å¼€RWTFlickrSearchViewController.må¹¶åœ¨bindViewModelæ–¹æ³•çš„ç»“å°¾æ·»åŠ ä»¥ä¸‹ä»£ç ï¼š</p>
<pre><code>self.searchButton.rac_command = self.viewModel.executeSearch;
</code></pre><p>rac_commandå±æ€§æ˜¯ReactiveCocoaä¸ºUIButtonæ·»åŠ çš„ã€‚ä¸Šé¢çš„ä»£ç ç¡®ä¿ç‚¹å‡»æŒ‰é’®æ‰§è¡Œç»™å®šçš„å‘½ä»¤ï¼Œä¸”æŒ‰é’®çš„å¯ç‚¹å‡»çŠ¶æ€åæ˜ äº†å‘½ä»¤çš„å¯ç”¨çŠ¶æ€ã€‚</p>
<p>è¿è¡Œç¨‹åºï¼Œè¾“å…¥ä¸€äº›å­—ç¬¦å¹¶ç‚¹å‡»GOï¼š</p>
<p><img src="http://www.raywenderlich.com/wp-content/uploads/2014/06/GoButtonEnabled.png" alt=""></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œä»…å½“text fieldä¸­è¶…è¿‡3ä¸ªå­—æ¯æ—¶æŒ‰é’®æ‰å¯ç‚¹å‡»ï¼Œç‚¹å‡»åä¼šç½®ç°2ç§’é’Ÿè¡¨ç¤ºæ­¤æ—¶ä¸å¯ç‚¹å‡»ï¼Œå½“æ‰§è¡Œçš„ä¿¡å·å®Œæˆæ—¶åˆæ¢å¤å¯ç‚¹å‡»ã€‚ä»æ§åˆ¶å°ï¼Œå¯ä»¥å‘ç°ç©ºä¿¡å·ä¼šç«‹å³å®Œæˆï¼Œè€Œå»¶è¿Ÿæ“ä½œä¼šåœ¨2ç§’åå‘é€äº‹ä»¶ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">09:31:25.728 RWTFlickrSearch ... name: +empty completed</div><div class="line">09:31:27.730 RWTFlickrSearch ... name: [+empty] -delay: 2.0 completed</div></pre></td></tr></table></figure>
<p>å±Œçˆ†äº†æœ‰æœ¨æœ‰ï¼Ÿ</p>
<h3 id="ç»‘å®šã€ç»‘å®šæ›´å¤šç»‘å®š"><a href="#ç»‘å®šã€ç»‘å®šæ›´å¤šç»‘å®š" class="headerlink" title="ç»‘å®šã€ç»‘å®šæ›´å¤šç»‘å®š"></a>ç»‘å®šã€ç»‘å®šæ›´å¤šç»‘å®š</h3><p>RACCommandç›‘å¬äº†æœç´¢æŒ‰é’®çŠ¶æ€çš„æ›´æ–°ï¼Œä½†å¤„ç†activity indicatorçš„å¯è§æ€§åº”ç”±ä½ è´Ÿè´£ã€‚RACCommandæš´éœ²äº†ä¸€ä¸ªexecutingå±æ€§ï¼Œå®ƒæ˜¯ä¸€ä¸ªä¼šå‘é€trueæˆ–falseæ¥æ ‡æ˜å‘½ä»¤å¼€å§‹å’Œç»“æŸæ‰§è¡Œçš„ä¿¡å·ã€‚å¯ä»¥ç”¨è¿™ä¸ªæ¥åæ˜ å½“å‰å‘½ä»¤çš„çŠ¶æ€ã€‚</p>
<p>åœ¨RWTFlickrSearchViewController.mä¸­çš„bindViewModelæ–¹æ³•ç»“å°¾å¤„æ·»åŠ ä»¥ä¸‹ä»£ç ï¼š</p>
<pre><code>RAC([UIApplication sharedApplication], networkActivityIndicatorVisible) = self.viewModel.executeSearch.executing;
</code></pre><p>è¿™å°†UIApplicationçš„networkActivityIndicatorVisibleå±æ€§ç»‘å®šåˆ°å‘½ä»¤çš„executingä¿¡å·ä¸Šã€‚è¿™ç¡®ä¿äº†ä¸ç®¡å‘½ä»¤ä»€ä¹ˆæ—¶å€™æ‰§è¡Œï¼ŒçŠ¶æ€æ ä¸­çš„ç½‘ç»œactivity indicatoréƒ½ä¼šæ˜¾ç¤ºã€‚  </p>
<p>æ¥ä¸‹æ¥æ·»åŠ ä»¥ä¸‹ä»£ç ï¼š</p>
<pre><code>RAC(self.loadingIndicator, hidden) = [self.viewModel.executeSearch.executing not];
</code></pre><p>å½“å‘½ä»¤æ‰§è¡Œæ—¶ï¼Œåº”è¯¥éšè—åŠ è½½indicatorã€‚è¿™å¯ä»¥é€šè¿‡notæ“ä½œæ¥åè½¬ä¿¡å·ã€‚</p>
<p>æœ€åï¼Œæ·»åŠ ä»¥ä¸‹ä»£ç ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[self.viewModel.executeSearch.executionSignals</div><div class="line">  subscribeNext:^(id x) &#123;</div><div class="line">    [self.searchTextField resignFirstResponder];</div><div class="line">  &#125;];</div></pre></td></tr></table></figure>
<p>ä»¥ä¸Šä»£ç ç¡®ä¿å‘½ä»¤æ‰§è¡Œæ—¶éšè—é”®ç›˜ã€‚executionSignalså±æ€§å‘é€ç”±å‘½ä»¤æ¯æ¬¡æ‰§è¡Œæ—¶ç”Ÿæˆçš„ä¿¡å·ã€‚è¿™ä¸ªå±æ€§æ˜¯ä¿¡å·çš„ä¿¡å·(è§ReactiveCocoa Tutorial â€“ The Definitive Introduction: Part Â½)ã€‚å½“åˆ›å»ºå’Œå‘å‡ºä¸€ä¸ªæ–°çš„å‘½ä»¤æ‰§è¡Œä¿¡å·æ—¶ï¼Œéšè—é”®ç›˜ã€‚</p>
<p>è¿è¡Œç¨‹åºçœ‹çœ‹æ•ˆæœå¦‚ä½•å§ã€‚</p>
<h3 id="Modelå“ªå„¿å»äº†ï¼Ÿ"><a href="#Modelå“ªå„¿å»äº†ï¼Ÿ" class="headerlink" title="Modelå“ªå„¿å»äº†ï¼Ÿ"></a>Modelå“ªå„¿å»äº†ï¼Ÿ</h3><p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œå·²ç»æœ‰äº†ä¸€ä¸ªæ¸…æ™°çš„View(RWTFlickrSearchViewController)å’ŒViewModel(RWTFlickrSearchViewModel)ï¼Œä½†æ˜¯Modelåœ¨å“ªå‘¢ï¼Ÿ</p>
<p>ç­”æ¡ˆå¾ˆç®€å•ï¼šå¹¶æ²¡æœ‰ï¼</p>
<p>å½“å‰çš„ç¨‹åºä¼šæ‰§è¡Œä¸€ä¸ªå‘½ä»¤æ¥å“åº”ç”¨æˆ·ç‚¹å‡»æœç´¢æŒ‰é’®çš„æ“ä½œï¼Œä½†æ˜¯å®ç°ä¸åšä»»ä½•å€¼çš„å¤„ç†ã€‚</p>
<p>ViewModelçœŸæ­£éœ€è¦åšçš„æ˜¯ä½¿ç”¨å½“å‰çš„searchTextæ¥æœç´¢Flickrï¼Œç„¶åè¿”å›ä¸€ä¸ªåŒ¹é…çš„åˆ—è¡¨ã€‚</p>
<p>ä½ å¯ä»¥æŠŠè¿™ä¸ªé€»è¾‘ç›´æ¥æ”¾åˆ°ViewModelä¸­ï¼Œä½†æ˜¯ç›¸ä¿¡æˆ‘ï¼Œä½ ä¼šåæ‚”çš„ã€‚å¦‚æœè¿™æ˜¯ä¸€ä¸ªviewcontrollerï¼Œæˆ‘æ‰“èµŒä½ ä¸€å®šä¼šç›´æ¥è¿™ä¹ˆåšã€‚</p>
<p>ViewModelæš´éœ²å±æ€§æ¥è¡¨ç¤ºUIçŠ¶æ€ï¼Œå®ƒåŒæ ·æš´éœ²å‘½ä»¤æ¥è¡¨ç¤ºUIæ“ä½œ(é€šå¸¸æ˜¯æ–¹æ³•)ã€‚å®ƒè´Ÿè´£ç®¡ç†åŸºäºç”¨æˆ·äº¤äº’çš„UIçŠ¶æ€çš„æ”¹å˜ã€‚</p>
<p>ç„¶è€Œå®ƒä¸è´Ÿè´£å®é™…æ‰§è¡Œè¿™äº›äº¤äº’äº§ç”Ÿçš„çš„ä¸šåŠ¡é€»è¾‘ï¼Œé‚£æ˜¯Modelçš„å·¥ä½œã€‚</p>
<p>ä¸‹ä¸€æ­¥ï¼Œåœ¨ç¨‹åºä¸­æ·»åŠ Modelå±‚ã€‚</p>
<p>åœ¨Modelåˆ†ç»„ä¸­ï¼Œæ·»åŠ åä¸ºRWTFlickrSearchçš„åè®®å¹¶æä¾›ä»¥ä¸‹å®ç°ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">#import &lt;ReactiveCocoa/ReactiveCocoa.h&gt;</div><div class="line">@import Foundation;</div><div class="line"> </div><div class="line">@protocol RWTFlickrSearch &lt;NSObject&gt;</div><div class="line"> </div><div class="line">- (RACSignal *)flickrSearchSignal:(NSString *)searchString;</div><div class="line"> </div><div class="line">@end</div></pre></td></tr></table></figure>
<p>è¿™ä¸ªåè®®å®šä¹‰äº†Modelå±‚çš„åˆå§‹æ¥å£ï¼Œå¹¶å°†æœç´¢Flickrçš„è´£ä»»ç§»å‡ºViewModelã€‚</p>
<p>æ¥ä¸‹æ¥åœ¨Modelåˆ†ç»„ä¸­æ·»åŠ RWTFlickrSearchImplç±»ï¼Œå…¶ç»§æ‰¿è‡ªNSObjectï¼Œå¹¶å®ç°äº†RWTFlickrSearchåè®®ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">@import Foundation;</div><div class="line">#import &quot;RWTFlickrSearch.h&quot;</div><div class="line"> </div><div class="line">@interface RWTFlickrSearchImpl : NSObject &lt;RWTFlickrSearch&gt;</div><div class="line"> </div><div class="line">@end</div></pre></td></tr></table></figure>
<p>æ‰“å¼€RWTFlickrSearchImpl.mæ–‡ä»¶ï¼Œæä¾›ä»¥ä¸‹å®ç°ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">@implementation RWTFlickrSearchImpl</div><div class="line"> </div><div class="line">- (RACSignal *)flickrSearchSignal:(NSString *)searchString &#123;</div><div class="line">  return [[[[RACSignal empty]</div><div class="line">            logAll]</div><div class="line">            delay:2.0]</div><div class="line">            logAll];</div><div class="line">&#125;</div><div class="line"> </div><div class="line">@end</div></pre></td></tr></table></figure>
<p>çœ‹ç€æ˜¯ä¸æ˜¯ä¼¼æ›¾ç›¸è¯†ï¼Ÿæ²¡é”™ï¼Œæˆ‘ä»¬åœ¨ä¸Šé¢çš„ViewModelä¸­æœ‰ç›¸åŒçš„å®ç°ã€‚</p>
<p>ä¸‹ä¸€æ­¥æ˜¯åœ¨ViewModelä¸­ä½¿ç”¨Modelå±‚ã€‚åœ¨ViewModelåˆ†ç»„ä¸­æ·»åŠ ä¸€ä¸ªå«åšRWTViewModelServicesçš„åè®®å¹¶å¦‚ä¸‹å®ç°ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">@import Foundation;</div><div class="line">#import &quot;RWTFlickrSearch.h&quot;</div><div class="line"> </div><div class="line">@protocol RWTViewModelServices &lt;NSObject&gt;</div><div class="line"> </div><div class="line">- (id&lt;RWTFlickrSearch&gt;) getFlickrSearchService;</div><div class="line"> </div><div class="line">@end</div></pre></td></tr></table></figure>
<p>è¿™ä¸ªåè®®å®šä¹‰äº†å”¯ä¸€çš„ä¸€ä¸ªæ–¹æ³•ï¼Œä»¥å…è®¸ViewModelè·å–ä¸€ä¸ªRWTFlickrSearchåè®®çš„å®ç°å¯¹è±¡çš„å¼•ç”¨ã€‚</p>
<p>æ‰“å¼€RWTFlickrSearchViewModel.hå¹¶å¯¼å…¥å¤´æ–‡ä»¶</p>
<pre><code>#import &quot;RWTViewModelServices.h&quot;
</code></pre><p>æ›´æ–°åˆå§‹åŒ–æ–¹æ³•ä»¥å°†å®ƒä½œä¸ºä¸€ä¸ªå‚æ•°ï¼š</p>
<pre><code>- (instancetype) initWithServices:(id&lt;RWTViewModelServices&gt;)services;
</code></pre><p>åœ¨RWTFlickrSearchViewModel.mä¸­ï¼Œæ·»åŠ ä¸€ä¸ªclass extensionå’Œä¸€ä¸ªç§æœ‰å±æ€§æ¥è·å¾—ä¸€ä¸ªview model servicesçš„å¼•ç”¨ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">@interface RWTFlickrSearchViewModel ()</div><div class="line"></div><div class="line">@property (nonatomic, weak) id&lt;RWTViewModelServices&gt; services;</div><div class="line"></div><div class="line">@end</div></pre></td></tr></table></figure>
<p>åœ¨è¯¥æ–‡ä»¶ä¸‹é¢ï¼Œæ·»åŠ åˆå§‹åŒ–æ–¹æ³•ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">- (instancetype) initWithServices:(id&lt;RWTViewModelServices&gt;)services &#123;</div><div class="line">  self = [super init];</div><div class="line">  if (self) &#123;</div><div class="line">    _services = services;</div><div class="line">    [self initialize];</div><div class="line">  &#125;</div><div class="line">  return self;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è¿™æ ·å°±ç®€å•å­˜å‚¨äº†servicesçš„å¼•ç”¨ã€‚</p>
<p>æœ€åï¼Œæ›´æ–°executeSearchSignalæ–¹æ³•ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">- (RACSignal *)executeSearchSignal &#123;</div><div class="line">  return [[self.services getFlickrSearchService]</div><div class="line">           flickrSearchSignal:self.searchText];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ä¸Šé¢çš„æ–¹æ³•å°†å®é™…æ‰§è¡Œæœç´¢çš„ä»»åŠ¡è½¬ç§»åˆ°äº†model(å±‚)ä¸­ã€‚</p>
<p>æœ€åä¸€æ­¥æ˜¯è¿æ¥Modelå’ŒViewModelã€‚</p>
<p>åœ¨å·¥ç¨‹çš„æ ¹åˆ†ç»„ä¸­ï¼Œæ·»åŠ ä¸€ä¸ªNSObjectçš„å­ç±»RWTViewModelServicesImplã€‚æ‰“å¼€RWTViewModelServicesImpl.hæ–‡ä»¶å¹¶å®ç°RWTViewModelServicesåè®®ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">@import Foundation;</div><div class="line">#import &quot;RWTViewModelServices.h&quot;</div><div class="line"> </div><div class="line">@interface RWTViewModelServicesImpl : NSObject &lt;RWTViewModelServices&gt;</div><div class="line"> </div><div class="line">@end</div></pre></td></tr></table></figure>
<p>æ‰“å¼€RWTViewModelServicesImpl.mï¼Œå¹¶æ·»åŠ å®ç°ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">#import &quot;RWTViewModelServicesImpl.h&quot;</div><div class="line">#import &quot;RWTFlickrSearchImpl.h&quot;</div><div class="line"> </div><div class="line">@interface RWTViewModelServicesImpl ()</div><div class="line"> </div><div class="line">@property (strong, nonatomic) RWTFlickrSearchImpl *searchService;</div><div class="line"> </div><div class="line">@end</div><div class="line"> </div><div class="line">@implementation RWTViewModelServicesImpl</div><div class="line"> </div><div class="line">- (instancetype)init &#123;</div><div class="line">  if (self = [super init]) &#123;</div><div class="line">    _searchService = [RWTFlickrSearchImpl new];</div><div class="line">  &#125;</div><div class="line">  return self;</div><div class="line">&#125;</div><div class="line"> </div><div class="line">- (id&lt;RWTFlickrSearch&gt;)getFlickrSearchService &#123;</div><div class="line">  return self.searchService;</div><div class="line">&#125;</div><div class="line"> </div><div class="line">@end</div></pre></td></tr></table></figure>
<p>è¿™ä¸ªç±»ç®€å•åˆ›å»ºäº†ä¸€ä¸ªRWTFlickrSearchImplå®ä¾‹ï¼ŒModelå±‚ä¸ºæœç´¢FlickræœåŠ¡ï¼Œå½“æœ‰è¯·æ±‚çš„æ—¶å€™å°†å…¶æä¾›ç»™ViewModelã€‚</p>
<p>æœ€åï¼Œæ‰“å¼€RWTAppDelegate.mæ–‡ä»¶ï¼Œæ·»åŠ ä»¥ä¸‹å¤´æ–‡ä»¶</p>
<pre><code>#import &quot;RWTViewModelServicesImpl.h&quot;
</code></pre><p>å¹¶æ·»åŠ ä¸€ä¸ªæ–°çš„ç§æœ‰å±æ€§</p>
<pre><code>@property (strong, nonatomic) RWTViewModelServicesImpl *viewModelServices;    
</code></pre><p>å†æ›´æ–°createInitialViewControlleræ–¹æ³•ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">- (UIViewController *)createInitialViewController &#123;</div><div class="line">  self.viewModelServices = [RWTViewModelServicesImpl new];</div><div class="line">  self.viewModel = [[RWTFlickrSearchViewModel alloc]</div><div class="line">                    initWithServices:self.viewModelServices];</div><div class="line">  return [[RWTFlickrSearchViewController alloc]</div><div class="line">          initWithViewModel:self.viewModel];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è¿è¡Œç¨‹åºï¼ŒéªŒè¯ç¨‹åºæœ‰æ²¡æœ‰æŒ‰ä¹‹å‰çš„æ–¹å¼æ¥å·¥ä½œã€‚å½“ç„¶ï¼Œè¿™ä¸æ˜¯æœ€ä»¤äººå…´å¥‹çš„å˜åŒ–ï¼Œä¸è¿‡å…ˆèŠ±ä¸€ç‚¹æ—¶é—´çœ‹çœ‹æ–°ä»£ç çš„æ¶æ„å§ã€‚</p>
<p>Modelå±‚æš´éœ²äº†ä¸€ä¸ªViewModelå±‚ä½¿ç”¨çš„â€˜æœåŠ¡â€™ã€‚ä¸€ä¸ªåè®®å®šä¹‰äº†è¿™ä¸ªæœåŠ¡çš„æ¥å£ï¼Œæä¾›äº†æ¾æ•£çš„ç»„åˆã€‚</p>
<p>ä½ å¯ä»¥ä½¿ç”¨è¿™ç§æ–¹å¼æ¥ä¸ºå•å…ƒæµ‹è¯•æä¾›ä¸€ä¸ªç±»ä¼¼çš„æœåŠ¡å®ç°ã€‚ç¨‹åºç°åœ¨æœ‰äº†æ­£ç¡®çš„MVVMç»“æ„ï¼Œè®©æˆ‘ä»¬å°ç»“ä¸€ä¸‹ï¼š</p>
<ol>
<li>Modelå±‚æš´éœ²æœåŠ¡å¹¶è´Ÿè´£æä¾›ç¨‹åºçš„ä¸šåŠ¡é€»è¾‘å®ç°ã€‚å…·ä½“æ¥è¯´ï¼Œå®ƒæä¾›äº†æœç´¢Flickrçš„æœåŠ¡ã€‚</li>
<li>ViewModelå±‚è¡¨ç¤ºç¨‹åºä¸­è§†å›¾çš„çŠ¶æ€ï¼ŒåŒæ—¶å“åº”ç”¨æˆ·äº¤äº’åŠæ¥è‡ªModelå±‚çš„äº‹ä»¶ï¼Œä¸¤è€…éƒ½ä¼šåæ˜ åˆ°view-stateçš„å˜åŒ–ã€‚</li>
<li>Viewå±‚éå¸¸è–„ï¼Œåªæä¾›ViewModelçŠ¶æ€çš„è§†è§‰å±•ç¤ºä»¥åŠä¼ é€’ç”¨æˆ·äº¤äº’ã€‚<br>æ³¨æ„ï¼šåœ¨æ­¤åº”ç”¨ä¸­modelå±‚å¯¹å¤–æš´éœ²æœåŠ¡æ˜¯åº”ç”¨çš„ReactiveCocoaä¸­çš„ä¿¡å·(signals)ï¼Œå¯ä»¥è¿™ä¸ªåº“ä¸ä»…ä»…èƒ½å¤Ÿè¿›è¡Œç»‘å®šã€‚</li>
</ol>
<h3 id="æœç´¢Flickr"><a href="#æœç´¢Flickr" class="headerlink" title="æœç´¢Flickr"></a>æœç´¢Flickr</h3><p>åœ¨è¿™ä¸€éƒ¨åˆ†ä½ å°†æä¾›ä¸€ä¸ªçœŸæ­£çš„Flickrçš„æœç´¢å®ç°ï¼Œäº‹æƒ…å¼€å§‹å˜å¾—ä»¤äººå…´å¥‹äº†å“ˆã€‚</p>
<p>ç¬¬ä¸€æ­¥å°±æ˜¯åˆ›å»ºèƒ½å¤Ÿè¡¨ç¤ºæœç´¢ç»“æœçš„æ¨¡å‹å¯¹è±¡ã€‚åœ¨Modelåˆ†ç»„ä¸­ï¼Œæ·»åŠ RWTFlickrPhotoç±»ï¼Œå¹¶ä¸ºå…¶æ·»åŠ ä¸‰ä¸ªå±æ€§ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">@interface RWTFlickrPhoto : NSObject</div><div class="line"> </div><div class="line">@property (strong, nonatomic) NSString *title;</div><div class="line">@property (strong, nonatomic) NSURL *url;</div><div class="line">@property (strong, nonatomic) NSString *identifier;</div><div class="line"> </div><div class="line">@end</div></pre></td></tr></table></figure>
<p>è¿™ä¸ªæ¨¡å‹å¯¹è±¡è¡¨ç¤ºç”±Flickræœç´¢APIè¿”å›ä¸€ä¸ªå›¾ç‰‡ã€‚</p>
<p>æ‰“å¼€RWTFlickrPhoto.mï¼Œå¹¶æ·»åŠ ä»¥ä¸‹æè¿°æ–¹æ³•çš„å®ç°ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">- (NSString *)description &#123;</div><div class="line">  return self.title;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è¿™èƒ½å…è®¸ä½ åœ¨è¿›è¡ŒUIæ”¹å˜ä¹‹å‰é€šè¿‡æ‰“å°ç»“æœæ¥æ£€æµ‹æœç´¢å®ç°æ˜¯å¦æ­£ç¡®ã€‚</p>
<p>ä¸‹ä¸€æ­¥ï¼Œå¢åŠ ä¸€ä¸ªæ–°çš„æ¨¡å‹å¯¹è±¡ç±»RWTFlickrSearchResultsï¼Œå¹¶æ·»åŠ ä»¥ä¸‹å±æ€§ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">@import Foundation;</div><div class="line"> </div><div class="line">@interface RWTFlickrSearchResults : NSObject</div><div class="line"> </div><div class="line">@property (strong, nonatomic) NSString *searchString;</div><div class="line">@property (strong, nonatomic) NSArray *photos;</div><div class="line">@property (nonatomic) NSUInteger totalResults;</div><div class="line"> </div><div class="line">@end</div></pre></td></tr></table></figure>
<p>è¿™ä¸ªç±»è¡¨ç¤ºç”±Flickræœç´¢è¿”å›çš„ç…§ç‰‡é›†åˆã€‚</p>
<p>æ‰“å¼€RWTFlickrSearchResults.mï¼Œå¹¶æ·»åŠ ä»¥ä¸‹æè¿°æ–¹æ³•çš„å®ç°ï¼ˆå½“ç„¶è¿˜æ˜¯å‡ºäºæ‰“å°çš„ç›®çš„ï¼‰ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">- (NSString *)description &#123;</div><div class="line">  return [NSString stringWithFormat:@&quot;searchString=%@, totalresults=%lU, photos=%@&quot;,</div><div class="line">          self.searchString, self.totalResults, self.photos];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æ˜¯æ—¶å€™å®ç°æœç´¢Flickräº†ã€‚æ‰“å¼€RWTFlickrSearchImpl.må¹¶å¯¼å…¥ä»¥ä¸‹å¤´æ–‡ä»¶ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">#import &quot;RWTFlickrSearchResults.h&quot;</div><div class="line">#import &quot;RWTFlickrPhoto.h&quot;</div><div class="line">#import &lt;objectiveflickr/ObjectiveFlickr.h&gt;</div><div class="line">#import &lt;LinqToObjectiveC/NSArray+LinqExtensions.h&gt;</div></pre></td></tr></table></figure>
<ul>
<li><p><a href="https://github.com/lukhnos/objectiveflickr" target="_blank" rel="external">ObjectiveFlickr</a>-è¿™æ˜¯ä¸€ä¸ªOC APIå¯¹Flickr APIçš„å°è£…ï¼Œå¤„ç†äº†æˆæƒå’Œè§£æå“åº”ã€‚è¿™æ¯”ç›´æ¥ä½¿ç”¨åŸç”ŸFlickr APIç®€å•å¤šäº†ã€‚</p>
</li>
<li><p><a href="https://github.com/ColinEberhardt/LinqToObjectiveC" target="_blank" rel="external">LinqToObjectiveC</a>-è¿™ä¸ªåº“æä¾›äº†ä¸€ç³»åˆ—é’ˆå¯¹æ•°ç»„å’Œå­—å…¸è¿›è¡ŒæŸ¥è¯¢ï¼Œè¿‡æ»¤å’Œè½¬æ¢çš„å‡½æ•°å¼æ¥å£ã€‚</p>
</li>
</ul>
<p>è¿˜æ˜¯åœ¨RWTFlickrSearchImpl.mæ–‡ä»¶ä¸­ï¼Œæ·»åŠ ä¸€ä¸ªç±»æ‰©å±•ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">@interface RWTFlickrSearchImpl () &lt;OFFlickrAPIRequestDelegate&gt;</div><div class="line"> </div><div class="line">@property (strong, nonatomic) NSMutableSet *requests;</div><div class="line">@property (strong, nonatomic) OFFlickrAPIContext *flickrContext;</div><div class="line"> </div><div class="line">@end</div></pre></td></tr></table></figure>
<p>è¿™ä¸ªç±»å®ç°äº†OFFlickrAPIRequestDelegateåè®®ï¼Œå¹¶æ·»åŠ äº†ä¸¤ä¸ªç§æœ‰å±æ€§ã€‚ä½ å°†å¾ˆå¿«çœ‹åˆ°å¦‚ä½•ä½¿ç”¨å®ƒä»¬ã€‚</p>
<p>ç»§ç»­æ·»åŠ ä»£ç ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">- (instancetype)init &#123;</div><div class="line">  self = [super init];</div><div class="line">  if (self) &#123;</div><div class="line">    NSString *OFSampleAppAPIKey = @&quot;YOUR_API_KEY_GOES_HERE&quot;;</div><div class="line">    NSString *OFSampleAppAPISharedSecret = @&quot;YOUR_SECRET_GOES_HERE&quot;;</div><div class="line"> </div><div class="line">    _flickrContext = [[OFFlickrAPIContext alloc] initWithAPIKey:OFSampleAppAPIKey</div><div class="line">                                                  sharedSecret:OFSampleAppAPISharedSecret];</div><div class="line">    _requests = [NSMutableSet new];</div><div class="line">  &#125;</div><div class="line">  return  self;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è¿™æ®µä»£ç åˆ›å»ºäº†ä¸€ä¸ªFlickrçš„ä¸Šä¸‹æ–‡ï¼Œç”¨äºå­˜å‚¨ObjectiveFlickrè¯·æ±‚çš„æ•°æ®ã€‚</p>
<p>æ³¨æ„ï¼šä¸ºäº†ä½¿ç”¨ObjectiveFlickrä½ éœ€è¦åœ¨<a href="https://www.flickr.com/services/apps/create/apply/" target="_blank" rel="external">Flickr App Garden</a>åˆ›å»ºä¸€ä¸ª Flickr App Keyã€‚</p>
<p>ObjectiveFlickr APIéå¸¸å…¸å‹ã€‚åˆ›å»ºAPIè¯·æ±‚åæˆåŠŸæˆ–å¤±è´¥çš„å›è°ƒéƒ½èƒ½é€šè¿‡ä»£ç†æ–¹æ³•å¾—åˆ°ã€‚</p>
<p>å½“å‰APIç”±Modelå±‚æœåŠ¡ç±»å¯¹å¤–æš´éœ²ï¼Œå…·ä½“å®ç°æ˜¯å®ç°RWTFlickrSearchåè®®ä¸­å”¯ä¸€çš„æ–¹æ³•ï¼Œä»è€ŒåŸºäºæ–‡æœ¬æœç´¢å­—ç¬¦æ¥æŸ¥æ‰¾å›¾ç‰‡ã€‚ä¸è¿‡ä½ å¾ˆå¿«å°±ä¼šæ·»åŠ æ›´å¤šçš„æ–¹æ³•ã€‚</p>
<p>åœ¨RWTFlickrSearchImpl.mä¸­æ·»åŠ ä»¥ä¸‹æ–¹æ³•ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line">- (RACSignal *)signalFromAPIMethod:(NSString *)method</div><div class="line">                         arguments:(NSDictionary *)args</div><div class="line">                         transform:(id (^)(NSDictionary *response))block &#123;</div><div class="line"> </div><div class="line">  // 1. Create a signal for this request</div><div class="line">  return [RACSignal createSignal:^RACDisposable *(id&lt;RACSubscriber&gt; subscriber) &#123;</div><div class="line"> </div><div class="line">    // 2. Create a Flick request object</div><div class="line">    OFFlickrAPIRequest *flickrRequest =</div><div class="line">      [[OFFlickrAPIRequest alloc] initWithAPIContext:self.flickrContext];</div><div class="line">    flickrRequest.delegate = self;</div><div class="line">    [self.requests addObject:flickrRequest];</div><div class="line"> </div><div class="line">    // 3. Create a signal from the delegate method</div><div class="line">    RACSignal *successSignal =</div><div class="line">      [self rac_signalForSelector:@selector(flickrAPIRequest:didCompleteWithResponse:)</div><div class="line">                     fromProtocol:@protocol(OFFlickrAPIRequestDelegate)];</div><div class="line"> </div><div class="line">    // 4. Handle the response</div><div class="line">    [[[successSignal</div><div class="line">      map:^id(RACTuple *tuple) &#123;</div><div class="line">        return tuple.second;</div><div class="line">      &#125;]</div><div class="line">      map:block]</div><div class="line">      subscribeNext:^(id x) &#123;</div><div class="line">        [subscriber sendNext:x];</div><div class="line">        [subscriber sendCompleted];</div><div class="line">      &#125;];</div><div class="line"> </div><div class="line">    // 5. Make the request</div><div class="line">    [flickrRequest callAPIMethodWithGET:method</div><div class="line">                              arguments:args];</div><div class="line"> </div><div class="line">    // 6. When we are done, remove the reference to this request</div><div class="line">    return [RACDisposable disposableWithBlock:^&#123;</div><div class="line">      [self.requests removeObject:flickrRequest];</div><div class="line">    &#125;];</div><div class="line">  &#125;];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è¿™ä¸ªæ–¹æ³•æ ¹æ®ä¼ å…¥çš„æ–¹æ³•ååŠå‚æ•°è§¦å‘ä¸€ä¸ªAPIè¯·æ±‚ï¼Œç„¶åä½¿ç”¨blockå‚æ•°æ¥è½¬æ¢å“åº”å¯¹è±¡ã€‚ç°åœ¨åˆ†åˆ«æ¥çœ‹çœ‹æ¯ä¸€æ­¥ï¼š</p>
<ol>
<li><p>createSignalæ–¹æ³•åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„ä¿¡å·ï¼Œblockä¸­çš„subscriberæš´éœ²çš„æ–¹æ³•å…è®¸ä½ å‘é€next,errorå’Œcompletedäº‹ä»¶ç»™ä¿¡å·çš„è®¢é˜…è€…ä»¬ã€‚</p>
</li>
<li><p>ä¸€ä¸ªObjectiveFlickrè¯·æ±‚è¢«åˆ›å»ºï¼Œç„¶åå­˜å‚¨äº†è¿™ä¸ªè¯·æ±‚ã€‚</p>
</li>
<li><p>rac_signalForSelector:fromProtocol:æ–¹æ³•åŸºäºè¡¨ç¤ºFlickr APIè¯·æ±‚å®Œæˆçš„ä»£ç†æ–¹æ³•åˆ›å»ºäº†ä¸€ä¸ªä¿¡å·ã€‚  </p>
</li>
<li><p>ä¿¡å·è¢«è®¢é˜…ï¼Œç»“æœè¿›è¡Œäº†è½¬æ¢ä¹‹åä½œä¸ºåˆ›å»ºçš„ä¿¡å·çš„ç»“æœè¢«å‘é€å‡ºå»ã€‚ï¼ˆç¨åå†ç»†è¯´ï¼‰</p>
</li>
<li><p>ObjectiveFlickr APIè¯·æ±‚è¢«è§¦å‘ã€‚</p>
</li>
<li><p>å½“è¿™ä¸ªä¿¡å·è¢«åºŸå¼ƒæ—¶ï¼Œè¿™ä¸ªblockèƒ½ä¿è¯Flickrè¯·æ±‚çš„å¼•ç”¨è¢«ç§»é™¤ï¼Œé¿å…å†…å­˜æ³„æ¼ã€‚</p>
</li>
</ol>
<p>ç°åœ¨æˆ‘ä»¬æ¥ä»”ç»†çœ‹ä¸€ä¸‹ç¬¬4æ­¥ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">[[[successSignal</div><div class="line">  // 1. Extract the second argument</div><div class="line">  map:^id(RACTuple *tuple) &#123;</div><div class="line">    return tuple.second;</div><div class="line">  &#125;]</div><div class="line">  // 2. transform the results</div><div class="line">  map:block]</div><div class="line">  subscribeNext:^(id x) &#123;</div><div class="line">    // 3. send the results to the subscribers</div><div class="line">    [subscriber sendNext:x];</div><div class="line">    [subscriber sendCompleted];</div><div class="line">  &#125;];</div></pre></td></tr></table></figure>
<p>rac_signalForSelector:fromProtocol: æ–¹æ³•åˆ›å»ºäº†successSignalï¼ŒåŒæ ·ä¹Ÿåœ¨ä»£ç†æ–¹æ³•çš„è°ƒç”¨ä¸­åˆ›å»ºäº†ä¿¡å·ã€‚</p>
<p>æ¯æ¬¡ä»£ç†æ–¹æ³•è¢«è°ƒç”¨æ—¶ï¼Œä¸€ä¸ªåŒ…å«æ–¹æ³•å‚æ•°çš„RACTuplenextäº‹ä»¶ä¼šå‘é€å‡ºå»ã€‚</p>
<p>ä¸Šé¢çš„ç®¡é“æŒ‰ç…§å¦‚ä¸‹æ­¥éª¤æ‰§è¡Œï¼š</p>
<ol>
<li>ä¸€ä¸ªmapæ“ä½œä»flickrAPIRequest:didCompleteWithResponse: ä»£ç†æ–¹æ³•ä¸­å–å‡ºç¬¬äºŒä¸ªå‚æ•°ï¼šå“åº”çš„å­—å…¸ã€‚</li>
<li>ä½œä¸ºå‚æ•°ä¼ è¿›æ¥çš„blockå¯¹ç»“æœè¿›è¡Œè½¬æ¢ï¼Œä½ å°†å¾ˆå¿«è§åˆ°æ€ä¹ˆæ ·å°†å­—å…¸è½¬æ¢æˆmodelå¯¹è±¡ã€‚</li>
<li>æœ€åï¼Œè¢«è½¬æ¢åçš„å“åº”è¢«ä½œä¸ºä¸€ä¸ªnexäº‹ä»¶å‘é€å‡ºå»ï¼Œç„¶åè¿™ä¸ªä¿¡å·å®Œæˆï¼Œç”Ÿå‘½å‘¨æœŸç»“æŸäº†ã€‚</li>
</ol>
<p>å®ç°Flickræœç´¢çš„æœ€åä¸€æ­¥å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">- (RACSignal *)flickrSearchSignal:(NSString *)searchString &#123;</div><div class="line">  return [self signalFromAPIMethod:@&quot;flickr.photos.search&quot;</div><div class="line">                         arguments:@&#123;@&quot;text&quot;: searchString,</div><div class="line">                                     @&quot;sort&quot;: @&quot;interestingness-desc&quot;&#125;</div><div class="line">                         transform:^id(NSDictionary *response) &#123;</div><div class="line"> </div><div class="line">    RWTFlickrSearchResults *results = [RWTFlickrSearchResults new];</div><div class="line">    results.searchString = searchString;</div><div class="line">    results.totalResults = [[response valueForKeyPath:@&quot;photos.total&quot;] integerValue];</div><div class="line"> </div><div class="line">    NSArray *photos = [response valueForKeyPath:@&quot;photos.photo&quot;];</div><div class="line">    results.photos = [photos linq_select:^id(NSDictionary *jsonPhoto) &#123;</div><div class="line">      RWTFlickrPhoto *photo = [RWTFlickrPhoto new];</div><div class="line">      photo.title = [jsonPhoto objectForKey:@&quot;title&quot;];</div><div class="line">      photo.identifier = [jsonPhoto objectForKey:@&quot;id&quot;];</div><div class="line">      photo.url = [self.flickrContext photoSourceURLFromDictionary:jsonPhoto</div><div class="line">                                                              size:OFFlickrSmallSize];</div><div class="line">      return photo;</div><div class="line">    &#125;];</div><div class="line"> </div><div class="line">    return results;</div><div class="line">  &#125;];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ä¸Šé¢çš„æ–¹æ³•ä½¿ç”¨äº†åˆšæ‰æ·»åŠ çš„signalFromAPIMethod:arguments:transform:æ–¹æ³•ã€‚flickr.photos.search APIä¸­æœç´¢ç…§ç‰‡çš„æ–¹æ³•ä¼šæä¾›æ ‡å‡†çš„å­—å…¸å†…å®¹ã€‚</p>
<p>ä¼ é€’ç»™transformå‚æ•°çš„blockç®€å•åœ°å°†NSDictionaryå“åº”è½¬åŒ–ä¸ºä¸€ä¸ªç­‰ä»·çš„æ¨¡å‹å¯¹è±¡ï¼Œè®©å®ƒåœ¨ViewModelä¸­æ›´å®¹æ˜“ä½¿ç”¨ã€‚</p>
<p>ä¸Šé¢ä»£ç ä½¿ç”¨äº†LinqToObjectiveCç»™NSArrayæ·»åŠ çš„linq_selectæ–¹æ³•ï¼Œä»è€Œèƒ½å¤Ÿåº”ç”¨å‡½æ•°å¼çš„APIè½¬æ¢æ•°ç»„ã€‚</p>
<p>æ³¨æ„ï¼šå¯¹äºæ›´åŠ å¤æ‚çš„JSON-to-objectçš„è½¬åŒ–ï¼Œæˆ‘å¼ºçƒˆæ¨èä½ å»çœ‹çœ‹<a href="https://github.com/Mantle/Mantle" target="_blank" rel="external">Mantle</a>ã€‚ </p>
<p>æœ€åä¸€æ­¥æ˜¯æ‰“å¼€RWTFlickrSearchViewModel.mæ–¹æ³•ï¼Œç„¶åæ›´æ–°æœç´¢ä¿¡å·æ¥è®°å½•æ—¥å¿—ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">- (RACSignal *)executeSearchSignal &#123;</div><div class="line">  return [[[self.services getFlickrSearchService]</div><div class="line">           flickrSearchSignal:self.searchText]</div><div class="line">           logAll];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ç¼–è¯‘ï¼Œè¿è¡Œå¹¶è¾“å…¥ä¸€äº›å­—ç¬¦åå¯åœ¨æ§åˆ¶å°çœ‹åˆ°ä»¥ä¸‹æ—¥å¿—ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">2014-06-03 [...] &lt;RACDynamicSignal: 0x8c368a0&gt; name: +createSignal: next: searchString=wibble, totalresults=1973, photos=(</div><div class="line">    &quot;Wibble, wobble, wibble, wobble&quot;,</div><div class="line">    &quot;unoa-army&quot;,</div><div class="line">    &quot;Day 277: Cheers to the freakin&apos; weekend!&quot;,</div><div class="line">    [...]</div><div class="line">    &quot;Angry sky&quot;,</div><div class="line">    Nemesis</div><div class="line">)</div></pre></td></tr></table></figure>
<p>æ³¨æ„ï¼šå¦‚æœä½ æ²¡æœ‰å¾—åˆ°ç»“æœï¼Œå†æ£€æŸ¥ä¸€ä¸‹ä½ çš„ Flickr API keyå’Œshared secretã€‚</p>
<p>è¿™æ ·æˆ‘ä»¬MVVMæŒ‡å—çš„ç¬¬ä¸€éƒ¨åˆ†å°±å·®ä¸å¤šç»“æŸäº†ï¼Œä½†åœ¨ç»“æŸä¹‹å‰ï¼Œè®©æˆ‘ä»¬å…ˆçœ‹çœ‹å†…å­˜é—®é¢˜å§ã€‚</p>
<h3 id="å†…å­˜ç®¡ç†"><a href="#å†…å­˜ç®¡ç†" class="headerlink" title="å†…å­˜ç®¡ç†"></a>å†…å­˜ç®¡ç†</h3><p>å‡è®¾æ­¤æ—¶æ­¤åˆ»ä½ å·²ç»ä»ä¸Šé¢æåˆ°è¿‡çš„ReactiveCocoaæ•™ç¨‹ä¸­äº†è§£äº†æ€æ ·ä½¿ç”¨@weakifyå’Œ@strongifyä¸¤ä¸ªå®å®šä¹‰æ¥é¿å…å¾ªç¯å¼•ç”¨ã€‚</p>
<p>ä½ æ˜¯å¦å¥½å¥‡ä¸ºä»€ä¹ˆsignalFromAPIMethod:arguments:transform:æ–¹æ³•å®ç°ä¸­å½“å¼•ç”¨selfæ—¶æ²¡æœ‰ä½¿ç”¨è¿™ä¸¤ä¸ªå®ï¼Ÿ</p>
<p>è¿™æ˜¯å› ä¸ºblockæ˜¯ä½œä¸ºcreateSignal:æ–¹æ³•çš„ä¸€ä¸ªå‚æ•°ï¼Œå®ƒä¸ä¼šåœ¨selfå’Œblockä¹‹é—´å»ºç«‹ä¸€ä¸ªå¼ºå¼•ç”¨å…³ç³»ã€‚è¿·èŒ«äº†å§ï¼Ÿä¸ç›¸ä¿¡çš„è¯å»æµ‹è¯•ä¸€ä¸‹è¿™æ®µä»£ç æœ‰æ²¡æœ‰å†…å­˜æ³„éœ²å§ã€‚</p>
<h3 id="ä½•å»ä½•ä»ï¼Ÿ"><a href="#ä½•å»ä½•ä»ï¼Ÿ" class="headerlink" title="ä½•å»ä½•ä»ï¼Ÿ"></a>ä½•å»ä½•ä»ï¼Ÿ</h3><p>åˆ°ç›®å‰ä¸ºæ­¢æœ¬æ•™ç¨‹ä¸­demoå·¥ç¨‹çš„å®Œæ•´ä»£ç å¯ä»¥åœ¨<a href="http://www.raywenderlich.com/wp-content/uploads/2014/06/FlickrSearchPart1Project1.zip" target="_blank" rel="external">è¿™é‡Œ</a>ä¸‹è½½ã€‚è¿™åŒ…æ‹¬äº†MVVM &amp; ReactiveCocoaå…¥é—¨æ•™ç¨‹çš„ç¬¬ä¸€éƒ¨åˆ†ã€‚</p>
<p>åœ¨ä¸‹ä¸€éƒ¨åˆ†ä¸­ï¼Œä½ å°†çœ‹åˆ°å¦‚ä½•ä»ViewModelä¸­åˆå§‹åŒ–ä¸€ä¸ªè§†å›¾æ§åˆ¶å™¨å¹¶å®ç°æ›´å¤šçš„Flickr APIè¯·æ±‚ä»è€Œä½¿è¿™ä¸ªåº”ç”¨å†…å®¹æ›´åŠ ä¸°å¯Œã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æœ¬æ–‡ç”±Colin Eberhardtäº14å¹´å‘è¡¨äº&lt;a href=&quot;https://www.raywenderlich.com&quot;&gt;raywenderlich&lt;/a&gt;ï¼ŒåŸæ–‡å¯æŸ¥çœ‹&lt;a href=&quot;https://www.raywenderlich.com/74106/mvvm-tutorial-with-reactivecocoa-part-1&quot;&gt;MVVM Tutorial with ReactiveCocoa: Part 1/2&lt;/a&gt;ï¼Œä¹‹å‰å·²ç»æœ‰è¿‡ä¸€ç¯‡è¿˜ä¸é”™çš„ç¿»è¯‘åœ¨&lt;a href=&quot;http://www.cnblogs.com/panyuluoye/p/4979740.html&quot;&gt;è¿™é‡Œ&lt;/a&gt;ï¼Œä½†æ˜¯è²Œä¼¼åªç¿»è¯‘äº†ç¬¬ä¸€éƒ¨åˆ†ï¼Œäºæ˜¯æˆ‘æƒ³åˆ°è¦ç¿»è¯‘ç¬¬äºŒéƒ¨åˆ†ï¼Œé¡ºä¾¿ä¹Ÿé‡æ–°ç¿»è¯‘ä¸‹ç¬¬ä¸€éƒ¨åˆ†å½“ä½œå¤ä¹ ã€‚&lt;br&gt;
    
    </summary>
    
      <category term="ç¿»è¯‘" scheme="http://yoursite.com/categories/%E7%BF%BB%E8%AF%91/"/>
    
    
      <category term="MVVM" scheme="http://yoursite.com/tags/MVVM/"/>
    
  </entry>
  
  <entry>
    <title>æ–‡ä»¶ä¸‹è½½å·¥å…·ç±»</title>
    <link href="http://yoursite.com/2016/08/25/%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD%E5%B7%A5%E5%85%B7%E7%B1%BB/"/>
    <id>http://yoursite.com/2016/08/25/æ–‡ä»¶ä¸‹è½½å·¥å…·ç±»/</id>
    <published>2016-08-25T09:28:43.000Z</published>
    <updated>2016-09-01T03:44:28.000Z</updated>
    
    <content type="html"><![CDATA[<p>ä¹‹å‰é¡¹ç›®ä¸­æœ‰è¿‡ä¸‹è½½è§†é¢‘çš„éœ€æ±‚ï¼Œäºæ˜¯æ»¡å¿ƒæ¬¢å–œçš„å»githubä¸Šæœç´¢æ–‡ä»¶ä¸‹è½½å·¥å…·ç±»ï¼Œç»“æœç•¥å¤±æœ›ï¼Œç«Ÿç„¶æ²¡æœ‰ä¸€ä¸ªç›¸å½“æ»¡æ„çš„ã€‚è™½ç„¶AFNetworkingä¸­å•ä¸ªæ–‡ä»¶ä¸‹è½½åŠŸèƒ½å·²ç»ç›¸å½“å®Œå–„ï¼Œä½†æ˜¯æˆ‘éœ€è¦ä¸€äº›æ¯”å¦‚å…¨éƒ¨æš‚åœï¼Œå…¨éƒ¨å¼€å§‹ä¹‹ç±»çš„ç®¡ç†çš„åŠŸèƒ½ï¼Œäºæ˜¯å°±è¯•ç€è‡ªå·±åŠ¨æ‰‹é€ äº†ä¸ªè½®å­ã€‚<br><a id="more"></a><br>å…¶å®æ–‡ä»¶ä¸‹è½½ï¼Œä»æ ¹æœ¬ä¸Šè¯´å°±æ˜¯ä¸¤ç§æ–¹å¼ï¼šNSURLConnectionæˆ–NSURLSessionã€‚ </p>
<p>é¦–å…ˆä¸€ä¸ªæ–‡ä»¶åŠ å…¥åˆ°ä¸‹è½½é˜Ÿåˆ—åå¯èƒ½ä¼šæœ‰å¦‚ä¸‹5ç§çŠ¶æ€ï¼šä¸‹è½½ä¸­ï¼Œç­‰å¾…ä¸­ï¼Œæš‚åœä¸­ï¼Œä¸‹è½½å®Œæˆï¼Œä¸‹è½½å¤±è´¥ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">typedef NS_ENUM(NSInteger, FileDownloadState)&#123;</div><div class="line">    FileDownloadStateWaiting = 0,</div><div class="line">    FileDownloadStateDownloading = 1,</div><div class="line">    FileDownloadStateSuspending = 2,</div><div class="line">    FileDownloadStateFail = 3,</div><div class="line">    FileDownloadStateFinish = 4,</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>ç„¶åæˆ‘å¸Œæœ›åœ¨åˆå§‹åŒ–ä¸‹è½½ç®¡ç†ç±»åèƒ½åªè°ƒç”¨ä¸€ä¸ªæ–¹æ³•å°±å¼€å§‹å»è¿›è¡Œæ–‡ä»¶ä¸‹è½½ï¼Œç„¶åå°±ç­‰å¾…æ¥æ”¶å›è°ƒæ–¹æ³•äº†ï¼Œäºæ˜¯</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">- (void)addDownloadWithFileId:(NSString *)fileId fileUrl:(NSString *)url directoryPath:(NSString *)directoryPath fileName:(NSString *)fileName;</div></pre></td></tr></table></figure>
<p>æ¥ç€ï¼Œä¸ºäº†å®ç°å¤šä¸ªæ–‡ä»¶åŒæ—¶ä¸‹è½½æ—¶çš„å„ç§æ§åˆ¶ï¼Œæˆ‘åˆ›å»ºäº†å¦‚ä¸‹è¯¸å¤šæ–¹æ³•ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">//ç‚¹å‡»ç­‰å¾…é¡¹ï¼ˆï¼ã€‹ç«‹å³ä¸‹è½½ï¼æš‚åœï¼do nothingï¼‰</div><div class="line">- (void)startDownloadWithFileId:(NSString *)fileId;</div><div class="line">//ç‚¹å‡»ä¸‹è½½é¡¹ ï¼ã€‹æš‚åœ</div><div class="line">- (void)suspendDownloadWithFileId:(NSString *)fileId;</div><div class="line">//ç‚¹å‡»æš‚åœé¡¹ï¼ˆï¼ã€‹ç«‹åˆ»ä¸‹è½½ï¼æ·»åŠ åˆ°ä¸‹è½½é˜Ÿåˆ—ï¼‰</div><div class="line">- (void)recoverDownloadWithFileId:(NSString *)fileId;</div><div class="line">//ç‚¹å‡»å¤±è´¥é¡¹ ï¼ã€‹æ·»åŠ åˆ°ä¸‹è½½é˜Ÿåˆ—</div><div class="line">- (void)restartDownloadWithFileId:(NSString *)fileId;</div><div class="line">//å–æ¶ˆä¸‹è½½ï¼Œä¸”åˆ é™¤æ–‡ä»¶ï¼Œåªé€‚ç”¨äºæœªä¸‹è½½å®ŒæˆçŠ¶æ€ï¼Œä¸‹è½½å®Œæˆçš„ç›´æ¥æ ¹æ®è·¯å¾„åˆ é™¤å³å¯</div><div class="line">- (void)cancelDownloadWithFileId:(NSString *)fileId;</div><div class="line">//æš‚åœå…¨éƒ¨ï¼šä¸‹è½½çš„ï¼Œç­‰å¾…çš„</div><div class="line">- (void)suspendAllFilesDownload;</div><div class="line">//æ¢å¤å…¨éƒ¨ï¼šæš‚åœçš„ï¼Œå¤±è´¥çš„</div><div class="line">- (void)recoverAllFilesDownload;</div><div class="line">//å–æ¶ˆå…¨éƒ¨ï¼šä¸‹è½½çš„ï¼Œç­‰å¾…çš„ï¼Œæš‚åœçš„ï¼Œå¤±è´¥çš„</div><div class="line">- (void)cancelAllFilesDownload;</div></pre></td></tr></table></figure>
<p>ä¸ºäº†çŸ¥é“å„ä¸ªæ–‡ä»¶çš„ä¸‹è½½çŠ¶æ€ï¼Œæœ‰å¦‚ä¸‹æ–¹æ³•ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">- (FileDownloadState)getFileDownloadStateWithFileId:(NSString *)fileId;</div></pre></td></tr></table></figure>
<p>æœ€åï¼Œå¯¹äºä¸‹è½½è¿‡ç¨‹ä¸­ä»¥åŠå®Œæˆåçš„å„ç§çŠ¶æ€éœ€è¦ç›‘æµ‹</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">/*</div><div class="line"> ä¸‹è½½å¼€å§‹</div><div class="line"> */</div><div class="line">- (void)fileDownloadManagerStartDownload:(SCFileDownload *)download;</div><div class="line">/*</div><div class="line"> å¾—åˆ°å“åº”ï¼Œè·å¾—æ–‡ä»¶å¤§å°ç­‰</div><div class="line"> */</div><div class="line">- (void)fileDownloadManagerReceiveResponse:(SCFileDownload *)download FileSize:(uint64_t)totalLength;</div><div class="line">/*</div><div class="line"> ä¸‹è½½è¿‡ç¨‹ï¼Œæ›´æ–°è¿›åº¦</div><div class="line"> */</div><div class="line"> - (void)fileDownloadManagerUpdateProgress:(SCFileDownload *)download didReceiveData:(uint64_t)receiveLength downloadSpeed:(NSString *)downloadSpeed;</div><div class="line">/*</div><div class="line"> ä¸‹è½½å®Œæˆï¼ŒåŒ…æ‹¬æˆåŠŸå’Œå¤±è´¥</div><div class="line"> */</div><div class="line"> - (void)fileDownloadManagerFinishDownload:(SCFileDownload *)download success:(BOOL)downloadSuccess error:(NSError *)error;</div></pre></td></tr></table></figure>
<p>è‡³äºæ–‡ä»¶å¦‚ä½•ä»ç½‘ç»œè·å–ï¼Œæ ¸å¿ƒä»£ç æ— éæ˜¯è°ƒç”¨å¦‚ä¸‹å‡ ä¸ªæ–¹æ³•ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">- (void)connection:(NSURLConnection *)connection didReceiveResponse:(NSURLResponse *)response&#123;</div><div class="line">&#125;</div><div class="line">- (void)connection:(NSURLConnection *)connection didReceiveData:(NSData *)data&#123;</div><div class="line">&#125;</div><div class="line">- (void)connectionDidFinishLoading:(NSURLConnection *)connection&#123;</div><div class="line">&#125;</div><div class="line">- (void)connection:(NSURLConnection *)connection didFailWithError:(NSError *)error&#123;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æˆ–è€…æ˜¯å¦‚ä¸‹å‡ ä¸ªæ–¹æ³•ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">- (void)URLSession:(NSURLSession *)session downloadTask:(NSURLSessionDownloadTask *)downloadTask didResumeAtOffset:(int64_t)fileOffset expectedTotalBytes:(int64_t)expectedTotalBytes&#123;</div><div class="line">&#125;</div><div class="line">- (void)URLSession:(NSURLSession *)session downloadTask:(NSURLSessionDownloadTask *)downloadTask didWriteData:(int64_t)bytesWritten totalBytesWritten:(int64_t)totalBytesWritten totalBytesExpectedToWrite:(int64_t)totalBytesExpectedToWrite&#123;</div><div class="line">&#125;</div><div class="line">- (void)URLSession:(NSURLSession *)session downloadTask:(NSURLSessionDownloadTask *)downloadTask didFinishDownloadingToURL:(NSURL *)location&#123;</div><div class="line">&#125;</div><div class="line">- (void)URLSession:(NSURLSession *)session task:(NSURLSessionTask *)task didCompleteWithError:(NSError *)error&#123;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æ›´æˆ–è€…ç›´æ¥ç”¨AFNetworkingä¹Ÿå¯ä»¥ã€‚</p>
<p>åŸºäºNSURLConnectionå®ç°å®Œæ•´ç‰ˆé¡¹ç›®çŒ›æˆ³<a href="https://github.com/kaisayoung/FileDownloadTool.git" target="_blank" rel="external">è¿™é‡Œ</a>ã€‚<br>åŸºäºNSURLSessionå®ç°å®Œæ•´ç‰ˆé¡¹ç›®çŒ›æˆ³<a href="https://github.com/kaisayoung/FileDownloadManager.git" target="_blank" rel="external">è¿™é‡Œ</a>ã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ä¹‹å‰é¡¹ç›®ä¸­æœ‰è¿‡ä¸‹è½½è§†é¢‘çš„éœ€æ±‚ï¼Œäºæ˜¯æ»¡å¿ƒæ¬¢å–œçš„å»githubä¸Šæœç´¢æ–‡ä»¶ä¸‹è½½å·¥å…·ç±»ï¼Œç»“æœç•¥å¤±æœ›ï¼Œç«Ÿç„¶æ²¡æœ‰ä¸€ä¸ªç›¸å½“æ»¡æ„çš„ã€‚è™½ç„¶AFNetworkingä¸­å•ä¸ªæ–‡ä»¶ä¸‹è½½åŠŸèƒ½å·²ç»ç›¸å½“å®Œå–„ï¼Œä½†æ˜¯æˆ‘éœ€è¦ä¸€äº›æ¯”å¦‚å…¨éƒ¨æš‚åœï¼Œå…¨éƒ¨å¼€å§‹ä¹‹ç±»çš„ç®¡ç†çš„åŠŸèƒ½ï¼Œäºæ˜¯å°±è¯•ç€è‡ªå·±åŠ¨æ‰‹é€ äº†ä¸ªè½®å­ã€‚&lt;br&gt;
    
    </summary>
    
      <category term="iOS" scheme="http://yoursite.com/categories/iOS/"/>
    
    
      <category term="ä¸‹è½½" scheme="http://yoursite.com/tags/%E4%B8%8B%E8%BD%BD/"/>
    
  </entry>
  
  <entry>
    <title>M3U8æ ¼å¼è§†é¢‘ä¸‹è½½</title>
    <link href="http://yoursite.com/2016/08/25/M3U8%E6%A0%BC%E5%BC%8F%E8%A7%86%E9%A2%91%E4%B8%8B%E8%BD%BD/"/>
    <id>http://yoursite.com/2016/08/25/M3U8æ ¼å¼è§†é¢‘ä¸‹è½½/</id>
    <published>2016-08-25T08:48:30.000Z</published>
    <updated>2016-09-01T03:46:40.000Z</updated>
    
    <content type="html"><![CDATA[<p>ç°åœ¨çœ‹æ¥ï¼Œè¿™æ˜¯ä¹‹å‰åšè¿‡çš„æœ€æœ‰æ„æ€çš„ä¸€ä¸ªåŠŸèƒ½ã€‚ğŸ˜</p>
<p>M3U8æ˜¯ä¸€ç§æµåª’ä½“ï¼Œç°å¤šç”¨äºè§†é¢‘æ’­æ”¾ã€‚å½“æŠŠm3u8æ ¼å¼è§†é¢‘å¯¹åº”çš„urlä¸‹è½½ä¸‹æ¥ç”¨æ–‡æœ¬æ‰“å¼€ä¼šå‘ç°å…¶å®åªæ˜¯ä¸€æ®µå­—ç¬¦ä¸²ï¼ŒåŒ…å«äº†å¾ˆå¤šè§†é¢‘å°ç‰‡æ®µçš„åœ°å€ï¼Œé‚£ä¹ˆæ€ä¹ˆæ ·æŠŠæ•´ä¸ªè§†é¢‘ä¸‹è½½ä¸‹æ¥ç”¨äºæœ¬åœ°æ’­æ”¾å‘¢ï¼Ÿ<br><a id="more"></a></p>
<h3 id="m3u8æ–‡ä»¶"><a href="#m3u8æ–‡ä»¶" class="headerlink" title="m3u8æ–‡ä»¶"></a>m3u8æ–‡ä»¶</h3><p>é¦–å…ˆï¼Œm3u8æ–‡ä»¶å±•å¼€åçš„å­—ç¬¦ä¸²ç±»ä¼¼è¿™æ ·ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">#EXTM3U</div><div class="line">#EXT-X-TARGETDURATION:30</div><div class="line">#EXT-X-VERSION:2</div><div class="line">#EXT-X-DISCONTINUITY</div><div class="line">#EXTINF:10,</div><div class="line">http://f.youku.com/player/getMpegtsPath/st/flv/fileid/03000201004F4BC6AFD0C202E26EEEB41666A0-C93C-D6C9-9FFA-33424A776707/ipad0_0.ts?KM=14eb49fe4969126c6&amp;start=0&amp;end=10&amp;ts=10&amp;html5=1&amp;seg_no=0&amp;seg_time=0</div><div class="line">#EXTINF:20,</div><div class="line">http://f.youku.com/player/getMpegtsPath/st/flv/fileid/03000201004F4BC6AFD0C202E26EEEB41666A0-C93C-D6C9-9FFA-33424A776707/ipad0_1.ts?KM=14eb49fe4969126c6&amp;start=10&amp;end=30&amp;ts=20&amp;html5=1&amp;seg_no=1&amp;seg_time=0</div><div class="line">#EXTINF:20,</div><div class="line">http://f.youku.com/player/getMpegtsPath/st/flv/fileid/03000201004F4BC6AFD0C202E26EEEB41666A0-C93C-D6C9-9FFA-33424A776707/ipad0_2.ts?KM=14eb49fe4969126c6&amp;start=30&amp;end=50&amp;ts=20&amp;html5=1&amp;seg_no=2&amp;seg_time=0</div><div class="line">#EXTINF:20,</div><div class="line">http://f.youku.com/player/getMpegtsPath/st/flv/fileid/03000201004F4BC6AFD0C202E26EEEB41666A0-C93C-D6C9-9FFA-33424A776707/ipad0_3.ts?KM=14eb49fe4969126c6&amp;start=50&amp;end=70&amp;ts=20&amp;html5=1&amp;seg_no=3&amp;seg_time=0</div><div class="line">#EXTINF:24,</div><div class="line">http://f.youku.com/player/getMpegtsPath/st/flv/fileid/03000201004F4BC6AFD0C202E26EEEB41666A0-C93C-D6C9-9FFA-33424A776707/ipad0_4.ts?KM=14eb49fe4969126c6&amp;start=70&amp;end=98&amp;ts=24&amp;html5=1&amp;seg_no=4&amp;seg_time=0</div><div class="line">#EXT-X-ENDLIST</div></pre></td></tr></table></figure>
<p>åœ¨æ¯ä¸€è¡Œ#EXTINF:ä¸‹é¢çš„ç½‘å€å°±æ˜¯ä¸€ä¸ªä¸ªtsæ–‡ä»¶çš„åœ°å€ï¼Œå®é™…å»ä¸‹è½½çš„åº”è¯¥æ˜¯è¿™äº›è§†é¢‘å°ç‰‡æ®µã€‚è€Œåœ¨#EXTINF:åé¢çš„æ•°å­—ä»£è¡¨çš„æ˜¯è¿™ä¸ªtsæ–‡ä»¶æ‰€åŒ…å«è§†é¢‘çš„æ—¶é•¿ã€‚</p>
<h3 id="è§£æ"><a href="#è§£æ" class="headerlink" title="è§£æ"></a>è§£æ</h3><p>ç¬¬ä¸€æ­¥è¦è§£æè¿™ä¸ªm3u8çš„urlï¼Œå°†å…¶ä¸­æ‰€æœ‰tsæ–‡ä»¶çš„ä¸‹è½½åœ°å€è®°å½•ä¸‹æ¥ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">NSString *data = [NSString stringWithContentsOfURL:url usedEncoding:&amp;encoding error:&amp;error];</div><div class="line">NSMutableArray *segments = [NSMutableArray array];</div><div class="line">NSRange segmentRange = [remainData rangeOfString:@&quot;#EXTINF:&quot;];</div><div class="line">NSInteger segmentIndex = 0;</div><div class="line">NSInteger totalSeconds = 0;</div><div class="line">while (segmentRange.location != NSNotFound) &#123;</div><div class="line">    SCM3U8SegmentInfo *segment = [[SCM3U8SegmentInfo alloc] init];</div><div class="line">    //è¯»å–ç‰‡æ®µæ—¶é•¿</div><div class="line">    NSRange commaRange = [remainData rangeOfString:@&quot;,&quot;];</div><div class="line">    NSString *value = [remainData substringWithRange:NSMakeRange(segmentRange.location + [@&quot;#EXTINF:&quot; length], commaRange.location -(segmentRange.location + [@&quot;#EXTINF:&quot; length]))];</div><div class="line">    segment.duration = [value intValue];</div><div class="line">    totalSeconds+=segment.duration;</div><div class="line">    remainData = [remainData substringFromIndex:commaRange.location];</div><div class="line">    //è¯»å–ç‰‡æ®µurl</div><div class="line">    NSRange linkRangeBegin = [remainData rangeOfString:@&quot;http&quot;];</div><div class="line">    NSRange linkRangeEnd = [remainData rangeOfString:@&quot;#&quot;];</div><div class="line">    NSString *linkurl = [remainData substringWithRange:NSMakeRange(linkRangeBegin.location, linkRangeEnd.location - linkRangeBegin.location)];</div><div class="line">    segment.url = linkurl;</div><div class="line">    segment.index = segmentIndex;</div><div class="line">    //</div><div class="line">    segmentIndex++;</div><div class="line">    [segments addObject:segment];</div><div class="line">    remainData = [remainData substringFromIndex:linkRangeEnd.location];</div><div class="line">    segmentRange = [remainData rangeOfString:@&quot;#EXTINF:&quot;];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="ä¸‹è½½"><a href="#ä¸‹è½½" class="headerlink" title="ä¸‹è½½"></a>ä¸‹è½½</h3><p>å¾—åˆ°äº†è¿™äº›è§†é¢‘æ–‡ä»¶çš„çœŸå®åœ°å€åï¼Œå°±å¯ä»¥å»ä¸‹è½½äº†ã€‚ä¸‹è½½æ–¹æ³•æœ‰å¾ˆå¤šï¼Œå¯ä»¥ç”¨ç¬¬ä¸‰æ–¹åº“ASIHTTPRequestï¼ŒAFNetworkingï¼›æˆ–è€…ç›´æ¥ç”¨åŸç”Ÿçš„NSURLConnectionï¼ŒNSURLSessionéƒ½å¯ä»¥ã€‚æ³¨æ„å› ä¸ºä¸€ä¸ªè§†é¢‘åŒ…å«å¾ˆå¤šä¸ªå°çš„tsæ–‡ä»¶ï¼Œæ‰€ä»¥ä¸ºäº†ä¾¿äºç®¡ç†ï¼Œå»ºè®®1 æ˜¯å°†è¿™äº›æ–‡ä»¶æŒ‰ç´¢å¼•å·åˆ†åˆ«å‘½åä¸ºid0.ts,id1.ts,id2.tsç­‰ï¼Œ2 æ˜¯æŒ‰é¡ºåºå»ä¸‹è½½è¿™äº›å°ç‰‡æ®µï¼Œä¸”åŒä¸€æ—¶é—´åªä¸‹è½½ä¸€ä¸ªï¼Œå½“ä¸€ä¸ªä¸‹è½½å®Œæˆåï¼Œå†å»ä¸‹è½½ä¸‹ä¸€ä¸ªã€‚æ³¨æ„è¿™é‡Œå…¶å®æ¯ä¸€ä¸ªtså°ç‰‡æ®µæœ¬èº«éƒ½æ˜¯ä¸æ”¯æŒæ–­ç‚¹ç»­ä¼ çš„ğŸ˜³ã€‚</p>
<h3 id="æ‹¼æ¥"><a href="#æ‹¼æ¥" class="headerlink" title="æ‹¼æ¥"></a>æ‹¼æ¥</h3><p>å½“æ‰€æœ‰è¿™äº›tsæ–‡ä»¶ä¸‹è½½å®Œæˆåï¼Œéœ€è¦åœ¨æœ¬åœ°å°†å®ƒä»¬æ‹¼æ¥æˆä¸€ä¸ªæ–°çš„m3u8æ–‡ä»¶ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">NSString *pathPrefix = [NSSearchPathForDirectoriesInDomains(NSDocumentDirectory,NSUserDomainMask,YES) objectAtIndex:0];</div><div class="line">NSString *saveTo = [[pathPrefix stringByAppendingPathComponent:kPathDownload] stringByAppendingPathComponent:self.vid];</div><div class="line">NSString *fullPath = [saveTo stringByAppendingPathComponent:@&quot;movie.m3u8&quot;];</div><div class="line">//åˆ›å»ºæ–‡ä»¶å¤´éƒ¨</div><div class="line">NSString* head = @&quot;#EXTM3U\n#EXT-X-TARGETDURATION:30\n#EXT-X-VERSION:2\n#EXT-X-DISCONTINUITY\n&quot;;</div><div class="line">NSString* segmentPrefix = [NSString stringWithFormat:@&quot;http://127.0.0.1:54321/%@/&quot;,self.vid];</div><div class="line">NSInteger count = [self.segmentList.segments count];</div><div class="line">//å¡«å……ç‰‡æ®µæ•°æ®</div><div class="line">for(int i = 0;i&lt;count;i++)&#123;</div><div class="line">    NSString *filename = [NSString stringWithFormat:@&quot;id%d.ts&quot;,i];</div><div class="line">    SCM3U8SegmentInfo *segInfo = [self.segmentList getSegmentWithIndex:i];</div><div class="line">    NSString *length = [NSString stringWithFormat:@&quot;#EXTINF:%ld,\n&quot;,(long)segInfo.duration];</div><div class="line">    NSString *url = [segmentPrefix stringByAppendingString:filename];</div><div class="line">    head = [NSString stringWithFormat:@&quot;%@%@%@\n&quot;,head,length,url];</div><div class="line">&#125;</div><div class="line">//åˆ›å»ºå°¾éƒ¨</div><div class="line">NSString* end = @&quot;#EXT-X-ENDLIST&quot;;</div><div class="line">head = [head stringByAppendingString:end];</div><div class="line">NSMutableData *writer = [[NSMutableData alloc] init];</div><div class="line">[writer appendData:[head dataUsingEncoding:NSUTF8StringEncoding]];</div><div class="line">[writer writeToFile:fullPath atomically:YES];</div></pre></td></tr></table></figure>
<p>å…¶ä¸­127.0.0.1æ˜¯éšä¾¿å†™çš„ï¼Œåªè¦å’Œæ’­æ”¾æ—¶è°ƒç”¨çš„ä¸€è‡´å³å¯ã€‚æ‹¼æˆåæœ¬åœ°çš„m3u8æ–‡ä»¶ç”¨æ–‡æœ¬æ‰“å¼€ç±»ä¼¼å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">#EXTM3U</div><div class="line">#EXT-X-TARGETDURATION:30</div><div class="line">#EXT-X-VERSION:2</div><div class="line">#EXT-X-DISCONTINUITY</div><div class="line">#EXTINF:6,</div><div class="line">http://127.0.0.1:54321/TTT/id0.ts</div><div class="line">#EXTINF:6,</div><div class="line">http://127.0.0.1:54321/TTT/id1.ts</div><div class="line">#EXTINF:6,</div><div class="line">http://127.0.0.1:54321/TTT/id2.ts</div><div class="line">#EXTINF:6,</div><div class="line">http://127.0.0.1:54321/TTT/id3.ts</div><div class="line">#EXTINF:6,</div><div class="line">http://127.0.0.1:54321/TTT/id4.ts</div><div class="line">#EXTINF:6,</div><div class="line">http://127.0.0.1:54321/TTT/id5.ts</div><div class="line">#EXTINF:6,</div><div class="line">http://127.0.0.1:54321/TTT/id6.ts</div><div class="line">#EXTINF:6,</div><div class="line">http://127.0.0.1:54321/TTT/id7.ts</div><div class="line">#EXTINF:6,</div><div class="line">http://127.0.0.1:54321/TTT/id8.ts</div><div class="line">#EXT-X-ENDLIST</div></pre></td></tr></table></figure>
<h3 id="æœ¬åœ°æ’­æ”¾"><a href="#æœ¬åœ°æ’­æ”¾" class="headerlink" title="æœ¬åœ°æ’­æ”¾"></a>æœ¬åœ°æ’­æ”¾</h3><p>ç”±äºm3u8åªæ”¯æŒhttpåè®®çš„è¿œç¨‹æ’­æ”¾ï¼Œæ‰€ä»¥å¿…é¡»åœ¨åº”ç”¨ç¨‹åºé‡Œæ­å»ºä¸€ä¸ªæœåŠ¡å™¨ã€‚å¥½æ¶ˆæ¯æ˜¯æ—©å°±æœ‰å¼€æºåº“CocoaHTTPServeråšåˆ°äº†è¿™ä¸€ç‚¹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">- (void)setHttpServer &#123;</div><div class="line">    _httpServer = [[HTTPServer alloc] init];</div><div class="line">    [_httpServer setType:@&quot;_http._tcp.&quot;];</div><div class="line">    [_httpServer setPort:54321];</div><div class="line">    NSString *pathPrefix = [NSSearchPathForDirectoriesInDomains(NSDocumentDirectory,NSUserDomainMask,YES) objectAtIndex:0];</div><div class="line">    NSString *webPath = [pathPrefix stringByAppendingPathComponent:kPathDownload];</div><div class="line">    NSLog(@&quot;Setting document root: %@&quot;, webPath);</div><div class="line">    [_httpServer setDocumentRoot:webPath];</div><div class="line">    NSError *error;</div><div class="line">    if(![_httpServer start:&amp;error]) &#123;</div><div class="line">        NSLog(@&quot;Error starting HTTP Server: %@&quot;, error);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æœ€åï¼Œå°†ç±»ä¼¼127.0.0.1:54321/%@/movie.m3u8è¿™æ ·çš„åœ°å€ä¼ ç»™ç³»ç»Ÿæ’­æ”¾å™¨å°±å¯ä»¥å®ç°æœ¬åœ°æ’­æ”¾äº†ã€‚</p>
<p>å®Œæ•´ç‰ˆDemoè¯·çŒ›æˆ³<a href="https://github.com/kaisayoung/M3U8VideoDownloadDemo.git" target="_blank" rel="external">è¿™é‡Œ</a>ã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ç°åœ¨çœ‹æ¥ï¼Œè¿™æ˜¯ä¹‹å‰åšè¿‡çš„æœ€æœ‰æ„æ€çš„ä¸€ä¸ªåŠŸèƒ½ã€‚ğŸ˜&lt;/p&gt;
&lt;p&gt;M3U8æ˜¯ä¸€ç§æµåª’ä½“ï¼Œç°å¤šç”¨äºè§†é¢‘æ’­æ”¾ã€‚å½“æŠŠm3u8æ ¼å¼è§†é¢‘å¯¹åº”çš„urlä¸‹è½½ä¸‹æ¥ç”¨æ–‡æœ¬æ‰“å¼€ä¼šå‘ç°å…¶å®åªæ˜¯ä¸€æ®µå­—ç¬¦ä¸²ï¼ŒåŒ…å«äº†å¾ˆå¤šè§†é¢‘å°ç‰‡æ®µçš„åœ°å€ï¼Œé‚£ä¹ˆæ€ä¹ˆæ ·æŠŠæ•´ä¸ªè§†é¢‘ä¸‹è½½ä¸‹æ¥ç”¨äºæœ¬åœ°æ’­æ”¾å‘¢ï¼Ÿ&lt;br&gt;
    
    </summary>
    
      <category term="iOS" scheme="http://yoursite.com/categories/iOS/"/>
    
    
      <category term="M3U8" scheme="http://yoursite.com/tags/M3U8/"/>
    
  </entry>
  
  <entry>
    <title>M3U8ç®€ä»‹</title>
    <link href="http://yoursite.com/2016/08/25/M3U8%E7%AE%80%E4%BB%8B/"/>
    <id>http://yoursite.com/2016/08/25/M3U8ç®€ä»‹/</id>
    <published>2016-08-25T08:35:43.000Z</published>
    <updated>2016-09-01T03:46:59.000Z</updated>
    
    <content type="html"><![CDATA[<p>ä¹‹å‰å…¬å¸ä»åˆ«çš„ç½‘ç«™ä¸ŠæŠ“äº†å¥½å¤šè§†é¢‘ï¼Œåæ¥æƒ³åšä¸‹è½½åŠŸèƒ½ï¼Œæœ¬æ¥ä»¥ä¸ºèƒ½æŠ“åˆ°mp4çš„è·¯å¾„ï¼Œåæ¥å‡ ç»æ³¢æŠ˜å‘ç°åªèƒ½å¾—åˆ°M3U8åœ°å€ï¼Œäºæ˜¯ç ”ç©¶ä¸‹åˆ°åº•ç¥é©¬æ˜¯M3U8ã€‚<br><a id="more"></a><br>M3Uæœ¬è´¨ä¸Šè¯´ä¸æ˜¯éŸ³é¢‘æ–‡ä»¶ï¼Œå®ƒæ˜¯éŸ³é¢‘æ–‡ä»¶çš„åˆ—è¡¨æ–‡ä»¶ï¼Œæ˜¯çº¯æ–‡æœ¬æ–‡ä»¶ã€‚ä½ ä¸‹è½½ä¸‹æ¥æ‰“å¼€å®ƒï¼Œæ’­æ”¾è½¯ä»¶å¹¶ä¸æ˜¯æ’­æ”¾å®ƒï¼Œè€Œæ˜¯æ ¹æ®å®ƒçš„è®°å½•æ‰¾åˆ°ç½‘ç»œåœ°å€è¿›è¡Œåœ¨çº¿æ’­æ”¾ã€‚<br>M3Uæ–‡ä»¶çš„å¤§å°å¾ˆå°ï¼Œä¹Ÿå°±æ˜¯å› ä¸ºå®ƒé‡Œé¢æ²¡æœ‰ä»»ä½•éŸ³é¢‘æ•°æ®ã€‚æŠŠM3Uæ–‡ä»¶ç›´æ¥è½¬æ¢ä¸ºéŸ³é¢‘æ–‡ä»¶æ˜¯ä¸å¯èƒ½çš„ï¼Œé™¤éä½ æŠŠå®ƒæŒ‡å‘çš„éŸ³é¢‘æ–‡ä»¶ä¸‹è½½ä¸‹æ¥å†ä½œå¤„ç†ã€‚m3uæ ¼å¼çš„æ–‡ä»¶åªæ˜¯å­˜å‚¨å¤šåª’ä½“æ’­æ”¾åˆ—è¡¨ï¼Œæä¾›äº†ä¸€ä¸ªæŒ‡å‘å…¶ä»–ä½ç½®çš„éŸ³é¢‘è§†é¢‘æ–‡ä»¶çš„ç´¢å¼•ï¼Œä½ æ’­æ”¾çš„è¿˜æ˜¯é‚£äº›è¢«æŒ‡å‘çš„æ–‡ä»¶ï¼Œç”¨è®°äº‹æœ¬æ‰“å¼€m3uæ–‡ä»¶å¯ä»¥æŸ¥çœ‹æ‰€æŒ‡å‘æ–‡ä»¶çš„åœ°å€åŠæ–‡ä»¶çš„å±æ€§ï¼Œä»¥é€‰ç”¨åˆé€‚æ’­æ”¾å™¨æ’­æ”¾ã€‚ </p>
<p>M3U8ä¹Ÿæ˜¯ä¸€ç§M3Uï¼Œåªæ˜¯å®ƒçš„ç¼–ç æ ¼å¼æ˜¯UTF-8æ ¼å¼ã€‚M3Uç”¨Latin-1å­—ç¬¦é›†ç¼–ç ã€‚</p>
<p>M3U8æœ‰å•¥å¥½å¤„å‘¢ï¼Ÿä¸»è¦æ˜¯å¯ä»¥åšå¤šç ç‡çš„é€‚é…ï¼Œæ ¹æ®ç½‘ç»œå¸¦å®½ï¼Œå®¢æˆ·ç«¯ä¼šè‡ªåŠ¨é€‰æ‹©ä¸€ä¸ªé€‚åˆè‡ªå·±ç ç‡çš„æ–‡ä»¶è¿›è¡Œæ’­æ”¾ï¼Œä¿è¯è§†é¢‘æµçš„æµç•…ã€‚</p>
<p>ä¸ºä»€ä¹ˆç°åœ¨å¤§éƒ¨åˆ†è§†é¢‘å®¢æˆ·ç«¯éƒ½ç”¨TSæµæ’­æ”¾è§†é¢‘è€Œä¸ç›´æ¥æ’­æ”¾æ–‡ä»¶å‘¢ï¼Ÿ</p>
<p>è¿™ä¸ªæ˜¯ Apple ä¸ºäº†æé«˜æµæ’­æ•ˆç‡å¼€å‘çš„æŠ€æœ¯ï¼Œç‰¹ç‚¹æ˜¯å°†æµåª’ä½“åˆ‡åˆ†ä¸ºè‹¥å¹² TS ç‰‡æ®µï¼ˆæ¯”å¦‚æ¯10ç§’ä¸€æ®µï¼‰ï¼Œç„¶åé€šè¿‡ä¸€ä¸ªæ‰©å±•çš„ m3u åˆ—è¡¨æ–‡ä»¶å°†è¿™äº› TS ç‰‡æ®µé›†ä¸­èµ·æ¥ä¾›å®¢æˆ·ç«¯æ’­æ”¾å™¨æ¥æ”¶ã€‚</p>
<p>è¿™æ ·åšç›¸æ¯”ä½¿ç”¨ RTSP åè®®çš„å¥½å¤„åœ¨äºï¼Œä¸€æ—¦åˆ‡åˆ†å®Œæˆï¼Œä¹‹åçš„åˆ†å‘è¿‡ç¨‹å®Œå…¨ä¸éœ€è¦é¢å¤–ä½¿ç”¨ä»»ä½•ä¸“é—¨è½¯ä»¶ï¼Œæ™®é€šçš„ç½‘ç»œæœåŠ¡å™¨å³å¯ï¼Œå¤§å¤§é™ä½äº† CDN è¾¹ç¼˜æœåŠ¡å™¨çš„é…ç½®è¦æ±‚ï¼Œå¯ä»¥ä½¿ç”¨ä»»ä½•ç°æˆçš„ CDNã€‚åˆ†å‘ä½¿ç”¨çš„åè®®æ˜¯æœ€å¸¸è§ HTTPï¼Œä»£ç†æœåŠ¡å™¨å¯¹è¿™ä¸ªåè®®çš„ç¼“å­˜ä¼˜åŒ–ç›¸å½“æˆç†Ÿï¼Œè€Œå¾ˆå°‘æœ‰ä»£ç†æœåŠ¡å™¨å¯¹ RTSP çš„è¿›è¡Œç¼“å­˜ä¼˜åŒ–ã€‚è¿™å¯¹æ’­æ”¾ï¼ˆè½¯ï¼‰å®æ—¶è§†é¢‘æœ‰ç›¸å½“å¤§çš„ä¼˜åŠ¿ï¼Œå› ä¸ºè¿™æ ·åˆ†å‘åï¼Œå¯¹æºæœåŠ¡å™¨çš„è´Ÿè½½å‹åŠ›å°å¾—å¤šã€‚</p>
<p>å¯¹äºéå®æ—¶è§†é¢‘ï¼ŒåŒæ ·çš„å¥½å¤„ä¹Ÿæ˜¯å­˜åœ¨çš„ï¼šå¦‚æœä½ è¦åœ¨ä¸€æ®µé•¿è¾¾ä¸€å°æ—¶çš„è§†é¢‘ä¸­è·³è½¬ï¼Œå¦‚æœä½¿ç”¨å•ä¸ª MP4 æ ¼å¼çš„è§†é¢‘æ–‡ä»¶ï¼Œå¹¶ä¸”ä¹Ÿæ˜¯ç”¨ HTTP åè®®ï¼Œé‚£ä¹ˆéœ€è¦ä»£ç†æœåŠ¡å™¨æ”¯æŒ HTTP range request ä»¥è·å–å¤§æ–‡ä»¶ä¸­çš„ä¸€éƒ¨åˆ†ã€‚ä¸æ˜¯æ‰€æœ‰çš„ä»£ç†æœåŠ¡å™¨éƒ½å¯¹æ­¤æœ‰è‰¯å¥½çš„æ”¯æŒã€‚è€Œ HTTP Live Streaming åˆ™åªéœ€è¦æ ¹æ®åˆ—è¡¨æ–‡ä»¶ä¸­çš„æ—¶é—´è½´æ‰¾å‡ºå¯¹åº”çš„ TS ç‰‡æ®µä¸‹è½½å³å¯ï¼Œä¸éœ€è¦ range requestï¼Œå¯¹ä»£ç†æœåŠ¡å™¨çš„è¦æ±‚å°å¾ˆå¤šã€‚æ‰€æœ‰ä»£ç†æœåŠ¡å™¨éƒ½æ”¯æŒå°æ–‡ä»¶çš„é«˜æ•ˆç¼“å­˜ã€‚</p>
<p>æ­¤å¤–ï¼ŒHTTP Live Streaming è¿˜æœ‰ä¸€ä¸ªå·¨å¤§ä¼˜åŠ¿ï¼šè‡ªé€‚åº”ç ç‡æµæ’­ï¼ˆadaptive streamingï¼‰ã€‚æ•ˆæœå°±æ˜¯å®¢æˆ·ç«¯ä¼šæ ¹æ®ç½‘ç»œçŠ¶å†µè‡ªåŠ¨é€‰æ‹©ä¸åŒç ç‡çš„è§†é¢‘æµï¼Œæ¡ä»¶å…è®¸çš„æƒ…å†µä¸‹ä½¿ç”¨é«˜ç ç‡ï¼Œç½‘ç»œç¹å¿™çš„æ—¶å€™ä½¿ç”¨ä½ç ç‡ï¼Œå¹¶ä¸”è‡ªåŠ¨åœ¨äºŒè€…é—´éšæ„åˆ‡æ¢ã€‚è¿™å¯¹ç§»åŠ¨è®¾å¤‡ç½‘ç»œçŠ¶å†µä¸ç¨³å®šçš„æƒ…å†µä¸‹ä¿éšœæµç•…æ’­æ”¾éå¸¸æœ‰å¸®åŠ©ã€‚å®ç°æ–¹æ³•æ˜¯æœåŠ¡å™¨ç«¯æä¾›å¤šç ç‡è§†é¢‘æµï¼Œå¹¶ä¸”åœ¨åˆ—è¡¨æ–‡ä»¶ä¸­æ³¨æ˜ï¼Œæ’­æ”¾å™¨æ ¹æ®æ’­æ”¾è¿›åº¦å’Œä¸‹è½½é€Ÿåº¦è‡ªåŠ¨è°ƒæ•´ã€‚</p>
<p>è‡³äºä¸ºä»€ä¹ˆè¦ç”¨ TS è€Œä¸æ˜¯ MP4ï¼Œè¿™æ˜¯å› ä¸ºä¸¤ä¸ª TS ç‰‡æ®µå¯ä»¥æ— ç¼æ‹¼æ¥ï¼Œæ’­æ”¾å™¨èƒ½è¿ç»­æ’­æ”¾ï¼Œè€Œ MP4 æ–‡ä»¶ç”±äºç¼–ç æ–¹å¼çš„åŸå› ï¼Œä¸¤æ®µ MP4 ä¸èƒ½æ— ç¼æ‹¼æ¥ï¼Œæ’­æ”¾å™¨è¿ç»­æ’­æ”¾ä¸¤ä¸ª MP4 æ–‡ä»¶ä¼šå‡ºç°ç ´éŸ³å’Œç”»é¢é—´æ–­ï¼Œå½±å“ç”¨æˆ·ä½“éªŒã€‚</p>
<p><a href="http://blog.csdn.net/langeldep/article/details/8603045" target="_blank" rel="external">å‚è€ƒ1</a><br><a href="http://blog.csdn.net/blueboyhi/article/details/40107683" target="_blank" rel="external">å‚è€ƒ2</a><br><a href="http://www.zhihu.com/question/19644648" target="_blank" rel="external">å‚è€ƒ3</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ä¹‹å‰å…¬å¸ä»åˆ«çš„ç½‘ç«™ä¸ŠæŠ“äº†å¥½å¤šè§†é¢‘ï¼Œåæ¥æƒ³åšä¸‹è½½åŠŸèƒ½ï¼Œæœ¬æ¥ä»¥ä¸ºèƒ½æŠ“åˆ°mp4çš„è·¯å¾„ï¼Œåæ¥å‡ ç»æ³¢æŠ˜å‘ç°åªèƒ½å¾—åˆ°M3U8åœ°å€ï¼Œäºæ˜¯ç ”ç©¶ä¸‹åˆ°åº•ç¥é©¬æ˜¯M3U8ã€‚&lt;br&gt;
    
    </summary>
    
      <category term="iOS" scheme="http://yoursite.com/categories/iOS/"/>
    
    
      <category term="M3U8" scheme="http://yoursite.com/tags/M3U8/"/>
    
  </entry>
  
  <entry>
    <title>ç±»ä¼¼æœç‹è§†é¢‘Appè§†é¢‘åˆ—è¡¨æ’­æ”¾</title>
    <link href="http://yoursite.com/2016/08/25/%E7%B1%BB%E4%BC%BC%E6%90%9C%E7%8B%90%E8%A7%86%E9%A2%91App%E8%A7%86%E9%A2%91%E5%88%97%E8%A1%A8%E6%92%AD%E6%94%BE/"/>
    <id>http://yoursite.com/2016/08/25/ç±»ä¼¼æœç‹è§†é¢‘Appè§†é¢‘åˆ—è¡¨æ’­æ”¾/</id>
    <published>2016-08-25T08:13:12.000Z</published>
    <updated>2016-09-01T03:47:10.000Z</updated>
    
    <content type="html"><![CDATA[<p>æœ‰äº›è§†é¢‘Appä¼šæœ‰ä¸€ä¸ªè§†é¢‘åˆ—è¡¨æ’­æ”¾åŠŸèƒ½ï¼Œä¾‹å¦‚æœç‹è§†é¢‘Appçš„çƒ­ç‚¹æ¨¡å—ï¼Œè…¾è®¯è§†é¢‘Appçš„çƒ­ç‚¹æ¨¡å—ç­‰ã€‚è¿›å…¥æ­¤é¡µé¢ä¼šè‡ªåŠ¨æ’­æ”¾è§†é¢‘ï¼Œæ»‘åŠ¨é¡µé¢è¿˜ä¼šè‡ªåŠ¨åˆ‡æ¢æ’­æ”¾è§†é¢‘ï¼ŒåŒæ—¶æ”¯æŒæ¨ªç«–å±åˆ‡æ¢ï¼Œç¡®å®æ¯”è¾ƒæ–¹ä¾¿ã€‚ç ”ç©¶äº†ä¸‹ï¼Œå®ç°æ–¹æ³•å¦‚ä¸‹ã€‚<br><a id="more"></a><br>é¦–å…ˆè®°å½•ä¸‹tableviewå½“å‰å±•ç¤ºçš„æ‰€æœ‰cellçš„indexPath:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">- (void)tableView:(UITableView *)tableView willDisplayCell:(UITableViewCell *)cell forRowAtIndexPath:(NSIndexPath *)indexPath &#123;</div><div class="line">    [self addOneIndexPathToVisibleIndexArrayWithValue:indexPath];</div><div class="line">&#125;</div><div class="line">- (void)tableView:(UITableView *)tableView didEndDisplayingCell:(UITableViewCell *)cell forRowAtIndexPath:(NSIndexPath *)indexPath &#123;</div><div class="line">    [_visibleIndexArray removeObject:indexPath];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ç„¶åå½“é¡µé¢åœæ­¢æ»‘åŠ¨æ—¶è¦åˆ¤æ–­å‡ºéœ€è¦æ’­æ”¾çš„è§†é¢‘å­˜åœ¨äºç¬¬å‡ ä¸ªcellä¸­ï¼Œè‡ªåŠ¨å»æ’­æ”¾å…¶ä¸­çš„è§†é¢‘ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">- (void)scrollViewDidEndScrollingAnimation:(UIScrollView *)scrollView &#123;</div><div class="line">    self.currentPlayingIndex = [self getCurrentCellIndexShouldBePlaying];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å…¶æ¬¡è¿˜è¦å°†æ­¤cellå›ä¼ åˆ°ViewControllerä¸­ï¼Œåœ¨cellä¸­æ·»åŠ delegateæ–¹æ³•ï¼Œæ³¨æ„å¦‚æœä¹‹å‰æœ‰cellå·²ç»åœ¨æ’­æ”¾è§†é¢‘ï¼Œéœ€è¦æ¢å¤åˆå§‹çŠ¶æ€</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">- (void)videoPlayListTableViewCellPlayButtonTappedWithIndex:(NSInteger)index AndCell:(SCVideoPlayListTableViewCell *)cell &#123;</div><div class="line">    if(_currentPlayingCell)&#123;</div><div class="line">        [_currentPlayingCell backToInitState];</div><div class="line">        _currentPlayingCell = nil;</div><div class="line">    &#125;</div><div class="line">    _currentPlayingIndex = index;</div><div class="line">    _currentPlayingCell = cell;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æ¥ç€æ»‘åŠ¨åˆ—è¡¨åœæ­¢æ—¶ï¼Œå¦‚æœä¹‹å‰æ’­æ”¾çš„cellå·²ç»æ»šå‡ºå±å¹•ï¼Œéœ€è¦åœæ­¢æ’­æ”¾</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">- (void)scrollViewDidEndScrollingAnimation:(UIScrollView *)scrollView &#123;</div><div class="line">    [NSObject cancelPreviousPerformRequestsWithTarget:self];</div><div class="line">    BOOL isOutOfScreen = [self judgeCurrentFullScreenPlayingCellIfOutOfScreen];</div><div class="line">    if(isOutOfScreen)&#123;</div><div class="line">        [self rotateToPortrait];</div><div class="line">        if(_currentPlayingCell)&#123;</div><div class="line">            [_currentPlayingCell removeFromSuperview];</div><div class="line">            [_currentPlayingCell backToInitState];</div><div class="line">            _currentPlayingCell = nil;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    self.currentPlayingIndex = [self getCurrentCellIndexShouldBePlaying];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ç„¶åä¸ºäº†å®ç°æ¨ªç«–å±åˆ‡æ¢ï¼Œæ·»åŠ ç›‘æµ‹å±å¹•æ–¹å‘å˜åŒ–çš„é€šçŸ¥ï¼Œå¹¶å®ç°å¯¹åº”çš„æ–¹æ³•</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">- (void)viewWillAppear:(BOOL)animated &#123;</div><div class="line">    [super viewWillAppear:animated];</div><div class="line">    [[NSNotificationCenter defaultCenter] addObserver:self selector:@selector(orientationHasChange:) name:UIDeviceOrientationDidChangeNotification object:nil];</div><div class="line">&#125;</div><div class="line">- (void)orientationHasChange:(NSNotification *)notification</div><div class="line">&#123;</div><div class="line">    if(!_currentPlayingCell)&#123;</div><div class="line">        return;</div><div class="line">    &#125;</div><div class="line">    UIDevice *device = (UIDevice *)notification.object;</div><div class="line">    if(device.orientation == UIInterfaceOrientationLandscapeLeft)&#123;</div><div class="line">        [self rotateToLandscapeLeft];</div><div class="line">    &#125;</div><div class="line">    else if(device.orientation == UIInterfaceOrientationLandscapeRight)&#123;</div><div class="line">        [self rotateToLandscapeRight];</div><div class="line">    &#125;</div><div class="line">    else if(device.orientation == UIInterfaceOrientationPortrait)&#123;</div><div class="line">        [self rotateToPortrait];</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æœ€åè¦æ³¨æ„ï¼Œç¦»å¼€é¡µé¢æ—¶ä¹Ÿè¦åœæ­¢æ’­æ”¾å½“å‰cellä¸­çš„è§†é¢‘</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">- (void)viewWillDisappear:(BOOL)animated</div><div class="line">&#123;</div><div class="line">    [super viewWillDisappear:animated];</div><div class="line">    [[NSNotificationCenter defaultCenter] removeObserver:self name:UIDeviceOrientationDidChangeNotification object:nil];</div><div class="line">    if(_currentPlayingCell)&#123;</div><div class="line">        [_currentPlayingCell backToInitState];</div><div class="line">        _currentPlayingCell = nil;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>é¡¹ç›®å®Œæ•´ç‰ˆåœ°å€è¯·çŒ›æˆ³<a href="https://github.com/kaisayoung/VideoListPlayDemo.git" target="_blank" rel="external">è¿™é‡Œ</a>ã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æœ‰äº›è§†é¢‘Appä¼šæœ‰ä¸€ä¸ªè§†é¢‘åˆ—è¡¨æ’­æ”¾åŠŸèƒ½ï¼Œä¾‹å¦‚æœç‹è§†é¢‘Appçš„çƒ­ç‚¹æ¨¡å—ï¼Œè…¾è®¯è§†é¢‘Appçš„çƒ­ç‚¹æ¨¡å—ç­‰ã€‚è¿›å…¥æ­¤é¡µé¢ä¼šè‡ªåŠ¨æ’­æ”¾è§†é¢‘ï¼Œæ»‘åŠ¨é¡µé¢è¿˜ä¼šè‡ªåŠ¨åˆ‡æ¢æ’­æ”¾è§†é¢‘ï¼ŒåŒæ—¶æ”¯æŒæ¨ªç«–å±åˆ‡æ¢ï¼Œç¡®å®æ¯”è¾ƒæ–¹ä¾¿ã€‚ç ”ç©¶äº†ä¸‹ï¼Œå®ç°æ–¹æ³•å¦‚ä¸‹ã€‚&lt;br&gt;
    
    </summary>
    
      <category term="iOS" scheme="http://yoursite.com/categories/iOS/"/>
    
    
      <category term="è§†é¢‘" scheme="http://yoursite.com/tags/%E8%A7%86%E9%A2%91/"/>
    
  </entry>
  
  <entry>
    <title>è§†é¢‘æ’­æ”¾æ¨ªç«–å±åˆ‡æ¢</title>
    <link href="http://yoursite.com/2016/08/25/%E8%A7%86%E9%A2%91%E6%92%AD%E6%94%BE%E6%A8%AA%E7%AB%96%E5%B1%8F%E5%88%87%E6%8D%A2/"/>
    <id>http://yoursite.com/2016/08/25/è§†é¢‘æ’­æ”¾æ¨ªç«–å±åˆ‡æ¢/</id>
    <published>2016-08-25T07:26:46.000Z</published>
    <updated>2016-09-01T03:47:27.000Z</updated>
    
    <content type="html"><![CDATA[<p>ä¹‹å‰å¾ˆé•¿ä¸€æ®µæ—¶é—´éƒ½åœ¨åšè§†é¢‘ç›¸å…³çš„é¡¹ç›®ï¼Œå…¶ä¸­ä¸€ä¸ªæœ€åŸºç¡€æœ€é‡è¦çš„åŠŸèƒ½å°±æ˜¯æ’­æ”¾æ—¶çš„æ¨ªç«–å±åˆ‡æ¢ï¼Œäºæ˜¯ä¹ç ”ç©¶å¯¹æ¯”äº†ä¸‹å¸‚åœºä¸Šä¸»è¦è§†é¢‘ç±»APPçš„æ¨ªç«–å±åˆ‡æ¢æ–¹å¼ã€‚å‘ç°å…±åˆ†ä¸ºä¸¤ç§ï¼Œä¸€ç§ä»¥ä¼˜é…·è§†é¢‘å’ŒåœŸè±†è§†é¢‘ä¸ºä»£è¡¨ï¼Œå½“æ¨ªæ”¾æ‰‹æœºæ—¶æ•´ä¸ªç•Œé¢éƒ½æ—‹è½¬ï¼›å¦ä¸€ç§ä»¥è…¾è®¯è§†é¢‘ï¼Œæœç‹è§†é¢‘ä¸ºä»£è¡¨ï¼Œå½“æ¨ªæ”¾æ‰‹æœºæ—¶åªæ˜¯æ’­æ”¾çš„å°è§†å›¾æ—‹è½¬ï¼Œå…¶ä½™å†…å®¹ä¸å˜ã€‚å®ç°æ–¹æ³•åˆ†åˆ«å¦‚ä¸‹ã€‚<br><a id="more"></a></p>
<h2 id="åˆ‡æ¢æ–¹å¼1ï¼ˆåŒä¼˜é…·è§†é¢‘ï¼‰"><a href="#åˆ‡æ¢æ–¹å¼1ï¼ˆåŒä¼˜é…·è§†é¢‘ï¼‰" class="headerlink" title="åˆ‡æ¢æ–¹å¼1ï¼ˆåŒä¼˜é…·è§†é¢‘ï¼‰"></a>åˆ‡æ¢æ–¹å¼1ï¼ˆåŒä¼˜é…·è§†é¢‘ï¼‰</h2><h4 id="controlleræ”¯æŒæ¨ªç«–å±åˆ‡æ¢"><a href="#controlleræ”¯æŒæ¨ªç«–å±åˆ‡æ¢" class="headerlink" title="controlleræ”¯æŒæ¨ªç«–å±åˆ‡æ¢"></a>controlleræ”¯æŒæ¨ªç«–å±åˆ‡æ¢</h4><p>æ§åˆ¶æ•´ä¸ªcontrollerçš„viewæ”¯æŒæ¨ªç«–å±åˆ‡æ¢çš„å‡ ä¸ªæ–¹æ³•</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">- (BOOL)shouldAutorotate &#123;</div><div class="line">    return YES;</div><div class="line">&#125;</div><div class="line">- (NSUInteger)supportedInterfaceOrientations &#123;</div><div class="line">    return UIInterfaceOrientationMaskAllButUpsideDown;</div><div class="line">&#125;</div><div class="line">- (UIInterfaceOrientation)preferredInterfaceOrientationForPresentation &#123;</div><div class="line">    return UIInterfaceOrientationPortrait;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="ç›‘æµ‹å±å¹•æ–¹å‘å˜åŒ–"><a href="#ç›‘æµ‹å±å¹•æ–¹å‘å˜åŒ–" class="headerlink" title="ç›‘æµ‹å±å¹•æ–¹å‘å˜åŒ–"></a>ç›‘æµ‹å±å¹•æ–¹å‘å˜åŒ–</h4><p>æ·»åŠ ç›‘æµ‹å±å¹•æ–¹å‘å˜åŒ–çš„é€šçŸ¥</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">- (void)viewWillAppear:(BOOL)animated &#123;</div><div class="line">    [super viewWillAppear:animated];</div><div class="line">    [[NSNotificationCenter defaultCenter] addObserver:self selector:@selector(orientationHasChange:) name:UIDeviceOrientationDidChangeNotification object:nil];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="å±å¹•æ–¹å‘å˜åŒ–æ—¶çš„å¤„ç†"><a href="#å±å¹•æ–¹å‘å˜åŒ–æ—¶çš„å¤„ç†" class="headerlink" title="å±å¹•æ–¹å‘å˜åŒ–æ—¶çš„å¤„ç†"></a>å±å¹•æ–¹å‘å˜åŒ–æ—¶çš„å¤„ç†</h4><p>é€šçŸ¥çš„å›è°ƒæ–¹æ³•ä¸­å¦‚ä¸‹</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line">- (void)orientationHasChange:(NSNotification *)notification &#123;</div><div class="line">    UIDevice *device = (UIDevice *)notification.object;</div><div class="line">    if(device.orientation == UIInterfaceOrientationLandscapeLeft)&#123;</div><div class="line">        [self rotateToLandscapeLeft];</div><div class="line">    &#125;</div><div class="line">    else if(device.orientation == UIInterfaceOrientationLandscapeRight)&#123;</div><div class="line">        [self rotateToLandscapeRight];</div><div class="line">    &#125;</div><div class="line">    else if(device.orientation == UIInterfaceOrientationPortrait)&#123;</div><div class="line">        [self rotateToPortrait];</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line">- (void)rotateToFullScreen &#123;</div><div class="line">    if(SCREEN_WIDTH&gt;SCREEN_HEIGHT)&#123;</div><div class="line">        _videoPlayManageView.frame = CGRectMake(0, 0, SCREEN_WIDTH, SCREEN_HEIGHT);</div><div class="line">    &#125;</div><div class="line">    else&#123;</div><div class="line">        _videoPlayManageView.frame = CGRectMake(0, 0, SCREEN_HEIGHT, SCREEN_WIDTH);</div><div class="line">    &#125;</div><div class="line">    [_videoPlayManageView enterInFullScreen];</div><div class="line">&#125;</div><div class="line">- (void)rotateToLandscapeLeft &#123;</div><div class="line">    if(_lastOrientationValue==UIInterfaceOrientationLandscapeLeft)&#123;</div><div class="line">        return;</div><div class="line">    &#125;</div><div class="line">    [self rotateToFullScreen];</div><div class="line">    _lastOrientationValue = UIInterfaceOrientationLandscapeLeft;</div><div class="line">&#125;</div><div class="line">- (void)rotateToLandscapeRight &#123;</div><div class="line">    if(_lastOrientationValue==UIInterfaceOrientationLandscapeRight)&#123;</div><div class="line">        return;</div><div class="line">    &#125;</div><div class="line">    [self rotateToFullScreen];</div><div class="line">    _lastOrientationValue = UIInterfaceOrientationLandscapeRight;</div><div class="line">&#125;</div><div class="line">- (void)rotateToPortrait &#123;</div><div class="line">    if(_lastOrientationValue==UIInterfaceOrientationPortrait)&#123;</div><div class="line">        return;</div><div class="line">    &#125;</div><div class="line">    _videoPlayManageView.frame = _normalScreenFrame;</div><div class="line">    [_videoPlayManageView exitFromFullScreen];</div><div class="line">    _lastOrientationValue = UIInterfaceOrientationPortrait;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="å¼ºåˆ¶åˆ‡æ¢"><a href="#å¼ºåˆ¶åˆ‡æ¢" class="headerlink" title="å¼ºåˆ¶åˆ‡æ¢"></a>å¼ºåˆ¶åˆ‡æ¢</h4><p>å¦‚æœæƒ³å¼ºåˆ¶æ’­æ”¾å™¨æ¨ªå±æˆ–è€…ç«–å±æ’­æ”¾ï¼Œå¯ä»¥è¿™æ ·</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">- (void)videoPlayManageViewExitFullScreenButtonTapped &#123;</div><div class="line">    if([[UIDevice currentDevice] respondsToSelector:@selector(setOrientation:)])&#123;</div><div class="line">        SEL selector = NSSelectorFromString(@&quot;setOrientation:&quot;);</div><div class="line">        NSInvocation *invocation = [NSInvocation invocationWithMethodSignature:[UIDevice instanceMethodSignatureForSelector:selector]];</div><div class="line">        [invocation setSelector:selector];</div><div class="line">        [invocation setTarget:[UIDevice currentDevice]];</div><div class="line">        int val = UIInterfaceOrientationPortrait;</div><div class="line">        [invocation setArgument:&amp;val atIndex:2];</div><div class="line">        [invocation invoke];</div><div class="line">    &#125;</div><div class="line">    [UIViewController attemptRotationToDeviceOrientation];</div><div class="line">&#125;</div><div class="line">- (void)videoPlayManageViewEnterFullScreenButtonTapped &#123;</div><div class="line">    if([[UIDevice currentDevice] respondsToSelector:@selector(setOrientation:)])&#123;</div><div class="line">        SEL selector = NSSelectorFromString(@&quot;setOrientation:&quot;);</div><div class="line">        NSInvocation *invocation = [NSInvocation invocationWithMethodSignature:[UIDevice instanceMethodSignatureForSelector:selector]];</div><div class="line">        [invocation setSelector:selector];</div><div class="line">        [invocation setTarget:[UIDevice currentDevice]];</div><div class="line">        int val = UIInterfaceOrientationLandscapeRight;</div><div class="line">        [invocation setArgument:&amp;val atIndex:2];</div><div class="line">        [invocation invoke];</div><div class="line">    &#125;</div><div class="line">    [UIViewController attemptRotationToDeviceOrientation];</div><div class="line">    [self rotateToLandscapeRight];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="åˆ‡æ¢æ–¹å¼2ï¼ˆåŒè…¾è®¯è§†é¢‘ï¼‰"><a href="#åˆ‡æ¢æ–¹å¼2ï¼ˆåŒè…¾è®¯è§†é¢‘ï¼‰" class="headerlink" title="åˆ‡æ¢æ–¹å¼2ï¼ˆåŒè…¾è®¯è§†é¢‘ï¼‰"></a>åˆ‡æ¢æ–¹å¼2ï¼ˆåŒè…¾è®¯è§†é¢‘ï¼‰</h2><h4 id="controllerä»…æ”¯æŒç«–å±"><a href="#controllerä»…æ”¯æŒç«–å±" class="headerlink" title="controllerä»…æ”¯æŒç«–å±"></a>controllerä»…æ”¯æŒç«–å±</h4><p>æ­¤æ—¶æ§åˆ¶æ•´ä¸ªcontrollerçš„viewä»…æ”¯æŒé»˜è®¤çš„ç«–å±å³å¯</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">- (BOOL)shouldAutorotate &#123;</div><div class="line">    return NO;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="ç›‘æµ‹å±å¹•æ–¹å‘å˜åŒ–-1"><a href="#ç›‘æµ‹å±å¹•æ–¹å‘å˜åŒ–-1" class="headerlink" title="ç›‘æµ‹å±å¹•æ–¹å‘å˜åŒ–"></a>ç›‘æµ‹å±å¹•æ–¹å‘å˜åŒ–</h4><p>ä»ç„¶æ·»åŠ ç›‘æµ‹å±å¹•æ–¹å‘å˜åŒ–çš„é€šçŸ¥</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">- (void)viewWillAppear:(BOOL)animated &#123;</div><div class="line">    [super viewWillAppear:animated];</div><div class="line">    [[NSNotificationCenter defaultCenter] addObserver:self selector:@selector(orientationHasChange:) name:UIDeviceOrientationDidChangeNotification object:nil];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="å±å¹•æ–¹å‘å˜åŒ–æ—¶çš„å¤„ç†-1"><a href="#å±å¹•æ–¹å‘å˜åŒ–æ—¶çš„å¤„ç†-1" class="headerlink" title="å±å¹•æ–¹å‘å˜åŒ–æ—¶çš„å¤„ç†"></a>å±å¹•æ–¹å‘å˜åŒ–æ—¶çš„å¤„ç†</h4><p>é€šçŸ¥çš„å›è°ƒæ–¹æ³•ä¸­å¦‚ä¸‹</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div></pre></td><td class="code"><pre><div class="line">- (void)orientationHasChange:(NSNotification *)notification &#123;</div><div class="line">    UIDevice *device = (UIDevice *)notification.object;</div><div class="line">    if(device.orientation == UIInterfaceOrientationLandscapeLeft)&#123;</div><div class="line">        [self rotateToLandscapeLeft];</div><div class="line">    &#125;</div><div class="line">    else if(device.orientation == UIInterfaceOrientationLandscapeRight)&#123;</div><div class="line">        [self rotateToLandscapeRight];</div><div class="line">    &#125;</div><div class="line">    else if(device.orientation == UIInterfaceOrientationPortrait)&#123;</div><div class="line">        [self rotateToPortrait];</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line">- (void)rotateToFullScreen &#123;</div><div class="line">    if(SCREEN_WIDTH&gt;SCREEN_HEIGHT)&#123;</div><div class="line">        _videoPlayManageView.frame = CGRectMake(0, 0, SCREEN_HEIGHT, SCREEN_WIDTH);</div><div class="line">    &#125;</div><div class="line">    else&#123;</div><div class="line">        _videoPlayManageView.frame = CGRectMake(0, 0, SCREEN_WIDTH, SCREEN_HEIGHT);</div><div class="line">    &#125;</div><div class="line">    [_videoPlayManageView enterInFullScreen];</div><div class="line">&#125;</div><div class="line">- (void)rotateToLandscapeLeft &#123;</div><div class="line">    if(_lastOrientationValue==UIInterfaceOrientationLandscapeLeft)&#123;</div><div class="line">        return;</div><div class="line">    &#125;</div><div class="line">    [UIView animateWithDuration:0.3 animations:^&#123;</div><div class="line">        _videoPlayManageView.transform = CGAffineTransformMakeRotation(-M_PI/2);</div><div class="line">        [self rotateToFullScreen];</div><div class="line">    &#125; completion:^(BOOL finished) &#123;</div><div class="line">    &#125;];</div><div class="line">    [[UIApplication sharedApplication] setStatusBarOrientation:UIInterfaceOrientationLandscapeLeft animated:NO];</div><div class="line">    _lastOrientationValue = UIInterfaceOrientationLandscapeLeft;</div><div class="line">&#125;</div><div class="line">- (void)rotateToLandscapeRight &#123;</div><div class="line">    if(_lastOrientationValue==UIInterfaceOrientationLandscapeRight)&#123;</div><div class="line">        return;</div><div class="line">    &#125;</div><div class="line">    [UIView animateWithDuration:0.3 animations:^&#123;</div><div class="line">        _videoPlayManageView.transform = CGAffineTransformMakeRotation(M_PI/2);</div><div class="line">        [self rotateToFullScreen];</div><div class="line">    &#125; completion:^(BOOL finished) &#123;</div><div class="line">    &#125;];</div><div class="line">    [[UIApplication sharedApplication] setStatusBarOrientation:UIInterfaceOrientationLandscapeRight animated:NO];</div><div class="line">    _lastOrientationValue = UIInterfaceOrientationLandscapeRight;</div><div class="line">&#125;</div><div class="line">- (void)rotateToPortrait &#123;</div><div class="line">    if(_lastOrientationValue==UIInterfaceOrientationPortrait)&#123;</div><div class="line">        return;</div><div class="line">    &#125;</div><div class="line">    [[UIApplication sharedApplication] setStatusBarHidden:NO];</div><div class="line">    [UIView animateWithDuration:0.3 animations:^&#123;</div><div class="line">        _videoPlayManageView.transform = CGAffineTransformIdentity;</div><div class="line">        _videoPlayManageView.frame = _normalScreenFrame;</div><div class="line">        [_videoPlayManageView exitFromFullScreen];</div><div class="line">    &#125; completion:^(BOOL finished) &#123;</div><div class="line">    &#125;];</div><div class="line">    [[UIApplication sharedApplication] setStatusBarOrientation:UIInterfaceOrientationPortrait animated:NO];</div><div class="line">    _lastOrientationValue = UIInterfaceOrientationPortrait;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="å¼ºåˆ¶åˆ‡æ¢-1"><a href="#å¼ºåˆ¶åˆ‡æ¢-1" class="headerlink" title="å¼ºåˆ¶åˆ‡æ¢"></a>å¼ºåˆ¶åˆ‡æ¢</h4><p>å¦‚æœæƒ³å¼ºåˆ¶æ’­æ”¾å™¨æ¨ªå±æˆ–è€…ç«–å±æ’­æ”¾ï¼Œå¯ä»¥è¿™æ ·</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">- (void)videoPlayManageViewExitFullScreenButtonTapped &#123;</div><div class="line">    [self rotateToPortrait];</div><div class="line">&#125;</div><div class="line">- (void)videoPlayManageViewEnterFullScreenButtonTapped &#123; </div><div class="line">    [self rotateToLandscapeRight];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å®Œæ•´ç‰ˆDemoè¯·çŒ›æˆ³<a href="https://github.com/kaisayoung/VideoPlayDemo.git" target="_blank" rel="external">è¿™é‡Œ</a>ã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ä¹‹å‰å¾ˆé•¿ä¸€æ®µæ—¶é—´éƒ½åœ¨åšè§†é¢‘ç›¸å…³çš„é¡¹ç›®ï¼Œå…¶ä¸­ä¸€ä¸ªæœ€åŸºç¡€æœ€é‡è¦çš„åŠŸèƒ½å°±æ˜¯æ’­æ”¾æ—¶çš„æ¨ªç«–å±åˆ‡æ¢ï¼Œäºæ˜¯ä¹ç ”ç©¶å¯¹æ¯”äº†ä¸‹å¸‚åœºä¸Šä¸»è¦è§†é¢‘ç±»APPçš„æ¨ªç«–å±åˆ‡æ¢æ–¹å¼ã€‚å‘ç°å…±åˆ†ä¸ºä¸¤ç§ï¼Œä¸€ç§ä»¥ä¼˜é…·è§†é¢‘å’ŒåœŸè±†è§†é¢‘ä¸ºä»£è¡¨ï¼Œå½“æ¨ªæ”¾æ‰‹æœºæ—¶æ•´ä¸ªç•Œé¢éƒ½æ—‹è½¬ï¼›å¦ä¸€ç§ä»¥è…¾è®¯è§†é¢‘ï¼Œæœç‹è§†é¢‘ä¸ºä»£è¡¨ï¼Œå½“æ¨ªæ”¾æ‰‹æœºæ—¶åªæ˜¯æ’­æ”¾çš„å°è§†å›¾æ—‹è½¬ï¼Œå…¶ä½™å†…å®¹ä¸å˜ã€‚å®ç°æ–¹æ³•åˆ†åˆ«å¦‚ä¸‹ã€‚&lt;br&gt;
    
    </summary>
    
      <category term="iOS" scheme="http://yoursite.com/categories/iOS/"/>
    
    
      <category term="è§†é¢‘" scheme="http://yoursite.com/tags/%E8%A7%86%E9%A2%91/"/>
    
  </entry>
  
  <entry>
    <title>ä¸€è¡Œå‘½ä»¤æ‰“åŒ…å¹¶ç”ŸæˆäºŒç»´ç </title>
    <link href="http://yoursite.com/2016/08/25/%E4%B8%80%E8%A1%8C%E5%91%BD%E4%BB%A4%E6%89%93%E5%8C%85%E5%B9%B6%E7%94%9F%E6%88%90%E4%BA%8C%E7%BB%B4%E7%A0%81/"/>
    <id>http://yoursite.com/2016/08/25/ä¸€è¡Œå‘½ä»¤æ‰“åŒ…å¹¶ç”ŸæˆäºŒç»´ç /</id>
    <published>2016-08-25T07:03:51.000Z</published>
    <updated>2016-09-01T03:47:46.000Z</updated>
    
    <content type="html"><![CDATA[<p>è¿™å‡ å¤©å…¬å¸é¡¹ç›®æ²¡ä»€ä¹ˆæ–°éœ€æ±‚ï¼ŒæŠŠä¹‹å‰åœ¨åˆ«çš„å¹³å°å†™è¿‡çš„éƒ¨åˆ†åšå®¢æ¬è¿‡æ¥ã€‚ğŸ˜Š</p>
<p>ä¹‹å‰æµ‹è¯•APPæ—¶æ€»è¦æ‰‹åŠ¨æ‰“åŒ…ç„¶åå†ä¸Šä¼ è’²å…¬è‹±ç½‘ç«™ç”ŸæˆäºŒç»´ç ï¼Œè™½ç„¶ä¹Ÿæ²¡æœ‰ä»€ä¹ˆå¤§é—®é¢˜ï¼Œä½†æ€»è§‰å¾—æœ‰ç‚¹æµªè´¹æ—¶é—´ï¼Œæ¯•ç«Ÿæ‰“åŒ…æ—¶ä¸èƒ½è¿è¡Œç¨‹åºï¼Œç”ŸæˆäºŒç»´ç æ—¶åˆè¦æ‰“å¼€è’²å…¬è‹±ç½‘ç«™ï¼Œäºæ˜¯æƒ³æœ‰æ²¡æœ‰ä»€ä¹ˆæ–¹æ³•èƒ½ä¸€é”®æå®šå‘¢ï¼Ÿäºæ˜¯æœäº†ä¸€ä¸‹å‘ç°<a href="http://fir.im" target="_blank" rel="external">fir.im</a>éƒ½å·²ç»åšå¥½äº†ï¼Œ<a href="https://github.com/FIRHQ/fir-cli" target="_blank" rel="external">æ•™ç¨‹</a>ç›¸å½“æ¸…æ™°ï¼Œso sweetã€‚<br><a id="more"></a></p>
<h3 id="å®‰è£…fir-cli"><a href="#å®‰è£…fir-cli" class="headerlink" title="å®‰è£…fir-cli"></a>å®‰è£…fir-cli</h3><p>åœ¨æœ¬åœ°ç»ˆç«¯è¾“å…¥ï¼š</p>
<pre><code>$ gem install fir-cli
</code></pre><p>è¿™æ ·å°±å®‰è£…å®Œæˆäº†ã€‚</p>
<p>ç„¶åå»firç½‘ç«™]æ³¨å†Œä¸ªè´¦å·ï¼Œå¹¶è®°å½•ä¸‹å¯¹åº”çš„fir-tokenã€‚ </p>
<h3 id="æœ¬åœ°ç™»å½•"><a href="#æœ¬åœ°ç™»å½•" class="headerlink" title="æœ¬åœ°ç™»å½•"></a>æœ¬åœ°ç™»å½•</h3><p>ç»§ç»­åœ¨ç»ˆç«¯è¾“å…¥ï¼š</p>
<pre><code>$ fir login
</code></pre><p>ä¹‹ååœ¨æç¤ºä¸‹è¾“å…¥åˆšæ‰è®°å½•ä¸‹çš„fir-tokenå³ç™»å½•æˆåŠŸï¼Œè¿™æ ·ä¸ç”¨ä»¥åæ¯æ¬¡ç”ŸæˆäºŒç»´ç æ—¶éƒ½è¦éªŒè¯è´¦å·ã€‚ </p>
<h3 id="æ‰“åŒ…ç”ŸæˆäºŒç»´ç "><a href="#æ‰“åŒ…ç”ŸæˆäºŒç»´ç " class="headerlink" title="æ‰“åŒ…ç”ŸæˆäºŒç»´ç "></a>æ‰“åŒ…ç”ŸæˆäºŒç»´ç </h3><p>cdä½ çš„å·¥ç¨‹çš„æ ¹ç›®å½•ã€‚<br>æ³¨æ„å½“ç¼–è¯‘æ—¶ï¼Œæ˜¯å¦åº”ç”¨äº†CocoaPodsçš„å·¥ç¨‹ç¼–è¯‘å‘½ä»¤æ˜¯ä¸ä¸€æ ·çš„ã€‚</p>
<p>æœªåº”ç”¨æ—¶å¯è¾“å…¥ç±»ä¼¼å¦‚ä¸‹ï¼š</p>
<pre><code>$ fir build_ipa path/to/project -o path/to/output
</code></pre><p>åº”ç”¨äº†æ—¶å¯è¾“å…¥ç±»ä¼¼å¦‚ä¸‹ï¼š</p>
<pre><code>$ fir build_ipa path/to/workspace -o path/to/output -w -C Release -S YourAppName
</code></pre><p>ä¸Šä¼ åˆ°firç½‘ç«™ç”ŸæˆäºŒç»´ç å¯è¾“å…¥ç±»ä¼¼å¦‚ä¸‹ï¼š</p>
<pre><code>$ fir publish path/to/output/YourAppName.ipa
</code></pre><p>æœ€åå¦‚æœä½ æƒ³ä¸€ä¸‹ç›´æ¥ç”ŸæˆäºŒç»´ç å¯è¾“å…¥ç±»ä¼¼å¦‚ä¸‹ï¼š</p>
<pre><code>$ fir build_ipa path/to/workspace -o path/to/output -w -C Release -S YourAppName -p
</code></pre><p>ä¸€åˆ‡æ˜¯å¦‚æ­¤ç®€å•ã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;è¿™å‡ å¤©å…¬å¸é¡¹ç›®æ²¡ä»€ä¹ˆæ–°éœ€æ±‚ï¼ŒæŠŠä¹‹å‰åœ¨åˆ«çš„å¹³å°å†™è¿‡çš„éƒ¨åˆ†åšå®¢æ¬è¿‡æ¥ã€‚ğŸ˜Š&lt;/p&gt;
&lt;p&gt;ä¹‹å‰æµ‹è¯•APPæ—¶æ€»è¦æ‰‹åŠ¨æ‰“åŒ…ç„¶åå†ä¸Šä¼ è’²å…¬è‹±ç½‘ç«™ç”ŸæˆäºŒç»´ç ï¼Œè™½ç„¶ä¹Ÿæ²¡æœ‰ä»€ä¹ˆå¤§é—®é¢˜ï¼Œä½†æ€»è§‰å¾—æœ‰ç‚¹æµªè´¹æ—¶é—´ï¼Œæ¯•ç«Ÿæ‰“åŒ…æ—¶ä¸èƒ½è¿è¡Œç¨‹åºï¼Œç”ŸæˆäºŒç»´ç æ—¶åˆè¦æ‰“å¼€è’²å…¬è‹±ç½‘ç«™ï¼Œäºæ˜¯æƒ³æœ‰æ²¡æœ‰ä»€ä¹ˆæ–¹æ³•èƒ½ä¸€é”®æå®šå‘¢ï¼Ÿäºæ˜¯æœäº†ä¸€ä¸‹å‘ç°&lt;a href=&quot;http://fir.im&quot;&gt;fir.im&lt;/a&gt;éƒ½å·²ç»åšå¥½äº†ï¼Œ&lt;a href=&quot;https://github.com/FIRHQ/fir-cli&quot;&gt;æ•™ç¨‹&lt;/a&gt;ç›¸å½“æ¸…æ™°ï¼Œso sweetã€‚&lt;br&gt;
    
    </summary>
    
      <category term="å®‰è£…é…ç½®" scheme="http://yoursite.com/categories/%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE/"/>
    
    
      <category term="æ‰“åŒ…" scheme="http://yoursite.com/tags/%E6%89%93%E5%8C%85/"/>
    
  </entry>
  
  <entry>
    <title>åº”ç”¨CocoaPodsåˆ›å»ºç§æœ‰ä»“åº“</title>
    <link href="http://yoursite.com/2016/08/24/%E5%BA%94%E7%94%A8CocoaPods%E5%88%9B%E5%BB%BA%E7%A7%81%E6%9C%89%E4%BB%93%E5%BA%93/"/>
    <id>http://yoursite.com/2016/08/24/åº”ç”¨CocoaPodsåˆ›å»ºç§æœ‰ä»“åº“/</id>
    <published>2016-08-24T08:27:12.000Z</published>
    <updated>2016-09-04T17:45:01.000Z</updated>
    
    <content type="html"><![CDATA[<p>è¿™ç®—æ˜¯æ­£å¼çš„ç¬¬ä¸€ç¯‡ï¼Œè¨€å½’æ­£ä¼ ï¼Œè®°å½•ä¸€ä¸‹å¦‚ä½•æŠŠä¹‹å‰å†™çš„ä¸€ä¸ªå·¥ç¨‹é€šè¿‡podæ–¹å¼æ·»åŠ ä¾›åˆ«äººä½¿ç”¨ã€‚<br><a id="more"></a></p>
<h5 id="åˆ›å»ºä»£ç ä»“åº“ï¼š"><a href="#åˆ›å»ºä»£ç ä»“åº“ï¼š" class="headerlink" title="åˆ›å»ºä»£ç ä»“åº“ï¼š"></a>åˆ›å»ºä»£ç ä»“åº“ï¼š</h5><p>é»˜è®¤ä½ å·²ç»å†™å¥½äº†ä¸€ä¸ªå·¥ç¨‹ï¼Œæ¨é€åˆ°gitæœåŠ¡å™¨ä¸Šï¼Œgithubæˆ–è€…gitlabéƒ½å¯ä»¥ã€‚</p>
<p>ç»™ç¨³å®šç‰ˆæœ¬æ‰“ä¸Štagï¼Œä¸€èˆ¬éƒ½æ˜¯ç‰ˆæœ¬å·ï¼Œå¹¶æ¨é€åˆ°è¿œç«¯ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ git tag -m &apos;first tag&apos; &apos;0.1.0&apos;</div><div class="line">$ git push --tags</div></pre></td></tr></table></figure>
<h5 id="åˆ›å»ºpodspecæ–‡ä»¶ï¼š"><a href="#åˆ›å»ºpodspecæ–‡ä»¶ï¼š" class="headerlink" title="åˆ›å»ºpodspecæ–‡ä»¶ï¼š"></a>åˆ›å»ºpodspecæ–‡ä»¶ï¼š</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ pod spec create å·¥ç¨‹å.podspec</div></pre></td></tr></table></figure>
<p>è¿™æ ·ä¼šåœ¨å½“å‰ç›®å½•åˆ›å»ºä¸€ä¸ª.podspecæ–‡ä»¶ï¼Œè¿™æ˜¯ä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œé‡Œé¢è®°å½•äº†å·¥ç¨‹çš„åå­—ï¼Œç‰ˆæœ¬å·ï¼Œè¿œç«¯ä»“åº“çš„é“¾æ¥åœ°å€ï¼Œå¯¹å¤–æš´éœ²çš„æ–‡ä»¶ç­‰ï¼Œæ€»ä¹‹æ‹¿åˆ°äº†.podspecæ–‡ä»¶å°±å¯ä»¥ä½¿ç”¨å¯¹åº”å·¥ç¨‹äº†ã€‚æ¯ä¸€ä¸ªå·¥ç¨‹å¯¹åº”æœ‰ä¸€ä¸ªï¼Œä¸åŒç‰ˆæœ¬ä¹‹é—´ä¹Ÿæ˜¯ä¸ä¸€æ ·çš„ã€‚é»˜è®¤å·²ç»å¡«å†™äº†å¥½å¤šï¼Œæ ¹æ®å®é™…æƒ…å†µå°†å…¶ä¿®æ”¹æ­£ç¡®ï¼Œæˆ–è€…å¯ä»¥ä»ç½‘ä¸Šæ‰¾ä¸ªè‘—åçš„å¼€æºåº“å‚è€ƒå®ƒæ˜¯æ€ä¹ˆå†™çš„ã€‚</p>
<p>åƒæˆ‘è¿™ä¸ªå·¥ç¨‹çš„é…ç½®æ–‡ä»¶æ˜¯è¿™æ ·çš„</p>
<p><img src="http://ocepn6hgq.bkt.clouddn.com/E4299691-FB2D-4814-BA46-52D16F373475.png" alt="æ­¤å¤„è¾“å…¥å›¾ç‰‡çš„æè¿°"></p>
<p>éªŒè¯podspecæ–‡ä»¶æœ‰æ•ˆæ€§ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ pod lib lint</div></pre></td></tr></table></figure>
<p>çœ‹åˆ°ç±»ä¼¼ <em>*</em> passed validation.ç®—æ˜¯éªŒè¯é€šè¿‡ï¼Œå¦åˆ™æ ¹æ®æç¤ºå»ä¿®æ”¹ã€‚</p>
<p>è¿˜è¦æ·»åŠ LICENSEæ–‡ä»¶</p>
<h5 id="æœ¬åœ°æµ‹è¯•ï¼š"><a href="#æœ¬åœ°æµ‹è¯•ï¼š" class="headerlink" title="æœ¬åœ°æµ‹è¯•ï¼š"></a>æœ¬åœ°æµ‹è¯•ï¼š</h5><p>éšä¾¿æ‰¾ä¸ªå·¥ç¨‹ï¼Œpodfileæ–‡ä»¶ä¸­æ·»åŠ ç±»ä¼¼å¦‚ä¸‹</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ pod &apos;AMTXibHelp&apos;, :podspec =&gt; &apos;~/Users/kaisa/PrivateRepo/AMTXibHelp/AMTXibHelp.podspec&apos;  #æŒ‡å®špodspecæ–‡ä»¶</div></pre></td></tr></table></figure>
<h5 id="æµ‹è¯•é€šè¿‡ååˆ›å»ºspecä»“åº“ï¼š"><a href="#æµ‹è¯•é€šè¿‡ååˆ›å»ºspecä»“åº“ï¼š" class="headerlink" title="æµ‹è¯•é€šè¿‡ååˆ›å»ºspecä»“åº“ï¼š"></a>æµ‹è¯•é€šè¿‡ååˆ›å»ºspecä»“åº“ï¼š</h5><p>æ³¨æ„ï¼Œè¿™é‡Œæ˜¯ç¬¬äºŒä¸ªä»“åº“ï¼Œåˆšæ‰ç¬¬ä¸€ä¸ªæ˜¯ç”¨æ¥å­˜æ”¾å·¥ç¨‹ä»£ç ï¼Œè¿™ä¸ªæ˜¯ç”¨æ¥å­˜æ”¾é…ç½®æ–‡ä»¶ã€‚</p>
<p>è‹¥è¿œç«¯å·²ç»æœ‰äº†ç§æœ‰ä»“åº“ï¼Œç›´æ¥cloneåˆ°æœ¬åœ°ï¼Œæ¯”å¦‚æ·˜ä¸–ç•Œçš„ç§æœ‰ä»“åº“åœ°å€æ˜¯http:gitlab.XXX/AMTPodSpecs.gitï¼Œ ä¼šåœ¨æœ¬åœ°å¾—åˆ°ä¸€ä¸ªå«åšAMTPodSpecsçš„æ–‡ä»¶å¤¹ï¼Œç„¶ååˆ›å»ºè‡ªå·±çš„å­ä»“åº“ï¼Œç±»ä¼¼ä¸‹å›¾</p>
<p><img src="http://ocepn6hgq.bkt.clouddn.com/569E1EC9-856A-4DA2-97E7-31C778D26FBE.png" alt="æ­¤å¤„è¾“å…¥å›¾ç‰‡çš„æè¿°"></p>
<p>ç„¶åæŠŠä¿®æ”¹æ¨é€åˆ°è¿œç«¯å³å¯ã€‚ </p>
<h5 id="å®é™…ä½¿ç”¨ï¼š"><a href="#å®é™…ä½¿ç”¨ï¼š" class="headerlink" title="å®é™…ä½¿ç”¨ï¼š"></a>å®é™…ä½¿ç”¨ï¼š</h5><p>å› ä¸ºåŒæ—¶ä½¿ç”¨äº†ç§æœ‰åº“å’Œï¼ˆé»˜è®¤çš„ï¼‰å…±æœ‰åº“ï¼Œæ‰€ä»¥è¦å†™æ¸…æ¥šsource</p>
<pre><code># private
source &apos;http://gitlab.XXX/AMTPodSpecs.git&apos;
# public
source &apos;https://github.com/CocoaPods/Specs.git&apos;

target &apos;ReactiveCocoaDemo&apos; do
pod &quot;AMTXibHelp&quot;, &quot;0.1.0&quot;
end
</code></pre><p>å¤§åŠŸå‘Šæˆã€‚    </p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;è¿™ç®—æ˜¯æ­£å¼çš„ç¬¬ä¸€ç¯‡ï¼Œè¨€å½’æ­£ä¼ ï¼Œè®°å½•ä¸€ä¸‹å¦‚ä½•æŠŠä¹‹å‰å†™çš„ä¸€ä¸ªå·¥ç¨‹é€šè¿‡podæ–¹å¼æ·»åŠ ä¾›åˆ«äººä½¿ç”¨ã€‚&lt;br&gt;
    
    </summary>
    
      <category term="å®‰è£…é…ç½®" scheme="http://yoursite.com/categories/%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE/"/>
    
    
      <category term="ç§æœ‰åº“" scheme="http://yoursite.com/tags/%E7%A7%81%E6%9C%89%E5%BA%93/"/>
    
  </entry>
  
  <entry>
    <title>First Blood</title>
    <link href="http://yoursite.com/2016/08/21/first%20blood/"/>
    <id>http://yoursite.com/2016/08/21/first blood/</id>
    <published>2016-08-21T05:13:12.000Z</published>
    <updated>2017-03-21T17:36:38.000Z</updated>
    
    <content type="html"><![CDATA[<p>æœºç¼˜å·§åˆï¼Œå‰å‡ å¤©å­¦ä¹ äº†åº”ç”¨CocoaPodså»ºç«‹ç§æœ‰ä»“åº“å¹¶å‘<a href="https://yozoe.github.io/" target="_blank" rel="external">ç‹å¤§èƒ–å­</a>å¹å˜˜ä¹‹ï¼Œç„¶åä»–é—®ä»–æ€ä¹ˆæ ·æ‰èƒ½çœ‹åˆ°å‘¢ï¼Œäºæ˜¯æ­¤åšå®¢åº”è¿è€Œç”Ÿã€‚åº”ç”¨<a href="https://hexo.io/" target="_blank" rel="external">Hexo</a>æ­å»ºåšå®¢ä¹‹åï¼Œé€‰æ‹©äº†è§†è§‰æœ€ä¸ºç®€å•çš„<a href="https://github.com/iissnan/hexo-theme-next/" target="_blank" rel="external">Next</a>ä¸»é¢˜ï¼Œä¸–ç•Œç¬é—´å¹²å‡€äº†è®¸å¤šã€‚<br>é¦–å…ˆè®°å½•ä¸€ä¸‹æ­å»ºçš„è¿‡ç¨‹å§ï¼Œè™½ç„¶Hexoå·²ç»æœ‰äº†è¯¦ç»†çš„æ–‡æ¡£ã€‚</p>
<h2 id=""><a href="#" class="headerlink" title=""></a><a id="more"></a></h2><h2 id="èƒŒæ™¯ç¯å¢ƒ"><a href="#èƒŒæ™¯ç¯å¢ƒ" class="headerlink" title="èƒŒæ™¯ç¯å¢ƒ"></a>èƒŒæ™¯ç¯å¢ƒ</h2><p><a href="https://nodejs.org/en/" target="_blank" rel="external">Node.js</a></p>
<p>Git</p>
<p>Githubè´¦æˆ·</p>
<h2 id="å®‰è£…Hexo"><a href="#å®‰è£…Hexo" class="headerlink" title="å®‰è£…Hexo"></a>å®‰è£…Hexo</h2><p>cdä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œä½œä¸ºåšå®¢æ ¹ç›®å½•</p>
<p>å®‰è£…ï¼š</p>
<p>sudo npm install -g hexo</p>
<p>åˆå§‹åŒ–ï¼š</p>
<p>hexo init</p>
<p>ç”Ÿæˆé™æ€é¡µé¢ï¼š</p>
<p>hexo generate</p>
<p>å¯åŠ¨æœ¬åœ°æœåŠ¡ï¼š</p>
<p>hexo server</p>
<p>ç„¶åæµè§ˆå™¨è¾“å…¥<a href="http://localhost:4000" target="_blank" rel="external">http://localhost:4000</a>å°±å¯ä»¥æœ¬åœ°è°ƒè¯•äº†!</p>
<h2 id="é…ç½®Github"><a href="#é…ç½®Github" class="headerlink" title="é…ç½®Github"></a>é…ç½®Github</h2><p>é»˜è®¤å·²ç»æœ‰äº†è´¦æˆ·ï¼Œå»ºç«‹ä¸€ä¸ªä»“åº“ï¼Œåç§°å¿…é¡»ä¸ºã€your_user_name.github.ioã€‘</p>
<p>è¿›å…¥åšå®¢æ ¹ç›®å½•æ‰¾åˆ°_config.ymlæ–‡ä»¶ï¼Œç¿»åˆ°æœ€ä¸‹é¢ï¼Œæ”¹æˆç±»ä¼¼è¿™æ ·ï¼š</p>
<pre><code>deploy:
 type: git
 repository: https://github.com/kaisayoung/kaisayoung.github.io
 branch: master
</code></pre><p>å…³è”ï¼š</p>
<p>npm install hexo-deployer-git â€“save</p>
<p>éƒ¨ç½²ï¼š</p>
<p>hexo deploy</p>
<p>æ­¤æ—¶å°±å¯ä»¥æ‰“å¼€ä½ çš„åšå®¢äº†ï¼</p>
<p><a href="https://kaisayoung.github.io/" target="_blank" rel="external">https://kaisayoung.github.io/</a></p>
<p>å…¶ä»–ä¸€äº›è¯¸å¦‚æ¢å¤´åƒï¼Œæ”¹åå­—ï¼Œé€‰è¯­è¨€ï¼Œå¢åŠ è¯„è®ºï¼Œç«™å†…æœç´¢ï¼Œç»Ÿè®¡é˜…è¯»é‡ç­‰åŠŸèƒ½Nextä¸»é¢˜éƒ½æœ‰è¯¦ç»†çš„<a href="http://theme-next.iissnan.com/" target="_blank" rel="external">ä½¿ç”¨è¯´æ˜</a>ï¼Œå¿ä¸ä½æƒ³ç»™ç‚¹ä¸ªèµã€‚</p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æœ€å¸¸ç”¨çš„å‡ ä¸ªå‘½ä»¤</p>
<p>åˆ›å»ºæ–°æ–‡ç« ï¼š</p>
<p>hexo new â€œNew Postâ€</p>
<p>å¯åŠ¨æœ¬åœ°æœåŠ¡ï¼š</p>
<p>hexo server</p>
<p>æ­¤æ—¶å¯ä»¥æœ¬åœ°å…ˆä½“éªŒæµ‹è¯•ä¸€ä¸‹</p>
<p>ç”Ÿæˆé™æ€é¡µé¢ï¼š</p>
<p>hexo generate</p>
<p>éƒ¨ç½²åˆ°è¿œç«¯ï¼š</p>
<p>hexo deploy</p>
<p>ç”Ÿæˆé™æ€é¡µé¢å‰è¿˜å¯ä»¥æ¸…é™¤ä¸€ä¸‹ç¼“å­˜ï¼š</p>
<p>hexo clean</p>
<p>è¿™æ ·å°±ç®—æ˜¯æ­£å¼ç”Ÿæ•ˆäº†</p>
<hr>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æœºç¼˜å·§åˆï¼Œå‰å‡ å¤©å­¦ä¹ äº†åº”ç”¨CocoaPodså»ºç«‹ç§æœ‰ä»“åº“å¹¶å‘&lt;a href=&quot;https://yozoe.github.io/&quot;&gt;ç‹å¤§èƒ–å­&lt;/a&gt;å¹å˜˜ä¹‹ï¼Œç„¶åä»–é—®ä»–æ€ä¹ˆæ ·æ‰èƒ½çœ‹åˆ°å‘¢ï¼Œäºæ˜¯æ­¤åšå®¢åº”è¿è€Œç”Ÿã€‚åº”ç”¨&lt;a href=&quot;https://hexo.io/&quot;&gt;Hexo&lt;/a&gt;æ­å»ºåšå®¢ä¹‹åï¼Œé€‰æ‹©äº†è§†è§‰æœ€ä¸ºç®€å•çš„&lt;a href=&quot;https://github.com/iissnan/hexo-theme-next/&quot;&gt;Next&lt;/a&gt;ä¸»é¢˜ï¼Œä¸–ç•Œç¬é—´å¹²å‡€äº†è®¸å¤šã€‚&lt;br&gt;é¦–å…ˆè®°å½•ä¸€ä¸‹æ­å»ºçš„è¿‡ç¨‹å§ï¼Œè™½ç„¶Hexoå·²ç»æœ‰äº†è¯¦ç»†çš„æ–‡æ¡£ã€‚&lt;/p&gt;
&lt;h2 id=&quot;&quot;&gt;&lt;a href=&quot;#&quot; class=&quot;headerlink&quot; title=&quot;&quot;&gt;&lt;/a&gt;
    
    </summary>
    
      <category term="å®‰è£…é…ç½®" scheme="http://yoursite.com/categories/%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE/"/>
    
    
      <category term="åšå®¢" scheme="http://yoursite.com/tags/%E5%8D%9A%E5%AE%A2/"/>
    
  </entry>
  
</feed>
