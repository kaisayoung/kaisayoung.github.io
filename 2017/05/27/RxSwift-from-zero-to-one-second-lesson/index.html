<!doctype html>



  


<html class="theme-next pisces use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="RxSwift," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1" />






<meta name="description" content="ä¸Šä¸€ç¯‡ä¸»è¦æ˜¯ä¸€äº›åŸºç¡€æ¦‚å¿µï¼Œè¿™ç¯‡æ¥æ¶‰åŠäº›ç¨å¾®æ·±å¥¥éš¾æ‡‚çš„ã€‚
ä»ç„¶å…ˆæ¥ä¸€å¼ å›¾é•‡å¸–ã€‚">
<meta property="og:type" content="article">
<meta property="og:title" content="RxSwiftè¿›é˜¶ï¼Œç»†èŠ‚ä¸UIç»‘å®š">
<meta property="og:url" content="http://yoursite.com/2017/05/27/RxSwift-from-zero-to-one-second-lesson/index.html">
<meta property="og:site_name" content="ä¸€ç›´åœ¨è·¯ä¸Š">
<meta property="og:description" content="ä¸Šä¸€ç¯‡ä¸»è¦æ˜¯ä¸€äº›åŸºç¡€æ¦‚å¿µï¼Œè¿™ç¯‡æ¥æ¶‰åŠäº›ç¨å¾®æ·±å¥¥éš¾æ‡‚çš„ã€‚
ä»ç„¶å…ˆæ¥ä¸€å¼ å›¾é•‡å¸–ã€‚">
<meta property="og:image" content="http://ocepn6hgq.bkt.clouddn.com/RxSwift-from-zero-to-one-second-lesson.png">
<meta property="og:image" content="http://ocepn6hgq.bkt.clouddn.com/RxSwift-from-zero-to-one-second-lesson.png">
<meta property="og:updated_time" content="2017-06-04T10:41:01.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="RxSwiftè¿›é˜¶ï¼Œç»†èŠ‚ä¸UIç»‘å®š">
<meta name="twitter:description" content="ä¸Šä¸€ç¯‡ä¸»è¦æ˜¯ä¸€äº›åŸºç¡€æ¦‚å¿µï¼Œè¿™ç¯‡æ¥æ¶‰åŠäº›ç¨å¾®æ·±å¥¥éš¾æ‡‚çš„ã€‚
ä»ç„¶å…ˆæ¥ä¸€å¼ å›¾é•‡å¸–ã€‚">
<meta name="twitter:image" content="http://ocepn6hgq.bkt.clouddn.com/RxSwift-from-zero-to-one-second-lesson.png">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 6321865863578256000,
      author: 'ä¸»ç¼–å¤§äºº'
    }
  };
</script>




  <link rel="canonical" href="http://yoursite.com/2017/05/27/RxSwift-from-zero-to-one-second-lesson/"/>

  <title> RxSwiftè¿›é˜¶ï¼Œç»†èŠ‚ä¸UIç»‘å®š | ä¸€ç›´åœ¨è·¯ä¸Š </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  



  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?d9a1587ce4c6042894f106ae7486a3ce";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>








  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">ä¸€ç›´åœ¨è·¯ä¸Š</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle"></p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            é¦–é¡µ
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            åˆ†ç±»
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            å½’æ¡£
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            æ ‡ç­¾
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                RxSwiftè¿›é˜¶ï¼Œç»†èŠ‚ä¸UIç»‘å®š
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">å‘è¡¨äº</span>
            <time itemprop="dateCreated" datetime="2017-05-27T01:12:48+08:00" content="2017-05-27">
              2017-05-27
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/FRP/" itemprop="url" rel="index">
                    <span itemprop="name">FRP</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2017/05/27/RxSwift-from-zero-to-one-second-lesson/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/05/27/RxSwift-from-zero-to-one-second-lesson/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>ä¸Šä¸€ç¯‡ä¸»è¦æ˜¯ä¸€äº›åŸºç¡€æ¦‚å¿µï¼Œè¿™ç¯‡æ¥æ¶‰åŠäº›ç¨å¾®æ·±å¥¥éš¾æ‡‚çš„ã€‚</p>
<p>ä»ç„¶å…ˆæ¥ä¸€å¼ å›¾é•‡å¸–ã€‚</p>
<p><img src="http://ocepn6hgq.bkt.clouddn.com/RxSwift-from-zero-to-one-second-lesson.png" alt="1"></p>
<a id="more"></a>
<h2 id="å¤šçº¿ç¨‹"><a href="#å¤šçº¿ç¨‹" class="headerlink" title="å¤šçº¿ç¨‹"></a>å¤šçº¿ç¨‹</h2><p><code>Schedulers</code>æ˜¯RxSwiftä¸­å¯¹<code>Thread</code>ï¼Œ<code>GCD</code>ï¼Œ<code>OperationQueue</code>ç­‰iOSå¼€å‘ä¸­çº¿ç¨‹ç›¸å…³è¿›è¡Œçš„æŠ½è±¡å’Œå°è£…ã€‚å¯ä»¥è®¤ä¸ºä¸€ä¸ª<code>Scheduler</code>ä»£è¡¨ä¸€ä¸ªçº¿ç¨‹ã€‚</p>
<p>æ¶‰åŠçš„ç±»ä¸»è¦æœ‰ï¼š</p>
<ul>
<li><code>MainScheduler</code> </li>
<li><code>CurrentThreadScheduler</code></li>
<li><code>SerialDispatchQueueScheduler</code></li>
<li><code>ConcurrentDispatchQueueScheduler</code> </li>
<li><code>OperationQueueScheduler</code></li>
</ul>
<p>ä»€ä¹ˆæ„æ€å…¶å®ä»å‘½åä¸Šå°±å¯ä»¥çœ‹å‡ºæ¥ï¼Œä¸å¤šè§£é‡Šäº†ã€‚</p>
<p>æ¶‰åŠçš„æ“ä½œç¬¦æœ‰ä¸¤ä¸ªï¼š</p>
<ul>
<li><a href="http://reactivex.io/documentation/operators/observeon.html" target="_blank" rel="external">observeOn()</a></li>
<li><a href="http://reactivex.io/documentation/operators/subscribeon.html" target="_blank" rel="external">subscribeOn()</a></li>
</ul>
<p>å¹¶ä¸æ˜¯å¾ˆå¥½è§£é‡Šï¼Œè¿˜æ˜¯ç›´æ¥çœ‹ä»£ç å§ã€‚</p>
<p>é¦–å…ˆå®šä¹‰ä¸€ä¸ªè¾…åŠ©å‡½æ•°ï¼š</p>
<pre><code>func myJust(_ element: String) -&gt; Observable&lt;String&gt; {
    print(&quot;Creating an Observable in thread : \(Thread.current)&quot;)
    return Observable.create { observer in
        print(&quot;Emitting one Event in thread : \(Thread.current)&quot;)
        observer.on(.next(element))
        observer.on(.completed)
        return Disposables.create()
    }
}
</code></pre><p>ä½œç”¨å’ŒRxSwiftè‡ªå¸¦çš„<code>Just</code>æ“ä½œç¬¦ä¸€æ ·ï¼Œåªæ˜¯é¢å¤–å¤šäº†ä¸¤è¡Œæ‰“å°ä»£ç ã€‚</p>
<p>ğŸŒ°1:</p>
<pre><code>print(&quot;Subscribing an Observable in thread : \(Thread.current)&quot;)
myJust(&quot;ğŸ&quot;)
    .do(onNext: { print(&quot;Intercepted \($0) in thread : \(Thread.current)&quot;) }
        , onError: nil, onCompleted: nil
    )
    .filter({
        print(&quot;Filtering \($0) in thread : \(Thread.current)&quot;)
        return $0 != &quot;ğŸ&quot;
    })
    .subscribe(onNext: {
        print(&quot;Receiving \($0) in thread : \(Thread.current)&quot;)
    })
    .disposed(by: disposeBag)
</code></pre><p>ç»“æœ1:</p>
<pre><code>Subscribing an Observable in thread : &lt;NSThread: 0x608000078f40&gt;{number = 1, name = main}
Creating an Observable in thread : &lt;NSThread: 0x608000078f40&gt;{number = 1, name = main}
Emitting one Event in thread : &lt;NSThread: 0x608000078f40&gt;{number = 1, name = main}
Intercepted ğŸ in thread : &lt;NSThread: 0x608000078f40&gt;{number = 1, name = main}
Filtering ğŸ in thread : &lt;NSThread: 0x608000078f40&gt;{number = 1, name = main}
Receiving ğŸ in thread : &lt;NSThread: 0x608000078f40&gt;{number = 1, name = main}
</code></pre><p>è§‚å¯Ÿç»“æœå¯ä»¥å‘ç°ï¼š</p>
<ol>
<li>ä»£ç æ‰§è¡Œé¡ºåºä¸ºï¼šè®¢é˜…-åˆ›å»º-å‘é€-æ‹¦æˆª-è¿‡æ»¤-æ¥æ”¶ï¼Œæ‰€æœ‰ä»£ç çš„æ‰§è¡Œéƒ½å‘ç”Ÿåœ¨åŒä¸€ä¸ªçº¿ç¨‹ä¸­ ï¼›</li>
</ol>
<p>è§£é‡Šä¸€ä¸‹ä¸Šé¢ä»£ç ï¼š</p>
<ol>
<li>è®¢é˜…ä½œä¸ºåˆå§‹æ­¥éª¤ï¼Œæ‰€åœ¨çš„ä¸Šä¸‹æ–‡ç¯å¢ƒæ˜¯ä¸»çº¿ç¨‹ï¼Œå¯¼è‡´æ¥ä¸‹æ¥çš„æ‰€æœ‰æ­¥éª¤éƒ½æ˜¯å‘ç”Ÿåœ¨ä¸»çº¿ç¨‹ï¼šä¹Ÿå°±æ˜¯è¯´é»˜è®¤æƒ…å†µä¸‹åœ¨å“ªä¸ªçº¿ç¨‹è®¢é˜…ä¸€ä¸ª<code>Observable</code>ï¼Œä¹‹åæ‰€æœ‰ä»£ç éƒ½ä¼šåœ¨åŒä¸€ä¸ªçº¿ç¨‹ä¸­æ‰§è¡Œã€‚</li>
</ol>
<p>ğŸŒ°2:</p>
<pre><code>let serialScheduler1 = SerialDispatchQueueScheduler(internalSerialQueueName: &quot;com.kaisa.gcdqueue1&quot;)  
let serialScheduler2 = SerialDispatchQueueScheduler(internalSerialQueueName: &quot;com.kaisa.gcdqueue2&quot;)  // 1

print(&quot;Subscribing an Observable in thread : \(Thread.current)&quot;)
myJust(&quot;ğŸ&quot;)
    .do(onNext: { print(&quot;Intercepted \($0) in thread : \(Thread.current)&quot;) }
        , onError: nil, onCompleted: nil
    )
    .observeOn(serialScheduler1)  // 2
    .filter({
        print(&quot;Filtering \($0) in thread : \(Thread.current)&quot;)
        return $0 != &quot;ğŸ&quot;
    })
    .observeOn(serialScheduler2)  // 2
    .map({ fruit in
        print(&quot;Mapping \(fruit) in thread : \(Thread.current)&quot;)
        return &quot;ğŸŠ&quot;
    })
    .observeOn(MainScheduler.instance)  // 3
    .subscribe(onNext: { (fruit: String) in
        print(&quot;Receiving \(fruit) in thread : \(Thread.current)&quot;)
    })
    .disposed(by: disposeBag)    
</code></pre><p>ç»“æœ2:</p>
<pre><code>Subscribing an Observable in thread : &lt;NSThread: 0x60000007e440&gt;{number = 1, name = main}
Creating an Observable in thread : &lt;NSThread: 0x60000007e440&gt;{number = 1, name = main}
Emitting one Event in thread : &lt;NSThread: 0x60000007e440&gt;{number = 1, name = main}
Intercepted ğŸ in thread : &lt;NSThread: 0x60000007e440&gt;{number = 1, name = main}
Filtering ğŸ in thread : &lt;NSThread: 0x600000470c40&gt;{number = 3, name = (null)}
Mapping ğŸ in thread : &lt;NSThread: 0x608000671200&gt;{number = 4, name = (null)}
Receiving ğŸŠ in thread : &lt;NSThread: 0x60000007ee40&gt;{number = 1, name = main}
</code></pre><p>è§‚å¯Ÿç»“æœå¯ä»¥å‘ç°ï¼š</p>
<ol>
<li>ä»£ç æ‰§è¡Œé¡ºåºå¹¶æ²¡æœ‰æ”¹å˜ï¼Œä½†æ˜¯å´å‘ç”Ÿåœ¨ä¸‰ä¸ªä¸åŒçš„çº¿ç¨‹ä¸­ ï¼›</li>
</ol>
<p>è§£é‡Šä¸€ä¸‹ä¸Šé¢ä»£ç ï¼š</p>
<ol>
<li>åˆ›å»ºä¸¤ä¸ªå’Œçº¿ç¨‹å¯¹åº”çš„<code>Scheduler</code>å¯¹è±¡ï¼ˆæ­¤ä¾‹å­ä¸­åº”ç”¨çš„æ˜¯GCDçš„ä¸²è¡Œé˜Ÿåˆ—ï¼‰ï¼›</li>
<li>å¯¹<code>observeOn()</code>æ“ä½œç¬¦ä¼ å…¥<code>Scheduler</code>å¯¹è±¡å¯ä»¥æ”¹å˜äº‹ä»¶æ¥å—æ—¶ä»£ç æ‰§è¡Œæ‰€åœ¨çš„çº¿ç¨‹ï¼šä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªæ“ä½œç¬¦ä¼šæ”¹å˜<code>Observable</code>å¯¹å¤–å‘é€äº‹ä»¶æ—¶ä½¿ç”¨çš„çº¿ç¨‹ï¼Œå¯¼è‡´ä¹‹åæ¥æ”¶åˆ°è¿™ä¸ªäº‹ä»¶æ—¶ä¹Ÿä¼šåœ¨ç›¸åŒçº¿ç¨‹ä¸­ ï¼›</li>
<li>é€šå¸¸éƒ½æ˜¯åœ¨ä¸»çº¿ç¨‹ä¸­è®¢é˜…ä¸€ä¸ª<code>Observable</code>ï¼Œç„¶åå›è°ƒä¹Ÿå’ŒUIç›¸å…³ï¼Œæ‰€ä»¥å¦‚æœä¸­é€”åç¦»äº†ä¸»çº¿ç¨‹æœ€åéƒ½è¦è½¬å›æ¥ ï¼›</li>
<li>åœ¨ä¸€æ®µä»£ç ä¸²ä¸­å¯ä»¥åŒæ—¶ä½¿ç”¨å¤šæ¬¡<code>observeOn()</code>æ“ä½œç¬¦ã€‚</li>
</ol>
<p>ğŸŒ°3:</p>
<pre><code>let serialScheduler = SerialDispatchQueueScheduler(internalSerialQueueName: &quot;com.kaisa.gcdqueue&quot;)  // 1

print(&quot;Subscribing an Observable in thread : \(Thread.current)&quot;)
myJust(&quot;ğŸ&quot;)
    .do(onNext: { print(&quot;Intercepted \($0) in thread : \(Thread.current)&quot;) }
        , onError: nil, onCompleted: nil
    )
    .map({ fruit in
        print(&quot;Mapping \(fruit) in thread : \(Thread.current)&quot;)
        return &quot;ğŸ‹&quot;
    })
    .subscribeOn(serialScheduler)  // 2
    .observeOn(MainScheduler.instance)  // 3
    .subscribe(onNext: { (fruit: String) in
        print(&quot;Receiving \(fruit) in thread : \(Thread.current)&quot;)
    })
    .disposed(by: disposeBag)
</code></pre><p>ç»“æœ3:</p>
<pre><code>Subscribing an Observable in thread : &lt;NSThread: 0x60000006fec0&gt;{number = 1, name = main}
Creating an Observable in thread : &lt;NSThread: 0x60000006fec0&gt;{number = 1, name = main}
Emitting one Event in thread : &lt;NSThread: 0x60000046e2c0&gt;{number = 3, name = (null)}
Intercepted ğŸ in thread : &lt;NSThread: 0x60000046e2c0&gt;{number = 3, name = (null)}
Mapping ğŸ in thread : &lt;NSThread: 0x60000046e2c0&gt;{number = 3, name = (null)}
Receiving ğŸ‹ in thread : &lt;NSThread: 0x60000006fec0&gt;{number = 1, name = main}
</code></pre><p>è§‚å¯Ÿç»“æœå¯ä»¥å‘ç°ï¼š</p>
<ol>
<li>ä»£ç æ‰§è¡Œé¡ºåºä¾ç„¶æ²¡æœ‰æ”¹å˜ï¼Œä½†æ˜¯å´å‘ç”Ÿåœ¨ä¸¤ä¸ªä¸åŒçš„çº¿ç¨‹ä¸­ ï¼›</li>
</ol>
<p>è§£é‡Šä¸€ä¸‹ä¸Šé¢ä»£ç ï¼š</p>
<ol>
<li>åˆ›å»ºä¸€ä¸ªå’Œçº¿ç¨‹å¯¹åº”çš„<code>Scheduler</code>å¯¹è±¡ ï¼›</li>
<li>å¯¹<code>subscribeOn()</code>æ“ä½œç¬¦ä¼ å…¥<code>Scheduler</code>å¯¹è±¡å¯ä»¥æ”¹å˜åˆ›å»º<code>Observable</code>ä¹‹åæ‰€æœ‰ä»£ç æ‰§è¡Œæ‰€åœ¨çš„çº¿ç¨‹ï¼šä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªæ“ä½œç¬¦ä¼šä»æºå¤´ä¸Šæ”¹å˜ä»£ç æ‰§è¡Œæ‰€åœ¨çš„ç¯å¢ƒï¼Œæ¯”<code>observeOn()</code>èµ·ä½œç”¨çš„æ—¶æœºè¦æ—© ï¼›</li>
<li>åº”ç”¨<code>observeOn()</code>æ“ä½œç¬¦ä¼ å…¥<code>MainScheduler.instance</code>ä½¿å¾—æœ€åçš„å›è°ƒä¾ç„¶å‘ç”Ÿåœ¨ä¸»çº¿ç¨‹ ï¼›</li>
<li><code>subscribeOn()</code>æ“ä½œç¬¦å¹¶ä¸å¸¸ç”¨ã€‚</li>
</ol>
<p>ğŸŒ°4:</p>
<pre><code>let serialScheduler = SerialDispatchQueueScheduler(internalSerialQueueName: &quot;com.kaisa.gcdqueue&quot;)

let observable = Observable.just(&quot;ğŸ&quot;).delay(1.0, scheduler: serialScheduler)  // 1

print(&quot;Subscribing an Observable in thread : \(Thread.current)&quot;)
observable
    .do(onNext: { print(&quot;Intercepted \($0) in thread : \(Thread.current)&quot;) }
        , onError: nil, onCompleted: nil
    )
    .map({ fruit in
        print(&quot;Mapping \(fruit) in thread : \(Thread.current)&quot;)
        return &quot;ğŸ&quot;
    })
    .observeOn(MainScheduler.instance) 
    .subscribe(onNext: { (fruit: String) in
        print(&quot;Receiving \(fruit) in thread : \(Thread.current)&quot;)
    })
    .disposed(by: disposeBag)
</code></pre><p>ç»“æœ4:</p>
<pre><code>Subscribing an Observable in thread : &lt;NSThread: 0x600000076c80&gt;{number = 1, name = main}
Intercepted ğŸ in thread : &lt;NSThread: 0x60800047c180&gt;{number = 3, name = (null)}
Mapping ğŸ in thread : &lt;NSThread: 0x60800047c180&gt;{number = 3, name = (null)}
Receiving ğŸ in thread : &lt;NSThread: 0x600000076c80&gt;{number = 1, name = main}
</code></pre><p>è§‚å¯Ÿç»“æœå¯ä»¥å‘ç°ï¼š</p>
<ol>
<li>åº”ç”¨RxSwiftæä¾›çš„ä¾¿æ·åˆ›å»º<code>Observable</code>çš„æ–¹æ³•æ—¶ï¼Œåˆ›å»º&amp;å‘é€ä¸¤ä¸ªæ—¶æœºå°±ä¸èƒ½ç›´æ¥æ§åˆ¶äº† ï¼›</li>
</ol>
<p>è§£é‡Šä¸€ä¸‹ä¸Šé¢ä»£ç ï¼š</p>
<ol>
<li>åˆ›å»ºä¸€ä¸ª<code>Observable</code>æ—¶é€šè¿‡è°ƒç”¨<code>delay</code>æ“ä½œç¬¦å¯ä»¥ä¼ å…¥ä¸€ä¸ª<code>Scheduler</code>å¯¹è±¡ï¼Œä½œç”¨ç±»ä¼¼äºä¸Šé¢çš„<code>subscribeOn()</code>ï¼Œæ‰€ä»¥æ­¤æ—¶æ— é¡»è°ƒç”¨<code>subscribeOn()</code>äº†ã€‚</li>
</ol>
<p>PSï¼šè¿˜è®°å¾—ä¸Šä¸€ç¯‡æ–‡ç« ä¸­æåˆ°çš„<code>interval</code>æ“ä½œç¬¦ä¹ˆï¼Ÿä½¿ç”¨æ–¹å¼ç±»ä¼¼è¿™æ ·ï¼š</p>
<pre><code>Observable&lt;Int&gt;
    .interval(0.3, scheduler: MainScheduler.instance)
    .subscribe (onNext: { print($0) })
    .disposed(by: disposeBag)
</code></pre><p>å®ç°å›ºå®šæ—¶é—´é—´éš”å‘é€ä¸€ä¸ªäº‹ä»¶ï¼ˆåœ¨è¿™é‡Œæ˜¯ä¸€ä¸ªæ•´æ•°ï¼‰çš„åŠŸèƒ½ï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯<code>interval</code>æ“ä½œç¬¦ä¹Ÿè¦ä¼ å…¥ä¸€ä¸ª<code>Scheduler</code>å¯¹è±¡ï¼Œæ„æ€å’Œä¸Šé¢ä¾‹å­ä¸­ä¸€æ ·ï¼Œç›¸ä¿¡ä½ å·²ç»ç†è§£äº†ã€‚</p>
<h2 id="Cold-amp-Hot"><a href="#Cold-amp-Hot" class="headerlink" title="Cold &amp; Hot"></a>Cold &amp; Hot</h2><p>åœ¨swiftè¯­è¨€ä¸Šå¦ä¸€ä¸ªéå¸¸å¼ºå¤§çš„FRPæ¡†æ¶RACä¸­å’ŒRxSwiftä¸­Observableç›¸å¯¹åº”çš„æ¦‚å¿µæ˜¯signalï¼Œç¿»è¯‘è¿‡æ¥å°±æ˜¯ä¿¡å·ã€‚RACä¸­æ˜ç¡®å°†ä¿¡å·åˆ†ä¸ºä¸¤ç§ï¼Œå³ï¼šå†·ä¿¡å·å’Œçƒ­ä¿¡å·ï¼Œå®ƒä»¬æ˜¯ä¸¤ç§ä¸åŒçš„ç±»å‹ã€‚é‚£ä¹ˆåœ¨RxSwiftä¸­æœ‰æ²¡æœ‰Cold Observable å’Œ Hot Observableä¹‹åˆ†å‘¢ï¼Ÿå…¶å®ä¹Ÿæ˜¯æœ‰çš„ã€‚</p>
<p>åœ¨<a href="http://reactivex.io/documentation/observable.html" target="_blank" rel="external">ReactiveX.io</a>ä¸­æœ‰å¦‚ä¸‹ä¸€æ®µè¯´æ˜æ–‡å­—ï¼š</p>
<blockquote>
<p>â€œHotâ€ and â€œColdâ€ Observables</p>
<p>When does an Observable begin emitting its sequence of items? It depends on the Observable. A â€œhotâ€ Observable may begin emitting items as soon as it is created, and so any observer who later subscribes to that Observable may start observing the sequence somewhere in the middle. A â€œcoldâ€ Observable, on the other hand, waits until an observer subscribes to it before it begins to emit items, and so such an observer is guaranteed to see the whole sequence from the beginning.</p>
<p>In some implementations of ReactiveX, there is also something called a â€œConnectableâ€ Observable. Such an Observable does not begin emitting items until its Connect method is called, whether or not any observers have subscribed to it.</p>
</blockquote>
<p>å…³é”®åŒºåˆ«ç‚¹åœ¨äºObservableå¼€å§‹å‘é€äº‹ä»¶çš„æ—¶æœºã€‚å¦‚æœå®ƒè¢«åˆ›å»ºåæ— è®ºæœ‰æ²¡æœ‰è¢«è®¢é˜…éƒ½ç«‹å³å‘é€é‚£ä¹ˆå®ƒå°±æ˜¯ä¸€ä¸ªçƒ­çš„Observableï¼Œå¦‚æœåªæœ‰è¢«è®¢é˜…åæ‰å¼€å§‹å‘é€é‚£ä¹ˆå®ƒå°±æ˜¯ä¸€ä¸ªå†·çš„Observableã€‚è€Œè¿™å…¶å®ä¼šå¼•ç”³å‡ºå¦ä¸€ä¸ªæ›´é‡è¦çš„é—®é¢˜ï¼šä¸åŒè®¢é˜…è€…åœ¨ä¸åŒæ—¶é—´ç‚¹è®¢é˜…åŒä¸€ä¸ªæºObservableï¼Œå®ƒä»¬æ¥æ”¶åˆ°çš„æ˜¯å¦æ˜¯è¿™ä¸ªæºObservableå‘é€çš„å…¨éƒ¨äº‹ä»¶ã€‚æ–°çš„è®¢é˜…è€…è®¢é˜…äº†ä¸€ä¸ªçƒ­çš„Observableååªä¼šæ¥æ”¶åˆ°ä¹‹åå‘å‡ºçš„äº‹ä»¶ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸åŒè®¢é˜…è€…ä¹‹é—´å…±äº«åŒä¸€ä¸ªæºObservableï¼›è€Œè®¢é˜…äº†ä¸€ä¸ªå†·çš„Observableåä¼šå®Œæ•´æ¥æ”¶åˆ°å‘å‡ºçš„å…¨éƒ¨äº‹ä»¶ï¼Œä¹Ÿå°±æ˜¯è¯´æ¯ä¸€ä¸ªè®¢é˜…è€…å¯¹åº”ç€ä¸€ä¸ªå•ç‹¬çš„æºObservableã€‚</p>
<p>ä¸¾ä¸ªä¸æ˜¯ååˆ†æ°å½“çš„ä¾‹å­ï¼šå®ƒä»¬ä¹‹é—´æœ‰ç‚¹åƒç«è½¦å’Œå‡ºç§Ÿè½¦çš„å…³ç³»ï¼Œä¸€åˆ—ç«è½¦å‡ºå‘çš„æ—¶é—´ç‚¹ä»¥åŠç»è¿‡å“ªäº›ç«™éƒ½æ˜¯æå‰å°±å®šå¥½äº†çš„ï¼ˆå¿½ç•¥æ™šç‚¹åŠå…¶ä»–ç‰¹æ®Šæƒ…å†µï¼‰ï¼Œå®ƒä¸ä¼šå› æœ‰æ²¡æœ‰ä¹˜å®¢æœ‰å¤šå°‘ä¹˜å®¢è€Œæ”¹å˜ï¼Œæ‰€æœ‰ä¹˜å®¢å…±äº«è¿™ä¸€åˆ—ç«è½¦ï¼Œä¸€ä¸ªä¹˜å®¢è‹¥ä¸Šä¸€ç«™æ²¡æœ‰èµ¶ä¸Šåˆ™åªèƒ½å»ä¸‹ä¸€ç«™ä¸Šè½¦äº†ï¼›è€Œå‡ºç§Ÿè½¦å‘¢ï¼Œä»»ä½•ä¸€å®šæ—¶é—´å†…å¯¹äºä¸€ä¸ªä¹˜å®¢è€Œè¨€éƒ½æ˜¯ä¸€ä¸€å¯¹åº”çš„ï¼ˆæš‚ä¸è€ƒè™‘å¤šäººå…±æ‰“ä¸€è¾†è½¦çš„æƒ…å†µï¼‰ï¼ŒAæƒ³ä»æµ·æ·€å»æœé˜³éœ€è¦æ‰“ä¸€è¾†è½¦ï¼ŒBä¹Ÿæƒ³ä»æµ·æ·€å»æœé˜³åˆ™éœ€è¦æ‰“å¦å¤–ä¸€è¾†è½¦ï¼Œå®ƒä»¬å½¼æ­¤ä¹‹é—´ç›¸äº’ç‹¬ç«‹ï¼Œä¹Ÿå°±æ˜¯ä¸å…±äº«ã€‚</p>
<p>æ ¸å¿ƒå…³é”®å°±æ˜¯ä¸€ä¸ªè¯ï¼šå…±äº«ã€‚</p>
<p>è¿˜è®°å¾—ä¸Šä¸€ç¯‡ä»‹ç»å¯è¿æ¥çš„<code>Observable</code>æ—¶æ¶‰åŠåˆ°çš„è¿æ¥æ“ä½œç¬¦ä¹ˆï¼Œå°¤å…¶æ˜¯<code>replay</code>ï¼Œå¿˜äº†çš„è¯ç¿»å›å»å¤ä¹ ä¸€éï¼Œå¯¹æ¥ä¸‹æ¥çš„ç†è§£å¾ˆæœ‰å¸®åŠ©ã€‚</p>
<p>ä¸‹é¢ç›´æ¥çœ‹ä»£ç ã€‚</p>
<p>é¦–å…ˆå®šä¹‰ä¸€ä¸ªè¾…åŠ©å‡½æ•°ï¼š</p>
<pre><code>func myInterval(_ interval: TimeInterval) -&gt; Observable&lt;Int&gt; {
    return Observable.create { observer in
        print(&quot;Subscribed&quot;)
        let timer = DispatchSource.makeTimerSource(queue: DispatchQueue.global())
        timer.scheduleRepeating(deadline: DispatchTime.now() + interval, interval: interval)

        let cancel = Disposables.create {
            print(&quot;Disposed&quot;)
            timer.cancel()
        }

        var next = 0
        timer.setEventHandler {
            if cancel.isDisposed {
                return
            }
            observer.on(.next(next))
            next += 1
        }
        timer.resume()

        return cancel
    }
}
</code></pre><p>å¦‚æœçœ‹ä¸æ‡‚ä¹Ÿæ²¡å…³ç³»ï¼Œä¸ç”¨å…³å¿ƒå¤ªå¤šç»†èŠ‚ï¼Œåªè¦ç†è§£å®ƒæ˜¯ä»¿ç…§RxSwiftæä¾›çš„<code>interval</code>æ“ä½œç¬¦ï¼Œå®ç°é—´éš”ä¸€å®šæ—¶é—´å‘é€ä¸€ä¸ªæ•´å½¢å˜é‡çš„åŠŸèƒ½å°±å¯ä»¥äº†ã€‚</p>
<p>ğŸŒ°1:</p>
<pre><code>let observable = myInterval(1)

print(&quot;Started ----&quot;)

let subscription1 = observable
    .subscribe(onNext: { n in
        print(&quot;First \(n)&quot;)
    })

Thread.sleep(forTimeInterval: 2)

let subscription2 = observable
    .subscribe(onNext: { n in
        print(&quot;Second \(n)&quot;)
    })

Thread.sleep(forTimeInterval: 3)

subscription1.dispose()

Thread.sleep(forTimeInterval: 4)

subscription2.dispose()

print(&quot;Ended ----&quot;)
</code></pre><p>ç»“æœ1ï¼š</p>
<pre><code>Started ----
Subscribed
First 0
First 1
Subscribed
First 2
Second 0
First 3
Second 1
First 4
Second 2
Disposed
Second 3
Second 4
Second 5
Second 6
Disposed
Ended ----
</code></pre><p>è§‚å¯Ÿç»“æœå¯ä»¥å‘ç°ï¼š</p>
<ol>
<li><code>observable</code>åœ¨è¢«è®¢é˜…ä¹‹åæ¯é—´éš”1séƒ½ä¼šå‘é€ä¸€ä¸ªæ•´å½¢æ•° ï¼›</li>
<li>è®¢é˜…è€…1 <code>subscription1</code> åœ¨è®¢é˜…çš„5sæ—¶é—´å†…å…±æ¥æ”¶åˆ°5æ¡æ•°æ®ï¼Œè®¢é˜…è€…2 <code>subscription2</code> åœ¨è®¢é˜…çš„7sæ—¶é—´å†…å…±æ¥æ”¶åˆ°7æ¡æ•°æ®ï¼Œä¸€å¦‚é¢„æœŸ ï¼›</li>
<li><code>Subscribed</code> å’Œ <code>Disposed</code>åˆ†åˆ«éƒ½è¢«æ‰“å°äº†ä¸¤æ¬¡ï¼Œè®¢é˜…è€…1å’Œè®¢é˜…è€…2æ¥æ”¶åˆ°çš„æ•´å½¢æ•°éƒ½æ˜¯ä»0å¼€å§‹çš„ ï¼›</li>
</ol>
<p>è§£é‡Šä¸€ä¸‹ä¸Šé¢ä»£ç ï¼š</p>
<ol>
<li><code>Subscribed</code> å’Œ <code>Disposed</code>åˆ†åˆ«éƒ½è¢«æ‰“å°äº†ä¸¤æ¬¡ï¼Œè¯æ˜æº<code>observable</code>å†…éƒ¨çš„åˆ›å»ºæµç¨‹ä¹Ÿèµ°äº†ä¸¤æ¬¡ ï¼›</li>
<li>è®¢é˜…è€…2åœ¨2såæ‰è®¢é˜…ä¹Ÿæ˜¯ä»0å¼€å§‹æ¥æ”¶åˆ°æ•°æ®ï¼Œè¯æ˜æ¯ä¸€ä¸ªè®¢é˜…è€…éƒ½å¯¹åº”ä¸€ä¸ªæº<code>observable</code>ã€‚</li>
</ol>
<p>è¿™å°±æ˜¯ä¸€ç§å…¸å‹çš„Cold Observableçš„ä½¿ç”¨æ–¹å¼ã€‚é‚£ä¹ˆåˆ°åº•è¿™ç§æ–¹å¼æœ‰ä»€ä¹ˆå¼Šç«¯æˆ–è€…è¯´ä¸æ»¡è¶³ä»€ä¹ˆæƒ…å†µå‘¢ï¼Ÿ</p>
<p>ä¸€åˆ‡å–å†³äºobservableå†…éƒ¨å‘é€äº‹ä»¶çš„æœºåˆ¶ï¼Œåƒä¸Šé¢ä¾‹å­ä¸­åªæ˜¯é—´éš”å›ºå®šæ—¶é—´å‘é€ä¸€ä¸ªæ•´å½¢æ•°ï¼Œå¯¹å¤–ç•Œå¹¶ä¸ä¼šäº§ç”Ÿä»»ä½•å½±å“ï¼Œæ‰€ä»¥å¹¶æ²¡æœ‰é—®é¢˜ã€‚ä½†æ˜¯è€ƒè™‘è¿™ä¹ˆä¸€ç§æƒ…å†µï¼šæºobservableè¢«è®¢é˜…åä¼šè§¦å‘ä¸€ä¸ªç½‘ç»œè¯·æ±‚ï¼Œç„¶åæ ¹æ®è¯·æ±‚ç»“æœå†³å®šå¯¹å¤–å‘é€çš„æ•°æ®ï¼Œä¸¤ä¸ªè®¢é˜…è€…åˆ†åˆ«æ˜¯ä¸¤ä¸ªUIæ§ä»¶ï¼Œå®ƒä»¬ç­‰å¾…æºobservableå‘å‡ºæ•°æ®è¿›è¡Œåˆ·æ–°ã€‚é‚£ä¹ˆç”¨ä¸Šé¢è¿™ç§æ–¹å¼ä¼šå¯¼è‡´ç½‘ç»œè¯·æ±‚å‘é€ä¸¤æ¬¡ï¼Œä»è€Œæœ‰å¯èƒ½é€ æˆUIåˆ·æ–°ä¸ä¸€è‡´ï¼Œæµªè´¹æµé‡ï¼Œæ•°æ®ç»Ÿè®¡é”™è¯¯ç­‰ä¸€ç³»åˆ—é—®é¢˜ã€‚æœ‰äº›æ–‡ç« ä¸­ä¼šè¯´è¿™æ˜¯ä¸€ç§â€œå‰¯ä½œç”¨â€ï¼Œå«ä»€ä¹ˆåå­—æ— æ‰€è°“ï¼Œé¢†ä¼šç²¾ç¥å°±å¥½ã€‚</p>
<p>é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œæ€ä¹ˆæ ·è§£å†³è¿™ç§é—®é¢˜å‘¢ï¼Ÿç­”æ¡ˆå¾ˆç®€å•ï¼Œæœ‰ä¸€ä¸ªæ–°çš„æ“ä½œç¬¦æ˜¯ï¼š<a href="http://reactivex.io/documentation/operators/replay.html" target="_blank" rel="external">shareReplay()</a>ã€‚</p>
<h3 id="shareReplay"><a href="#shareReplay" class="headerlink" title="shareReplay"></a>shareReplay</h3><p>æ¥çœ‹ä¸‹é¢çš„ğŸŒ°2:</p>
<pre><code>let observable = myInterval(1).shareReplay(1)  // 1

print(&quot;Started ----&quot;)

let subscription1 = observable
    .subscribe(onNext: { n in
        print(&quot;First \(n)&quot;)
    })

Thread.sleep(forTimeInterval: 2)

let subscription2 = observable
    .subscribe(onNext: { n in
        print(&quot;Second \(n)&quot;)
    })

Thread.sleep(forTimeInterval: 3)

subscription1.dispose()

Thread.sleep(forTimeInterval: 4)

subscription2.dispose()

print(&quot;Ended ----&quot;)
</code></pre><p>ç»“æœ2ï¼š</p>
<pre><code>Started ----
Subscribed
First 0
First 1
Second 1
First 2
Second 2
First 3
Second 3
First 4
Second 4
Second 5
Second 6
Second 7
Second 8
Disposed
Ended ----
</code></pre><p>è§‚å¯Ÿç»“æœå¯ä»¥å‘ç°ï¼š</p>
<ol>
<li><code>observable</code>åœ¨è¢«è®¢é˜…ä¹‹åä»ç„¶æ¯é—´éš”1så‘é€ä¸€ä¸ªæ•´å½¢æ•° ï¼›</li>
<li>è®¢é˜…è€…1 <code>subscription1</code> åœ¨è®¢é˜…çš„5sæ—¶é—´å†…å…±æ¥æ”¶åˆ°5æ¡æ•°æ®ï¼Œè€Œä¸”æ˜¯ä»0å¼€å§‹çš„ï¼Œå’Œä¹‹å‰ä¸€æ · ï¼›</li>
<li>è®¢é˜…è€…2 <code>subscription2</code> åœ¨è®¢é˜…çš„7sæ—¶é—´å†…å…±æ¥æ”¶åˆ°8æ¡æ•°æ®ï¼Œæ¯”ä¹‹å‰å¤šä¸€æ¡ï¼Œè€Œä¸”æ˜¯ä»1å¼€å§‹çš„ï¼Œå’Œä¹‹å‰ä¸ä¸€æ · ï¼›</li>
<li><code>Subscribed</code> å’Œ <code>Disposed</code>åˆ†åˆ«éƒ½åªè¢«æ‰“å°äº†ä¸€æ¬¡ ï¼›</li>
</ol>
<p>è§£é‡Šä¸€ä¸‹ä¸Šé¢ä»£ç ï¼š</p>
<ol>
<li>å’Œä¸Šé¢ä¾‹å­å”¯ä¸€çš„åŒºåˆ«æ˜¯åº”ç”¨äº†<code>shareReplay()</code>æ“ä½œç¬¦å¹¶ä¸”ä¼ å…¥äº†ä¸€ä¸ª1ä½œä¸ºå‚æ•° ï¼›</li>
<li><code>Subscribed</code> å’Œ <code>Disposed</code>åˆ†åˆ«éƒ½åªè¢«æ‰“å°äº†ä¸€æ¬¡ï¼Œè¯æ˜æºobservableå†…éƒ¨çš„åˆ›å»ºæµç¨‹åªèµ°äº†ä¸€æ¬¡ ï¼›</li>
<li>è®¢é˜…è€…2åœ¨2såå¼€å§‹è®¢é˜…ç„¶åç«‹åˆ»æ¥æ”¶åˆ°çš„ç¬¬ä¸€ä¸ªæ•°æ®æ˜¯1æ˜¯å› ä¸ºç»è¿‡äº†<code>shareReplay(1)</code>ä¹‹åçš„<code>observable</code>å†…éƒ¨ä¼šä¿å­˜å½“å‰å‘é€çš„æœ€åä¸€æ¡æ•°æ®ï¼Œå½“æœ‰æ–°çš„è®¢é˜…è€…è®¢é˜…ä¹‹åé¦–å…ˆå°†æœ€åä¸€æ¡å†å‘é€ç»™å®ƒï¼Œä¹Ÿå°±æ˜¯è¯´ç»è¿‡<code>shareReplay(1)</code>ä¹‹åä¸€ä¸ªæ— çŠ¶æ€çš„<code>observable</code>ä¼šå˜ä¸ºæœ‰çŠ¶æ€çš„<code>observable</code> ï¼›</li>
<li>è®¢é˜…è€…2åœ¨æ”¶åˆ°1ä¹‹ååˆå’Œè®¢é˜…è€…1åŒæ—¶é™†ç»­æ”¶åˆ°äº†æ•´æ•°2ï¼Œ3ï¼Œ4ï¼Œè¯æ˜å’Œä¸¤ä¸ªè®¢é˜…è€…ä¹‹é—´ç¡®å®å…±äº«ç€åŒä¸€ä¸ªæº<code>Observable</code>ã€‚</li>
</ol>
<p>å»ºè®®è¯»è€…å†å‘<code>shareReplay()</code>ä¸­åˆ†åˆ«ä¼ å…¥0å’Œ2å¯¹æ¯”è§‚å¯Ÿä¸€ä¸‹è¾“å‡ºç»“æœã€‚</p>
<p>å¯è§ï¼Œé€šè¿‡ä½¿ç”¨<code>shareReplay()</code>ä½¿å¾—å¤šä¸ªè®¢é˜…è€…ä¹‹é—´å…±äº«åŒä¸€ä¸ªæºObservableå°±å®Œç¾çš„è§£å†³äº†ä¸Šé¢ä¾‹å­ä¸­ä½¿ç”¨Cold Observableæ‰€å¸¦æ¥çš„é—®é¢˜ï¼Œæ­¤æ—¶å°±å˜æˆäº†Hot Observableã€‚</p>
<h3 id="shareReplayLatestWhileConnected"><a href="#shareReplayLatestWhileConnected" class="headerlink" title="shareReplayLatestWhileConnected"></a>shareReplayLatestWhileConnected</h3><p><code>shareReplay</code> è¿˜æœ‰ä¸€ä¸ªå…„å¼Ÿæ“ä½œç¬¦å«åš <code>shareReplayLatestWhileConnected</code>ï¼Œä¸¤è€…ä¹‹é—´åªæœ‰ä¸€ä¸ªéå¸¸å°çš„åŒºåˆ«ã€‚</p>
<p>ğŸŒ°3:</p>
<pre><code>let observable = myInterval(1).shareReplay(1)

print(&quot;Started ----&quot;)

let subscription1 = observable
    .subscribe(onNext: { n in
        print(&quot;First \(n)&quot;)
    })

Thread.sleep(forTimeInterval: 2)

let subscription2 = observable
    .subscribe(onNext: { n in
        print(&quot;Second \(n)&quot;)
    })

Thread.sleep(forTimeInterval: 3)

subscription1.dispose()

Thread.sleep(forTimeInterval: 4)

subscription2.dispose()

print(&quot;Observer become 0&quot;)

Thread.sleep(forTimeInterval: 1)

let subscription3 = observable
    .subscribe(onNext: { n in
        print(&quot;Third \(n)&quot;)
    })

Thread.sleep(forTimeInterval: 2)

subscription3.dispose()

print(&quot;Ended ----&quot;)
</code></pre><p>ç»“æœ3ï¼š</p>
<pre><code>Started ----
Subscribed
First 0
First 1
Second 1
First 2
Second 2
First 3
Second 3
First 4
Second 4
Second 5
Second 6
Second 7
Second 8
Disposed
Observer become 0
Third 8
Subscribed
Third 0
Third 1
Disposed
Ended ----
</code></pre><p>æ³¨æ„å’Œä¸Šé¢ä¾‹å­çš„åŒºåˆ«ï¼Œ<code>observable</code>ä¼šç»å†ä¸€ä¸ªä»è¢«è®¢é˜…åˆ°æ²¡æœ‰è¢«è®¢é˜…å†åˆ°é‡æ–°è¢«è®¢é˜…çš„è¿‡ç¨‹ï¼Œè€Œé‡æ–°è¢«è®¢é˜…æ—¶ä»ç„¶é¦–å…ˆä¼šå‘é€ä¸€ä¸ªæ­¤å‰æ›¾ç»å‘é€è¿‡çš„æœ€åä¸€ä¸ªå€¼ï¼Œä¹‹åå†é‡æ–°å¼€å§‹ã€‚</p>
<p>ğŸŒ°4:</p>
<pre><code>let observable = myInterval(1).shareReplayLatestWhileConnected()

print(&quot;Started ----&quot;)

let subscription1 = observable
    .subscribe(onNext: { n in
        print(&quot;First \(n)&quot;)
    })

Thread.sleep(forTimeInterval: 2)

let subscription2 = observable
    .subscribe(onNext: { n in
        print(&quot;Second \(n)&quot;)
    })

Thread.sleep(forTimeInterval: 3)

subscription1.dispose()

Thread.sleep(forTimeInterval: 4)

subscription2.dispose()

print(&quot;Observer become 0&quot;)

Thread.sleep(forTimeInterval: 1)

let subscription3 = observable
    .subscribe(onNext: { n in
        print(&quot;Third \(n)&quot;)
    })

Thread.sleep(forTimeInterval: 2)

subscription3.dispose()

print(&quot;Ended ----&quot;)
</code></pre><p>ç»“æœ4ï¼š </p>
<pre><code>Started ----
Subscribed
First 0
First 1
Second 1
First 2
Second 2
First 3
Second 3
First 4
Second 4
Second 5
Second 6
Second 7
Second 8
Disposed
Observer become 0
Subscribed
Third 0
Third 1
Disposed
Ended ----  
</code></pre><p>å¯¹æ¯”<code>shareReplayLatestWhileConnected</code>å’Œ<code>shareReplay(1)</code>å¯ä»¥å‘ç°ï¼Œä»è¢«è®¢é˜…åˆ°æ²¡æœ‰è¢«è®¢é˜…å†åˆ°é‡æ–°è¢«è®¢é˜…æ—¶ä¸ä¼šå‘é€æ­¤å‰æ›¾ç»å‘é€è¿‡çš„æœ€åä¸€ä¸ªå€¼ï¼Œè€Œæ˜¯ç›´æ¥é‡æ–°å¼€å§‹ã€‚    </p>
<p>å¼„æ‡‚äº†è¿™ä¸¤ä¸ªä¹‹åå†ç¿»å›å»çœ‹ä¸€ä¸‹ä¸Šä¸€ç¯‡ä»‹ç»çš„<code>Subject</code>ç›¸å…³çš„å‡ ä¸ªæ“ä½œç¬¦ï¼Œç›¸ä¿¡ä½ ä¸€å®šä¼šè±ç„¶å¼€æœ—ã€‚</p>
<p>æœ€åçœ‹ä¸€ä¸‹RxSwiftå®˜æ–¹ä»‹ç»åŠ æ·±ä¸€ä¸‹ç†è§£ï¼š<a href="https://github.com/ReactiveX/RxSwift/blob/master/Documentation/HotAndColdObservables.md" target="_blank" rel="external">Hot and Cold Observables</a> ã€‚</p>
<h2 id="è‡ªå®šä¹‰operator"><a href="#è‡ªå®šä¹‰operator" class="headerlink" title="è‡ªå®šä¹‰operator"></a>è‡ªå®šä¹‰operator</h2><p>ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ä»‹ç»äº†å¾ˆå¤šä¸ªæ“ä½œç¬¦ï¼Œè¿™ç¯‡æ–‡ç« å‰é¢éƒ¨åˆ†åˆé‡ç‚¹ä»‹ç»äº†3ä¸ªæ“ä½œç¬¦ï¼Œå¦å¤–è¿˜æœ‰å¾ˆå¤šå¹¶æœªæåŠçš„æ“ä½œç¬¦ï¼Œæ‰€ä»¥ä»æŸç§æ„ä¹‰ä¸Šå¯ä»¥è¯´ï¼ŒRxSwiftä¹‹æ‰€ä»¥å¼ºå¤§å°±åœ¨äºå®ƒæœ¬èº«å®šä¹‰äº†å„ç§å„æ ·çš„æ“ä½œç¬¦ã€‚</p>
<p>è¿™é‡Œæ˜¯æ‰€æœ‰æ“ä½œç¬¦çš„<a href="http://reactivex.io/documentation/operators.html#tree" target="_blank" rel="external">åˆ—è¡¨</a>ï¼Œæœ‰äº‹æ²¡äº‹å¯ä»¥æŸ¥ä¸€æŸ¥ï¼Œçœ‹çœ‹å…·ä½“éƒ½æœ‰å“ªäº›ã€‚</p>
<p>ä½†å³ä½¿æ˜¯å·²ç»æœ‰äº†è¿™ä¹ˆå¤šï¼Œåœ¨å®é™…å¼€å‘ä¸­å¯èƒ½ä¹Ÿä¼šé‡åˆ°ä¸æ»¡è¶³æ¡ä»¶çš„æƒ…å†µï¼Œæ€ä¹ˆåŠå‘¢ï¼Ÿå¾ˆç®€å•ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰æ“ä½œç¬¦ã€‚</p>
<p>é‰´äºæœ¬èº«å·²ç»å­˜åœ¨çš„æ“ä½œç¬¦çš„å®ç°æ–¹å¼å·²ç»åšäº†ç›¸å½“ç¨‹åº¦çš„ä¼˜åŒ–ï¼Œæ‰€ä»¥è²Œä¸€çœ‹ä¸ä¸€å®šèƒ½çœ‹å¾—æ‡‚ã€‚ä½†ä¸‡å˜ä¸ç¦»å…¶å®—ï¼Œåˆ›å»ºæ“ä½œç¬¦åœ¨æœ¬è´¨ä¸Šä»ç„¶æ˜¯åˆ›å»ºä¸€ä¸ªObservableåºåˆ—ï¼Œæ‰€ä»¥å…¶å®æ–¹æ³•ä½ å·²ç»çŸ¥é“äº†ã€‚è€Œä¸”å‰é¢ä¹Ÿå·²ç»æˆ–å¤šæˆ–å°‘çš„æ¶‰åŠè¿‡ï¼Œè¿˜è®°å¾—ä¸Šæ–‡ä¸­å‡ºç°çš„ <code>myJust()</code> å’Œ <code>myInterval()</code> ä¹ˆï¼Ÿç¿»å›å»å†çœ‹ä¸€éï¼Œå®ƒä»¬å°±æ˜¯è‡ªå®šä¹‰çš„æ“ä½œç¬¦ã€‚</p>
<p>æ¥çœ‹ä¸€ä¸‹å®˜æ–¹æä¾›çš„æœªç»è¿‡ä¼˜åŒ–çš„<code>map</code>æ“ä½œç¬¦ç‰ˆæœ¬ï¼š</p>
<pre><code>extension ObservableType {
    func myMap&lt;R&gt;(transform: @escaping (E) -&gt; R) -&gt; Observable&lt;R&gt; {
        return Observable.create { observer in
            let subscription = self.subscribe { e in
                switch e {
                case .next(let value):
                    let result = transform(value)
                    observer.on(.next(result))
                case .error(let error):
                    observer.on(.error(error))
                case .completed:
                    observer.on(.completed)
                }
            }

            return subscription
        }
    }
}
</code></pre><p>ä½¿ç”¨æ–¹å¼å’Œä½¿ç”¨ç³»ç»Ÿæä¾›çš„ä¸€æ¨¡ä¸€æ ·ï¼š</p>
<pre><code>let subscription = myInterval(0.1)
    .myMap { event in
        return &quot;This is simply \(event)&quot;
    }
    .subscribe(onNext: { next in
        print(next)
    })
</code></pre><p>ä¸€å¦‚é¢„æœŸï¼Œè¾“å‡ºç»“æœä¸ºï¼š</p>
<pre><code>Subscribed
This is simply 0
This is simply 1
This is simply 2
This is simply 3
This is simply 4
This is simply 5
This is simply 6
...
</code></pre><p>ç›¸å½“ç®€å•æœ‰æœ¨æœ‰ï¼Ÿï¼    </p>
<hr>
<p>ç›®å‰ä¸ºæ­¢ä»‹ç»çš„å…¨æ˜¯RxSwifté’ˆå¯¹swiftè¿™é—¨è¯­è¨€å®ç°çš„å‡½æ•°å¼å“åº”å¼ç¼–ç¨‹èŒƒå¼ï¼Œè‡³äºä½ æ˜¯ç”¨swiftå†™å®¢æˆ·ç«¯è¿˜æ˜¯å†™æœåŠ¡ç«¯å…¶å®æ— æ‰€è°“ã€‚æ¥ä¸‹æ¥è¦ä»‹ç»çš„ä¸€äº›å†…å®¹å°±åªé€‚ç”¨äºiOSç³»ç»Ÿå¼€å‘è‹¹æœæ‰‹æœºAppäº†ã€‚</p>
<h2 id="å¤§ä¸€ç»Ÿ"><a href="#å¤§ä¸€ç»Ÿ" class="headerlink" title="å¤§ä¸€ç»Ÿ"></a>å¤§ä¸€ç»Ÿ</h2><p>ä¸Šä¸€ç¯‡ä¸­æåˆ°è¿‡ï¼ŒRxSwiftå¯ä»¥å°†iOSç³»ç»Ÿé»˜è®¤æä¾›çš„å‡ ç§äº‹ä»¶å“åº”æ–¹å¼è¿›è¡Œç»Ÿä¸€ï¼Œè¿™æ ·èƒ½å¾ˆå¤§ç¨‹åº¦ä¸Šæé«˜ä»£ç å¯è¯»æ€§ï¼Œä½¿å¾—ä»£ç æ›´åŠ æ˜“äºç»´æŠ¤ä¸æ‹“å±•ã€‚ä¸‹é¢å°±æ¥çœ‹çœ‹å…·ä½“æ˜¯æ€ä¹ˆåšçš„ã€‚</p>
<h3 id="KVO"><a href="#KVO" class="headerlink" title="KVO"></a>KVO</h3><p>å…ˆæ¥çœ‹ä¸€ä¸‹ç³»ç»Ÿæä¾›çš„ä½¿ç”¨KVOçš„ä¸‰ä¸ªå‡½æ•°ï¼Œæ³¨æ„æ˜¯ä¸‰ä¸ª!!!</p>
<pre><code>func addObserver(_ observer: NSObject, forKeyPath keyPath: String, options: NSKeyValueObservingOptions = [], context: UnsafeMutableRawPointer?)
func removeObserver(_ observer: NSObject, forKeyPath keyPath: String)
func observeValue(forKeyPath keyPath: String?, of object: Any?, change: [NSKeyValueChangeKey : Any]?, context: UnsafeMutableRawPointer?)
</code></pre><p>å…·ä½“æœ‰å¤šéš¾ç”¨å°±ä¸æäº†ï¼Œè°ç”¨è°çŸ¥é“ã€‚</p>
<p>æ¥çœ‹ä¸€ä¸‹RxSwiftæä¾›çš„æ”¯æŒKVOçš„ä¸¤ç§æ–¹å¼ï¼Œæ¯ç§æ–¹å¼éƒ½åªæœ‰ä¸€ä¸ªå‡½æ•°ã€‚</p>
<pre><code>func observe&lt;E&gt;(_ type: E.Type, _ keyPath: String, options: NSKeyValueObservingOptions = [.new, .initial], retainSelf: Bool = true) -&gt; Observable&lt;E?&gt; { }

func observeWeakly&lt;E&gt;(_ type: E.Type, _ keyPath: String, options: NSKeyValueObservingOptions = [.new, .initial]) -&gt; Observable&lt;E?&gt; { }
</code></pre><p>åŒºåˆ«ä¸»è¦åœ¨äºå†…å­˜ç®¡ç†æ–¹å¼ä¸ä¸€è‡´ã€‚æ¥çœ‹ä¸€ä¸‹æ€ä¹ˆä½¿ç”¨ï¼š</p>
<pre><code>view
   .rx.observe(CGRect.self, &quot;frame&quot;)
    .subscribe(onNext: { frame in
      ...
    })
    .disposed(by: disposeBag)
</code></pre><p>æˆ–è€…</p>
<pre><code>view
    .rx.observeWeakly(CGRect.self, &quot;frame&quot;)
    .subscribe(onNext: { frame in
      ...
    }) 
    .disposed(by: disposeBag)       
</code></pre><p>çœŸæ˜¯æ²¡æœ‰å¯¹æ¯”å°±æ²¡æœ‰ä¼¤å®³ï¼Œæ—¢ä¸éœ€è¦æ³¨å†Œåˆä¸éœ€è¦ç§»é™¤ï¼Œæ¯”ç³»ç»Ÿçš„æ–¹ä¾¿ç®€å•å¾ˆå¤šæœ‰æœ¨æœ‰ï¼Ÿï¼</p>
<h4 id="rx-observe"><a href="#rx-observe" class="headerlink" title="rx.observe"></a>rx.observe</h4><p><code>rx.observe</code>æ€§èƒ½æ›´åŠ é«˜æ•ˆæ˜¯å› ä¸ºå®ƒä»…ä»…æ˜¯å¯¹ç³»ç»ŸKVOçš„ç®€å•å°è£…ï¼Œç›¸å¯¹æ¥è¯´é€‚åˆåº”ç”¨çš„åœºæ™¯æ¯”è¾ƒå°‘ï¼š</p>
<ul>
<li>å®ƒå¯ä»¥ç”¨äºç›‘æµ‹ç”±<code>self</code>æˆ–è€…çˆ¶ç±»å¼€å§‹çš„è·¯å¾„ (<code>retainSelf</code> = <code>false</code>)</li>
<li>å®ƒå¯ä»¥ç”¨äºç›‘æµ‹ç”±å­ç±»å¼€å§‹çš„è·¯å¾„ (<code>retainSelf</code> = <code>true</code>)</li>
<li>æ•´ä¸ªè·¯å¾„å½“ä¸­çš„æ‰€æœ‰å±æ€§å¿…é¡»éƒ½æ˜¯ç”¨<code>strong</code>ä¿®é¥°çš„ï¼Œå¦åˆ™å°±ä¼šé¢ä¸´ç€crashçš„é£é™©</li>
</ul>
<p>ä¸¾ä¸ªä¾‹å­ï¼š</p>
<pre><code>self.rx.observe(CGRect.self, &quot;view.frame&quot;, retainSelf: false)
</code></pre><h4 id="rx-observeWeakly"><a href="#rx-observeWeakly" class="headerlink" title="rx.observeWeakly"></a>rx.observeWeakly</h4><p><code>rx.observeWeakly</code>ä¼šæ¯”<code>rx.observe</code>æ€§èƒ½ç¨å¾®å·®ä¸€äº›æ˜¯å› ä¸ºå®ƒä¸ºäº†é˜²æ­¢å¼±å¼•ç”¨å‡ºç°ä¸å¾—ä¸å»å¤„ç†å¯¹è±¡çš„é‡Šæ”¾ï¼ˆ<code>dealloc</code>ï¼‰ã€‚</p>
<p>å®ƒé™¤äº†å¯ä»¥ç”¨äºä»»ä½•é€‚ç”¨äº<code>rx.observe</code>çš„åœºæ™¯ä¹‹å¤–ï¼Œè¿˜é€‚åˆåº”ç”¨çš„åœºæ™¯æœ‰ï¼š</p>
<ul>
<li>å› ä¸ºå®ƒä¸ä¼šä¿ç•™è¢«ç›‘æµ‹çš„ç›®æ ‡ï¼Œå®ƒå¯ä»¥ç”¨äºç›‘æµ‹ä»»æ„çš„å¯¹è±¡ï¼Œå³ä½¿å®ƒçš„æ‰€æœ‰æƒå…³ç³»æœªçŸ¥</li>
<li>å®ƒå¯ä»¥ç”¨äºç›‘æµ‹ç”¨<code>weak</code>ä¿®é¥°çš„å±æ€§</li>
</ul>
<p>å†ä¸¾ä¸ªä¾‹å­ï¼š</p>
<pre><code>someSuspiciousViewController.rx.observeWeakly(Bool.self, &quot;behavingOk&quot;)
</code></pre><p>æ€»ç»“ä¸€ä¸‹ï¼Œé™¤éä½ ååˆ†ç¡®å®šç”¨<code>rx.observe</code>å¾ˆåˆé€‚ï¼Œå¦åˆ™éƒ½ç”¨<code>rx.observeWeakly</code>æ²¡æ¯›ç—…ã€‚</p>
<h3 id="Notification"><a href="#Notification" class="headerlink" title="Notification"></a>Notification</h3><p>é€šçŸ¥å’ŒKVOç‰¹åˆ«åƒï¼Œé¦–å…ˆè¿˜æ˜¯çœ‹ä¸€ä¸‹ç³»ç»Ÿæä¾›çš„å‡½æ•°ï¼š</p>
<pre><code>func addObserver(_ observer: Any, selector aSelector: Selector, name aName: NSNotification.Name?, object anObject: Any?)
func addObserver(forName name: NSNotification.Name?, object obj: Any?, queue: OperationQueue?, using block: @escaping (Notification) -&gt; Swift.Void) -&gt; NSObjectProtocol
removeObserver(_ observer: Any)
post(name aName: NSNotification.Name, object anObject: Any?, userInfo aUserInfo: [AnyHashable : Any]? = nil)
</code></pre><p>å‰ä¸¤ä¸ªå‡½æ•°æ˜¯å¹¶åˆ—å…³ç³»ï¼Œä½¿ç”¨æ—¶äºŒé€‰ä¸€ã€‚å…¶å®ç›¸æ¯”äºKVOï¼Œå¹¶æ²¡æœ‰è§‰å¾—é€šçŸ¥å¤šä¹ˆéš¾ç”¨ã€‚</p>
<p>æ¥çœ‹ä¸€ä¸‹RxSwiftæä¾›çš„ç”¨äºä»£æ›¿ç³»ç»Ÿé€šçŸ¥çš„å‡½æ•°ã€‚</p>
<pre><code>public func notification(_ name: Notification.Name?, object: AnyObject? = nil) -&gt; Observable&lt;Notification&gt; { }
</code></pre><p>ä½¿ç”¨æ–¹å¼ä¸ºï¼š</p>
<pre><code>NotificationCenter.default
   .rx.notification(Notification.Name(rawValue: &quot;testNotification&quot;), object: nil)
   .subscribe(onNext: { noti in
          ...
   })
   .disposed(by: disposeBag)
</code></pre><p>æˆ–è€…</p>
<pre><code>NotificationCenter.default
     .rx.notification(Notification.Name.UITextViewTextDidBeginEditing, object: myTextView)
     .subscribe(onNext: { n in
       ...
     }) 
     .disposed(by: disposeBag) 
</code></pre><p>å¯è§ï¼Œåªæ˜¯ä½¿å¾—æ¥æ”¶é€šçŸ¥æ—¶çš„å¤„ç†æ–¹å¼å˜çš„æ›´åŠ ä¼˜é›…ï¼Œå‘é€å’Œé”€æ¯çš„æ–¹å¼ä¸å˜ã€‚</p>
<h3 id="Target-Action"><a href="#Target-Action" class="headerlink" title="Target-Action"></a>Target-Action</h3><p>è¿™ç§æ–¹å¼å˜å¾—å°¤å…¶ç®€å•ã€‚</p>
<pre><code>@IBOutlet weak var button: UIButton!

button.rx.tap
   .subscribe(onNext: {
       print(&quot;button is clicked&quot;)
   })
   .addDisposableTo(disposeBag)
</code></pre><p>çœŸæ˜¯æ²¡ä»€ä¹ˆå¯è§£é‡Šçš„ï¼ŒSo Easyï¼Œç…§è‘«èŠ¦ç”»ç“¢å°±å¯ä»¥ã€‚</p>
<h3 id="Delegate"><a href="#Delegate" class="headerlink" title="Delegate"></a>Delegate</h3><p>ä¸åºŸè¯ï¼Œç›´æ¥çœ‹ä»£ç ã€‚</p>
<pre><code>@IBOutlet weak var scrollView: UIScrollView!

scrollView.rx.didScroll
   .subscribe(onNext: { [weak self] in
       print(&quot;current offsetY is \(self?.scrollView.contentOffset.y)&quot;)
   })
   .addDisposableTo(disposeBag)
</code></pre><p>å¯è§ï¼ŒRxSwiftå°†<code>UIScrollView</code>çš„ä»£ç†æ–¹æ³•<code>scrollViewDidScroll:</code>å°è£…æˆäº†ä¸€ä¸ª<code>Observable</code>çš„å±æ€§ï¼Œä½¿ç”¨çš„æ—¶å€™ä¸å†éœ€è¦è·¨æ–¹æ³•ï¼Œç›´æ¥è®¢é˜…å°±å¥½äº†ã€‚ä»£ç æ›´åŠ ç´§å‡‘æœ‰æœ¨æœ‰ï¼Ÿ</p>
<p>è‡³äºå¦‚ä½•æ‹“å±•è‡ªå·±å®šä¹‰çš„ä»£ç†æ–¹æ³•ä¹Ÿå¯ä»¥åº”ç”¨è¿™ç§æ–¹å¼ç•¥æœ‰ç‚¹å¤æ‚ï¼Œæš‚æ—¶å¿½ç•¥ï¼Œæœ‰å…´è¶£çš„å¯ä»¥è‡ªå·±å»ç ”ç©¶ä¸€ä¸‹ã€‚</p>
<h2 id="ç»‘å®š"><a href="#ç»‘å®š" class="headerlink" title="ç»‘å®š"></a>ç»‘å®š</h2><p>ä¸€å¥è¯æè¿°é‡è¦æ€§ï¼šè¿™æ˜¯RxSwiftç”šè‡³å“åº”å¼ç¼–ç¨‹ä¸­æœ€é‡è¦çš„ä¸€ä¸ªæ¦‚å¿µï¼Œæ²¡æœ‰ä¹‹ä¸€ã€‚</p>
<p>å…¶å®å…¨ç§°åº”è¯¥æ˜¯æ•°æ®ç»‘å®šï¼Œ<a href="http://baike.baidu.com/item/%E6%95%B0%E6%8D%AE%E7%BB%91%E5%AE%9A" target="_blank" rel="external">ç™¾åº¦ç™¾ç§‘</a>ä¸Šæ˜¯è¿™ä¹ˆå®šä¹‰çš„ï¼šç»‘å®šæ˜¯å°†ä¸€ä¸ªç”¨æˆ·ç•Œé¢å…ƒç´ ï¼ˆæ§ä»¶ï¼‰çš„å±æ€§ç»‘å®šåˆ°ä¸€ä¸ªç±»å‹ï¼ˆå¯¹è±¡ï¼‰å®ä¾‹ä¸Šçš„æŸä¸ªå±æ€§çš„æ–¹æ³•ã€‚</p>
<p>å¦‚æœä½ å¹¶æ²¡æœ‰å®Œå…¨ç†è§£ï¼Œé‚£ä¹ˆæˆ‘æ¥ä¸¾ä¸€ä¸ªé€šä¿—æ˜“æ‡‚çš„ä¾‹å­ã€‚å‡è®¾ç°åœ¨è¦åšä¸€ä¸ªç±»ä¼¼å¾®ä¿¡æœ‹å‹åœˆçš„åŠŸèƒ½ï¼Œå¯ä»¥å‘å¸–å¯ä»¥ç‚¹èµï¼Œåœ¨æ¯æ¡å¸–å­ä¸‹é¢è¦å±•ç¤ºå½“å‰è·å¾—çš„ç‚¹èµæ•°ã€‚å¾ˆç®€å•çš„éœ€æ±‚å¯¹å§ï¼ŒæŠ›å¼€å‘å¸–ç‚¹èµä¸æåªè€ƒè™‘å±•ç¤ºç‚¹èµï¼Œå‡è®¾æ¨¡å‹ç±»çš„å®ä¾‹å¯¹è±¡å«åš<code>article</code>ï¼Œç‚¹èµæ•°é‡çš„å±æ€§å­—æ®µå«åš<code>starCount</code>ï¼Œåªéœ€è¦å–åˆ°è¿™ä¸ªå­—æ®µç„¶åèµ‹å€¼ç»™ä¸€ä¸ª<code>label</code>å°±å¯ä»¥ã€‚é‚£ä¹ˆå½“å½“å‰ç”¨æˆ·ä¹Ÿç‚¹èµäº†åï¼Œ<code>starCount</code>è¦+1ï¼Œ<code>label</code>è¦æ”¹å˜ï¼Œæ€ä¹ˆåšå‘¢ï¼ŸæŒ‰ç…§ä»¥å¾€æœ€ç®€å•çš„æ–¹å¼æ— å¤–ä¹æ˜¯å¯¹<code>article</code>çš„<code>starCount</code>åšä¸€ä¸ªKVOï¼Œå½“æ”¹å˜æ—¶é‡æ–°å¯¹<code>label</code>è¿›è¡Œèµ‹å€¼ã€‚é‚£å¦‚æœåº”ç”¨ç»‘å®šçš„æ–¹å¼å‘¢ï¼Œå°†è¿™ä¸ª<code>label</code>å’Œ<code>article</code>çš„<code>starCount</code>è¿›è¡Œç»‘å®šï¼Œ<code>starCount</code>å¯ä»¥éšæ„å˜ï¼Œæ— éœ€æ‰‹åŠ¨å†™KVOï¼Œæ— éœ€æ‰‹åŠ¨é‡æ–°èµ‹å€¼ï¼Œ<code>label</code>éƒ½ä¼šè‡ªåŠ¨æ”¹å˜ï¼Œ666æœ‰æœ¨æœ‰ï¼Ÿï¼</p>
<p>ç„¶åæ³¨æ„è¿™åªæ˜¯å•å‘ç»‘å®šï¼ŒåŒå‘ç»‘å®šå¤ªå¤æ‚ï¼Œæš‚æ—¶ä¸åšè®¨è®ºã€‚</p>
<p>å…ˆæ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼š</p>
<pre><code>@IBOutlet weak var number1: UITextField!
@IBOutlet weak var number2: UITextField!
@IBOutlet weak var label: UILabel!

let disposeBag = DisposeBag()

number1.rx.text
    .bind(to: label.rx.text)
    .addDisposableTo(disposeBag)

number1.rx.text
    .bind(to: number2.rx.text)
    .addDisposableTo(disposeBag)
</code></pre><p>é¦–å…ˆå®šä¹‰äº†ä¸¤ä¸ª<code>UITextField</code>å’Œä¸€ä¸ª<code>UILabel</code>åˆ†åˆ«å«åš<code>number1</code>ï¼Œ<code>number2</code>å’Œ<code>label</code>ï¼Œç„¶ååº”ç”¨<code>bind</code>å‘½ä»¤å°†<code>number1</code>å’Œ<code>label</code>è¿›è¡Œç»‘å®šï¼Œå°†<code>number1</code>å’Œ<code>number2</code>ä¹Ÿè¿›è¡Œç»‘å®šã€‚å®é™…è¿è¡Œæ—¶ä¼šå‘ç°æ— è®ºåœ¨<code>number1</code>ä¸­è¾“å…¥ä»»ä½•å†…å®¹<code>number2</code>å’Œ<code>label</code>éƒ½ä¼šå˜æˆåŒæ ·çš„å†…å®¹ã€‚è¿™å°±æ˜¯ç»‘å®šçš„å‰å®³ã€‚é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œä¸ºä»€ä¹ˆå¯ä»¥è¿™æ ·ç»‘å®šå‘¢ï¼Ÿ</p>
<p>åŸæ¥ï¼Œé€šè¿‡æŸ¥çœ‹æºç ä¼šå‘ç° <code>number1.rx.text</code> æ˜¯ä¸€ä¸ª <code>ControlProperty&lt;String?&gt;</code> ç±»å‹çš„å±æ€§ï¼Œè€Œ <code>label.rx.text</code> æ˜¯ä¸€ä¸ª <code>UIBindingObserver&lt;Base, String?&gt;</code> ç±»å‹çš„å±æ€§ï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªç©¶ç«Ÿæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p>
<p>åœ¨ä»‹ç»è¿™ä¸¤ä¸ªä¹‹å‰ï¼Œé¦–å…ˆè¦æ’ä¸ªé˜Ÿï¼Œè¿˜è®°å¾—ä¸Šé¢ç”¨è¿‡çš„ <code>button.rx.tap</code>å—ï¼Œå…¶å®å®ƒæ˜¯ä¸€ä¸ª <code>ControlEvent&lt;Void&gt;</code> ç±»å‹çš„å±æ€§ï¼Œç°åœ¨ä¹Ÿæ¥æ¢ç©¶ä¸€ä¸‹å®ƒç©¶ç«Ÿæ˜¯ä»€ä¹ˆã€‚</p>
<p>åœ¨å®é™…å¼€å‘ä¸­æœ€å¸¸ç”¨çš„ä¸‰ä¸ªåŸºç¡€æ§ä»¶ï¼š<code>UIButton</code>ï¼Œ<code>UITextField</code>ï¼Œ<code>UILabel</code>ã€‚</p>
<p>ç›¸å¯¹åº”çš„æƒ³è¦ç†è§£å¦‚ä½•å®ç°çš„ç»‘å®šé¦–å…ˆè¦æ¸…æ¥šä¸‰ä¸ªæ¦‚å¿µï¼š<code>ControlEvent</code>ï¼Œ<code>ControlProperty</code>ï¼Œ<code>UIBindingObserver</code>ã€‚</p>
<p>é¦–å…ˆè¦æ˜ç¡®çš„ä¸€ç‚¹æ˜¯è¿™ä¸‰ä¸ªæ¦‚å¿µéƒ½åªé€‚ç”¨äºUIå±‚ï¼Œæ‰€ä»¥ä¸å­˜åœ¨å¤šçº¿ç¨‹çš„é—®é¢˜ã€‚</p>
<h3 id="ControlEvent"><a href="#ControlEvent" class="headerlink" title="ControlEvent"></a>ControlEvent</h3><p>é¦–å…ˆçœ‹å®šä¹‰ï¼š</p>
<pre><code>struct ControlEvent&lt;PropertyType&gt; : ControlEventType

protocol ControlEventType : ObservableType
</code></pre><p>äºæ˜¯æˆ‘ä»¬å‘ç°é¦–å…ˆ<code>ControlEvent</code>æ˜¯ä¸€ä¸ªç»“æ„ä½“ï¼Œç„¶åå½’æ ¹ç»“åº•å®ç°äº†<code>ObservableType</code>åè®®ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒæ˜¯ä¸€ä¸ªè¢«è§‚å¯Ÿè€…ï¼Œå³<code>Observable</code>ã€‚</p>
<p>ç„¶åå®ƒæœ‰ä»¥ä¸‹è¿™äº›æ€§è´¨ï¼š</p>
<pre><code>- it never fails
- it won&apos;t send any initial value on subscription
- it will `Complete` sequence on control being deallocated
- it never errors out
- it delivers events on `MainScheduler.instance`
</code></pre><p>éƒ½æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Œæ‹¿åˆšæ‰çš„æŒ‰é’®ä¸¾ä¾‹ï¼Œä¸€ä¸ªæŒ‰é’®è¢«ç‚¹å‡»æ˜¯ä¸€ä¸ª<code>ControlEvent</code>çš„å®ä¾‹ï¼Œé‚£ä¹ˆï¼š</p>
<ol>
<li>ä¸è€ƒè™‘ä¸»çº¿ç¨‹å¡æ­»ï¼ŒæŒ‰é’®ä¸€ç›´å¯ä»¥è¢«ç‚¹å‡»ï¼Œå½“ç„¶ä¸ä¼šå¤±è´¥ï¼›</li>
<li>æŒ‰é’®åªæœ‰è¢«æŒ‰ä¸‹æ—¶æ‰ä¼šå‘é€äº‹ä»¶ï¼Œåˆšè¢«è¿›è¡Œç»‘å®šåä¸ä¼šå‘é€äº‹ä»¶ï¼›</li>
<li>æŒ‰é’®è¢«é”€æ¯æ—¶ä¼šå‘é€ä¸€ä¸ªå®Œæˆç±»å‹äº‹ä»¶ï¼›</li>
<li>å’Œç¬¬ä¸€æ¡å·®ä¸å¤šï¼Œä¸ä¼šå¤±è´¥ä¹Ÿå°±ä¸ä¼šå‘é€é”™è¯¯ç±»å‹äº‹ä»¶ï¼›</li>
<li>å‘é€äº‹ä»¶éƒ½æ˜¯åœ¨ä¸»çº¿ç¨‹ï¼›</li>
</ol>
<p>ä¸€å¥è¯æ€»ç»“å°±æ˜¯ï¼Œè¿™æ˜¯ä¸€ä¸ªåªèƒ½åœ¨ä¸»çº¿ç¨‹å‘é€äº‹ä»¶çš„<code>Observable</code>ã€‚</p>
<p>é¡ºä¾¿æä¸€å¥ï¼Œä¸Šé¢ç”¨è¿‡çš„ <code>scrollView.rx.didScroll</code>å…¶å®ä¹Ÿæ˜¯ä¸€ä¸ª<code>ControlEvent&lt;Void&gt;</code> ç±»å‹çš„å±æ€§ã€‚æ‰€ä»¥ç°åœ¨ä½ ç»ˆäºçŸ¥é“å®ƒä»¬ä¸ºä»€ä¹ˆå¯ä»¥è¢«è®¢é˜…äº†å§ï¼</p>
<h3 id="ControlProperty"><a href="#ControlProperty" class="headerlink" title="ControlProperty"></a>ControlProperty</h3><p>ä»ç„¶é¦–å…ˆçœ‹å®šä¹‰ï¼š</p>
<pre><code>struct ControlProperty&lt;PropertyType&gt; : ControlPropertyType

protocol ControlPropertyType : ObservableType, ObserverType
</code></pre><p>äºæ˜¯æˆ‘ä»¬å‘ç°é¦–å…ˆ<code>ControlProperty</code>ä¹Ÿæ˜¯ä¸€ä¸ªç»“æ„ä½“ï¼Œç„¶åå½’æ ¹ç»“åº•åŒæ—¶å®ç°äº†<code>ObservableType</code>ä¸<code>ObserverType</code>ä¸¤ä¸ªåè®®ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒå³æ˜¯ä¸€ä¸ªè¢«è§‚å¯Ÿè€…ï¼Œå³<code>Observable</code>ï¼Œåˆæ˜¯ä¸€ä¸ªè§‚å¯Ÿè€…ï¼Œå³<code>Observer</code>ã€‚</p>
<p>ç„¶åå®ƒæœ‰ä»¥ä¸‹è¿™äº›æ€§è´¨ï¼š</p>
<pre><code>- it never fails
- `shareReplay(1)` behavior
    - it&apos;s stateful, upon subscription (calling subscribe) last element is immediately replayed if it was produced
- it will `Complete` sequence on control being deallocated
- it never errors out
- it delivers events on `MainScheduler.instance`
</code></pre><p>æ‹¿åˆšæ‰çš„è¾“å…¥æ¡†ä¸¾ä¾‹å­ï¼Œä¸€ä¸ªè¾“å…¥æ¡†çš„<code>text</code>å€¼æ˜¯ä¸€ä¸ª<code>ControlProperty</code>çš„å®ä¾‹ï¼Œé‚£ä¹ˆï¼š</p>
<ol>
<li>ä¸è€ƒè™‘ä¸»çº¿ç¨‹å¡æ­»ï¼Œè¾“å…¥æ¡†ä¸€ç›´å¯ä»¥è¢«æ”¹å˜ï¼Œå½“ç„¶ä¸ä¼šå¤±è´¥ï¼›</li>
<li>ä¸€ä¸ªè¾“å…¥æ¡†å½“ç„¶å¯ä»¥åŒæ—¶è¢«å¤šä¸ªè§‚å¯Ÿè€…è®¢é˜…ï¼Œæ­¤æ—¶è¿™äº›è§‚å¯Ÿè€…æ˜¯<code>å…±äº«</code>è¿™ä¸€ä¸ªè¾“å…¥æ¡†çš„ï¼›</li>
<li>å‰©ä¸‹ä¸‰æ¡éƒ½å’Œä¸Šé¢ä¸€æ ·ã€‚</li>
</ol>
<p>ä¸€å¥è¯æ€»ç»“å°±æ˜¯ï¼Œè¿™æ˜¯ä¸€ä¸ªåªèƒ½åœ¨ä¸»çº¿ç¨‹å‘é€äº‹ä»¶çš„<code>Observable</code>å’Œä¸€ä¸ªåªèƒ½åœ¨ä¸»çº¿ç¨‹è®¢é˜…äº‹ä»¶çš„<code>Observer</code>çš„è”åˆä½“ã€‚</p>
<h3 id="UIBindingObserver"><a href="#UIBindingObserver" class="headerlink" title="UIBindingObserver"></a>UIBindingObserver</h3><p>ä¾ç„¶é¦–å…ˆçœ‹å®šä¹‰ï¼š</p>
<pre><code>class UIBindingObserver&lt;UIElementType, Value&gt; : ObserverType where UIElementType: AnyObject
</code></pre><p>äºæ˜¯æˆ‘ä»¬å‘ç°é¦–å…ˆ<code>UIBindingObserver</code>æ˜¯ä¸€ä¸ªç±»ï¼Œç„¶åå½’æ ¹ç»“åº•å®ç°äº†<code>ObserverType</code>åè®®ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒæ˜¯ä¸€ä¸ªè§‚å¯Ÿè€…ï¼Œå³<code>Observer</code>ã€‚</p>
<p>ç„¶åå®ƒæœ‰ä»¥ä¸‹è¿™äº›è§„åˆ™æˆ–è€…è¯´é™åˆ¶ï¼š</p>
<pre><code>* can&apos;t bind errors 
 * ensures binding is performed on main thread
</code></pre><p>æ‹¿åˆšæ‰çš„æ ‡ç­¾ä¸¾ä¾‹å­ï¼Œä¸€ä¸ªæ ‡ç­¾çš„<code>text</code>å€¼æ˜¯ä¸€ä¸ª<code>UIBindingObserver</code>çš„å®ä¾‹ï¼Œé‚£ä¹ˆï¼š</p>
<ol>
<li>å› ä¸ºæ ‡ç­¾çš„<code>text</code>å±æ€§å¯¹åº”çš„åªèƒ½æ˜¯æœ‰æ•ˆçš„å­—ç¬¦ä¸²ï¼Œé‚£ä¹ˆå¦‚æœç»‘å®šä¸€ä¸ªä¼šå‘é€é”™è¯¯äº‹ä»¶çš„<code>Observable</code>ï¼Œæ¥æ”¶åˆ°é”™è¯¯äº‹ä»¶æ—¶æ— æ³•å¤„ç†äº†ï¼›</li>
<li>æ—¢ç„¶æ˜¯æ ‡ç­¾å°±å±äºUIKitåº“ï¼Œä¹Ÿå°±è¢«é™åˆ¶ä½åªèƒ½åœ¨ä¸»çº¿ç¨‹æ“ä½œï¼Œæ—¢ç„¶åªèƒ½åœ¨ä¸»çº¿ç¨‹æ¥æ”¶å€¼ï¼Œé‚£ä¹ˆä¹Ÿå°±é™åˆ¶äº†åªèƒ½åœ¨ä¸»çº¿ç¨‹ç»‘å®šå€¼ã€‚</li>
</ol>
<p>ä¸€å¥è¯æ€»ç»“å°±æ˜¯ï¼Œè¿™æ˜¯ä¸€ä¸ªåªèƒ½åœ¨ä¸»çº¿ç¨‹è¿›è¡Œç»‘å®šçš„<code>Observer</code>ã€‚</p>
<p>æ‰€è°“æºç é¢å‰æ²¡æœ‰ç§˜å¯†ï¼Œåˆæ­¥äº†è§£äº†è¿™ä¸‰ä¸ªåŸºæœ¬æ¦‚å¿µä¹‹åå†å›è¿‡å¤´å»çœ‹ä¸Šé¢çš„ä¾‹å­å°±ä¼šè±ç„¶å¼€æœ—ã€‚ç»‘å®šå…¶å®ä¹Ÿä¸è¿‡å°±æ˜¯ä¸€ä¸ª<code>Observable</code>å»è°ƒç”¨ç»‘å®šå‡½æ•°ï¼Œå‡½æ•°ä¸­ä¼ å…¥å¦ä¸€ä¸ª<code>Observer</code>è€Œå·²ã€‚<code>number1.rx.text</code> ä½œä¸ºä¸€ä¸ª<code>Observable</code>å½“ç„¶å¯ä»¥å»è°ƒç”¨<code>bind</code>å‡½æ•°ï¼Œè€Œ<code>number2.rx.text</code>å’Œ<code>label.rx.text</code>ä½œä¸ºä¸€ä¸ª<code>Observer</code>å½“ç„¶ä¹Ÿå¯ä»¥ä½œä¸ºå‚æ•°ä¼ åˆ°<code>bind</code>å‡½æ•°ä¸­ã€‚</p>
<p>é¡ºä¾¿æä¸€å¥ï¼ŒUIBindingObserverè¿˜å¯ä»¥è‡ªæ‹“å±•ä»¥æ›´å¥½çš„æ»¡è¶³å®é™…å¼€å‘ä¸­çš„éœ€æ±‚ã€‚</p>
<p>æ€ä¹ˆåšå‘¢ï¼Œå‚è€ƒå·²ç»å®ç°å¥½äº†çš„å‘€ï¼Œæ¯”å¦‚åˆšæ‰çš„<code>label.rx.text</code>æ˜¯è¿™æ ·å®ç°çš„ï¼š</p>
<pre><code>extension Reactive where Base: UILabel {

    /// Bindable sink for `text` property.
    public var text: UIBindingObserver&lt;Base, String?&gt; {
        return UIBindingObserver(UIElement: self.base) { label, text in
            label.text = text
        }
    }

}
</code></pre><p>äºæ˜¯ä¹ä»¿ç…§ä¸€ä¸ªï¼š</p>
<pre><code>extension ValidationResult: CustomStringConvertible {
    public var description: String {
        switch self {
        case .empty:
            return &quot;&quot;
        case let .ok(message):
                return message
           case let .failed(message):
                return message
            }
        }
}

extension ValidationResult {
    var textColor: UIColor {
            switch self {
            case .empty:
            return UIColor.yellow
        case .ok:
            return UIColor.green
        case .failed:
            return UIColor.red
            }
    }
}

extension Reactive where Base: UILabel {
    var validationResult: UIBindingObserver&lt;Base, ValidationResult&gt; {
        return UIBindingObserver(UIElement: base) { label, result in
            label.text = result.description
            label.textColor = result.textColor
        }
    }
}
</code></pre><p>é€šè¿‡ä½¿ç”¨è¿™ä¸ªæ‹“å±•ï¼Œå¯ä»¥åšåˆ°åŒæ—¶ä¿®æ”¹æ ‡ç­¾çš„å†…å®¹åŠé¢œè‰²ã€‚</p>
<h2 id="Driver"><a href="#Driver" class="headerlink" title="Driver"></a>Driver</h2><p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œå¯¹RxSwiftä¹Ÿä»‹ç»äº†ä¸å°‘å†…å®¹äº†ï¼Œä½†æ˜¯æœ€æ ¸å¿ƒçš„å…¶å®å°±æ˜¯å››ä¸ªæ¦‚å¿µï¼Œä¸¤ä¸ªåè¯ï¼š<code>è¢«è§‚å¯Ÿè€…</code>ï¼ˆ<code>Observable</code>ï¼‰å’Œ<code>è§‚å¯Ÿè€…</code>ï¼ˆ<code>Observer</code>ï¼‰ï¼›ä¸¤ä¸ªåŠ¨è¯ï¼š<code>è®¢é˜…</code>ï¼ˆ<code>subscribe</code>ï¼‰å’Œ<code>ç»‘å®š</code>ï¼ˆ<code>bind</code>ï¼‰ã€‚æ¥ä¸‹æ¥ç»ˆäºè¦è½®åˆ°ç¬¬äº”ä¸ªä¹Ÿæ˜¯æœ€åä¸€ä¸ªäº†ï¼Œå®ƒå°±æ˜¯ â€“ <code>é©±åŠ¨</code>ï¼ˆ<code>drive</code>ï¼‰ã€‚</p>
<p>äº‹å®ä¸Šï¼Œå®ƒæ˜¯ä¸“ä¸ºUIå±‚ç»‘å®šæ–¹ä¾¿è€Œåˆ›é€ å‡ºçš„ä¸€ä¸ªæ¦‚å¿µï¼Œä¹Ÿå°±æ˜¯è¯´å½“åœ¨UIå±‚åšç»‘å®šæ—¶å®ƒå¹¶ä¸æ˜¯å¿…é¡»çš„ï¼Œä½†æ˜¯åº”ç”¨å®ƒä¼šä½¿å¾—äº‹æƒ…æ›´åŠ ç®€å•ã€‚</p>
<h3 id="UIå±‚çš„è®¢é˜…å’Œç»‘å®š"><a href="#UIå±‚çš„è®¢é˜…å’Œç»‘å®š" class="headerlink" title="UIå±‚çš„è®¢é˜…å’Œç»‘å®š"></a>UIå±‚çš„è®¢é˜…å’Œç»‘å®š</h3><p>æ—¢ç„¶è¯´åˆ°UIå±‚ï¼Œç‰¹æ„è¯´æ˜ä¸€ä¸‹ï¼šåœ¨UIå±‚åšç»‘å®šæ‰€ä½¿ç”¨çš„<code>Observable</code>å…¶å®æ˜¯å¿…é¡»è¦æ»¡è¶³äºä»¥ä¸‹ä¸‰ä¸ªæ¡ä»¶çš„ã€‚</p>
<h4 id="ä¸»çº¿ç¨‹"><a href="#ä¸»çº¿ç¨‹" class="headerlink" title="ä¸»çº¿ç¨‹"></a>ä¸»çº¿ç¨‹</h4><p>æ‰€æœ‰ç³»ç»Ÿæä¾›çš„UIæ§ä»¶å…¨éƒ¨åœ¨UIKitæ¡†æ¶ä¸­ï¼Œè€Œè¿™ä¸ªæ¡†æ¶åªèƒ½åœ¨ä¸»çº¿ç¨‹ä¸­è¢«ä½¿ç”¨ï¼Œå¦åˆ™ä¸çŸ¥é“ä¼šå‘ç”Ÿä»€ä¹ˆã€‚å½“ç„¶è¿™ä¸€ç‚¹ä½ è‚¯å®šæ˜¯çŸ¥é“çš„ï¼Œé‚£ä¹ˆç›¸å¯¹åº”çš„åœ¨ä¸»çº¿ç¨‹ä¸­ç»‘å®šä½¿ç”¨çš„<code>Observable</code>ä¹Ÿå°±åªèƒ½åœ¨ä¸»çº¿ç¨‹ä¸­å‘é€æ•°æ®ï¼Œæ‰€ä»¥é€šå¸¸ä¹Ÿå°±ä¼šè°ƒç”¨ä¸€ä¸‹æ“ä½œç¬¦ï¼š<code>observeOn()</code>ï¼Œç„¶åä¼ å…¥<code>MainScheduler.instance</code>ã€‚</p>
<h4 id="é”™è¯¯å¤„ç†"><a href="#é”™è¯¯å¤„ç†" class="headerlink" title="é”™è¯¯å¤„ç†"></a>é”™è¯¯å¤„ç†</h4><p>ä¸Šä¸€å°èŠ‚ä»‹ç»çš„ä¸‰ä¸ªæ¦‚å¿µæœ‰å¾ˆå¤šç›¸åŒä¹‹å¤„ï¼Œå…¶ä¸­ä¸€ä¸ªå°±æ˜¯<code>can&#39;t error</code>ã€‚å› ä¸ºæ— è®ºæ˜¯ä¸€ä¸ª<code>UITextField</code>è¿˜æ˜¯ä¸€ä¸ª<code>UILabel</code>éƒ½æ— æ³•æ¥æ”¶å¤„ç†é”™è¯¯ï¼Œæ‰€ä»¥é€šå¸¸ä¹Ÿå°±ä¼šè°ƒç”¨ä¸€ä¸‹æ“ä½œç¬¦ï¼š<code>catchErrorJustReturn()</code>ç„¶åä¼ å…¥ä¸€ä¸ªå½“é”™è¯¯å‘ç”Ÿæ—¶è¦ä¼ é€’çš„å€¼ã€‚</p>
<h4 id="å…±äº«ç»™å¤šä¸ªè®¢é˜…è€…"><a href="#å…±äº«ç»™å¤šä¸ªè®¢é˜…è€…" class="headerlink" title="å…±äº«ç»™å¤šä¸ªè®¢é˜…è€…"></a>å…±äº«ç»™å¤šä¸ªè®¢é˜…è€…</h4><p>é€šå¸¸åœ¨UIå±‚éƒ½ä¼šå¤šä¸ª<code>Observer</code>å…±äº«åŒä¸€ä¸ª<code>Observable</code>ï¼Œæ¯”å¦‚å½“å¤šä¸ªUIæ§ä»¶çš„æ•°æ®æ¥æºäºåŒä¸€ä¸ªç½‘ç»œè¯·æ±‚çš„ç»“æœæ—¶ï¼Œä½ è‚¯å®šä¸å¸Œæœ›æ­¤è¯·æ±‚å‘ç”Ÿå¤šæ¬¡ï¼Œæ‰€ä»¥é€šå¸¸ä¹Ÿå°±ä¼šè°ƒç”¨ä¸€ä¸‹æ“ä½œç¬¦ï¼š<br><code>shareReplay()</code>ï¼Œä¸€èˆ¬éƒ½ä¼šä¼ å…¥<code>1</code>ã€‚</p>
<h3 id="å®ä¾‹"><a href="#å®ä¾‹" class="headerlink" title="å®ä¾‹"></a>å®ä¾‹</h3><p>ä¸‹é¢æ¥çœ‹ä¸€ä¸ªå®ä¾‹ï¼Œé¦–å…ˆå®šä¹‰å‡ ä¸ªå˜é‡ä¾›ä¸‹é¢ä½¿ç”¨ï¼š</p>
<pre><code>@IBOutlet weak var searchText: UITextField!
@IBOutlet weak var resultCount: UILabel!
@IBOutlet weak var resultsTableView: UITableView!
let disposeBag = DisposeBag()
</code></pre><p>æœ€åˆå§‹ç‰ˆæœ¬ï¼š</p>
<pre><code>let results = searchText.rx.text
    .throttle(0.3, scheduler: MainScheduler.instance)
    .distinctUntilChanged()
    .flatMapLatest { query in
        API.getSearchResults(query) 
    }

results
    .map { &quot;\($0.count)&quot; }
    .bind(to: resultCount.rx.text)
    .addDisposableTo(disposeBag)

results
    .bind(to: resultsTableView.rx.items(cellIdentifier: &quot;Cell&quot;)) { (_, result, cell) in
        cell.textLabel?.text = &quot;\(result)&quot;
    }
    .addDisposableTo(disposeBag)
</code></pre><p>å¾ˆç®€å•ï¼Œæ ¹æ®è¾“å…¥å†…å®¹è§¦å‘ä¸€ä¸ªæœç´¢è¯·æ±‚ï¼Œå°†ç»“æœç»‘å®šåˆ°ä¸¤ä¸ªUIæ§ä»¶ä¸Šã€‚</p>
<p>é¡ºä¾¿è¯´ä¸‹ï¼š<code>throttle</code>æ“ä½œç¬¦å¯ä»¥æ§åˆ¶å½“è¾“å…¥æ¡†<code>searchText</code>ä¸­çš„å†…å®¹è¶…è¿‡0.3sæ— å˜åŒ–åå†å¾€ä¸‹ç»§ç»­ï¼Œé¿å…ç”¨æˆ·è¿˜åœ¨å¿«é€Ÿè¾“å…¥æ—¶å°±è§¦å‘ä¸‹é¢çš„ç½‘ç»œè¯·æ±‚ï¼›</p>
<p>é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œä¸Šé¢ä»£ç æœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ</p>
<p>ç­”æ¡ˆä¸€ç›®äº†ç„¶ï¼Œä¸Šé¢è¯´çš„ä¸‰ä¸ªæ¡ä»¶éƒ½æ²¡æ»¡è¶³ï¼šéä¸»çº¿ç¨‹å¯¹UIæ§ä»¶èµ‹å€¼ä¸å®‰å…¨ï¼›è¯·æ±‚é”™è¯¯ä¹‹åæ— æ³•è¯†åˆ«ï¼›ç½‘ç»œè¯·æ±‚å‘ç”Ÿä¸¤æ¬¡ã€‚</p>
<p>æ€ä¹ˆè§£å†³å‘¢ï¼Ÿ</p>
<p>æ”¹è¿›åç‰ˆæœ¬ï¼š</p>
<pre><code>let results = searchText.rx.text
    .throttle(0.3, MainScheduler.instance) 
    .distinctUntilChanged()
    .flatMapLatest { query in
          API.getSearchResults(query)
            .observeOn(MainScheduler.instance) // 1
          .catchErrorJustReturn([]) // 2
    }
    .shareReplay(1) // 3  

results
    .map { &quot;\($0.count)&quot; }
    .bind(to: resultCount.rx.text) 
    .disposed(by: disposeBag)

results
    .bind(to: resultsTableView.rx.items(cellIdentifier: &quot;Cell&quot;)) { (_, result, cell) in  
        cell.textLabel?.text = &quot;\(result)&quot;
    }
    .disposed(by: disposeBag)
</code></pre><p>å®Œå…¨è§£å†³äº†ä¸Šé¢ä»£ç ä¸­å­˜åœ¨çš„é—®é¢˜ï¼Œä¸‰ä¸ªæ¡ä»¶éƒ½æ»¡è¶³ï¼š</p>
<ol>
<li>åº”ç”¨<code>observeOn()</code>æ“ä½œç¬¦ä½¿å¾—ä¹‹åä¼šåœ¨ä¸»çº¿ç¨‹å‘é€æ•°æ®ï¼›</li>
<li>åº”ç”¨<code>catchErrorJustReturn()</code>æ“ä½œç¬¦ä½¿å¾—é‡åˆ°é”™è¯¯æ—¶ä¼šè¿”å›ä¸€ä¸ªç©ºæ•°ç»„ï¼›</li>
<li>åº”ç”¨<code>shareReplay()</code>æ“ä½œç¬¦å…±äº«ç½‘ç»œè¯·æ±‚å¾—åˆ°çš„æ•°æ®ï¼›</li>
</ol>
<p>é‚£ä¹ˆé—®é¢˜åˆæ¥äº†ï¼Œä¸Šé¢ä»£ç æœ‰ä»€ä¹ˆé—®é¢˜ï¼ˆæˆ–è€…ç¼ºé™·ï¼‰ï¼Ÿ</p>
<p>ç­”æ¡ˆæ˜¯ç¨å¾®æœ‰ç‚¹éº»çƒ¦ã€‚å› ä¸ºå¯ä»¥æƒ³åƒè¿™ä¸‰ä¸ªæ“ä½œç¬¦ä¼šå¤§é‡é‡å¤ä½¿ç”¨ã€‚</p>
<p>é‚£ä¹ˆæœ‰æ²¡æœ‰æ›´å¥½çš„æ–¹å¼å‘¢ï¼Ÿ</p>
<p>ç­”æ¡ˆå½“ç„¶æ˜¯è‚¯å®šçš„ï¼Œä¹Ÿå°±æ˜¯åº”ç”¨æœ¬å°èŠ‚çš„ä¸»è§’-<code>drive</code>ã€‚</p>
<p>ä¼˜ç§€çš„ç‰ˆæœ¬ï¼š</p>
<pre><code>let results = searchText.rx.text.asDriver() 
    .throttle(0.3, scheduler: MainScheduler.instance)
    .distinctUntilChanged()
    .flatMapLatest { query in
         API.getSearchResults(query)
            .asDriver(onErrorJustReturn: []) 
    }

results
    .map { &quot;\($0.count)&quot; }
    .drive(resultCount.rx.text)               
    .disposed(by: disposeBag)                                                            

results
    .drive(resultsTableView.rx.items(cellIdentifier: &quot;Cell&quot;)) { (_, result, cell) in  
        cell.textLabel?.text = &quot;\(result)&quot;
    }
    .disposed(by: disposeBag)
</code></pre><p>ç¨å¾®è§£é‡Šä¸€ä¸‹å‡ å¤„ä¸åŒçš„åœ°æ–¹ï¼š</p>
<ol>
<li>åº”ç”¨<code>asDriver()</code>æ“ä½œç¬¦å°†<code>ControlProperty</code>è½¬æ¢æˆä¸€ä¸ª<code>Driver</code>ï¼Œåº”ç”¨<code>asDriver(onErrorJustReturn: [])</code>ä½¿å¾—è¯·æ±‚ç»“æœé€šè¿‡ä¸€ä¸ª<code>Driver</code>å‘é€å‡ºå»ï¼›</li>
<li>åœ¨åŸæ¥åº”ç”¨<code>bind</code>æ“ä½œç¬¦çš„åœ°æ–¹å…¨æ¢æˆ<code>drive</code>æ“ä½œç¬¦ï¼Œå‚æ•°ä¸å˜ã€‚</li>
</ol>
<p>é€šè¿‡è¿™æ ·å°å°çš„è°ƒæ•´ï¼Œæ–°çš„<code>results</code>å°±è‡ªåŠ¨æ»¡è¶³äº†ä¸Šé¢è¯´çš„ä¸‰ä¸ªæ¡ä»¶ï¼Œå®Œç¾è§£å†³äº†æœ€åˆçš„é—®é¢˜ï¼š</p>
<ul>
<li>ä¸å‘é€é”™è¯¯äº‹ä»¶</li>
<li>åœ¨ä¸»çº¿ç¨‹å‘é€æ•°æ®</li>
<li>å…±äº«äº‹ä»¶æµï¼ˆæ³¨æ„å…¶å®æ˜¯<code>shareReplayLatestWhileConnected()</code>ï¼‰</li>
</ul>
<p>å¯ä»¥æƒ³è±¡ï¼Œ<code>asDriver(onErrorJustReturn: [])</code>å†…éƒ¨å®ç°å¤§æ¦‚æ˜¯è¿™æ ·ï¼š</p>
<pre><code>let safeObservable = xs
      .observeOn(MainScheduler.instance)       // observe events on main scheduler
      .catchErrorJustReturn(onErrorJustReturn) // can&apos;t error out
      .shareReplayLatestWhileConnected()       // side effects sharing
return Driver(raw: safeObservable)           // wrap it up
</code></pre><p>æ€»ç»“ä¸€ä¸‹ï¼šå‡¡æ˜¯åœ¨UIå±‚åšç»‘å®šçš„åœ°æ–¹å°†<code>bind</code>å…¨éƒ¨æ¢æˆ<code>drive</code>æ“ä½œç¬¦æ²¡æ¯›ç—…ã€‚</p>
<p>æœ€åå†çœ‹ä¸€çœ¼æœ€å¼€å§‹å‡ºç°è¿‡çš„å›¾ç‰‡ã€‚</p>
<p><img src="http://ocepn6hgq.bkt.clouddn.com/RxSwift-from-zero-to-one-second-lesson.png" alt="1"></p>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/RxSwift/" rel="tag">#RxSwift</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/04/21/RxSwift-from-zero-to-one-first-lesson/" rel="next" title="RxSwiftåŸºæœ¬æ¦‚å¿µä¸ä½¿ç”¨">
                <i class="fa fa-chevron-left"></i> RxSwiftåŸºæœ¬æ¦‚å¿µä¸ä½¿ç”¨
              </a>
            
          </div>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2017/09/19/ReactiveObjC-from-zero-to-one-first-lesson/" rel="prev" title="ReactiveObjCåŸºæœ¬æ¦‚å¿µä¸ç®€å•ä½¿ç”¨">
                ReactiveObjCåŸºæœ¬æ¦‚å¿µä¸ç®€å•ä½¿ç”¨ <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div class="ds-thread" data-thread-key="2017/05/27/RxSwift-from-zero-to-one-second-lesson/"
           data-title="RxSwiftè¿›é˜¶ï¼Œç»†èŠ‚ä¸UIç»‘å®š" data-url="http://yoursite.com/2017/05/27/RxSwift-from-zero-to-one-second-lesson/">
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            æ–‡ç« ç›®å½•
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            ç«™ç‚¹æ¦‚è§ˆ
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.jpg"
               alt="Kaisa" />
          <p class="site-author-name" itemprop="name">Kaisa</p>
          <p class="site-description motion-element" itemprop="description">å¿ƒè‹¥ä¸è€ï¼Œä»æ˜¯å°‘å¹´</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">18</span>
              <span class="site-state-item-name">æ—¥å¿—</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">4</span>
                <span class="site-state-item-name">åˆ†ç±»</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">11</span>
                <span class="site-state-item-name">æ ‡ç­¾</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/kaisayoung" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
          
        </div>

        
        

        
        

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">
            
              
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#å¤šçº¿ç¨‹"><span class="nav-number">1.</span> <span class="nav-text">å¤šçº¿ç¨‹</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Cold-amp-Hot"><span class="nav-number">2.</span> <span class="nav-text">Cold & Hot</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#shareReplay"><span class="nav-number">2.1.</span> <span class="nav-text">shareReplay</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#shareReplayLatestWhileConnected"><span class="nav-number">2.2.</span> <span class="nav-text">shareReplayLatestWhileConnected</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#è‡ªå®šä¹‰operator"><span class="nav-number">3.</span> <span class="nav-text">è‡ªå®šä¹‰operator</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#å¤§ä¸€ç»Ÿ"><span class="nav-number">4.</span> <span class="nav-text">å¤§ä¸€ç»Ÿ</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#KVO"><span class="nav-number">4.1.</span> <span class="nav-text">KVO</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#rx-observe"><span class="nav-number">4.1.1.</span> <span class="nav-text">rx.observe</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#rx-observeWeakly"><span class="nav-number">4.1.2.</span> <span class="nav-text">rx.observeWeakly</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Notification"><span class="nav-number">4.2.</span> <span class="nav-text">Notification</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Target-Action"><span class="nav-number">4.3.</span> <span class="nav-text">Target-Action</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Delegate"><span class="nav-number">4.4.</span> <span class="nav-text">Delegate</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ç»‘å®š"><span class="nav-number">5.</span> <span class="nav-text">ç»‘å®š</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#ControlEvent"><span class="nav-number">5.1.</span> <span class="nav-text">ControlEvent</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ControlProperty"><span class="nav-number">5.2.</span> <span class="nav-text">ControlProperty</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#UIBindingObserver"><span class="nav-number">5.3.</span> <span class="nav-text">UIBindingObserver</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Driver"><span class="nav-number">6.</span> <span class="nav-text">Driver</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#UIå±‚çš„è®¢é˜…å’Œç»‘å®š"><span class="nav-number">6.1.</span> <span class="nav-text">UIå±‚çš„è®¢é˜…å’Œç»‘å®š</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#ä¸»çº¿ç¨‹"><span class="nav-number">6.1.1.</span> <span class="nav-text">ä¸»çº¿ç¨‹</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#é”™è¯¯å¤„ç†"><span class="nav-number">6.1.2.</span> <span class="nav-text">é”™è¯¯å¤„ç†</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#å…±äº«ç»™å¤šä¸ªè®¢é˜…è€…"><span class="nav-number">6.1.3.</span> <span class="nav-text">å…±äº«ç»™å¤šä¸ªè®¢é˜…è€…</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#å®ä¾‹"><span class="nav-number">6.2.</span> <span class="nav-text">å®ä¾‹</span></a></li></ol></li></ol></div>
            
          </div>
        </section>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Kaisa</span>
</div>

<div class="powered-by">
  ç”± <a class="theme-link" href="https://hexo.io">Hexo</a> å¼ºåŠ›é©±åŠ¨
</div>

<div class="theme-info">
  ä¸»é¢˜ -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.0.1"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.0.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.0.1"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"kaisayoung"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
    <script src="/vendors/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
    <script src="/js/src/hook-duoshuo.js"></script>
  






  
  

  

  

  

</body>
</html>
